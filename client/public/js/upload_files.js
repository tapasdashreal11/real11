"use strict";function upload_compeltely(){var a=Number(list_of_uploaded_images.length)+Number(cancelledAmount);return a==Number(filesAmount)&&void setTimeout(function(){$("#modal-upload-images").fadeOut(),$("#list-of-uploaded-images").html(""),$("#number-of-uploaded-images").text(""),$("#number-of-cancelled-images").text(""),toastr&&toastr.success("Upload completely")},1e3)}function get_size_container(){var a=screen.width;a<500?(container_width=.8*a,modal_margin_left=10):(container_width=.5*a,modal_margin_left=20),container_height=9*container_width/16}function init_upload_modal(){var a='\n        <div class="row col-xs-12 col-sm-12 col-md-12" style="display: none;">\n            <input type="file" id="amazon-upload-images" '+(window.$amazon.multiple?"multiple":"")+'>\n        </div>\n        <div id="modal-upload-images" style="position: fixed; display: none; width: 100%; height: 100%; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); z-index: 9999;cursor: pointer;overflow-y: auto;">\n            <div \n                style="\n                        background-color: white;\n                        margin-top: 5%; \n                        margin-left: '+modal_margin_left+"%; \n                        margin-bottom: 5%; \n                        width: "+(100-2*modal_margin_left)+'%; \n                        padding: 10px;\n                        border-radius: 25px;\n                        box-shadow: 0 19px 38px rgba(0,0,0,0.30), 0 15px 12px rgba(0,0,0,0.22);\n                    "\n                class="center-block">\n                <div class="form-row form-group">\n                    <p class="h3" id="number-of-uploaded-images" style="font-weight: bold; color: green ;display: inline-block; margin-top: 35px; margin-left: 20px;"></p>\n                    <p class="h3" id="number-of-cancelled-images" style="font-weight: bold; color: red ;display: inline-block; margin-top: 35px; margin-left: 20px;"></p>\n                    <p class="h3 float-right" id="close-upload-modal" style="margin-right: 5%; color: red; display: inline-block"><i class="fa fa-times fa-2x" aria-hidden="true"></i></p>\n                </div>\n                <div id="list-of-uploaded-images">\n\n                </div>\n            </div>\n        </div>\n    ';$("body").append(a),$("#close-upload-modal").on("click",function(){swal({title:"Are you sure to cancel to upload all images?",html:!0,text:"This action only cancel the images that aren't uploaded.",type:"warning",showCancelButton:!0,confirmButtonText:"Ok",confirmButtonColor:"#3cb371",cancelButtonText:"No",closeOnCancel:!0},function(a){a&&($("#list-of-uploaded-images").html(""),$("#number-of-uploaded-images").text(""),$("#number-of-cancelled-images").text(""),$("#modal-upload-images").hide())})})}var cropper={},container_width,container_height,modal_margin_left,list_of_uploaded_images=[],cancelledAmount=0,filesAmount=0;window.$amazon={input:"#amazon-upload-images",multiple:!0,frame:16/9,type:"",urls:[],callback:{}},$(document).ready(function(){get_size_container(),init_upload_modal(),$("#amazon-upload-images").on("click",function(){window.$amazon.multiple||$("#amazon-upload-images").removeAttr("multiple")}),$("#amazon-upload-images").on("change",function(){cropper={},list_of_uploaded_images=[],cancelledAmount=0,filesAmount=0,window.$amazon.multiple||$("#amazon-upload-images").removeAttr("multiple"),upload_images(this)}),$("#modal-upload-images").on("click",".submit-image",function(){$(this).prop("disabled",!0),$(this).text("Uploading...");var a=$(this).data("key");upload_images_to_amazons3(a).then(function(a){window.$amazon.callback[$amazon.type]()})}),$("#modal-upload-images").on("click",".cancel-image",function(){var a=$(this).data("key");$("#image-"+a).remove(),cancelledAmount++,$("#number-of-cancelled-images").text("Cancelled: "+cancelledAmount+"/"+filesAmount),upload_compeltely()})});var upload_images_to_amazons3=function(a){return new Promise(function(e,o){var n=cropper[a].getCroppedCanvas().toDataURL("image/jpeg"),t={images:[n]};$.ajax({url:"/upload-images-to-amazons3",method:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(t)}).then(function(o){window.$amazon.urls=o.data,list_of_uploaded_images=list_of_uploaded_images.concat(o.data),$("#number-of-uploaded-images").text("Uploaded: "+list_of_uploaded_images.length+"/"+filesAmount);var t='\n                <img src="'+n+'" style="width: 100px !important; display:inline-block;margin-left: 10%">\n                <p class="h4" style="display:inline-block; color: green;"><i class="fa fa-check fa-2x" aria-hidden="true"></i></p>\n            ';return $("#image-"+a).html(t),upload_compeltely(),e(o.data)})["catch"](function(a){return o(a)})})},upload_images=function(a){if(!a.files)return!1;filesAmount=a.files.length;for(var e=function(){var e=new FileReader;e.onload=function(){var a=document.createElement("canvas"),o=a.getContext("2d"),n=new Image;n.onload=function(){n.width<n.height?(a.width=480,a.height=720):(a.width=720,a.height=480),o.clearRect(0,0,a.width,a.height),o.drawImage(n,0,0,a.width,a.height);var e=a.toDataURL("image/jpeg",1),t=Math.random().toString(36).substring(2),i='\n                            <div class="form-row" id="image-'+t+'" style="padding-top: 20px; padding-bottom: 20px;border-top: 5px solid grey;">\n                                <div class="form-row col-xs-12 col-sm-12 col-md-12">\n                                    <div style="width: '+container_width+"px; height: "+container_height+'px; margin: auto;" >\n                                        <img id="upload-image-'+t+'" style="width: 100%;" src="'+e+'">\n                                    <div>\n                                </div>\n                                <div class="form-row col-xs-12 col-sm-12 col-md-12" style="padding-top: 20px">\n                                    <div class="col-xs-6 col-sm-6 col-md-6">\n                                        <button type="button" class="btn btn-danger cancel-image" data-key="'+t+'" style="display: inline-block">Cancel</button>\n                                    </div>\n                                    <div class="col-xs-6 col-sm-6 col-md-6">\n                                        <button type="button" class="btn btn-success float-right submit-image" data-key="'+t+'" style="display: inline-block">Submit</button>\n                                    </div>\n                                </div>\n                            </div>\n                    ';$("#list-of-uploaded-images").append(i);var l=$("#list-of-uploaded-images").find("#upload-image-"+t);crop_photo(l,t)},n.src=e.result},e.readAsDataURL(a.files[o])},o=0;o<filesAmount;o++)e();$("#modal-upload-images").fadeIn()},crop_photo=function(a,e){a.cropper({aspectRatio:window.$amazon.frame||16/9,minContainerWidth:container_width,minContainerHeight:container_height,background:!1,crop:function(a){}}),cropper[e]=a.data("cropper")};
//# sourceMappingURL=upload_files.js.map
