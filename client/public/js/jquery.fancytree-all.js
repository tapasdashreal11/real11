"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t,n,i){function r(t,n){t||(n=n?": "+n:"",e.error("Fancytree assertion failed"+n))}function o(e,n){var i,r,o=t.console?t.console[e]:null;if(o)try{o.apply(t.console,n)}catch(s){for(r="",i=0;i<n.length;i++)r+=n[i];o(r)}}function s(e){return!(!e.tree||e.statusNodeType===i)}function a(t,n,i,r){var o,s,a,l=e.map(e.trim(t).split("."),function(e){return parseInt(e,10)}),d=e.map(Array.prototype.slice.call(arguments,1),function(e){return parseInt(e,10)});for(o=0;o<d.length;o++)if(s=l[o]||0,a=d[o]||0,s!==a)return s>a;return!0}function l(e,t,n,i,r){var o=function(){var n=t[e],o=i[e],s=t.ext[r],a=function(){return n.apply(t,arguments)},l=function(e){return n.apply(t,e)};return function(){var e=t._local,n=t._super,i=t._superApply;try{return t._local=s,t._super=a,t._superApply=l,o.apply(t,arguments)}finally{t._local=e,t._super=n,t._superApply=i}}}();return o}function d(t,n,i,r){for(var o in i)"function"==typeof i[o]?"function"==typeof t[o]?t[o]=l(o,t,n,i,r):"_"===o.charAt(0)?t.ext[r][o]=l(o,t,n,i,r):e.error("Could not override tree."+o+". Use prefix '_' to create tree."+r+"._"+o):"options"!==o&&(t.ext[r][o]=i[o])}function c(t,n){return t===i?e.Deferred(function(){this.resolve()}).promise():e.Deferred(function(){this.resolveWith(t,n)}).promise()}function u(t,n){return t===i?e.Deferred(function(){this.reject()}).promise():e.Deferred(function(){this.rejectWith(t,n)}).promise()}function h(e,t){return function(){e.resolveWith(t)}}function p(t){var n=e.extend({},t.data()),i=n.json;return delete n.fancytree,delete n.uiFancytree,i&&(delete n.json,n=e.extend(n,i)),n}function f(e){return(""+e).replace(_,function(e){return S[e]})}function g(e){return e=e.toLowerCase(),function(t){return t.title.toLowerCase().indexOf(e)>=0}}function y(e){var t=new RegExp("^"+e,"i");return function(e){return t.test(e.title)}}function v(t,n){var i,o,s,a;for(this.parent=t,this.tree=t.tree,this.ul=null,this.li=null,this.statusNodeType=null,this._isLoading=!1,this._error=null,this.data={},i=0,o=P.length;i<o;i++)s=P[i],this[s]=n[s];n.data&&e.extend(this.data,n.data);for(s in n)L[s]||e.isFunction(n[s])||D[s]||(this.data[s]=n[s]);null==this.key?this.tree.options.defaultKey?(this.key=this.tree.options.defaultKey(this),r(this.key,"defaultKey() must return a unique key")):this.key="_"+C._nextNodeKey++:this.key=""+this.key,n.active&&(r(null===this.tree.activeNode,"only one active node allowed"),this.tree.activeNode=this),n.selected&&(this.tree.lastSelectedNode=this),a=n.children,a?a.length?this._setChildren(a):this.children=this.lazy?[]:null:this.children=null,this.tree._callHook("treeRegisterNode",this.tree,!0,this)}function m(t){this.widget=t,this.$div=t.element,this.options=t.options,this.options&&(e.isFunction(this.options.lazyload)&&!e.isFunction(this.options.lazyLoad)&&(this.options.lazyLoad=function(){return C.warn("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead."),t.options.lazyload.apply(this,arguments)}),e.isFunction(this.options.loaderror)&&e.error("The 'loaderror' event was renamed since 2014-07-03. Use 'loadError' (with uppercase E) instead."),this.options.fx!==i&&C.warn("The 'fx' options was replaced by 'toggleEffect' since 2014-11-30.")),this.ext={},this.data=p(this.$div),this._id=e.ui.fancytree._nextId++,this._ns=".fancytree-"+this._id,this.activeNode=null,this.focusNode=null,this._hasFocus=null,this.lastSelectedNode=null,this.systemFocusElement=null,this.lastQuicksearchTerm="",this.lastQuicksearchTime=0,this.statusClassPropName="span",this.ariaPropName="li",this.nodeContainerAttrName="li",this.$div.find(">ul.fancytree-container").remove();var n,r={tree:this};this.rootNode=new v(r,{title:"root",key:"root_"+this._id,children:null,expanded:!0}),this.rootNode.parent=null,n=e("<ul>",{"class":"ui-fancytree fancytree-container fancytree-plain"}).appendTo(this.$div),this.$container=n,this.rootNode.ul=n[0],null==this.options.debugLevel&&(this.options.debugLevel=C.debugLevel),this.$container.attr("tabindex",this.options.tabindex),this.options.aria&&this.$container.attr("role","tree").attr("aria-multiselectable",!0)}if(e.ui&&e.ui.fancytree)return void e.ui.fancytree.warn("Fancytree: ignored duplicate include");var x,b,C=null,k=new RegExp(/\.|\//),_=/[&<>"'\/]/g,N="$recursive_request",S={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},w={16:!0,17:!0,18:!0},E={8:"backspace",9:"tab",10:"return",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},A={0:"",1:"left",2:"middle",3:"right"},T="active expanded focus folder hideCheckbox lazy selected unselectable".split(" "),F={},P="expanded extraClasses folder hideCheckbox icon key lazy refKey selected statusNodeType title tooltip unselectable".split(" "),L={},R={},D={active:!0,children:!0,data:!0,focus:!0};for(x=0;x<T.length;x++)F[T[x]]=!0;for(x=0;x<P.length;x++)b=P[x],L[b]=!0,b!==b.toLowerCase()&&(R[b.toLowerCase()]=b);r(e.ui,"Fancytree requires jQuery UI (http://jqueryui.com)"),v.prototype={_findDirectChild:function(e){var t,n,i=this.children;if(i)if("string"==typeof e){for(t=0,n=i.length;t<n;t++)if(i[t].key===e)return i[t]}else{if("number"==typeof e)return this.children[e];if(e.parent===this)return e}return null},_setChildren:function(e){r(e&&(!this.children||0===this.children.length),"only init supported"),this.children=[];for(var t=0,n=e.length;t<n;t++)this.children.push(new v(this,e[t]))},addChildren:function(t,n){var i,o,s,a=null,l=[];for(e.isPlainObject(t)&&(t=[t]),this.children||(this.children=[]),i=0,o=t.length;i<o;i++)l.push(new v(this,t[i]));return a=l[0],null==n?this.children=this.children.concat(l):(n=this._findDirectChild(n),s=e.inArray(n,this.children),r(s>=0,"insertBefore must be an existing child"),this.children.splice.apply(this.children,[s,0].concat(l))),(!this.parent||this.parent.ul||this.tr)&&this.render(),3===this.tree.options.selectMode&&this.fixSelection3FromEndNodes(),a},addClass:function(e){return this.toggleClass(e,!0)},addNode:function(e,t){switch(t!==i&&"over"!==t||(t="child"),t){case"after":return this.getParent().addChildren(e,this.getNextSibling());case"before":return this.getParent().addChildren(e,this);case"firstChild":var n=this.children?this.children[0]:null;return this.addChildren(e,n);case"child":case"over":return this.addChildren(e)}r(!1,"Invalid mode: "+t)},addPagingNode:function(t,n){var i,r;if(n=n||"child",t===!1){for(i=this.children.length-1;i>=0;i--)r=this.children[i],"paging"===r.statusNodeType&&this.removeChild(r);return void(this.partload=!1)}return t=e.extend({title:this.tree.options.strings.moreData,statusNodeType:"paging",icon:!1},t),this.partload=!0,this.addNode(t,n)},appendSibling:function(e){return this.addNode(e,"after")},applyPatch:function(t){if(null===t)return this.remove(),c(this);var n,i,r,o={children:!0,expanded:!0,parent:!0};for(n in t)r=t[n],o[n]||e.isFunction(r)||(L[n]?this[n]=r:this.data[n]=r);return t.hasOwnProperty("children")&&(this.removeChildren(),t.children&&this._setChildren(t.children)),this.isVisible()&&(this.renderTitle(),this.renderStatus()),i=t.hasOwnProperty("expanded")?this.setExpanded(t.expanded):c(this)},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(e,t,n){return e.addNode(this.toDict(!0,n),t)},countChildren:function(e){var t,n,i,r=this.children;if(!r)return 0;if(i=r.length,e!==!1)for(t=0,n=i;t<n;t++)i+=r[t].countChildren();return i},debug:function(e){this.tree.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),o("log",arguments))},discard:function(){return this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead."),this.resetLazy()},discardMarkup:function(e){var t=e?"nodeRemoveMarkup":"nodeRemoveChildMarkup";this.tree._callHook(t,this)},findAll:function(t){t=e.isFunction(t)?t:g(t);var n=[];return this.visit(function(e){t(e)&&n.push(e)}),n},findFirst:function(t){t=e.isFunction(t)?t:g(t);var n=null;return this.visit(function(e){if(t(e))return n=e,!1}),n},_changeSelectStatusAttrs:function(e){var t=!1;switch(e){case!1:t=this.selected||this.partsel,this.selected=!1,this.partsel=!1;break;case!0:t=!this.selected||!this.partsel,this.selected=!0,this.partsel=!0;break;case i:t=this.selected||!this.partsel,this.selected=!1,this.partsel=!0;break;default:r(!1,"invalid state: "+e)}return t&&this.renderStatus(),t},fixSelection3AfterClick:function(){var e=this.isSelected();this.visit(function(t){t._changeSelectStatusAttrs(e)}),this.fixSelection3FromEndNodes()},fixSelection3FromEndNodes:function(){function e(t){var n,r,o,s,a,l,d,c=t.children;if(c&&c.length){for(l=!0,d=!1,n=0,r=c.length;n<r;n++)o=c[n],s=e(o),s!==!1&&(d=!0),s!==!0&&(l=!1);a=!!l||!!d&&i}else a=!!t.selected;return t._changeSelectStatusAttrs(a),a}r(3===this.tree.options.selectMode,"expected selectMode 3"),e(this),this.visitParents(function(e){var t,n,r,o,s=e.children,a=!0,l=!1;for(t=0,n=s.length;t<n;t++)r=s[t],(r.selected||r.partsel)&&(l=!0),r.unselectable||r.selected||(a=!1);o=!!a||!!l&&i,e._changeSelectStatusAttrs(o)})},fromDict:function(t){for(var n in t)L[n]?this[n]=t[n]:"data"===n?e.extend(this.data,t.data):e.isFunction(t[n])||D[n]||(this.data[n]=t[n]);t.children&&(this.removeChildren(),this.addChildren(t.children)),this.renderTitle()},getChildren:function(){return this.hasChildren()===i?i:this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return e.inArray(this,this.parent.children)},getIndexHier:function(t,n){t=t||".";var i,r=[];return e.each(this.getParentList(!1,!0),function(e,t){i=""+(t.getIndex()+1),n&&(i=("0000000"+i).substr(-n)),r.push(i)}),r.join(t)},getKeyPath:function(e){var t=[],n=this.tree.options.keyPathSeparator;return this.visitParents(function(e){e.parent&&t.unshift(e.key)},!e),n+t.join(n)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e},getNextSibling:function(){if(this.parent){var e,t,n=this.parent.children;for(e=0,t=n.length-1;e<t;e++)if(n[e]===this)return n[e+1]}return null},getParent:function(){return this.parent},getParentList:function(e,t){for(var n=[],i=t?this:this.parent;i;)(e||i.parent)&&n.unshift(i),i=i.parent;return n},getPrevSibling:function(){if(this.parent){var e,t,n=this.parent.children;for(e=1,t=n.length;e<t;e++)if(n[e]===this)return n[e-1]}return null},getSelectedNodes:function(e){var t=[];return this.visit(function(n){if(n.selected&&(t.push(n),e===!0))return"skip"}),t},hasChildren:function(){return this.lazy?null==this.children?i:0!==this.children.length&&(1!==this.children.length||!this.children[0].isStatusNode()||i):!(!this.children||!this.children.length)},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},info:function(e){this.tree.options.debugLevel>=1&&(Array.prototype.unshift.call(arguments,this.toString()),o("info",arguments))},isActive:function(){return this.tree.activeNode===this},isChildOf:function(e){return this.parent&&this.parent===e},isDescendantOf:function(e){if(!e||e.tree!==this.tree)return!1;for(var t=this.parent;t;){if(t===e)return!0;t=t.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var e=this.parent;return!e||e.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var e=this.parent;return!e||e.children[e.children.length-1]===this},isLazy:function(){return!!this.lazy},isLoaded:function(){return!this.lazy||this.hasChildren()!==i},isLoading:function(){return!!this._isLoading},isRoot:function(){return this.isRootNode()},isPartload:function(){return!!this.partload},isRootNode:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isStatusNode:function(){return!!this.statusNodeType},isPagingNode:function(){return"paging"===this.statusNodeType},isTopLevel:function(){return this.tree.rootNode===this.parent},isUndefined:function(){return this.hasChildren()===i},isVisible:function(){var e,t,n=this.getParentList(!1,!1);for(e=0,t=n.length;e<t;e++)if(!n[e].expanded)return!1;return!0},lazyLoad:function(e){return this.warn("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead."),this.load(e)},load:function(e){var t,n,i=this;return r(this.isLazy(),"load() requires a lazy node"),e||this.isUndefined()?(this.isLoaded()&&this.resetLazy(),n=this.tree._triggerNodeEvent("lazyLoad",this),n===!1?c(this):(r("boolean"!=typeof n,"lazyLoad event must return source in data.result"),t=this.tree._callHook("nodeLoadChildren",this,n),this.expanded&&t.always(function(){i.render()}),t)):c(this)},makeVisible:function(t){var n,i=this,r=[],o=new e.Deferred,s=this.getParentList(!1,!1),a=s.length,l=!(t&&t.noAnimation===!0),d=!(t&&t.scrollIntoView===!1);for(n=a-1;n>=0;n--)r.push(s[n].setExpanded(!0,t));return e.when.apply(e,r).done(function(){d?i.scrollIntoView(l).done(function(){o.resolve()}):o.resolve()}),o.promise()},moveTo:function(t,n,o){n===i||"over"===n?n="child":"firstChild"===n&&(t.children&&t.children.length?(n="before",t=t.children[0]):n="child");var s,a=this.parent,l="child"===n?t:t.parent;if(this!==t){if(this.parent?l.isDescendantOf(this)&&e.error("Cannot move a node to its own descendant"):e.error("Cannot move system root"),1===this.parent.children.length){if(this.parent===l)return;this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1}else s=e.inArray(this,this.parent.children),r(s>=0,"invalid source parent"),this.parent.children.splice(s,1);if(this.parent=l,l.hasChildren())switch(n){case"child":l.children.push(this);break;case"before":s=e.inArray(t,l.children),r(s>=0,"invalid target parent"),l.children.splice(s,0,this);break;case"after":s=e.inArray(t,l.children),r(s>=0,"invalid target parent"),l.children.splice(s+1,0,this);break;default:e.error("Invalid mode "+n)}else l.children=[this];o&&t.visit(o,!0),this.tree!==t.tree&&(this.warn("Cross-tree moveTo is experimantal!"),this.visit(function(e){e.tree=t.tree},!0)),a.isDescendantOf(l)||a.render(),l.isDescendantOf(a)||l===a||l.render()}},navigate:function(t,n){function i(i){if(i){try{i.makeVisible()}catch(r){}return e(i.span).is(":visible")?n===!1?i.setFocus():i.setActive():(i.debug("Navigate: skipping hidden node"),void i.navigate(t,n))}}var r,o,s,a=!0,l=e.ui.keyCode,d=null;switch(t){case l.BACKSPACE:this.parent&&this.parent.parent&&(s=i(this.parent));break;case l.LEFT:this.expanded?(this.setExpanded(!1),s=i(this)):this.parent&&this.parent.parent&&(s=i(this.parent));break;case l.RIGHT:this.expanded||!this.children&&!this.lazy?this.children&&this.children.length&&(s=i(this.children[0])):(this.setExpanded(),s=i(this));break;case l.UP:for(d=this.getPrevSibling();d&&!e(d.span).is(":visible");)d=d.getPrevSibling();for(;d&&d.expanded&&d.children&&d.children.length;)d=d.children[d.children.length-1];!d&&this.parent&&this.parent.parent&&(d=this.parent),s=i(d);break;case l.DOWN:if(this.expanded&&this.children&&this.children.length)d=this.children[0];else for(o=this.getParentList(!1,!0),r=o.length-1;r>=0;r--){for(d=o[r].getNextSibling();d&&!e(d.span).is(":visible");)d=d.getNextSibling();if(d)break}s=i(d);break;default:a=!1}return s||c()},remove:function(){return this.parent.removeChild(this)},removeChild:function(e){return this.tree._callHook("nodeRemoveChild",this,e)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},removeClass:function(e){return this.toggleClass(e,!1)},render:function(e,t){return this.tree._callHook("nodeRender",this,e,t)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},replaceWith:function(t){var n,i=this.parent,o=e.inArray(this,i.children),s=this;return r(this.isPagingNode(),"replaceWith() currently requires a paging status node"),n=this.tree._callHook("nodeLoadChildren",this,t),n.done(function(e){var t=s.children;for(x=0;x<t.length;x++)t[x].parent=i;i.children.splice.apply(i.children,[o+1,0].concat(t)),s.children=null,s.remove(),i.render()}).fail(function(){s.setExpanded()}),n},resetLazy:function(){this.removeChildren(),this.expanded=!1,this.lazy=!0,this.children=i,this.renderStatus()},scheduleAction:function(t,n){this.tree.timer&&clearTimeout(this.tree.timer),this.tree.timer=null;var i=this;switch(t){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){i.tree.debug("setTimeout: trigger expand"),i.setExpanded(!0)},n);break;case"activate":this.tree.timer=setTimeout(function(){i.tree.debug("setTimeout: trigger activate"),i.setActive(!0)},n);break;default:e.error("Invalid mode "+t)}},scrollIntoView:function(o,a){a!==i&&s(a)&&(this.warn("scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead."),a={topNode:a});var l,d,u,h,p=e.extend({effects:o===!0?{duration:200,queue:!1}:o,scrollOfs:this.tree.options.scrollOfs,scrollParent:this.tree.options.scrollParent||this.tree.$container,topNode:null},a),f=new e.Deferred,g=this,y=e(this.span).height(),v=e(p.scrollParent),m=p.scrollOfs.top||0,x=p.scrollOfs.bottom||0,b=v.height(),C=v.scrollTop(),k=v,_=v[0]===t,N=p.topNode||null,S=null;return e(this.span).is(":visible")?(_?(d=e(this.span).offset().top,l=N&&N.span?e(N.span).offset().top:0,k=e("html,body")):(r(v[0]!==n&&v[0]!==n.body,"scrollParent should be a simple element or `window`, not document or body."),h=v.offset().top,d=e(this.span).offset().top-h+C,l=N?e(N.span).offset().top-h+C:0,u=Math.max(0,v.innerHeight()-v[0].clientHeight),b-=u),d<C+m?S=d-m:d+y>C+b-x&&(S=d+y-b+x,N&&(r(N.isRootNode()||e(N.span).is(":visible"),"topNode must be visible"),l<S&&(S=l-m))),null!==S?p.effects?(p.effects.complete=function(){f.resolveWith(g)},k.stop(!0).animate({scrollTop:S},p.effects)):(k[0].scrollTop=S,f.resolveWith(this)):f.resolveWith(this),f.promise()):(this.warn("scrollIntoView(): node is invisible."),c())},setActive:function(e,t){return this.tree._callHook("nodeSetActive",this,e,t)},setExpanded:function(e,t){return this.tree._callHook("nodeSetExpanded",this,e,t)},setFocus:function(e){return this.tree._callHook("nodeSetFocus",this,e)},setSelected:function(e){return this.tree._callHook("nodeSetSelected",this,e)},setStatus:function(e,t,n){return this.tree._callHook("nodeSetStatus",this,e,t,n)},setTitle:function(e){this.title=e,this.renderTitle()},sortChildren:function(e,t){var n,i,r=this.children;if(r){if(e=e||function(e,t){var n=e.title.toLowerCase(),i=t.title.toLowerCase();return n===i?0:n>i?1:-1},r.sort(e),t)for(n=0,i=r.length;n<i;n++)r[n].children&&r[n].sortChildren(e,"$norender$");"$norender$"!==t&&this.render()}},toDict:function(t,n){var i,r,o,s={},a=this;if(e.each(P,function(e,t){(a[t]||a[t]===!1)&&(s[t]=a[t])}),e.isEmptyObject(this.data)||(s.data=e.extend({},this.data),e.isEmptyObject(s.data)&&delete s.data),n&&n(s,a),t&&this.hasChildren())for(s.children=[],i=0,r=this.children.length;i<r;i++)o=this.children[i],o.isStatusNode()||s.children.push(o.toDict(!0,n));return s},toggleClass:function(t,n){var r,o,s=/\S+/g,a=t.match(s)||[],l=0,d=!1,c=this[this.tree.statusClassPropName],u=" "+(this.extraClasses||"")+" ";for(c&&e(c).toggleClass(t,n);r=a[l++];)if(o=u.indexOf(" "+r+" ")>=0,n=n===i?!o:!!n)o||(u+=r+" ",d=!0);else for(;u.indexOf(" "+r+" ")>-1;)u=u.replace(" "+r+" "," ");return this.extraClasses=e.trim(u),d},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"<FancytreeNode(#"+this.key+", '"+this.title+"')>"},visit:function(e,t){var n,i,r=!0,o=this.children;if(t===!0&&(r=e(this),r===!1||"skip"===r))return r;if(o)for(n=0,i=o.length;n<i&&(r=o[n].visit(e,!0),r!==!1);n++);return r},visitAndLoad:function(t,n,i){var r,o,s,a=this;return t&&n===!0&&(o=t(a),o===!1||"skip"===o)?i?o:c():a.children||a.lazy?(r=new e.Deferred,s=[],a.load().done(function(){for(var n=0,i=a.children.length;n<i;n++){if(o=a.children[n].visitAndLoad(t,!0,!0),o===!1){r.reject();break}"skip"!==o&&s.push(o)}e.when.apply(this,s).then(function(){r.resolve()})}),r.promise()):c()},visitParents:function(e,t){if(t&&e(this)===!1)return!1;for(var n=this.parent;n;){if(e(n)===!1)return!1;n=n.parent}return!0},warn:function(e){Array.prototype.unshift.call(arguments,this.toString()),o("warn",arguments)}},m.prototype={_makeHookContext:function(t,n,r){var o,s;return t.node!==i?(n&&t.originalEvent!==n&&e.error("invalid args"),o=t):t.tree?(s=t.tree,o={node:t,tree:s,widget:s.widget,options:s.widget.options,originalEvent:n}):t.widget?o={node:null,tree:t,widget:t.widget,options:t.widget.options,originalEvent:n}:e.error("invalid args"),r&&e.extend(o,r),o},_callHook:function(t,n,i){var r=this._makeHookContext(n),o=this[t],s=Array.prototype.slice.call(arguments,2);return e.isFunction(o)||e.error("_callHook('"+t+"') is not a function"),s.unshift(r),o.apply(this,s)},_requireExtension:function(t,n,i,o){i=!!i;var s=this._local.name,a=this.options.extensions,l=e.inArray(t,a)<e.inArray(s,a),d=n&&null==this.ext[t],c=!d&&null!=i&&i!==l;return r(s&&s!==t,"invalid or same name"),!d&&!c||(o||(d||n?(o="'"+s+"' extension requires '"+t+"'",c&&(o+=" to be registered "+(i?"before":"after")+" itself")):o="If used together, `"+t+"` must be registered "+(i?"before":"after")+" `"+s+"`"),e.error(o),!1)},activateKey:function(e){var t=this.getNodeByKey(e);return t?t.setActive():this.activeNode&&this.activeNode.setActive(!1),t},addPagingNode:function(e,t){return this.rootNode.addPagingNode(e,t)},applyPatch:function(t){var n,i,o,s,a,l,d=t.length,c=[];for(i=0;i<d;i++)o=t[i],r(2===o.length,"patchList must be an array of length-2-arrays"),s=o[0],a=o[1],l=null===s?this.rootNode:this.getNodeByKey(s),l?(n=new e.Deferred,c.push(n),l.applyPatch(a).always(h(n,l))):this.warn("could not find node with key '"+s+"'");return e.when.apply(e,c).promise()},clear:function(e){this._callHook("treeClear",this)},count:function(){return this.rootNode.countChildren()},debug:function(e){this.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),o("log",arguments))},findAll:function(e){return this.rootNode.findAll(e)},findFirst:function(e){return this.rootNode.findFirst(e)},findNextNode:function(t,n,i){var r=null,o=n.parent.children,s=null,a=function l(e,t,n){var i,r,o=e.children,s=o.length,a=o[t];if(a&&n(a)===!1)return!1;if(a&&a.children&&a.expanded&&l(a,0,n)===!1)return!1;for(i=t+1;i<s;i++)if(l(e,i,n)===!1)return!1;return r=e.parent,r?l(r,r.children.indexOf(e)+1,n):l(e,0,n)};return t="string"==typeof t?y(t):t,n=n||this.getFirstChild(),a(n.parent,o.indexOf(n),function(i){return i!==r&&(r=r||i,e(i.span).is(":visible")?(!t(i)||(s=i,s===n))&&void 0:void i.debug("quicksearch: skipping hidden node"))}),s},generateFormElements:function(t,n,i){i=i||{};var r,o="string"==typeof t?t:"ft_"+this._id+"[]",s="string"==typeof n?n:"ft_"+this._id+"_active",a="fancytree_result_"+this._id,l=e("#"+a),d=3===this.options.selectMode&&i.stopOnParents!==!1;l.length?l.empty():l=e("<div>",{id:a}).hide().insertAfter(this.$container),t!==!1&&(r=this.getSelectedNodes(d),e.each(r,function(t,n){l.append(e("<input>",{type:"checkbox",name:o,value:n.key,checked:!0}))})),n!==!1&&this.activeNode&&l.append(e("<input>",{type:"radio",name:s,value:this.activeNode.key,checked:!0}))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(){return this.focusNode},getNodeByKey:function(e,t){var i,r;return!t&&(i=n.getElementById(this.options.idPrefix+e))?i.ftnode?i.ftnode:null:(t=t||this.rootNode,r=null,t.visit(function(t){if(t.key===e)return r=t,!1},!0),r)},getRootNode:function(){return this.rootNode},getSelectedNodes:function(e){return this.rootNode.getSelectedNodes(e)},hasFocus:function(){return!!this._hasFocus},info:function(e){this.options.debugLevel>=1&&(Array.prototype.unshift.call(arguments,this.toString()),o("info",arguments))},loadKeyPath:function(t,n,r){function o(e,t,i){n.call(v,t,"loading"),t.load().done(function(){v.loadKeyPath.call(v,u[e],n,t).always(h(i,v))}).fail(function(r){v.warn("loadKeyPath: error loading: "+e+" (parent: "+f+")"),n.call(v,t,"error"),i.reject()})}var s,a,l,d,c,u,p,f,g,y=this.options.keyPathSeparator,v=this;for(n=n||e.noop,e.isArray(t)||(t=[t]),u={},l=0;l<t.length;l++)for(f=r||this.rootNode,d=t[l],d.charAt(0)===y&&(d=d.substr(1)),g=d.split(y);g.length;){if(c=g.shift(),p=f._findDirectChild(c),!p){this.warn("loadKeyPath: key not found: "+c+" (parent: "+f+")"),n.call(this,c,"error");break}if(0===g.length){n.call(this,p,"ok");break}if(p.lazy&&p.hasChildren()===i){n.call(this,p,"loaded"),u[c]?u[c].push(g.join(y)):u[c]=[g.join(y)];break}n.call(this,p,"loaded"),f=p}s=[];for(c in u)p=f._findDirectChild(c),a=new e.Deferred,s.push(a),o(c,p,a);return e.when.apply(e,s).promise()},reactivate:function(e){var t,n=this.activeNode;return n?(this.activeNode=null,t=n.setActive(!0,{noFocus:!0}),e&&n.setFocus(),t):c()},reload:function(e){return this._callHook("treeClear",this),this._callHook("treeLoad",this,e)},render:function(e,t){return this.rootNode.render(e,t)},setFocus:function(e){return this._callHook("treeSetFocus",this,e)},toDict:function(e,t){var n=this.rootNode.toDict(!0,t);return e?n:n.children},toString:function(){return"<Fancytree(#"+this._id+")>"},_triggerNodeEvent:function(e,t,n,r){var o=this._makeHookContext(t,n,r),s=this.widget._trigger(e,n,o);return s!==!1&&o.result!==i?o.result:s},_triggerTreeEvent:function(e,t,n){var r=this._makeHookContext(this,t,n),o=this.widget._trigger(e,t,r);return o!==!1&&r.result!==i?r.result:o},visit:function(e){return this.rootNode.visit(e,!1)},warn:function(e){Array.prototype.unshift.call(arguments,this.toString()),o("warn",arguments)}},e.extend(m.prototype,{nodeClick:function(e){var t,n,i=e.targetType,r=e.node;if("expander"===i){if(r.isLoading())return void r.debug("Got 2nd click while loading: ignored");this._callHook("nodeToggleExpanded",e)}else if("checkbox"===i)this._callHook("nodeToggleSelected",e),e.options.focusOnSelect&&this._callHook("nodeSetFocus",e,!0);else{if(n=!1,t=!0,r.folder)switch(e.options.clickFolderMode){case 2:n=!0,t=!1;break;case 3:t=!0,n=!0}t&&(this.nodeSetFocus(e),this._callHook("nodeSetActive",e,!0)),n&&this._callHook("nodeToggleExpanded",e)}},nodeCollapseSiblings:function(e,t){var n,i,r,o=e.node;if(o.parent)for(n=o.parent.children,i=0,r=n.length;i<r;i++)n[i]!==o&&n[i].expanded&&this._callHook("nodeSetExpanded",n[i],!1,t)},nodeDblclick:function(e){"title"===e.targetType&&4===e.options.clickFolderMode&&this._callHook("nodeToggleExpanded",e),"title"===e.targetType&&e.originalEvent.preventDefault()},nodeKeydown:function(t){var n,i,r,o,s=t.originalEvent,a=t.node,l=t.tree,d=t.options,c=s.which,u=String.fromCharCode(c),h=!(s.altKey||s.ctrlKey||s.metaKey||s.shiftKey),p=e(s.target),f=!0,g=!(s.ctrlKey||!d.autoActivate);if(a||(o=this.getActiveNode()||this.getFirstChild(),o&&(o.setFocus(),a=t.node=this.focusNode,a.debug("Keydown force focus on active node"))),d.quicksearch&&h&&/\w/.test(u)&&!p.is(":input:enabled"))return i=(new Date).getTime(),i-l.lastQuicksearchTime>500&&(l.lastQuicksearchTerm=""),l.lastQuicksearchTime=i,l.lastQuicksearchTerm+=u,n=l.findNextNode(l.lastQuicksearchTerm,l.getActiveNode()),n&&n.setActive(),void s.preventDefault();switch(C.eventToString(s)){case"+":case"=":l.nodeSetExpanded(t,!0);break;case"-":l.nodeSetExpanded(t,!1);break;case"space":a.isPagingNode()?l._triggerNodeEvent("clickPaging",t,s):d.checkbox?l.nodeToggleSelected(t):l.nodeSetActive(t,!0);break;case"return":l.nodeSetActive(t,!0);break;case"backspace":case"left":case"right":case"up":case"down":r=a.navigate(s.which,g);break;default:f=!1}f&&s.preventDefault()},nodeLoadChildren:function(t,n){var i,o,s,a=t.tree,l=t.node,d=(new Date).getTime();return e.isFunction(n)&&(n=n.call(a,{type:"source"},t),r(!e.isFunction(n),"source callback must not return another function")),n.url&&(l._requestId&&l.warn("Recursive load request #"+d+" while #"+l._requestId+" is pending."),i=e.extend({},t.options.ajax,n),l._requestId=d,i.debugDelay?(o=i.debugDelay,e.isArray(o)&&(o=o[0]+Math.random()*(o[1]-o[0])),l.warn("nodeLoadChildren waiting debugDelay "+Math.round(o)+" ms ..."),i.debugDelay=!1,s=e.Deferred(function(t){setTimeout(function(){e.ajax(i).done(function(){t.resolveWith(this,arguments)}).fail(function(){t.rejectWith(this,arguments)})},o)})):s=e.ajax(i),n=new e.Deferred,s.done(function(i,r,o){var s,c;if("json"!==this.dataType&&"jsonp"!==this.dataType||"string"!=typeof i||e.error("Ajax request returned a string (did you get the JSON dataType wrong?)."),l._requestId&&l._requestId>d)return void n.rejectWith(this,[N]);if(t.options.postProcess){try{c=a._triggerNodeEvent("postProcess",t,t.originalEvent,{response:i,error:null,dataType:this.dataType})}catch(u){c={error:u,message:""+u,details:"postProcess failed"}}if(c.error)return s=e.isPlainObject(c.error)?c.error:{message:c.error},s=a._makeHookContext(l,null,s),void n.rejectWith(this,[s]);i=e.isArray(c)?c:i}else i&&i.hasOwnProperty("d")&&t.options.enableAspx&&(i="string"==typeof i.d?e.parseJSON(i.d):i.d);n.resolveWith(this,[i])}).fail(function(e,t,i){var r=a._makeHookContext(l,null,{error:e,args:Array.prototype.slice.call(arguments),message:i,details:e.status+": "+i});n.rejectWith(this,[r])})),e.isFunction(n.then)&&e.isFunction(n["catch"])&&(s=n,n=new e.Deferred,s.then(function(e){n.resolve(e)},function(e){n.reject(e)})),e.isFunction(n.promise)&&(a.nodeSetStatus(t,"loading"),n.done(function(e){a.nodeSetStatus(t,"ok"),l._requestId=null}).fail(function(e){var n;return e===N?void l.warn("Ignored response for obsolete load request #"+d+" (expected #"+l._requestId+")"):(e.node&&e.error&&e.message?n=e:(n=a._makeHookContext(l,null,{error:e,args:Array.prototype.slice.call(arguments),message:e?e.message||e.toString():""}),"[object Object]"===n.message&&(n.message="")),l.warn("Load children failed ("+n.message+")",n),void(a._triggerNodeEvent("loadError",n,null)!==!1&&a.nodeSetStatus(t,"error",n.message,n.details)))})),e.when(n).done(function(t){var n;e.isPlainObject(t)&&(r(l.isRootNode(),"source may only be an object for root nodes (expecting an array of child objects otherwise)"),r(e.isArray(t.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),n=t,t=t.children,delete n.children,e.extend(a.data,n)),r(e.isArray(t),"expected array of children"),l._setChildren(t),a._triggerNodeEvent("loadChildren",l)})},nodeLoadKeyPath:function(e,t){},nodeRemoveChild:function(t,n){var i,o=t.node,s=t.options,a=e.extend({},t,{node:n}),l=o.children;return 1===l.length?(r(n===l[0],"invalid single child"),this.nodeRemoveChildren(t)):(this.activeNode&&(n===this.activeNode||this.activeNode.isDescendantOf(n))&&this.activeNode.setActive(!1),this.focusNode&&(n===this.focusNode||this.focusNode.isDescendantOf(n))&&(this.focusNode=null),this.nodeRemoveMarkup(a),this.nodeRemoveChildren(a),i=e.inArray(n,l),r(i>=0,"invalid child"),n.visit(function(e){e.parent=null},!0),this._callHook("treeRegisterNode",this,!1,n),s.removeNode&&s.removeNode.call(t.tree,{type:"removeNode"},a),void l.splice(i,1))},nodeRemoveChildMarkup:function(t){var n=t.node;n.ul&&(n.isRootNode()?e(n.ul).empty():(e(n.ul).remove(),n.ul=null),n.visit(function(e){e.li=e.ul=null}))},nodeRemoveChildren:function(t){
var n,i=t.tree,r=t.node,o=r.children,s=t.options;o&&(this.activeNode&&this.activeNode.isDescendantOf(r)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(r)&&(this.focusNode=null),this.nodeRemoveChildMarkup(t),n=e.extend({},t),r.visit(function(e){e.parent=null,i._callHook("treeRegisterNode",i,!1,e),s.removeNode&&(n.node=e,s.removeNode.call(t.tree,{type:"removeNode"},n))}),r.lazy?r.children=[]:r.children=null,r.isRootNode()||(r.expanded=!1),this.nodeRenderStatus(t))},nodeRemoveMarkup:function(t){var n=t.node;n.li&&(e(n.li).remove(),n.li=null),this.nodeRemoveChildMarkup(t)},nodeRender:function(t,i,o,s,a){var l,d,c,u,h,p,f,g=t.node,y=t.tree,v=t.options,m=v.aria,x=!1,b=g.parent,C=!b,k=g.children,_=null;if(C||b.ul){if(r(C||b.ul,"parent UL must exist"),C||(g.li&&(i||g.li.parentNode!==g.parent.ul)&&(g.li.parentNode===g.parent.ul?_=g.li.nextSibling:this.debug("Unlinking "+g+" (must be child of "+g.parent+")"),this.nodeRemoveMarkup(t)),g.li?this.nodeRenderStatus(t):(x=!0,g.li=n.createElement("li"),g.li.ftnode=g,g.key&&v.generateIds&&(g.li.id=v.idPrefix+g.key),g.span=n.createElement("span"),g.span.className="fancytree-node",m&&e(g.span).attr("aria-labelledby","ftal_"+v.idPrefix+g.key),g.li.appendChild(g.span),this.nodeRenderTitle(t),v.createNode&&v.createNode.call(y,{type:"createNode"},t)),v.renderNode&&v.renderNode.call(y,{type:"renderNode"},t)),k){if(C||g.expanded||o===!0){for(g.ul||(g.ul=n.createElement("ul"),(s!==!0||a)&&g.expanded||(g.ul.style.display="none"),m&&e(g.ul).attr("role","group"),g.li?g.li.appendChild(g.ul):g.tree.$div.append(g.ul)),u=0,h=k.length;u<h;u++)f=e.extend({},t,{node:k[u]}),this.nodeRender(f,i,o,!1,!0);for(l=g.ul.firstChild;l;)c=l.ftnode,c&&c.parent!==g?(g.debug("_fixParent: remove missing "+c,l),p=l.nextSibling,l.parentNode.removeChild(l),l=p):l=l.nextSibling;for(l=g.ul.firstChild,u=0,h=k.length-1;u<h;u++)d=k[u],c=l.ftnode,d!==c?g.ul.insertBefore(d.li,c.li):l=l.nextSibling}}else g.ul&&(this.warn("remove child markup for "+g),this.nodeRemoveChildMarkup(t));C||x&&b.ul.insertBefore(g.li,_)}},nodeRenderTitle:function(t,n){var r,o,s,a,l,d,c=t.node,u=t.tree,h=t.options,p=h.aria,g=c.getLevel(),y=[];n!==i&&(c.title=n),c.span&&(g<h.minExpandLevel?(c.lazy||(c.expanded=!0),g>1&&(p?y.push("<span role='button' class='fancytree-expander fancytree-expander-fixed'></span>"):y.push("<span class='fancytree-expander fancytree-expander-fixed''></span>"))):p?y.push("<span role='button' class='fancytree-expander'></span>"):y.push("<span class='fancytree-expander'></span>"),h.checkbox&&c.hideCheckbox!==!0&&!c.isStatusNode()&&(p?y.push("<span role='checkbox' class='fancytree-checkbox'></span>"):y.push("<span class='fancytree-checkbox'></span>")),c.data.iconClass!==i&&(c.icon?e.error("'iconClass' node option is deprecated since v2.14.0: use 'icon' only instead"):(c.warn("'iconClass' node option is deprecated since v2.14.0: use 'icon' instead"),c.icon=c.data.iconClass)),e.isFunction(h.icon)?(o=h.icon.call(u,{type:"icon"},t),null==o&&(o=c.icon)):o=null!=c.icon?c.icon:h.icon,null==o?o=!0:"boolean"!=typeof o&&(o=""+o),o!==!1&&(a=p?" role='img'":"","string"==typeof o?k.test(o)?(o="/"===o.charAt(0)?o:(h.imagePath||"")+o,y.push("<img src='"+o+"' class='fancytree-icon' alt='' />")):y.push("<span "+a+" class='fancytree-custom-icon "+o+"'></span>"):y.push("<span "+a+" class='fancytree-icon'></span>")),s="",h.renderTitle&&(s=h.renderTitle.call(u,{type:"renderTitle"},t)||""),s||(d=c.tooltip?" title='"+f(c.tooltip)+"'":"",r=p?" id='ftal_"+h.idPrefix+c.key+"'":"",a=p?" role='treeitem'":"",l=h.titlesTabbable?" tabindex='0'":"",s="<span "+a+" class='fancytree-title'"+r+d+l+">"+(h.escapeTitles?f(c.title):c.title)+"</span>"),y.push(s),c.span.innerHTML=y.join(""),this.nodeRenderStatus(t),h.enhanceTitle&&(t.$title=e(">span.fancytree-title",c.span),s=h.enhanceTitle.call(u,{type:"enhanceTitle"},t)||""))},nodeRenderStatus:function(t){var n=t.node,i=t.tree,r=t.options,o=n.hasChildren(),s=n.isLastSibling(),a=r.aria,l=e(n.span).find(".fancytree-title"),d=r._classNames,c=[],u=n[i.statusClassPropName];u&&(c.push(d.node),i.activeNode===n&&c.push(d.active),i.focusNode===n?(c.push(d.focused),a&&l.attr("aria-activedescendant",!0)):a&&l.removeAttr("aria-activedescendant"),n.expanded?(c.push(d.expanded),a&&l.attr("aria-expanded",!0)):a&&l.removeAttr("aria-expanded"),n.folder&&c.push(d.folder),o!==!1&&c.push(d.hasChildren),s&&c.push(d.lastsib),n.lazy&&null==n.children&&c.push(d.lazy),n.partload&&c.push(d.partload),n.partsel&&c.push(d.partsel),n.unselectable&&c.push(d.unselectable),n._isLoading&&c.push(d.loading),n._error&&c.push(d.error),n.statusNodeType&&c.push(d.statusNodePrefix+n.statusNodeType),n.selected?(c.push(d.selected),a&&l.attr("aria-selected",!0)):a&&l.attr("aria-selected",!1),n.extraClasses&&c.push(n.extraClasses),o===!1?c.push(d.combinedExpanderPrefix+"n"+(s?"l":"")):c.push(d.combinedExpanderPrefix+(n.expanded?"e":"c")+(n.lazy&&null==n.children?"d":"")+(s?"l":"")),c.push(d.combinedIconPrefix+(n.expanded?"e":"c")+(n.folder?"f":"")),u.className=c.join(" "),n.li&&(n.li.className=s?d.lastsib:""))},nodeSetActive:function(t,n,i){i=i||{};var o,s=t.node,a=t.tree,l=t.options,d=i.noEvents===!0,h=i.noFocus===!0,p=s===a.activeNode;return n=n!==!1,p===n?c(s):n&&!d&&this._triggerNodeEvent("beforeActivate",s,t.originalEvent)===!1?u(s,["rejected"]):(n?(a.activeNode&&(r(a.activeNode!==s,"node was active (inconsistency)"),o=e.extend({},t,{node:a.activeNode}),a.nodeSetActive(o,!1),r(null===a.activeNode,"deactivate was out of sync?")),l.activeVisible&&s.makeVisible({scrollIntoView:!1}),a.activeNode=s,a.nodeRenderStatus(t),h||a.nodeSetFocus(t),d||a._triggerNodeEvent("activate",s,t.originalEvent)):(r(a.activeNode===s,"node was not active (inconsistency)"),a.activeNode=null,this.nodeRenderStatus(t),d||t.tree._triggerNodeEvent("deactivate",s,t.originalEvent)),c(s))},nodeSetExpanded:function(t,n,r){r=r||{};var o,s,a,l,d,h,p=t.node,f=t.tree,g=t.options,y=r.noAnimation===!0,v=r.noEvents===!0;if(n=n!==!1,p.expanded&&n||!p.expanded&&!n)return c(p);if(n&&!p.lazy&&!p.hasChildren())return c(p);if(!n&&p.getLevel()<g.minExpandLevel)return u(p,["locked"]);if(!v&&this._triggerNodeEvent("beforeExpand",p,t.originalEvent)===!1)return u(p,["rejected"]);if(y||p.isVisible()||(y=r.noAnimation=!0),s=new e.Deferred,n&&!p.expanded&&g.autoCollapse){d=p.getParentList(!1,!0),h=g.autoCollapse;try{for(g.autoCollapse=!1,a=0,l=d.length;a<l;a++)this._callHook("nodeCollapseSiblings",d[a],r)}finally{g.autoCollapse=h}}return s.done(function(){var e=p.getLastChild();n&&g.autoScroll&&!y&&e?e.scrollIntoView(!0,{topNode:p}).always(function(){v||t.tree._triggerNodeEvent(n?"expand":"collapse",t)}):v||t.tree._triggerNodeEvent(n?"expand":"collapse",t)}),o=function(i){var r,o,s=g.toggleEffect;if(p.expanded=n,f._callHook("nodeRender",t,!1,!1,!0),p.ul)if(r="none"!==p.ul.style.display,o=!!p.expanded,r===o)p.warn("nodeSetExpanded: UL.style.display already set");else{if(s&&!y)return void e(p.ul).toggle(s.effect,s.options,s.duration,function(){i()});p.ul.style.display=p.expanded||!parent?"":"none"}i()},n&&p.lazy&&p.hasChildren()===i?p.load().done(function(){s.notifyWith&&s.notifyWith(p,["loaded"]),o(function(){s.resolveWith(p)})}).fail(function(e){o(function(){s.rejectWith(p,["load failed ("+e+")"])})}):o(function(){s.resolveWith(p)}),s.promise()},nodeSetFocus:function(t,i){var r,o=t.tree,s=t.node;if(i=i!==!1,o.focusNode){if(o.focusNode===s&&i)return;r=e.extend({},t,{node:o.focusNode}),o.focusNode=null,this._triggerNodeEvent("blur",r),this._callHook("nodeRenderStatus",r)}i&&(this.hasFocus()||(s.debug("nodeSetFocus: forcing container focus"),this._callHook("treeSetFocus",t,!0,{calledByNode:!0})),s.makeVisible({scrollIntoView:!1}),o.focusNode=s,o.options.titlesTabbable?e(s.span).find(".fancytree-title").focus():0===e(n.activeElement).closest(".fancytree-container").length&&e(o.$container).focus(),this._triggerNodeEvent("focus",t),t.options.autoScroll&&s.scrollIntoView(),this._callHook("nodeRenderStatus",t))},nodeSetSelected:function(e,t){var n=e.node,i=e.tree,r=e.options;if(t=t!==!1,n.debug("nodeSetSelected("+t+")",e),!n.unselectable){if(n.selected&&t||!n.selected&&!t)return!!n.selected;if(this._triggerNodeEvent("beforeSelect",n,e.originalEvent)===!1)return!!n.selected;t&&1===r.selectMode?i.lastSelectedNode&&i.lastSelectedNode.setSelected(!1):3===r.selectMode&&(n.selected=t,n.fixSelection3AfterClick()),n.selected=t,this.nodeRenderStatus(e),i.lastSelectedNode=t?n:null,i._triggerNodeEvent("select",e)}},nodeSetStatus:function(t,n,i,r){function o(){var e=a.children?a.children[0]:null;if(e&&e.isStatusNode()){try{a.ul&&(a.ul.removeChild(e.li),e.li=null)}catch(t){}1===a.children.length?a.children=[]:a.children.shift()}}function s(t,n){var i=a.children?a.children[0]:null;return i&&i.isStatusNode()?(e.extend(i,t),i.statusNodeType=n,l._callHook("nodeRenderTitle",i)):(a._setChildren([t]),a.children[0].statusNodeType=n,l.render()),a.children[0]}var a=t.node,l=t.tree;switch(n){case"ok":o(),a._isLoading=!1,a._error=null,a.renderStatus();break;case"loading":a.parent||s({title:l.options.strings.loading+(i?" ("+i+")":""),checkbox:!1,tooltip:r},n),a._isLoading=!0,a._error=null,a.renderStatus();break;case"error":s({title:l.options.strings.loadError+(i?" ("+i+")":""),checkbox:!1,tooltip:r},n),a._isLoading=!1,a._error={message:i,details:r},a.renderStatus();break;case"nodata":s({title:l.options.strings.noData,checkbox:!1,tooltip:r},n),a._isLoading=!1,a._error=null,a.renderStatus();break;default:e.error("invalid node status "+n)}},nodeToggleExpanded:function(e){return this.nodeSetExpanded(e,!e.node.expanded)},nodeToggleSelected:function(e){return this.nodeSetSelected(e,!e.node.selected)},treeClear:function(e){var t=e.tree;t.activeNode=null,t.focusNode=null,t.$div.find(">ul.fancytree-container").empty(),t.rootNode.children=null},treeCreate:function(e){},treeDestroy:function(e){this.$div.find(">ul.fancytree-container").remove(),this.$source&&this.$source.removeClass("ui-helper-hidden")},treeInit:function(e){this.treeLoad(e)},treeLoad:function(t,n){var i,r,o,s=t.tree,a=t.widget.element,l=e.extend({},t,{node:this.rootNode});if(s.rootNode.children&&this.treeClear(t),n=n||this.options.source)"string"==typeof n&&e.error("Not implemented");else switch(i=a.data("type")||"html"){case"html":r=a.find(">ul:first"),r.addClass("ui-fancytree-source ui-helper-hidden"),n=e.ui.fancytree.parseHtml(r),this.data=e.extend(this.data,p(r));break;case"json":n=e.parseJSON(a.text()),n.children&&(n.title&&(s.title=n.title),n=n.children);break;default:e.error("Invalid data-type: "+i)}return o=this.nodeLoadChildren(l,n).done(function(){s.render(),3===t.options.selectMode&&s.rootNode.fixSelection3FromEndNodes(),s.activeNode&&s.options.activeVisible&&s.activeNode.makeVisible(),s._triggerTreeEvent("init",null,{status:!0})}).fail(function(){s.render(),s._triggerTreeEvent("init",null,{status:!1})})},treeRegisterNode:function(e,t,n){},treeSetFocus:function(t,n,i){n=n!==!1,n!==this.hasFocus()&&(this._hasFocus=n,!n&&this.focusNode?this.focusNode.setFocus(!1):!n||i&&i.calledByNode||e(this.$container).focus(),this.$container.toggleClass("fancytree-treefocus",n),this._triggerTreeEvent(n?"focusTree":"blurTree"))}}),e.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!1,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,debugLevel:null,disabled:!1,enableAspx:!0,escapeTitles:!1,extensions:[],toggleEffect:{effect:"blind",options:{direction:"vertical",scale:"box"},duration:200},generateIds:!1,icon:!0,idPrefix:"ft_",focusOnSelect:!1,keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,quicksearch:!1,scrollOfs:{top:0,bottom:0},scrollParent:null,selectMode:2,strings:{loading:"Loading&#8230;",loadError:"Load error!",moreData:"More&#8230;",noData:"No data."},tabindex:"0",titlesTabbable:!1,_classNames:{node:"fancytree-node",folder:"fancytree-folder",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",hasChildren:"fancytree-has-children",active:"fancytree-active",selected:"fancytree-selected",expanded:"fancytree-expanded",lazy:"fancytree-lazy",focused:"fancytree-focused",partload:"fancytree-partload",partsel:"fancytree-partsel",unselectable:"fancytree-unselectable",lastsib:"fancytree-lastsib",loading:"fancytree-loading",error:"fancytree-error",statusNodePrefix:"fancytree-statusnode-"},lazyLoad:null,postProcess:null},_create:function(){this.tree=new m(this),this.$source=this.source||"json"===this.element.data("type")?this.element:this.element.find(">ul:first");var t,n,o,s=this.options,a=s.extensions,l=this.tree;for(o=0;o<a.length;o++)n=a[o],t=e.ui.fancytree._extensions[n],t||e.error("Could not apply extension '"+n+"' (it is not registered, did you forget to include it?)"),this.tree.options[n]=e.extend(!0,{},t.options,this.tree.options[n]),r(this.tree.ext[n]===i,"Extension name must not exist as Fancytree.ext attribute: '"+n+"'"),this.tree.ext[n]={},d(this.tree,l,t,n),l=t;s.icons!==i&&(s.icon!==!0?e.error("'icons' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'icons' tree option is deprecated since v2.14.0: use 'icon' instead"),s.icon=s.icons)),s.iconClass!==i&&(s.icon?e.error("'iconClass' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'iconClass' tree option is deprecated since v2.14.0: use 'icon' instead"),s.icon=s.iconClass)),s.tabbable!==i&&(s.tabindex=s.tabbable?"0":"-1",this.tree.warn("'tabbable' tree option is deprecated since v2.17.0: use 'tabindex='"+s.tabindex+"' instead")),this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree),this._bind()},_setOption:function(t,n){var i=!0,r=!1;switch(t){case"aria":case"checkbox":case"icon":case"minExpandLevel":case"tabindex":this.tree._callHook("treeCreate",this.tree),r=!0;break;case"escapeTitles":r=!0;break;case"source":i=!1,this.tree._callHook("treeLoad",this.tree,n)}this.tree.debug("set option "+t+"="+n+" <"+("undefined"==typeof n?"undefined":_typeof(n))+">"),i&&e.Widget.prototype._setOption.apply(this,arguments),r&&this.tree.render(!0,!1)},destroy:function(){this._unbind(),this.tree._callHook("treeDestroy",this.tree),e.Widget.prototype.destroy.call(this)},_unbind:function(){var t=this.tree._ns;this.element.unbind(t),this.tree.$container.unbind(t),e(n).unbind(t)},_bind:function(){var e=this,t=this.options,n=this.tree,i=n._ns;this._unbind(),n.$container.on("focusin"+i+" focusout"+i,function(e){var t=C.getNode(e),i="focusin"===e.type;t?n._callHook("nodeSetFocus",t,i):n._callHook("treeSetFocus",n,i)}).on("selectstart"+i,"span.fancytree-title",function(e){e.preventDefault()}).on("keydown"+i,function(e){if(t.disabled||t.keyboard===!1)return!0;var i,r=n.focusNode,o=n._makeHookContext(r||n,e),s=n.phase;try{return n.phase="userEvent",i=r?n._triggerNodeEvent("keydown",r,e):n._triggerTreeEvent("keydown",e),"preventNav"===i?i=!0:i!==!1&&(i=n._callHook("nodeKeydown",o)),i}finally{n.phase=s}}).on("click"+i+" dblclick"+i,function(n){if(t.disabled)return!0;var i,r=C.getEventTarget(n),o=r.node,s=e.tree,a=s.phase;if(!o)return!0;i=s._makeHookContext(o,n);try{switch(s.phase="userEvent",n.type){case"click":return i.targetType=r.type,o.isPagingNode()?s._triggerNodeEvent("clickPaging",i,n)===!0:s._triggerNodeEvent("click",i,n)!==!1&&s._callHook("nodeClick",i);case"dblclick":return i.targetType=r.type,s._triggerNodeEvent("dblclick",i,n)!==!1&&s._callHook("nodeDblclick",i)}}finally{s.phase=a}})},getActiveNode:function(){return this.tree.activeNode},getNodeByKey:function(e){return this.tree.getNodeByKey(e)},getRootNode:function(){return this.tree.rootNode},getTree:function(){return this.tree}}),C=e.ui.fancytree,e.extend(e.ui.fancytree,{version:"2.18.0",buildType:"production",debugLevel:1,_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:m,_FancytreeNodeClass:v,jquerySupports:{positionMyOfs:a(e.ui.version,1,9)},assert:function(e,t){return r(e,t)},debounce:function(e,t,n,i){var r;return 3===arguments.length&&"boolean"!=typeof n&&(i=n,n=!1),function(){var o=arguments;i=i||this,n&&!r&&t.apply(i,o),clearTimeout(r),r=setTimeout(function(){n||t.apply(i,o),r=null},e)}},debug:function(t){e.ui.fancytree.debugLevel>=2&&o("log",arguments)},error:function(e){o("error",arguments)},escapeHtml:f,fixPositionOptions:function(t){if((t.offset||(""+t.my+t.at).indexOf("%")>=0)&&e.error("expected new position syntax (but '%' is not supported)"),!e.ui.fancytree.jquerySupports.positionMyOfs){var n=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(t.my),i=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(t.at),r=(n[2]?+n[2]:0)+(i[2]?+i[2]:0),o=(n[4]?+n[4]:0)+(i[4]?+i[4]:0);t=e.extend({},t,{my:n[1]+" "+n[3],at:i[1]+" "+i[3]}),(r||o)&&(t.offset=""+r+" "+o)}return t},getEventTargetType:function(e){return this.getEventTarget(e).type},getEventTarget:function(t){var n=t&&t.target?t.target.className:"",r={node:this.getNode(t.target),type:i};return/\bfancytree-title\b/.test(n)?r.type="title":/\bfancytree-expander\b/.test(n)?r.type=r.node.hasChildren()===!1?"prefix":"expander":/\bfancytree-checkbox\b/.test(n)||/\bfancytree-radio\b/.test(n)?r.type="checkbox":/\bfancytree-icon\b/.test(n)?r.type="icon":/\bfancytree-node\b/.test(n)?r.type="title":t&&t.target&&e(t.target).closest(".fancytree-title").length&&(r.type="title"),r},getNode:function(e){if(e instanceof v)return e;for(e.selector!==i?e=e[0]:e.originalEvent!==i&&(e=e.target);e;){if(e.ftnode)return e.ftnode;e=e.parentNode}return null},getTree:function(t){var n;return t instanceof m?t:(t===i&&(t=0),"number"==typeof t?t=e(".fancytree-container").eq(t):"string"==typeof t?t=e(t).eq(0):t.selector!==i?t=t.eq(0):t.originalEvent!==i&&(t=e(t.target)),t=t.closest(":ui-fancytree"),n=t.data("ui-fancytree")||t.data("fancytree"),n?n.tree:null)},info:function(t){e.ui.fancytree.debugLevel>=1&&o("info",arguments)},eventToString:function(e){var t=e.which,n=e.type,i=[];return e.altKey&&i.push("alt"),e.ctrlKey&&i.push("ctrl"),e.metaKey&&i.push("meta"),e.shiftKey&&i.push("shift"),"click"===n||"dblclick"===n?i.push(A[e.button]+n):w[t]||i.push(E[t]||String.fromCharCode(t).toLowerCase()),i.join("+")},keyEventToString:function(e){return this.warn("keyEventToString() is deprecated: use eventToString()"),this.eventToString(e)},parseHtml:function(t){var n,r,o,s,a,l,d,c,u=t.find(">li"),h=[];return u.each(function(){var u,f,g=e(this),y=g.find(">span:first",this),v=y.length?null:g.find(">a:first"),m={tooltip:null,data:{}};for(y.length?m.title=y.html():v&&v.length?(m.title=v.html(),m.data.href=v.attr("href"),m.data.target=v.attr("target"),m.tooltip=v.attr("title")):(m.title=g.html(),a=m.title.search(/<ul/i),a>=0&&(m.title=m.title.substring(0,a))),m.title=e.trim(m.title),s=0,l=T.length;s<l;s++)m[T[s]]=i;for(n=this.className.split(" "),o=[],s=0,l=n.length;s<l;s++)r=n[s],F[r]?m[r]=!0:o.push(r);if(m.extraClasses=o.join(" "),d=g.attr("title"),d&&(m.tooltip=d),d=g.attr("id"),d&&(m.key=d),u=p(g),u&&!e.isEmptyObject(u)){for(f in R)u.hasOwnProperty(f)&&(u[R[f]]=u[f],delete u[f]);for(s=0,l=P.length;s<l;s++)d=P[s],c=u[d],null!=c&&(delete u[d],m[d]=c);e.extend(m.data,u)}t=g.find(">ul:first"),t.length?m.children=e.ui.fancytree.parseHtml(t):m.children=m.lazy?i:null,h.push(m)}),h},registerExtension:function(t){r(null!=t.name,"extensions must have a `name` property."),r(null!=t.version,"extensions must have a `version` property."),e.ui.fancytree._extensions[t.name]=t},unescapeHtml:function(e){var t=n.createElement("div");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue},warn:function(e){o("warn",arguments)}})}(jQuery,window,document),function(e,t){e.ui.fancytree._FancytreeClass.prototype.countSelected=function(e){var t=this;t.options;return t.getSelectedNodes(e).length},e.ui.fancytree._FancytreeNodeClass.prototype.updateCounters=function(){var t=this,n=e("span.fancytree-childcounter",t.span),i=t.tree.options.childcounter,r=t.countChildren(i.deep);t.data.childCounter=r,!r&&i.hideZeros||t.isExpanded()&&i.hideExpanded?n.remove():(n.length||(n=e("<span class='fancytree-childcounter'/>").appendTo(e("span.fancytree-icon",t.span))),n.text(r)),!i.deep||t.isTopLevel()||t.isRoot()||t.parent.updateCounters()},e.ui.fancytree.prototype.widgetMethod1=function(e){this.tree;return e},e.ui.fancytree.registerExtension({name:"childcounter",version:"1.0.0",options:{deep:!0,hideZeros:!0,hideExpanded:!1},foo:42,_appendCounter:function(e){},treeInit:function(e){e.options,e.options.childcounter;this._superApply(arguments),this.$container.addClass("fancytree-ext-childcounter")},treeDestroy:function(e){this._superApply(arguments)},nodeRenderTitle:function(t,n){var i=t.node,r=t.options.childcounter,o=null==i.data.childCounter?i.countChildren(r.deep):+i.data.childCounter;this._superApply(arguments),!o&&r.hideZeros||i.isExpanded()&&r.hideExpanded||e("span.fancytree-icon",i.span).append(e("<span class='fancytree-childcounter'/>").text(o))},nodeSetExpanded:function(e,t,n){var i=e.tree;e.node;return this._superApply(arguments).always(function(){i.nodeRenderTitle(e)})}})}(jQuery),function(e,t,n,i){function r(t,n){t||(n=n?": "+n:"",e.error("Assertion failed"+n))}function o(e,t){var n;for(n=e.length-1;n>=0;n--)if(e[n]===t)return e.splice(n,1),!0;return!1}function s(e,t,n){for(var i,r,o=3&e.length,s=e.length-o,a=n,l=3432918353,d=461845907,c=0;c<s;)r=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,r=(65535&r)*l+(((r>>>16)*l&65535)<<16)&4294967295,r=r<<15|r>>>17,r=(65535&r)*d+(((r>>>16)*d&65535)<<16)&4294967295,a^=r,a=a<<13|a>>>19,i=5*(65535&a)+((5*(a>>>16)&65535)<<16)&4294967295,a=(65535&i)+27492+(((i>>>16)+58964&65535)<<16);switch(r=0,o){case 3:r^=(255&e.charCodeAt(c+2))<<16;case 2:r^=(255&e.charCodeAt(c+1))<<8;case 1:r^=255&e.charCodeAt(c),r=(65535&r)*l+(((r>>>16)*l&65535)<<16)&4294967295,r=r<<15|r>>>17,r=(65535&r)*d+(((r>>>16)*d&65535)<<16)&4294967295,a^=r}return a^=e.length,a^=a>>>16,a=2246822507*(65535&a)+((2246822507*(a>>>16)&65535)<<16)&4294967295,a^=a>>>13,a=3266489909*(65535&a)+((3266489909*(a>>>16)&65535)<<16)&4294967295,a^=a>>>16,t?("0000000"+(a>>>0).toString(16)).substr(-8):a>>>0}function a(t){var n,i=e.map(t.getParentList(!1,!0),function(e){return e.refKey||e.key});return i=i.join("/"),n="id_"+s(i,!0)}e.ui.fancytree._FancytreeNodeClass.prototype.getCloneList=function(t){var n,i=this.tree,r=i.refMap[this.refKey]||null,o=i.keyMap;return r&&(n=this.key,t?r=e.map(r,function(e){return o[e]}):(r=e.map(r,function(e){return e===n?null:o[e]}),r.length<1&&(r=null))),r},e.ui.fancytree._FancytreeNodeClass.prototype.isClone=function(){var e=this.refKey||null,t=e&&this.tree.refMap[e]||null;return!!(t&&t.length>1)},e.ui.fancytree._FancytreeNodeClass.prototype.reRegister=function(t,n){t=null==t?null:""+t,n=null==n?null:""+n;var i=this.tree,r=this.key,o=this.refKey,s=i.keyMap,a=i.refMap,l=a[o]||null,d=!1;return null!=t&&t!==this.key&&(s[t]&&e.error("[ext-clones] reRegister("+t+"): already exists: "+this),delete s[r],s[t]=this,l&&(a[o]=e.map(l,function(e){return e===r?t:e})),this.key=t,d=!0),null!=n&&n!==this.refKey&&(l&&(1===l.length?delete a[o]:a[o]=e.map(l,function(e){return e===r?null:e})),a[n]?a[n].append(t):a[n]=[this.key],this.refKey=n,d=!0),d},e.ui.fancytree._FancytreeNodeClass.prototype.setRefKey=function(e){return this.reRegister(null,e)},e.ui.fancytree._FancytreeClass.prototype.getNodesByRef=function(t,n){var i=this.keyMap,r=this.refMap[t]||null;return r&&(r=n?e.map(r,function(e){var t=i[e];return t.isDescendantOf(n)?t:null}):e.map(r,function(e){return i[e]}),r.length<1&&(r=null)),r},e.ui.fancytree._FancytreeClass.prototype.changeRefKey=function(e,t){var n,i,r=this.keyMap,o=this.refMap[e]||null;if(o){for(n=0;n<o.length;n++)i=r[o[n]],i.refKey=t;delete this.refMap[e],this.refMap[t]=o}},e.ui.fancytree.registerExtension({name:"clones",version:"0.0.3",options:{highlightActiveClones:!0,highlightClones:!1},treeCreate:function(e){this._superApply(arguments),e.tree.refMap={},e.tree.keyMap={}},treeInit:function(e){this.$container.addClass("fancytree-ext-clones"),r(null==e.options.defaultKey),e.options.defaultKey=function(e){return a(e)},this._superApply(arguments)},treeClear:function(e){return e.tree.refMap={},e.tree.keyMap={},this._superApply(arguments)},treeRegisterNode:function(t,n,i){var s,a,l=t.tree,d=l.keyMap,c=l.refMap,u=i.key,h=i&&null!=i.refKey?""+i.refKey:null;return i.isStatusNode()?this._superApply(arguments):(n?(null!=d[i.key]&&e.error("clones.treeRegisterNode: node.key already exists: "+i),d[u]=i,h&&(s=c[h],s?(s.push(u),2===s.length&&t.options.clones.highlightClones&&d[s[0]].renderStatus()):c[h]=[u])):(null==d[u]&&e.error("clones.treeRegisterNode: node.key not registered: "+i.key),delete d[u],h&&(s=c[h],s&&(a=s.length,a<=1?(r(1===a),r(s[0]===u),delete c[h]):(o(s,u),2===a&&t.options.clones.highlightClones&&d[s[0]].renderStatus())))),this._superApply(arguments))},nodeRenderStatus:function(t){var n,i,r=t.node;return i=this._superApply(arguments),t.options.clones.highlightClones&&(n=e(r[t.tree.statusClassPropName]),n.length&&r.isClone()&&n.addClass("fancytree-clone")),i},nodeSetActive:function(t,n){var i,r=t.tree.statusClassPropName,o=t.node;return i=this._superApply(arguments),t.options.clones.highlightActiveClones&&o.isClone()&&e.each(o.getCloneList(!0),function(t,i){e(i[r]).toggleClass("fancytree-active-clone",n!==!1)}),i}})}(jQuery,window,document),function(e,t,n,i){function r(e){return 0===e?"":e>0?"+"+e:""+e}function o(){a||(e.ui.plugin.add("draggable","connectToFancytree",{start:function(t,n){var i=e(this).data("ui-draggable")||e(this).data("draggable"),r=n.helper.data("ftSourceNode")||null;if(r)return i.offset.click.top=-2,i.offset.click.left=16,r.tree.ext.dnd._onDragEvent("start",r,null,t,n,i)},drag:function(t,n){var i,r,o,s=e(this).data("ui-draggable")||e(this).data("draggable"),a=n.helper.data("ftSourceNode")||null,l=n.helper.data("ftTargetNode")||null,d=e.ui.fancytree.getNode(t.target),c=a&&a.tree.options.dnd;return t.target&&!d&&(r=e(t.target).closest("div.fancytree-drag-helper,#fancytree-drop-marker").length>0)?(o=a||l||e.ui.fancytree,void o.debug("Drag event over helper: ignored.")):(n.helper.data("ftTargetNode",d),c&&c.updateHelper&&(i=a.tree._makeHookContext(a,t,{otherNode:d,ui:n,draggable:s,dropMarker:e("#fancytree-drop-marker")}),c.updateHelper.call(a.tree,a,i)),l&&l!==d&&l.tree.ext.dnd._onDragEvent("leave",l,a,t,n,s),void(d&&d.tree.options.dnd.dragDrop&&(d===l?d.tree.ext.dnd._onDragEvent("over",d,a,t,n,s):(d.tree.ext.dnd._onDragEvent("enter",d,a,t,n,s),d.tree.ext.dnd._onDragEvent("over",d,a,t,n,s)))))},stop:function(t,n){var i,r=e(this).data("ui-draggable")||e(this).data("draggable"),o=n.helper.data("ftSourceNode")||null,s=n.helper.data("ftTargetNode")||null,a="mouseup"===t.type&&1===t.which;a||(i=o||s||e.ui.fancytree,i.debug("Drag was cancelled")),s&&(a&&s.tree.ext.dnd._onDragEvent("drop",s,o,t,n,r),s.tree.ext.dnd._onDragEvent("leave",s,o,t,n,r)),o&&o.tree.ext.dnd._onDragEvent("stop",o,null,t,n,r)}}),a=!0)}function s(t){var n=t.options.dnd||null,i=t.options.glyph||null;n&&o(),n&&n.dragStart&&t.widget.element.draggable(e.extend({addClasses:!1,appendTo:t.$container,containment:!1,delay:0,distance:4,revert:!1,scroll:!0,scrollSpeed:7,scrollSensitivity:10,connectToFancytree:!0,helper:function(t){var n,r,o,s=e.ui.fancytree.getNode(t.target);return s?(o=s.tree.options.dnd,r=e(s.span),n=e("<div class='fancytree-drag-helper'><span class='fancytree-drag-helper-img' /></div>").css({zIndex:3,position:"relative"}).append(r.find("span.fancytree-title").clone()),n.data("ftSourceNode",s),i&&n.find(".fancytree-drag-helper-img").addClass(i.map.dragHelper),o.initHelper&&o.initHelper.call(s.tree,s,{node:s,tree:s.tree,originalEvent:t,ui:{helper:n}}),n):"<div>ERROR?: helper requested but sourceNode not found</div>"},start:function(e,t){var n=t.helper.data("ftSourceNode");return!!n}},t.options.dnd.draggable)),n&&n.dragDrop&&t.widget.element.droppable(e.extend({addClasses:!1,tolerance:"intersect",greedy:!1},t.options.dnd.droppable))}var a=!1,l="fancytree-drop-accept",d="fancytree-drop-after",c="fancytree-drop-before",u="fancytree-drop-over",h="fancytree-drop-reject",p="fancytree-drop-target";e.ui.fancytree.registerExtension({name:"dnd",version:"0.3.0",options:{autoExpandMS:1e3,draggable:null,droppable:null,focusOnClick:!1,preventVoidMoves:!0,preventRecursiveMoves:!0,smartRevert:!0,dragStart:null,dragStop:null,initHelper:null,updateHelper:null,dragEnter:null,dragOver:null,dragExpand:null,dragDrop:null,dragLeave:null},treeInit:function(t){var n=t.tree;this._superApply(arguments),n.options.dnd.dragStart&&n.$container.on("mousedown",function(n){if(t.options.dnd.focusOnClick){var i=e.ui.fancytree.getNode(n);i&&i.debug("Re-enable focus that was prevented by jQuery UI draggable."),setTimeout(function(){e(n.target).closest(":tabbable").focus()},10)}}),s(n)},_setDndStatus:function(t,n,i,o,s){var a=0,f="center",g=this._local,y=this.options.glyph||null,v=t?e(t.span):null,m=e(n.span);if(g.$dropMarker||(g.$dropMarker=e("<div id='fancytree-drop-marker'></div>").hide().css({"z-index":1e3}).prependTo(e(this.$div).parent()),y&&g.$dropMarker.addClass(y.map.dropMarker)),"after"===o||"before"===o||"over"===o){switch(o){case"before":f="top";break;case"after":f="bottom";break;default:a=8}g.$dropMarker.toggleClass(d,"after"===o).toggleClass(u,"over"===o).toggleClass(c,"before"===o).show().position(e.ui.fancytree.fixPositionOptions({my:"left"+r(a)+" center",at:"left "+f,of:m}))}else g.$dropMarker.hide();v&&v.toggleClass(l,s===!0).toggleClass(h,s===!1),m.toggleClass(p,"after"===o||"before"===o||"over"===o).toggleClass(d,"after"===o).toggleClass(c,"before"===o).toggleClass(l,s===!0).toggleClass(h,s===!1),i.toggleClass(l,s===!0).toggleClass(h,s===!1)},_onDragEvent:function(t,r,o,s,a,l){var d,c,u,h,p,f,g,y,v,m=this.options,x=m.dnd,b=this._makeHookContext(r,s,{otherNode:o,ui:a,draggable:l}),C=null,k=this,_=e(r.span);switch(x.smartRevert&&(l.options.revert="invalid"),t){case"start":r.isStatusNode()?C=!1:x.dragStart&&(C=x.dragStart(r,b)),C===!1?(this.debug("tree.dragStart() cancelled"),a.helper.trigger("mouseup").hide()):(x.smartRevert&&(h=r[b.tree.nodeContainerAttrName].getBoundingClientRect(),u=e(l.options.appendTo)[0].getBoundingClientRect(),l.originalPosition.left=Math.max(0,h.left-u.left),l.originalPosition.top=Math.max(0,h.top-u.top)),_.addClass("fancytree-drag-source"),e(n).on("keydown.fancytree-dnd,mousedown.fancytree-dnd",function(t){"keydown"===t.type&&t.which===e.ui.keyCode.ESCAPE?k.ext.dnd._cancelDrag():"mousedown"===t.type&&k.ext.dnd._cancelDrag()}));break;case"enter":v=(!x.preventRecursiveMoves||!r.isDescendantOf(o))&&(x.dragEnter?x.dragEnter(r,b):null),C=!!v&&(e.isArray(v)?{over:e.inArray("over",v)>=0,before:e.inArray("before",v)>=0,after:e.inArray("after",v)>=0}:{over:v===!0||"over"===v,before:v===!0||"before"===v,after:v===!0||"after"===v}),a.helper.data("enterResponse",C);break;case"over":g=a.helper.data("enterResponse"),y=null,g===!1||("string"==typeof g?y=g:(c=_.offset(),p={x:s.pageX-c.left,y:s.pageY-c.top},f={x:p.x/_.width(),y:p.y/_.height()},g.after&&f.y>.75?y="after":!g.over&&g.after&&f.y>.5?y="after":g.before&&f.y<=.25?y="before":!g.over&&g.before&&f.y<=.5?y="before":g.over&&(y="over"),x.preventVoidMoves&&(r===o?(this.debug("    drop over source node prevented"),y=null):"before"===y&&o&&r===o.getNextSibling()?(this.debug("    drop after source node prevented"),y=null):"after"===y&&o&&r===o.getPrevSibling()?(this.debug("    drop before source node prevented"),y=null):"over"===y&&o&&o.parent===r&&o.isLastSibling()&&(this.debug("    drop last child over own parent prevented"),y=null)),a.helper.data("hitMode",y))),"before"===y||"after"===y||!x.autoExpandMS||r.hasChildren()===!1||r.expanded||x.dragExpand&&x.dragExpand(r,b)===!1||r.scheduleAction("expand",x.autoExpandMS),y&&x.dragOver&&(b.hitMode=y,C=x.dragOver(r,b)),d=C!==!1&&null!==y,x.smartRevert&&(l.options.revert=!d),this._local._setDndStatus(o,r,a.helper,y,d);break;case"drop":y=a.helper.data("hitMode"),y&&x.dragDrop&&(b.hitMode=y,x.dragDrop(r,b));
break;case"leave":r.scheduleAction("cancel"),a.helper.data("enterResponse",null),a.helper.data("hitMode",null),this._local._setDndStatus(o,r,a.helper,"out",i),x.dragLeave&&x.dragLeave(r,b);break;case"stop":_.removeClass("fancytree-drag-source"),e(n).off(".fancytree-dnd"),x.dragStop&&x.dragStop(r,b);break;default:e.error("Unsupported drag event: "+t)}return C},_cancelDrag:function(){var t=e.ui.ddmanager.current;t&&t.cancel()}})}(jQuery,window,document),function(e,t,n,i){var r=/Mac/.test(navigator.platform),o=e.ui.fancytree.escapeHtml,s=e.ui.fancytree.unescapeHtml;e.ui.fancytree._FancytreeNodeClass.prototype.editStart=function(){var t,i=this,r=this.tree,o=r.ext.edit,a=r.options.edit,l=e(".fancytree-title",i.span),d={node:i,tree:r,options:r.options,isNew:e(i[r.statusClassPropName]).hasClass("fancytree-edit-new"),orgTitle:i.title,input:null,dirty:!1};return a.beforeEdit.call(i,{type:"beforeEdit"},d)!==!1&&(e.ui.fancytree.assert(!o.currentNode,"recursive edit"),o.currentNode=this,o.eventData=d,r.widget._unbind(),e(n).on("mousedown.fancytree-edit",function(t){e(t.target).hasClass("fancytree-edit-input")||i.editEnd(!0,t)}),t=e("<input />",{"class":"fancytree-edit-input",type:"text",value:r.options.escapeTitles?d.orgTitle:s(d.orgTitle)}),o.eventData.input=t,null!=a.adjustWidthOfs&&t.width(l.width()+a.adjustWidthOfs),null!=a.inputCss&&t.css(a.inputCss),l.html(t),t.focus().change(function(e){t.addClass("fancytree-edit-dirty")}).keydown(function(t){switch(t.which){case e.ui.keyCode.ESCAPE:i.editEnd(!1,t);break;case e.ui.keyCode.ENTER:return i.editEnd(!0,t),!1}t.stopPropagation()}).blur(function(e){return i.editEnd(!0,e)}),void a.edit.call(i,{type:"edit"},d))},e.ui.fancytree._FancytreeNodeClass.prototype.editEnd=function(t,i){var r,s=this,a=this.tree,l=a.ext.edit,d=l.eventData,c=a.options.edit,u=e(".fancytree-title",s.span),h=u.find("input.fancytree-edit-input");return c.trim&&h.val(e.trim(h.val())),r=h.val(),d.dirty=r!==s.title,t===!1?d.save=!1:d.isNew?d.save=""!==r:d.save=d.dirty&&""!==r,c.beforeClose.call(s,{type:"beforeClose"},d)!==!1&&((!d.save||c.save.call(s,{type:"save"},d)!==!1)&&(h.removeClass("fancytree-edit-dirty").unbind(),e(n).off(".fancytree-edit"),d.save?(s.setTitle(a.options.escapeTitles?r:o(r)),s.setFocus()):d.isNew?(s.remove(),s=d.node=null,l.relatedNode.setFocus()):(s.renderTitle(),s.setFocus()),l.eventData=null,l.currentNode=null,l.relatedNode=null,a.widget._bind(),e(a.$container).focus(),d.input=null,c.close.call(s,{type:"close"},d),!0))},e.ui.fancytree._FancytreeNodeClass.prototype.editCreateNode=function(t,n){var i,r=this.tree,o=this;return t=t||"child",null==n?n={title:""}:"string"==typeof n?n={title:n}:e.ui.fancytree.assert(e.isPlainObject(n)),"child"!==t||this.isExpanded()||this.hasChildren()===!1?(i=this.addNode(n,t),void i.makeVisible().done(function(){e(i[r.statusClassPropName]).addClass("fancytree-edit-new"),o.tree.ext.edit.relatedNode=o,i.editStart()})):void this.setExpanded().done(function(){o.editCreateNode(t,n)})},e.ui.fancytree._FancytreeClass.prototype.isEditing=function(){return this.ext.edit.currentNode},e.ui.fancytree._FancytreeNodeClass.prototype.isEditing=function(){return this.tree.ext.edit.currentNode===this},e.ui.fancytree.registerExtension({name:"edit",version:"0.2.0",options:{adjustWidthOfs:4,allowEmpty:!1,inputCss:{minWidth:"3em"},triggerCancel:["esc","tab","click"],triggerStart:["f2","shift+click","mac+enter"],trim:!0,beforeClose:e.noop,beforeEdit:e.noop,close:e.noop,edit:e.noop,save:e.noop},currentNode:null,treeInit:function(e){this._superApply(arguments),this.$container.addClass("fancytree-ext-edit")},nodeClick:function(t){return e.inArray("shift+click",t.options.edit.triggerStart)>=0&&t.originalEvent.shiftKey?(t.node.editStart(),!1):this._superApply(arguments)},nodeDblclick:function(t){return e.inArray("dblclick",t.options.edit.triggerStart)>=0?(t.node.editStart(),!1):this._superApply(arguments)},nodeKeydown:function(t){switch(t.originalEvent.which){case 113:if(e.inArray("f2",t.options.edit.triggerStart)>=0)return t.node.editStart(),!1;break;case e.ui.keyCode.ENTER:if(e.inArray("mac+enter",t.options.edit.triggerStart)>=0&&r)return t.node.editStart(),!1}return this._superApply(arguments)}})}(jQuery,window,document),function(e,t,n,i){function r(e){return(e+"").replace(/([.?*+\^\$\[\]\\(){}|-])/g,"\\$1")}function o(t){return t.indexOf(">")>=0?e("<div/>").html(t).text():t}var s="__not_found__",a=e.ui.fancytree.escapeHtml;e.ui.fancytree._FancytreeClass.prototype._applyFilterImpl=function(t,n,i){var l,d,c,u,h,p=0,f=this.options,g=f.escapeTitles,y=f.filter,v="hide"===y.mode;return i=i||{},l=!!i.leavesOnly&&!n,"string"==typeof t&&(d=y.fuzzy?t.split("").reduce(function(e,t){return e+"[^"+t+"]*"+t}):r(t),u=new RegExp(".*"+d+".*","i"),h=new RegExp(t,"gi"),t=function(e){var t,n=g?e.title:o(e.title),i=!!u.test(n);return i&&y.highlight&&(t=g?a(e.title):n,e.titleWithHighlight=t.replace(h,function(e){return"<mark>"+e+"</mark>"})),i}),this.enableFilter=!0,this.lastFilterArgs=arguments,this.$div.addClass("fancytree-ext-filter"),v?this.$div.addClass("fancytree-ext-filter-hide"):this.$div.addClass("fancytree-ext-filter-dimm"),this.visit(function(e){delete e.match,delete e.titleWithHighlight,e.subMatchCount=0}),c=this.getRootNode()._findDirectChild(s),c&&c.remove(),this.visit(function(e){if(!l||null==e.children){var r=t(e);return"skip"===r?(e.visit(function(e){e.match=!1},!0),"skip"):r&&(p++,e.match=!0,e.visitParents(function(e){e.subMatchCount+=1,i.autoExpand&&!e.expanded&&(e.setExpanded(!0,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),e._filterAutoExpanded=!0)}),n||"branch"===r)?(e.visit(function(e){e.match=!0}),i.autoExpand&&!e.expanded&&(e.setExpanded(!0,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),e._filterAutoExpanded=!0),"skip"):void 0}}),0===p&&y.nodata&&(c=y.nodata,e.isFunction(c)&&(c=c()),c===!0?c={}:"string"==typeof c&&(c={title:c}),c=e.extend({statusNodeType:"nodata",key:s,title:this.options.strings.noData},c),this.getRootNode().addNode(c).match=!0),this.render(),p},e.ui.fancytree._FancytreeClass.prototype.filterNodes=function(e,t){return"boolean"==typeof t&&(t={leavesOnly:t},this.warn("Fancytree.filterNodes() leavesOnly option is deprecated since 2.9.0 / 2015-04-19.")),this._applyFilterImpl(e,!1,t)},e.ui.fancytree._FancytreeClass.prototype.applyFilter=function(e){return this.warn("Fancytree.applyFilter() is deprecated since 2.1.0 / 2014-05-29. Use .filterNodes() instead."),this.filterNodes.apply(this,arguments)},e.ui.fancytree._FancytreeClass.prototype.filterBranches=function(e,t){return this._applyFilterImpl(e,!0,t)},e.ui.fancytree._FancytreeClass.prototype.clearFilter=function(){var t,n=this.getRootNode()._findDirectChild(s),i=this.options.escapeTitles,r=this.options.enhanceTitle;n&&n.remove(),this.visit(function(n){n.match&&(t=e(">span.fancytree-title",n.span),i?t.text(n.title):t.html(n.title),r&&r({type:"enhanceTitle"},{node:n,$title:t})),delete n.match,delete n.subMatchCount,delete n.titleWithHighlight,n.$subMatchBadge&&(n.$subMatchBadge.remove(),delete n.$subMatchBadge),n._filterAutoExpanded&&n.expanded&&n.setExpanded(!1,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),delete n._filterAutoExpanded}),this.enableFilter=!1,this.lastFilterArgs=null,this.$div.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide"),this.render()},e.ui.fancytree._FancytreeClass.prototype.isFilterActive=function(){return!!this.enableFilter},e.ui.fancytree._FancytreeNodeClass.prototype.isMatched=function(){return!(this.tree.enableFilter&&!this.match)},e.ui.fancytree.registerExtension({name:"filter",version:"0.7.0",options:{autoApply:!0,counter:!0,fuzzy:!1,hideExpandedCounter:!0,highlight:!0,nodata:!0,mode:"dimm",enhanceTitle:null},nodeLoadChildren:function(e,t){return this._superApply(arguments).done(function(){e.tree.enableFilter&&e.tree.lastFilterArgs&&e.options.filter.autoApply&&e.tree._applyFilterImpl.apply(e.tree,e.tree.lastFilterArgs)})},nodeSetExpanded:function(e,t,n){return delete e.node._filterAutoExpanded,!t&&e.options.filter.hideExpandedCounter&&e.node.$subMatchBadge&&e.node.$subMatchBadge.show(),this._superApply(arguments)},nodeRenderStatus:function(t){var n,i=t.node,r=t.tree,o=t.options.filter,s=e("span.fancytree-title",i.span),a=e(i[r.statusClassPropName]),l=t.options.enhanceTitle,d=t.options.escapeTitles;return n=this._superApply(arguments),a.length&&r.enableFilter?(a.toggleClass("fancytree-match",!!i.match).toggleClass("fancytree-submatch",!!i.subMatchCount).toggleClass("fancytree-hide",!(i.match||i.subMatchCount)),!o.counter||!i.subMatchCount||i.isExpanded()&&o.hideExpandedCounter?i.$subMatchBadge&&i.$subMatchBadge.hide():(i.$subMatchBadge||(i.$subMatchBadge=e("<span class='fancytree-childcounter'/>"),e("span.fancytree-icon, span.fancytree-custom-icon",i.span).append(i.$subMatchBadge)),i.$subMatchBadge.show().text(i.subMatchCount)),i.titleWithHighlight?s.html(i.titleWithHighlight):d?s.text(i.title):s.html(i.title),l&&l({type:"enhanceTitle"},{node:i,$title:s}),n):n}})}(jQuery,window,document),function(e,t,n,i){function r(e,t){return e.map[t]}e.ui.fancytree.registerExtension({name:"glyph",version:"0.4.0",options:{map:{checkbox:"icon-check-empty",checkboxSelected:"icon-check",checkboxUnknown:"icon-check icon-muted",error:"icon-exclamation-sign",expanderClosed:"icon-caret-right",expanderLazy:"icon-angle-right",expanderOpen:"icon-caret-down",nodata:"icon-meh",noExpander:"",dragHelper:"icon-caret-right",dropMarker:"icon-caret-right",doc:"icon-file-alt",docOpen:"icon-file-alt",loading:"icon-refresh icon-spin",folder:"icon-folder-close-alt",folderOpen:"icon-folder-open-alt"}},treeInit:function(e){var t=e.tree;this._superApply(arguments),t.$container.addClass("fancytree-ext-glyph")},nodeRenderStatus:function(t){var n,i,o,s=t.node,a=e(s.span),l=t.options.glyph,d=l.map;return i=this._superApply(arguments),s.isRoot()?i:(o=a.children("span.fancytree-expander").get(0),o&&(n=s.expanded?"expanderOpen":s.isUndefined()?"expanderLazy":s.hasChildren()?"expanderClosed":"noExpander",o.className="fancytree-expander "+d[n]),o=s.tr?e("td",s.tr).find("span.fancytree-checkbox").get(0):a.children("span.fancytree-checkbox").get(0),o&&(n=s.selected?"checkboxSelected":s.partsel?"checkboxUnknown":"checkbox",o.className="fancytree-checkbox "+d[n]),o=a.children("span.fancytree-icon").get(0),o&&(n=s.statusNodeType?r(l,s.statusNodeType):s.folder?s.expanded?r(l,"folderOpen"):r(l,"folder"):s.expanded?r(l,"docOpen"):r(l,"doc"),o.className="fancytree-icon "+n),i)},nodeSetStatus:function(t,n,i,o){var s,a,l=t.options.glyph,d=t.node;return s=this._superApply(arguments),"error"!==n&&"loading"!==n&&"nodata"!==n||(d.parent?(a=e("span.fancytree-expander",d.span).get(0),a.className="fancytree-expander "+r(l,n)):(a=e(".fancytree-statusnode-"+n,d[this.nodeContainerAttrName]).find("span.fancytree-icon").get(0),a.className="fancytree-icon "+r(l,n))),s}})}(jQuery,window,document),function(e,t,n,i){function r(t,n){var i,r=n.get(0),o=0;return t.children().each(function(){return this!==r&&(i=e(this).prop("colspan"),void(o+=i?i:1))}),o}function o(t,n){var i,r=null,o=0;return t.children().each(function(){return o>=n?(r=e(this),!1):(i=e(this).prop("colspan"),void(o+=i?i:1))}),r}function s(e,t){var n,i,s=e.closest("td"),l=null;switch(t){case a.LEFT:l=s.prev();break;case a.RIGHT:l=s.next();break;case a.UP:case a.DOWN:for(n=s.parent(),i=r(n,s);;){if(n=t===a.UP?n.prev():n.next(),!n.length)break;if(!n.is(":hidden")&&(l=o(n,i),l&&l.find(":input").length))break}}return l}var a=e.ui.keyCode,l={text:[a.UP,a.DOWN],checkbox:[a.UP,a.DOWN,a.LEFT,a.RIGHT],radiobutton:[a.UP,a.DOWN,a.LEFT,a.RIGHT],"select-one":[a.LEFT,a.RIGHT],"select-multiple":[a.LEFT,a.RIGHT]};e.ui.fancytree.registerExtension({name:"gridnav",version:"0.0.1",options:{autofocusInput:!1,handleCursorKeys:!0},treeInit:function(t){this._requireExtension("table",!0,!0),this._superApply(arguments),this.$container.addClass("fancytree-ext-gridnav"),this.$container.on("focusin",function(n){var i,r=e.ui.fancytree.getNode(n.target);r&&!r.isActive()&&(i=t.tree._makeHookContext(r,n),t.tree._callHook("nodeSetActive",i,!0))})},nodeSetActive:function(t,n){var i,r=t.options.gridnav,o=t.node,s=t.originalEvent||{},a=e(s.target).is(":input");n=n!==!1,this._superApply(arguments),n&&(t.options.titlesTabbable?(a||(e(o.span).find("span.fancytree-title").focus(),o.setFocus()),t.tree.$container.attr("tabindex","-1")):r.autofocusInput&&!a&&(i=e(o.tr||o.span),i.find(":input:enabled:first").focus()))},nodeKeydown:function(t){var n,i,r,o=t.options.gridnav,a=t.originalEvent,d=e(a.target);return n=d.is(":input:enabled")?d.prop("type"):null,n&&o.handleCursorKeys?(i=l[n],!(i&&e.inArray(a.which,i)>=0&&(r=s(d,a.which),r&&r.length))||(r.find(":input:enabled").focus(),!1)):this._superApply(arguments)}})}(jQuery,window,document),function(e,t,n,i){function r(t,n,i,o,s){var a,l,d,u,h=!1,p=[],f=[];for(i=i||[],s=s||e.Deferred(),a=0,d=i.length;a<d;a++)l=i[a],u=t.getNodeByKey(l),u?o&&u.isUndefined()?(h=!0,t.debug("_loadLazyNodes: "+u+" is lazy: loading..."),"expand"===o?p.push(u.setExpanded()):p.push(u.load())):(t.debug("_loadLazyNodes: "+u+" already loaded."),u.setExpanded()):(f.push(l),t.debug("_loadLazyNodes: "+u+" was not yet found."));return e.when.apply(e,p).always(function(){if(h&&f.length>0)r(t,n,f,o,s);else{if(f.length)for(t.warn("_loadLazyNodes: could not load those keys: ",f),a=0,d=f.length;a<d;a++)l=i[a],n._appendKey(c,i[a],!1);s.resolve()}}),s}var o,s,a,l=e.ui.fancytree.assert,d="active",c="expanded",u="focus",h="selected";"function"==typeof Cookies?(a=Cookies.set,o=Cookies.get,s=Cookies.remove):(a=o=e.cookie,s=e.removeCookie),e.ui.fancytree._FancytreeClass.prototype.clearCookies=function(e){var t=this.ext.persist,n=t.cookiePrefix;e=e||"active expanded focus selected",e.indexOf(d)>=0&&t._data(n+d,null),e.indexOf(c)>=0&&t._data(n+c,null),e.indexOf(u)>=0&&t._data(n+u,null),e.indexOf(h)>=0&&t._data(n+h,null)},e.ui.fancytree._FancytreeClass.prototype.getPersistData=function(){var e=this.ext.persist,t=e.cookiePrefix,n=e.cookieDelimiter,i={};return i[d]=e._data(t+d),i[c]=(e._data(t+c)||"").split(n),i[h]=(e._data(t+h)||"").split(n),i[u]=e._data(t+u),i},e.ui.fancytree.registerExtension({name:"persist",version:"0.3.0",options:{cookieDelimiter:"~",cookiePrefix:i,cookie:{raw:!1,expires:"",path:"",domain:"",secure:!1},expandLazy:!1,fireActivate:!0,overrideSource:!0,store:"auto",types:"active expanded focus selected"},_data:function(e,t){var n=this._local.localStorage;return t===i?n?n.getItem(e):o(e):void(null===t?n?n.removeItem(e):s(e):n?n.setItem(e,t):a(e,t,this.options.persist.cookie))},_appendKey:function(t,n,i){n=""+n;var r=this._local,o=this.options.persist,s=o.cookieDelimiter,a=r.cookiePrefix+t,l=r._data(a),d=l?l.split(s):[],c=e.inArray(n,d);c>=0&&d.splice(c,1),i&&d.push(n),r._data(a,d.join(s))},treeInit:function(n){var s=n.tree,a=n.options,p=this._local,f=this.options.persist;return l("auto"!==f.store&&"cookie"!==f.store||o,"Missing required plugin for 'persist' extension: js.cookie.js or jquery.cookie.js"),p.cookiePrefix=f.cookiePrefix||"fancytree-"+s._id+"-",p.storeActive=f.types.indexOf(d)>=0,p.storeExpanded=f.types.indexOf(c)>=0,p.storeSelected=f.types.indexOf(h)>=0,p.storeFocus=f.types.indexOf(u)>=0,"cookie"!==f.store&&t.localStorage?p.localStorage="local"===f.store?t.localStorage:t.sessionStorage:p.localStorage=null,s.$div.bind("fancytreeinit",function(t){if(s._triggerTreeEvent("beforeRestore",null,{})!==!1){var n,o,l,g,y,v=p._data(p.cookiePrefix+u),m=f.fireActivate===!1;n=p._data(p.cookiePrefix+c),g=n&&n.split(f.cookieDelimiter),o=p.storeExpanded?r(s,p,g,!!f.expandLazy&&"expand",null):(new e.Deferred).resolve(),o.done(function(){if(p.storeSelected){if(n=p._data(p.cookiePrefix+h))for(g=n.split(f.cookieDelimiter),l=0;l<g.length;l++)y=s.getNodeByKey(g[l]),y?(y.selected===i||f.overrideSource&&y.selected===!1)&&(y.selected=!0,y.renderStatus()):p._appendKey(h,g[l],!1);3===s.options.selectMode&&s.visit(function(e){if(e.selected)return e.fixSelection3AfterClick(),"skip"})}p.storeActive&&(n=p._data(p.cookiePrefix+d),!n||!a.persist.overrideSource&&s.activeNode||(y=s.getNodeByKey(n),y&&(y.debug("persist: set active",n),y.setActive(!0,{noFocus:!0,noEvents:m})))),p.storeFocus&&v&&(y=s.getNodeByKey(v),y&&(s.options.titlesTabbable?e(y.span).find(".fancytree-title").focus():e(s.$container).focus())),s._triggerTreeEvent("restore",null,{})})}}),this._superApply(arguments)},nodeSetActive:function(e,t,n){var i,r=this._local;return t=t!==!1,i=this._superApply(arguments),r.storeActive&&r._data(r.cookiePrefix+d,this.activeNode?this.activeNode.key:null),i},nodeSetExpanded:function(e,t,n){var i,r=e.node,o=this._local;return t=t!==!1,i=this._superApply(arguments),o.storeExpanded&&o._appendKey(c,r.key,t),i},nodeSetFocus:function(e,t){var n,i=this._local;return t=t!==!1,n=this._superApply(arguments),i.storeFocus&&i._data(i.cookiePrefix+u,this.focusNode?this.focusNode.key:null),n},nodeSetSelected:function(t,n){var i,r,o=t.tree,s=t.node,a=this._local;return n=n!==!1,i=this._superApply(arguments),a.storeSelected&&(3===o.options.selectMode?(r=e.map(o.getSelectedNodes(!0),function(e){return e.key}),r=r.join(t.options.persist.cookieDelimiter),a._data(a.cookiePrefix+h,r)):a._appendKey(h,s.key,s.selected)),i}})}(jQuery,window,document),function(e,t,n,i){function r(t,n){n=n||"",t||e.error("Assertion failed "+n)}function o(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function s(e,t){e.visit(function(e){var n=e.tr;if(n&&(n.style.display=e.hide||!t?"none":""),!e.expanded)return"skip"})}function a(t){var n,i,o,s=t.parent,a=s?s.children:null;if(a&&a.length>1&&a[0]!==t)for(n=e.inArray(t,a),o=a[n-1],r(o.tr);o.children&&(i=o.children[o.children.length-1],i.tr);)o=i;else o=s;return o}e.ui.fancytree.registerExtension({name:"table",version:"0.3.0",options:{checkboxColumnIdx:null,indentation:16,nodeColumnIdx:0},treeInit:function(t){var i,o,s,a,l=t.tree,d=t.options,c=d.table,u=l.widget.element;if(null!=c.customStatus&&(null!=d.renderStatusColumns?e.error("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' only instead."):(l.warn("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' instead."),d.renderStatusColumns=c.customStatus)),d.renderStatusColumns&&d.renderStatusColumns===!0&&(d.renderStatusColumns=d.renderColumns),u.addClass("fancytree-container fancytree-ext-table"),l.tbody=u.find(">tbody")[0],a=e(l.tbody),l.columnCount=e("thead >tr:last >th",u).length,s=a.children("tr:first"),s.length)o=s.children("td").length,l.columnCount&&o!==l.columnCount&&(l.warn("Column count mismatch between thead ("+l.columnCount+") and tbody ("+o+"); using tbody."),l.columnCount=o),s=s.clone();else for(r(l.columnCount>=1,"Need either <thead> or <tbody> with <td> elements to determine column count."),s=e("<tr />"),i=0;i<l.columnCount;i++)s.append("<td />");s.find(">td").eq(c.nodeColumnIdx).html("<span class='fancytree-node' />"),d.aria&&(s.attr("role","row"),s.find("td").attr("role","gridcell")),l.rowFragment=n.createDocumentFragment(),l.rowFragment.appendChild(s.get(0)),a.empty(),l.statusClassPropName="tr",l.ariaPropName="tr",this.nodeContainerAttrName="tr",l.$container=u,this._superApply(arguments),e(l.rootNode.ul).remove(),l.rootNode.ul=null,this.$container.attr("tabindex",d.tabindex),d.aria&&l.$container.attr("role","treegrid").attr("aria-readonly",!0)},nodeRemoveChildMarkup:function(t){var n=t.node;n.visit(function(t){t.tr&&(e(t.tr).remove(),t.tr=null)})},nodeRemoveMarkup:function(t){var n=t.node;n.tr&&(e(n.tr).remove(),n.tr=null),this.nodeRemoveChildMarkup(t)},nodeRender:function(t,n,i,l,d){var c,u,h,p,f,g,y,v,m=t.tree,x=t.node,b=t.options,C=!x.parent;if(d||(t.hasCollapsedParents=x.parent&&!x.parent.expanded),!C)if(x.tr)n?this.nodeRenderTitle(t):this.nodeRenderStatus(t);else{if(t.hasCollapsedParents&&!i)return void x.debug("nodeRender ignored due to unrendered parent");f=m.rowFragment.firstChild.cloneNode(!0),g=a(x),r(g),l===!0&&d?f.style.display="none":i&&t.hasCollapsedParents&&(f.style.display="none"),g.tr?o(g.tr,f):(r(!g.parent,"prev. row must have a tr, or is system root"),m.tbody.appendChild(f)),x.tr=f,x.key&&b.generateIds&&(x.tr.id=b.idPrefix+x.key),x.tr.ftnode=x,b.aria&&e(x.tr).attr("aria-labelledby","ftal_"+x.key),x.span=e("span.fancytree-node",x.tr).get(0),this.nodeRenderTitle(t),b.createNode&&b.createNode.call(m,{type:"createNode"},t)}if(b.renderNode&&b.renderNode.call(m,{type:"renderNode"},t),c=x.children,c&&(C||i||x.expanded))for(h=0,p=c.length;h<p;h++)v=e.extend({},t,{node:c[h]}),v.hasCollapsedParents=v.hasCollapsedParents||!x.expanded,this.nodeRender(v,n,i,l,!0);c&&!d&&(y=x.tr||null,u=m.tbody.firstChild,x.visit(function(e){if(e.tr){if(e.parent.expanded||"none"===e.tr.style.display||(e.tr.style.display="none",s(e,!1)),e.tr.previousSibling!==y){x.debug("_fixOrder: mismatch at node: "+e);var t=y?y.nextSibling:u;m.tbody.insertBefore(e.tr,t)}y=e.tr}}))},nodeRenderTitle:function(t,n){var i,r,o=t.node,s=t.options,a=o.isStatusNode();return r=this._superApply(arguments),o.isRootNode()?r:(s.checkbox&&!a&&null!=s.table.checkboxColumnIdx&&(i=e("span.fancytree-checkbox",o.span),e(o.tr).find("td").eq(+s.table.checkboxColumnIdx).html(i)),this.nodeRenderStatus(t),a?s.renderStatusColumns&&s.renderStatusColumns.call(t.tree,{type:"renderStatusColumns"},t):s.renderColumns&&s.renderColumns.call(t.tree,{type:"renderColumns"},t),r)},nodeRenderStatus:function(t){var n,i=t.node,r=t.options;this._superApply(arguments),e(i.tr).removeClass("fancytree-node"),n=(i.getLevel()-1)*r.table.indentation,e(i.span).css({paddingLeft:n+"px"})},nodeSetExpanded:function(t,n,i){function r(e){s(t.node,n),e?n&&t.options.autoScroll&&!i.noAnimation&&t.node.hasChildren()?t.node.getLastChild().scrollIntoView(!0,{topNode:t.node}).always(function(){i.noEvents||t.tree._triggerNodeEvent(n?"expand":"collapse",t),o.resolveWith(t.node)}):(i.noEvents||t.tree._triggerNodeEvent(n?"expand":"collapse",t),o.resolveWith(t.node)):(i.noEvents||t.tree._triggerNodeEvent(n?"expand":"collapse",t),o.rejectWith(t.node))}if(n=n!==!1,t.node.expanded&&n||!t.node.expanded&&!n)return this._superApply(arguments);var o=new e.Deferred,a=e.extend({},i,{noEvents:!0,noAnimation:!0});return i=i||{},this._super(t,n,a).done(function(){r(!0)}).fail(function(){r(!1)}),o.promise()},nodeSetStatus:function(t,n,i,r){if("ok"===n){var o=t.node,s=o.children?o.children[0]:null;s&&s.isStatusNode()&&e(s.tr).remove()}return this._superApply(arguments)},treeClear:function(e){return this.nodeRemoveChildMarkup(this._makeHookContext(this.rootNode)),this._superApply(arguments)},treeDestroy:function(e){this.$container.find("tbody").empty(),this.$source&&this.$source.removeClass("ui-helper-hidden")}})}(jQuery,window,document),function(e,t,n,i){e.ui.fancytree.registerExtension({name:"themeroller",version:"0.0.1",options:{activeClass:"ui-state-active",foccusClass:"ui-state-focus",hoverClass:"ui-state-hover",selectedClass:"ui-state-highlight"},treeInit:function(t){this._superApply(arguments);var n=t.widget.element;"TABLE"===n[0].nodeName?(n.addClass("ui-widget ui-corner-all"),n.find(">thead tr").addClass("ui-widget-header"),n.find(">tbody").addClass("ui-widget-conent")):n.addClass("ui-widget ui-widget-content ui-corner-all"),n.delegate(".fancytree-node","mouseenter mouseleave",function(t){var n=e.ui.fancytree.getNode(t.target),i="mouseenter"===t.type;n.debug("hover: "+i),e(n.tr?n.tr:n.span).toggleClass("ui-state-hover ui-corner-all",i)})},treeDestroy:function(e){this._superApply(arguments),e.widget.element.removeClass("ui-widget ui-widget-content ui-corner-all")},nodeRenderStatus:function(t){var n=t.node,i=e(n.tr?n.tr:n.span);this._superApply(arguments),i.toggleClass("ui-state-active",n.isActive()),i.toggleClass("ui-state-focus",n.hasFocus()),i.toggleClass("ui-state-highlight",n.isSelected())}})}(jQuery,window,document),function(e,t,n,i){function r(t,n){t="fancytree-style-"+t;var i=e("#"+t);if(!n)return i.remove(),null;i.length||(i=e("<style />").attr("id",t).addClass("fancytree-style").prop("type","text/css").appendTo("head"));try{i.html(n)}catch(r){i[0].styleSheet.cssText=n}return i}function o(e,t,n,i,r){var o,s="#"+e+" span.fancytree-level-",a=[];for(o=0;o<t;o++)a.push(s+(o+1)+" span.fancytree-title { padding-left: "+(o*n+i)+r+"; }");return a.push("#"+e+" div.ui-effects-wrapper ul li span.fancytree-title { padding-left: 3px; position: static; width: auto; }"),a.join("\n")}var s=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/;e.ui.fancytree.registerExtension({name:"wide",version:"0.0.3",options:{iconWidth:null,iconSpacing:null,levelOfs:null},treeCreate:function(t){this._superApply(arguments),this.$container.addClass("fancytree-ext-wide");var n,i,a,l,d,c=t.options.wide,u=e("<li id='fancytreeTemp'><span class='fancytree-node'><span class='fancytree-icon' /><span class='fancytree-title' /></span><ul />").appendTo(t.tree.$container),h=u.find(".fancytree-icon"),p=u.find("ul"),f=c.iconSpacing||h.css("margin-left"),g=c.iconWidth||h.css("width"),y=c.levelOfs||p.css("padding-left");u.remove(),a=f.match(s)[2],f=parseFloat(f,10),l=g.match(s)[2],g=parseFloat(g,10),d=y.match(s)[2],a===l&&d===l||e.error("iconWidth, iconSpacing, and levelOfs must have the same css measure unit"),this._local.measureUnit=l,this._local.levelOfs=parseFloat(y),this._local.lineOfs=(1+(t.options.checkbox?1:0)+(t.options.icon===!1?0:1))*(g+f)+f,this._local.maxDepth=10,n=this.$container.uniqueId().attr("id"),i=o(n,this._local.maxDepth,this._local.levelOfs,this._local.lineOfs,this._local.measureUnit),r(n,i)},treeDestroy:function(e){return r(this.$container.attr("id"),null),this._superApply(arguments)},nodeRenderStatus:function(t){var n,i,s,a=t.node,l=a.getLevel();return s=this._superApply(arguments),l>this._local.maxDepth&&(n=this.$container.attr("id"),this._local.maxDepth*=2,a.debug("Define global ext-wide css up to level "+this._local.maxDepth),i=o(n,this._local.maxDepth,this._local.levelOfs,this._local.lineOfs,this._local.measureUnit),r(n,i)),e(a.span).addClass("fancytree-level-"+l),s}})}(jQuery,window,document);
//# sourceMappingURL=jquery.fancytree-all.js.map
