{"version":3,"sources":["jquery.fancytree-all.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","$","window","document","undefined","_assert","cond","msg","error","consoleApply","method","args","i","s","fn","console","apply","e","length","_isNode","x","tree","statusNodeType","isVersionAtLeast","dottedVersion","major","minor","patch","v","t","verParts","map","trim","split","parseInt","testParts","Array","slice","call","arguments","_makeVirtualFunction","methodName","base","extension","extName","proxy","prevFunc","baseFunc","_local","ext","_super","_superApply","prevLocal","prevSuper","prevSuperApply","_subclassObject","attrName","charAt","_getResolvedPromise","context","argArray","Deferred","this","resolve","promise","resolveWith","_getRejectedPromise","reject","rejectWith","_makeResolveFunc","deferred","_getElementDataAsDict","$el","d","extend","data","json","fancytree","uiFancytree","_escapeHtml","replace","REX_HTML","ENTITY_MAP","_makeNodeTitleMatcher","toLowerCase","node","title","indexOf","_makeNodeTitleStartMatcher","reMatch","RegExp","test","FancytreeNode","parent","l","name","cl","ul","li","_isLoading","_error","NODE_ATTRS","NODE_ATTR_MAP","isFunction","NONE_NODE_DATA_MAP","key","options","defaultKey","FT","_nextNodeKey","active","activeNode","selected","lastSelectedNode","children","_setChildren","lazy","_callHook","Fancytree","widget","$div","element","lazyload","lazyLoad","warn","loaderror","fx","_id","ui","_nextId","_ns","focusNode","_hasFocus","systemFocusElement","lastQuicksearchTerm","lastQuicksearchTime","statusClassPropName","ariaPropName","nodeContainerAttrName","find","remove","$ul","fakeParent","rootNode","expanded","class","appendTo","$container","debugLevel","attr","tabindex","aria","TEST_IMG","RECURSIVE_REQUEST_ERROR","&","<",">","\"","'","/","IGNORE_KEYCODES","16","17","18","SPECIAL_KEYCODES","8","9","10","13","19","20","27","32","33","34","35","36","37","38","39","40","45","46","59","61","96","97","98","99","100","101","102","103","104","105","106","107","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","144","145","173","186","187","188","189","190","191","192","219","220","221","222","MOUSE_BUTTONS","0","1","2","3","CLASS_ATTRS","CLASS_ATTR_MAP","NODE_ATTR_LOWERCASE_MAP","focus","_findDirectChild","ptr","push","addChildren","insertBefore","pos","firstNode","nodeList","isPlainObject","concat","inArray","splice","tr","render","selectMode","fixSelection3FromEndNodes","addClass","className","toggleClass","addNode","mode","getParent","getNextSibling","addPagingNode","n","removeChild","partload","strings","moreData","icon","appendSibling","applyPatch","IGNORE_MAP","hasOwnProperty","removeChildren","isVisible","renderTitle","renderStatus","setExpanded","collapseSiblings","copyTo","toDict","countChildren","deep","debug","unshift","toString","discard","resetLazy","discardMarkup","includeSelf","findAll","match","res","visit","findFirst","_changeSelectStatusAttrs","state","changed","partsel","fixSelection3AfterClick","flag","isSelected","_walk","child","allSelected","someSelected","visitParents","unselectable","fromDict","dict","getChildren","hasChildren","getFirstChild","getIndex","getIndexHier","separator","digits","each","getParentList","o","substr","join","getKeyPath","excludeSelf","path","sep","keyPathSeparator","getLastChild","getLevel","level","dtn","ac","includeRoot","getPrevSibling","getSelectedNodes","stopOnParents","isStatusNode","hasFocus","info","isActive","isChildOf","otherNode","isDescendantOf","p","isExpanded","isFirstSibling","isFolder","folder","isLastSibling","isLazy","isLoaded","isLoading","isRoot","isRootNode","isPartload","isPagingNode","isTopLevel","isUndefined","parents","load","forceReload","source","that","_triggerNodeEvent","always","makeVisible","opts","deferreds","dfd","len","effects","noAnimation","scroll","scrollIntoView","when","done","moveTo","targetNode","prevParent","targetParent","navigate","where","activate","_goto","span","is","setFocus","setActive","handled","KC","keyCode","sib","BACKSPACE","LEFT","RIGHT","UP","DOWN","childNode","removeClass","force","replaceWith","fail","scheduleAction","ms","timer","clearTimeout","self","setTimeout","topNode","topNodeY","nodeY","horzScrollbarHeight","containerOffsetTop","duration","queue","scrollOfs","scrollParent","nodeHeight","height","topOfs","top","bottomOfs","bottom","containerHeight","scrollTop","$animateTarget","isParentWindow","newScrollTop","offset","body","Math","max","innerHeight","clientHeight","complete","stop","animate","setSelected","setStatus","status","message","details","setTitle","sortChildren","cmp","a","b","y","sort","recursive","callback","isEmptyObject","value","hasClass","rnotwhite","classNames","wasAdded","statusElem","curClasses","extraClasses","toggleExpanded","toggleSelected","visitAndLoad","_recursion","loaders","then","_makeHookContext","originalEvent","extra","ctx","funcName","contextObject","_extraArgs","_requireExtension","required","before","thisName","extList","extensions","isBefore","isMissing","badOrder","activateKey","getNodeByKey","patchList","p2","patchCount","deferredList","clear","count","findNextNode","startNode","visibleOnly","stopNode","parentChildren","matchingNode","walkVisible","idx","grandParent","siblingCount","generateFormElements","selectedName","activeName","id","$result","empty","hide","insertAfter","append","type","checked","getActiveNode","getFocusNode","searchRoot","el","getElementById","idPrefix","ftnode","getRootNode","loadKeyPath","keyPathList","_rootNode","__lazyload","loadMap","errMsg","root","segList","noop","isArray","shift","reactivate","noFocus","reload","_trigger","result","_triggerTreeEvent","nodeClick","expand","targetType","focusOnSelect","clickFolderMode","nodeSetFocus","nodeCollapseSiblings","callOpts","nodeDblclick","preventDefault","nodeKeydown","matchNode","stamp","event","which","whichChar","String","fromCharCode","clean","altKey","ctrlKey","metaKey","shiftKey","$target","target","autoActivate","quicksearch","Date","getTime","eventToString","nodeSetExpanded","checkbox","nodeToggleSelected","nodeSetActive","nodeLoadChildren","ajax","delay","requestId","url","_requestId","debugDelay","random","round","textStatus","jqXHR","errorObj","dataType","postProcess","response","enableAspx","parseJSON","errorThrown","reason","nodeSetStatus","ctxErr","metaData","nodeLoadKeyPath","nodeRemoveChild","subCtx","nodeRemoveChildren","nodeRemoveMarkup","removeNode","nodeRemoveChildMarkup","nodeRenderStatus","nodeRender","collapsed","_recursive","childLI","childNode1","childNode2","next","firstTime","successorLi","parentNode","nextSibling","createElement","generateIds","appendChild","nodeRenderTitle","createNode","renderNode","style","display","firstChild","nodeTitle","role","tooltip","ares","minExpandLevel","hideCheckbox","iconClass","imagePath","titlesTabbable","escapeTitles","innerHTML","enhanceTitle","$title","isLastSib","$ariaElem","cn","_classNames","cnList","focused","removeAttr","lastsib","loading","statusNodePrefix","combinedExpanderPrefix","combinedIconPrefix","noEvents","activeVisible","_afterLoad","prevAC","autoCollapse","lastChild","autoScroll","effect","toggleEffect","toggle","notifyWith","ctx2","calledByNode","activeElement","closest","nodeSetSelected","_clearStatusNode","_setStatusNode","loadError","noData","nodeToggleExpanded","treeClear","treeCreate","treeDestroy","$source","treeInit","treeLoad","rootCtx","parseHtml","text","treeRegisterNode","add","treeSetFocus","cache","disabled","direction","scale","keyboard","_create","_extensions","icons","tabbable","_init","_bind","_setOption","callDefault","rerender","Widget","destroy","_unbind","ns","unbind","on","getNode","prevPhase","phase","et","getEventTarget","getTree","version","buildType","_FancytreeClass","_FancytreeNodeClass","jquerySupports","positionMyOfs","assert","debounce","timeout","invokeAsap","escapeHtml","fixPositionOptions","my","at","myParts","exec","atParts","dx","dy","getEventTargetType","tcn","selector","eq","button","keyEventToString","classes","iPos","tmp","tmp2","$children","allData","lowerCaseAttr","$li","$liSpan","$liA","html","href","search","substring","registerExtension","definition","unescapeHtml","childNodes","nodeValue","jQuery","countSelected","topOnly","updateCounters","$badge","extOpts","childcounter","childCounter","hideZeros","hideExpanded","widgetMethod1","arg1","foo","_appendCounter","bar","_removeArrayMember","arr","elem","hashMurmur3","asString","seed","h1b","k1","remainder","bytes","h1","c1","c2","charCodeAt","calcUniqueKey","refKey","getCloneList","refList","refMap","keyMap","val","isClone","reRegister","prevKey","prevRefKey","modified","setRefKey","getNodesByRef","changeRefKey","oldRefKey","newRefKey","highlightActiveClones","highlightClones","clones","$span","scpn","offsetString","_registerDnd","didRegisterDnd","plugin","start","draggable","sourceNode","helper","click","left","dnd","_onDragEvent","drag","isHelper","logObject","prevTargetNode","dndOpts","updateHelper","dropMarker","dragDrop","dropped","_initDragAndDrop","glyph","dragStart","addClasses","containment","distance","revert","scrollSpeed","scrollSensitivity","connectToFancytree","$helper","$nodeTag","css","zIndex","position","clone","dragHelper","initHelper","droppable","tolerance","greedy","classDropAccept","classDropAfter","classDropBefore","classDropOver","classDropReject","classDropTarget","autoExpandMS","focusOnClick","preventVoidMoves","preventRecursiveMoves","smartRevert","dragStop","dragEnter","dragOver","dragExpand","dragLeave","_setDndStatus","hitMode","accept","markerOffsetX","markerAt","instData","$dropMarker","z-index","prependTo","show","of","eventName","nodeOfs","parentRect","rect","relPos","relPos2","enterResponse","r","trigger","getBoundingClientRect","originalPosition","ESCAPE","_cancelDrag","over","after","pageX","pageY","width","off","dd","ddmanager","current","cancel","isMac","navigator","platform","editStart","$input","local","edit","instOpts","eventData","isNew","orgTitle","input","dirty","beforeEdit","currentNode","editEnd","adjustWidthOfs","inputCss","change","keydown","ENTER","stopPropagation","blur","applyChanges","_event","newVal","save","beforeClose","relatedNode","close","editCreateNode","init","newNode","isEditing","allowEmpty","minWidth","triggerCancel","triggerStart","_escapeRegex","str","extractHtmlText","KeyNoData","_applyFilterImpl","filter","branchMode","leavesOnly","statusNode","re","re2","treeOpts","filterOpts","hideMode","fuzzy","reduce","highlight","titleWithHighlight","enableFilter","lastFilterArgs","subMatchCount","c","autoExpand","_filterAutoExpanded","nodata","filterNodes","applyFilter","filterBranches","clearFilter","$subMatchBadge","isFilterActive","isMatched","autoApply","counter","hideExpandedCounter","_getIcon","checkboxSelected","checkboxUnknown","expanderClosed","expanderLazy","expanderOpen","noExpander","doc","docOpen","folderOpen","get","getColIdx","$tr","$td","colspan","td","prop","findTdAtColIdx","colIdx","findNeighbourTd","$tdNext","prev","NAV_KEYS","radiobutton","select-one","select-multiple","autofocusInput","handleCursorKeys","$outer","gridnav","triggeredByInput","inputType","handleKeys","_loadLazyNodes","keyList","foundOne","missingKeyList","_appendKey","EXPANDED","cookieGetter","cookieRemover","cookieSetter","ACTIVE","FOCUS","SELECTED","Cookies","set","cookie","removeCookie","clearCookies","types","persist","prefix","cookiePrefix","_data","getPersistData","delim","cookieDelimiter","raw","expires","domain","secure","expandLazy","fireActivate","overrideSource","store","ls","localStorage","getItem","removeItem","setItem","cookieName","storeActive","storeExpanded","storeSelected","storeFocus","sessionStorage","bind","prevFocus","selNodes","insertSiblingAfter","referenceNode","setChildRowVisibility","findPrevRowNode","last","siblings","checkboxColumnIdx","indentation","nodeColumnIdx","$row","$tbody","tableOpts","table","$table","customStatus","renderStatusColumns","renderColumns","tbody","columnCount","rowFragment","createDocumentFragment","firstTr","newRow","prevNode","prevTr","hasCollapsedParents","cloneNode","previousSibling","nextTr","$cb","indent","paddingLeft","_afterExpand","ok","subOpts","activeClass","foccusClass","hoverClass","selectedClass","nodeName","delegate","defineHeadStyleElement","cssText","$headStyle","styleSheet","renderLevelCss","containerId","depth","levelOfs","lineOfs","measureUnit","rules","reNumUnit","iconWidth","iconSpacing","iconSpacingUnit","iconWidthUnit","levelOfsUnit","wide","$dummyLI","$dummyIcon","$dummyUL","parseFloat","maxDepth","uniqueId"],"mappings":"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","file":"jquery.fancytree-all.js","sourcesContent":["/*!\n * jquery.fancytree.js\n * Tree view control with support for lazy loading and much more.\n * https://github.com/mar10/fancytree/\n *\n * Copyright (c) 2008-2016, Martin Wendt (http://wwWendt.de)\n * Released under the MIT license\n * https://github.com/mar10/fancytree/wiki/LicenseInfo\n *\n * @version 2.18.0\n * @date 2016-05-02T19:34\n */\n\n/** Core Fancytree module.\n */\n\n\n// Start of local namespace\n;(function($, window, document, undefined) {\n\"use strict\";\n\n// prevent duplicate loading\nif ( $.ui && $.ui.fancytree ) {\n\t$.ui.fancytree.warn(\"Fancytree: ignored duplicate include\");\n\treturn;\n}\n\n\n/* *****************************************************************************\n * Private functions and variables\n */\n\nvar i, attr,\n\tFT = null, // initialized below\n\tTEST_IMG = new RegExp(/\\.|\\//),  // strings are considered image urls if they conatin '.' or '/'\n\tREX_HTML = /[&<>\"'\\/]/g,\n\tRECURSIVE_REQUEST_ERROR = \"$recursive_request\",\n\tENTITY_MAP = {\"&\": \"&amp;\", \"<\": \"&lt;\", \">\": \"&gt;\", \"\\\"\": \"&quot;\", \"'\": \"&#39;\", \"/\": \"&#x2F;\"},\n\tIGNORE_KEYCODES = { 16: true, 17: true, 18: true },\n\tSPECIAL_KEYCODES = {\n\t\t8: \"backspace\", 9: \"tab\", 10: \"return\", 13: \"return\",\n\t\t// 16: null, 17: null, 18: null, // ignore shift, ctrl, alt\n\t\t19: \"pause\", 20: \"capslock\", 27: \"esc\", 32: \"space\", 33: \"pageup\",\n\t\t34: \"pagedown\", 35: \"end\", 36: \"home\", 37: \"left\", 38: \"up\",\n\t\t39: \"right\", 40: \"down\", 45: \"insert\", 46: \"del\", 59: \";\", 61: \"=\",\n\t\t96: \"0\", 97: \"1\", 98: \"2\", 99: \"3\", 100: \"4\", 101: \"5\", 102: \"6\",\n\t\t103: \"7\", 104: \"8\", 105: \"9\", 106: \"*\", 107: \"+\", 109: \"-\", 110: \".\",\n\t\t111: \"/\", 112: \"f1\", 113: \"f2\", 114: \"f3\", 115: \"f4\", 116: \"f5\",\n\t\t117: \"f6\", 118: \"f7\", 119: \"f8\", 120: \"f9\", 121: \"f10\", 122: \"f11\",\n\t\t123: \"f12\", 144: \"numlock\", 145: \"scroll\", 173: \"-\", 186: \";\", 187: \"=\",\n\t\t188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\",\n\t\t221: \"]\", 222: \"'\"},\n\tMOUSE_BUTTONS = { 0: \"\", 1: \"left\", 2: \"middle\", 3: \"right\" },\n\t//boolean attributes that can be set with equivalent class names in the LI tags\n\tCLASS_ATTRS = \"active expanded focus folder hideCheckbox lazy selected unselectable\".split(\" \"),\n\tCLASS_ATTR_MAP = {},\n\t//\tTop-level Fancytree node attributes, that can be set by dict\n\tNODE_ATTRS = \"expanded extraClasses folder hideCheckbox icon key lazy refKey selected statusNodeType title tooltip unselectable\".split(\" \"),\n\tNODE_ATTR_MAP = {},\n\t// Mapping of lowercase -> real name (because HTML5 data-... attribute only supports lowercase)\n\tNODE_ATTR_LOWERCASE_MAP = {},\n\t// Attribute names that should NOT be added to node.data\n\tNONE_NODE_DATA_MAP = {\"active\": true, \"children\": true, \"data\": true, \"focus\": true};\n\nfor(i=0; i<CLASS_ATTRS.length; i++){ CLASS_ATTR_MAP[CLASS_ATTRS[i]] = true; }\nfor(i=0; i<NODE_ATTRS.length; i++) {\n\tattr = NODE_ATTRS[i];\n\tNODE_ATTR_MAP[attr] = true;\n\tif( attr !== attr.toLowerCase() ) {\n\t\tNODE_ATTR_LOWERCASE_MAP[attr.toLowerCase()] = attr;\n\t}\n}\n\n\nfunction _assert(cond, msg){\n\t// TODO: see qunit.js extractStacktrace()\n\tif(!cond){\n\t\tmsg = msg ? \": \" + msg : \"\";\n\t\t// consoleApply(\"assert\", [!!cond, msg]);\n\t\t$.error(\"Fancytree assertion failed\" + msg);\n\t}\n}\n\n_assert($.ui, \"Fancytree requires jQuery UI (http://jqueryui.com)\");\n\nfunction consoleApply(method, args){\n\tvar i, s,\n\t\tfn = window.console ? window.console[method] : null;\n\n\tif(fn){\n\t\ttry{\n\t\t\tfn.apply(window.console, args);\n\t\t} catch(e) {\n\t\t\t// IE 8?\n\t\t\ts = \"\";\n\t\t\tfor( i=0; i<args.length; i++ ) {\n\t\t\t\ts += args[i];\n\t\t\t}\n\t\t\tfn(s);\n\t\t}\n\t}\n}\n\n/*Return true if x is a FancytreeNode.*/\nfunction _isNode(x){\n\treturn !!(x.tree && x.statusNodeType !== undefined);\n}\n\n/** Return true if dotted version string is equal or higher than requested version.\n *\n * See http://jsfiddle.net/mar10/FjSAN/\n */\nfunction isVersionAtLeast(dottedVersion, major, minor, patch){\n\tvar i, v, t,\n\t\tverParts = $.map($.trim(dottedVersion).split(\".\"), function(e){ return parseInt(e, 10); }),\n\t\ttestParts = $.map(Array.prototype.slice.call(arguments, 1), function(e){ return parseInt(e, 10); });\n\n\tfor( i = 0; i < testParts.length; i++ ){\n\t\tv = verParts[i] || 0;\n\t\tt = testParts[i] || 0;\n\t\tif( v !== t ){\n\t\t\treturn ( v > t );\n\t\t}\n\t}\n\treturn true;\n}\n\n/** Return a wrapper that calls sub.methodName() and exposes\n *  this        : tree\n *  this._local : tree.ext.EXTNAME\n *  this._super : base.methodName()\n */\nfunction _makeVirtualFunction(methodName, tree, base, extension, extName){\n\t// $.ui.fancytree.debug(\"_makeVirtualFunction\", methodName, tree, base, extension, extName);\n\t// if(rexTestSuper && !rexTestSuper.test(func)){\n\t//     // extension.methodName() doesn't call _super(), so no wrapper required\n\t//     return func;\n\t// }\n\t// Use an immediate function as closure\n\tvar proxy = (function(){\n\t\tvar prevFunc = tree[methodName],      // org. tree method or prev. proxy\n\t\t\tbaseFunc = extension[methodName], //\n\t\t\t_local = tree.ext[extName],\n\t\t\t_super = function(){\n\t\t\t\treturn prevFunc.apply(tree, arguments);\n\t\t\t},\n\t\t\t_superApply = function(args){\n\t\t\t\treturn prevFunc.apply(tree, args);\n\t\t\t};\n\n\t\t// Return the wrapper function\n\t\treturn function(){\n\t\t\tvar prevLocal = tree._local,\n\t\t\t\tprevSuper = tree._super,\n\t\t\t\tprevSuperApply = tree._superApply;\n\n\t\t\ttry{\n\t\t\t\ttree._local = _local;\n\t\t\t\ttree._super = _super;\n\t\t\t\ttree._superApply = _superApply;\n\t\t\t\treturn  baseFunc.apply(tree, arguments);\n\t\t\t}finally{\n\t\t\t\ttree._local = prevLocal;\n\t\t\t\ttree._super = prevSuper;\n\t\t\t\ttree._superApply = prevSuperApply;\n\t\t\t}\n\t\t};\n\t})(); // end of Immediate Function\n\treturn proxy;\n}\n\n/**\n * Subclass `base` by creating proxy functions\n */\nfunction _subclassObject(tree, base, extension, extName){\n\t// $.ui.fancytree.debug(\"_subclassObject\", tree, base, extension, extName);\n\tfor(var attrName in extension){\n\t\tif(typeof extension[attrName] === \"function\"){\n\t\t\tif(typeof tree[attrName] === \"function\"){\n\t\t\t\t// override existing method\n\t\t\t\ttree[attrName] = _makeVirtualFunction(attrName, tree, base, extension, extName);\n\t\t\t}else if(attrName.charAt(0) === \"_\"){\n\t\t\t\t// Create private methods in tree.ext.EXTENSION namespace\n\t\t\t\ttree.ext[extName][attrName] = _makeVirtualFunction(attrName, tree, base, extension, extName);\n\t\t\t}else{\n\t\t\t\t$.error(\"Could not override tree.\" + attrName + \". Use prefix '_' to create tree.\" + extName + \"._\" + attrName);\n\t\t\t}\n\t\t}else{\n\t\t\t// Create member variables in tree.ext.EXTENSION namespace\n\t\t\tif(attrName !== \"options\"){\n\t\t\t\ttree.ext[extName][attrName] = extension[attrName];\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nfunction _getResolvedPromise(context, argArray){\n\tif(context === undefined){\n\t\treturn $.Deferred(function(){this.resolve();}).promise();\n\t}else{\n\t\treturn $.Deferred(function(){this.resolveWith(context, argArray);}).promise();\n\t}\n}\n\n\nfunction _getRejectedPromise(context, argArray){\n\tif(context === undefined){\n\t\treturn $.Deferred(function(){this.reject();}).promise();\n\t}else{\n\t\treturn $.Deferred(function(){this.rejectWith(context, argArray);}).promise();\n\t}\n}\n\n\nfunction _makeResolveFunc(deferred, context){\n\treturn function(){\n\t\tdeferred.resolveWith(context);\n\t};\n}\n\n\nfunction _getElementDataAsDict($el){\n\t// Evaluate 'data-NAME' attributes with special treatment for 'data-json'.\n\tvar d = $.extend({}, $el.data()),\n\t\tjson = d.json;\n\n\tdelete d.fancytree; // added to container by widget factory (old jQuery UI)\n\tdelete d.uiFancytree; // added to container by widget factory\n\n\tif( json ) {\n\t\tdelete d.json;\n\t\t// <li data-json='...'> is already returned as object (http://api.jquery.com/data/#data-html5)\n\t\td = $.extend(d, json);\n\t}\n\treturn d;\n}\n\n\nfunction _escapeHtml(s){\n\treturn (\"\" + s).replace(REX_HTML, function (s) {\n\t\treturn ENTITY_MAP[s];\n\t});\n}\n\n\n// TODO: use currying\nfunction _makeNodeTitleMatcher(s){\n\ts = s.toLowerCase();\n\treturn function(node){\n\t\treturn node.title.toLowerCase().indexOf(s) >= 0;\n\t};\n}\n\n\nfunction _makeNodeTitleStartMatcher(s){\n\tvar reMatch = new RegExp(\"^\" + s, \"i\");\n\treturn function(node){\n\t\treturn reMatch.test(node.title);\n\t};\n}\n\n\n/* *****************************************************************************\n * FancytreeNode\n */\n\n\n/**\n * Creates a new FancytreeNode\n *\n * @class FancytreeNode\n * @classdesc A FancytreeNode represents the hierarchical data model and operations.\n *\n * @param {FancytreeNode} parent\n * @param {NodeData} obj\n *\n * @property {Fancytree} tree The tree instance\n * @property {FancytreeNode} parent The parent node\n * @property {string} key Node id (must be unique inside the tree)\n * @property {string} title Display name (may contain HTML)\n * @property {object} data Contains all extra data that was passed on node creation\n * @property {FancytreeNode[] | null | undefined} children Array of child nodes.<br>\n *     For lazy nodes, null or undefined means 'not yet loaded'. Use an empty array\n *     to define a node that has no children.\n * @property {boolean} expanded Use isExpanded(), setExpanded() to access this property.\n * @property {string} extraClasses Additional CSS classes, added to the node's `&lt;span>`.<br>\n *     Note: use `node.add/remove/toggleClass()` to modify.\n * @property {boolean} folder Folder nodes have different default icons and click behavior.<br>\n *     Note: Also non-folders may have children.\n * @property {string} statusNodeType null for standard nodes. Otherwise type of special system node: 'error', 'loading', 'nodata', or 'paging'.\n * @property {boolean} lazy True if this node is loaded on demand, i.e. on first expansion.\n * @property {boolean} selected Use isSelected(), setSelected() to access this property.\n * @property {string} tooltip Alternative description used as hover banner\n */\nfunction FancytreeNode(parent, obj){\n\tvar i, l, name, cl;\n\n\tthis.parent = parent;\n\tthis.tree = parent.tree;\n\tthis.ul = null;\n\tthis.li = null;  // <li id='key' ftnode=this> tag\n\tthis.statusNodeType = null; // if this is a temp. node to display the status of its parent\n\tthis._isLoading = false;    // if this node itself is loading\n\tthis._error = null;         // {message: '...'} if a load error occurred\n\tthis.data = {};\n\n\t// TODO: merge this code with node.toDict()\n\t// copy attributes from obj object\n\tfor(i=0, l=NODE_ATTRS.length; i<l; i++){\n\t\tname = NODE_ATTRS[i];\n\t\tthis[name] = obj[name];\n\t}\n\t// node.data += obj.data\n\tif(obj.data){\n\t\t$.extend(this.data, obj.data);\n\t}\n\t// copy all other attributes to this.data.NAME\n\tfor(name in obj){\n\t\tif(!NODE_ATTR_MAP[name] && !$.isFunction(obj[name]) && !NONE_NODE_DATA_MAP[name]){\n\t\t\t// node.data.NAME = obj.NAME\n\t\t\tthis.data[name] = obj[name];\n\t\t}\n\t}\n\n\t// Fix missing key\n\tif( this.key == null ){ // test for null OR undefined\n\t\tif( this.tree.options.defaultKey ) {\n\t\t\tthis.key = this.tree.options.defaultKey(this);\n\t\t\t_assert(this.key, \"defaultKey() must return a unique key\");\n\t\t} else {\n\t\t\tthis.key = \"_\" + (FT._nextNodeKey++);\n\t\t}\n\t} else {\n\t\tthis.key = \"\" + this.key; // Convert to string (#217)\n\t}\n\n\t// Fix tree.activeNode\n\t// TODO: not elegant: we use obj.active as marker to set tree.activeNode\n\t// when loading from a dictionary.\n\tif(obj.active){\n\t\t_assert(this.tree.activeNode === null, \"only one active node allowed\");\n\t\tthis.tree.activeNode = this;\n\t}\n\tif( obj.selected ){ // #186\n\t\tthis.tree.lastSelectedNode = this;\n\t}\n\t// TODO: handle obj.focus = true\n\t// Create child nodes\n\tcl = obj.children;\n\tif( cl ){\n\t\tif( cl.length ){\n\t\t\tthis._setChildren(cl);\n\t\t} else {\n\t\t\t// if an empty array was passed for a lazy node, keep it, in order to mark it 'loaded'\n\t\t\tthis.children = this.lazy ? [] : null;\n\t\t}\n\t} else {\n\t\tthis.children = null;\n\t}\n\t// Add to key/ref map (except for root node)\n//\tif( parent ) {\n\tthis.tree._callHook(\"treeRegisterNode\", this.tree, true, this);\n//\t}\n}\n\n\nFancytreeNode.prototype = /** @lends FancytreeNode# */{\n\t/* Return the direct child FancytreeNode with a given key, index. */\n\t_findDirectChild: function(ptr){\n\t\tvar i, l,\n\t\t\tcl = this.children;\n\n\t\tif(cl){\n\t\t\tif(typeof ptr === \"string\"){\n\t\t\t\tfor(i=0, l=cl.length; i<l; i++){\n\t\t\t\t\tif(cl[i].key === ptr){\n\t\t\t\t\t\treturn cl[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}else if(typeof ptr === \"number\"){\n\t\t\t\treturn this.children[ptr];\n\t\t\t}else if(ptr.parent === this){\n\t\t\t\treturn ptr;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t},\n\t// TODO: activate()\n\t// TODO: activateSilently()\n\t/* Internal helper called in recursive addChildren sequence.*/\n\t_setChildren: function(children){\n\t\t_assert(children && (!this.children || this.children.length === 0), \"only init supported\");\n\t\tthis.children = [];\n\t\tfor(var i=0, l=children.length; i<l; i++){\n\t\t\tthis.children.push(new FancytreeNode(this, children[i]));\n\t\t}\n\t},\n\t/**\n\t * Append (or insert) a list of child nodes.\n\t *\n\t * @param {NodeData[]} children array of child node definitions (also single child accepted)\n\t * @param {FancytreeNode | string | Integer} [insertBefore] child node (or key or index of such).\n\t *     If omitted, the new children are appended.\n\t * @returns {FancytreeNode} first child added\n\t *\n\t * @see FancytreeNode#applyPatch\n\t */\n\taddChildren: function(children, insertBefore){\n\t\tvar i, l, pos,\n\t\t\tfirstNode = null,\n\t\t\tnodeList = [];\n\n\t\tif($.isPlainObject(children) ){\n\t\t\tchildren = [children];\n\t\t}\n\t\tif(!this.children){\n\t\t\tthis.children = [];\n\t\t}\n\t\tfor(i=0, l=children.length; i<l; i++){\n\t\t\tnodeList.push(new FancytreeNode(this, children[i]));\n\t\t}\n\t\tfirstNode = nodeList[0];\n\t\tif(insertBefore == null){\n\t\t\tthis.children = this.children.concat(nodeList);\n\t\t}else{\n\t\t\tinsertBefore = this._findDirectChild(insertBefore);\n\t\t\tpos = $.inArray(insertBefore, this.children);\n\t\t\t_assert(pos >= 0, \"insertBefore must be an existing child\");\n\t\t\t// insert nodeList after children[pos]\n\t\t\tthis.children.splice.apply(this.children, [pos, 0].concat(nodeList));\n\t\t}\n\t\tif( !this.parent || this.parent.ul || this.tr ){\n\t\t\t// render if the parent was rendered (or this is a root node)\n\t\t\tthis.render();\n\t\t}\n\t\tif( this.tree.options.selectMode === 3 ){\n\t\t\tthis.fixSelection3FromEndNodes();\n\t\t}\n\t\treturn firstNode;\n\t},\n\t/**\n\t * Add class to node's span tag and to .extraClasses.\n\t *\n\t * @param {string} className class name\n\t *\n\t * @since 2.17\n\t */\n\taddClass: function(className){\n\t\treturn this.toggleClass(className, true);\n\t},\n\t/**\n\t * Append or prepend a node, or append a child node.\n\t *\n\t * This a convenience function that calls addChildren()\n\t *\n\t * @param {NodeData} node node definition\n\t * @param {string} [mode=child] 'before', 'after', 'firstChild', or 'child' ('over' is a synonym for 'child')\n\t * @returns {FancytreeNode} new node\n\t */\n\taddNode: function(node, mode){\n\t\tif(mode === undefined || mode === \"over\"){\n\t\t\tmode = \"child\";\n\t\t}\n\t\tswitch(mode){\n\t\tcase \"after\":\n\t\t\treturn this.getParent().addChildren(node, this.getNextSibling());\n\t\tcase \"before\":\n\t\t\treturn this.getParent().addChildren(node, this);\n\t\tcase \"firstChild\":\n\t\t\t// Insert before the first child if any\n\t\t\tvar insertBefore = (this.children ? this.children[0] : null);\n\t\t\treturn this.addChildren(node, insertBefore);\n\t\tcase \"child\":\n\t\tcase \"over\":\n\t\t\treturn this.addChildren(node);\n\t\t}\n\t\t_assert(false, \"Invalid mode: \" + mode);\n\t},\n\t/**Add child status nodes that indicate 'More...', etc.\n\t *\n\t * This also maintains the node's `partload` property.\n\t * @param {boolean|object} node optional node definition. Pass `false` to remove all paging nodes.\n\t * @param {string} [mode='child'] 'child'|firstChild'\n\t * @since 2.15\n\t */\n\taddPagingNode: function(node, mode){\n\t\tvar i, n;\n\n\t\tmode = mode || \"child\";\n\t\tif( node === false ) {\n\t\t\tfor(i=this.children.length-1; i >= 0; i--) {\n\t\t\t\tn = this.children[i];\n\t\t\t\tif( n.statusNodeType === \"paging\" ) {\n\t\t\t\t\tthis.removeChild(n);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.partload = false;\n\t\t\treturn;\n\t\t}\n\t\tnode = $.extend({\n\t\t\ttitle: this.tree.options.strings.moreData,\n\t\t\tstatusNodeType: \"paging\",\n\t\t\ticon: false\n\t\t}, node);\n\t\tthis.partload = true;\n\t\treturn this.addNode(node, mode);\n\t},\n\t/**\n\t * Append new node after this.\n\t *\n\t * This a convenience function that calls addNode(node, 'after')\n\t *\n\t * @param {NodeData} node node definition\n\t * @returns {FancytreeNode} new node\n\t */\n\tappendSibling: function(node){\n\t\treturn this.addNode(node, \"after\");\n\t},\n\t/**\n\t * Modify existing child nodes.\n\t *\n\t * @param {NodePatch} patch\n\t * @returns {$.Promise}\n\t * @see FancytreeNode#addChildren\n\t */\n\tapplyPatch: function(patch) {\n\t\t// patch [key, null] means 'remove'\n\t\tif(patch === null){\n\t\t\tthis.remove();\n\t\t\treturn _getResolvedPromise(this);\n\t\t}\n\t\t// TODO: make sure that root node is not collapsed or modified\n\t\t// copy (most) attributes to node.ATTR or node.data.ATTR\n\t\tvar name, promise, v,\n\t\t\tIGNORE_MAP = { children: true, expanded: true, parent: true }; // TODO: should be global\n\n\t\tfor(name in patch){\n\t\t\tv = patch[name];\n\t\t\tif( !IGNORE_MAP[name] && !$.isFunction(v)){\n\t\t\t\tif(NODE_ATTR_MAP[name]){\n\t\t\t\t\tthis[name] = v;\n\t\t\t\t}else{\n\t\t\t\t\tthis.data[name] = v;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// Remove and/or create children\n\t\tif(patch.hasOwnProperty(\"children\")){\n\t\t\tthis.removeChildren();\n\t\t\tif(patch.children){ // only if not null and not empty list\n\t\t\t\t// TODO: addChildren instead?\n\t\t\t\tthis._setChildren(patch.children);\n\t\t\t}\n\t\t\t// TODO: how can we APPEND or INSERT child nodes?\n\t\t}\n\t\tif(this.isVisible()){\n\t\t\tthis.renderTitle();\n\t\t\tthis.renderStatus();\n\t\t}\n\t\t// Expand collapse (final step, since this may be async)\n\t\tif(patch.hasOwnProperty(\"expanded\")){\n\t\t\tpromise = this.setExpanded(patch.expanded);\n\t\t}else{\n\t\t\tpromise = _getResolvedPromise(this);\n\t\t}\n\t\treturn promise;\n\t},\n\t/** Collapse all sibling nodes.\n\t * @returns {$.Promise}\n\t */\n\tcollapseSiblings: function() {\n\t\treturn this.tree._callHook(\"nodeCollapseSiblings\", this);\n\t},\n\t/** Copy this node as sibling or child of `node`.\n\t *\n\t * @param {FancytreeNode} node source node\n\t * @param {string} [mode=child] 'before' | 'after' | 'child'\n\t * @param {Function} [map] callback function(NodeData) that could modify the new node\n\t * @returns {FancytreeNode} new\n\t */\n\tcopyTo: function(node, mode, map) {\n\t\treturn node.addNode(this.toDict(true, map), mode);\n\t},\n\t/** Count direct and indirect children.\n\t *\n\t * @param {boolean} [deep=true] pass 'false' to only count direct children\n\t * @returns {int} number of child nodes\n\t */\n\tcountChildren: function(deep) {\n\t\tvar cl = this.children, i, l, n;\n\t\tif( !cl ){\n\t\t\treturn 0;\n\t\t}\n\t\tn = cl.length;\n\t\tif(deep !== false){\n\t\t\tfor(i=0, l=n; i<l; i++){\n\t\t\t\tn += cl[i].countChildren();\n\t\t\t}\n\t\t}\n\t\treturn n;\n\t},\n\t// TODO: deactivate()\n\t/** Write to browser console if debugLevel >= 2 (prepending node info)\n\t *\n\t * @param {*} msg string or object or array of such\n\t */\n\tdebug: function(msg){\n\t\tif( this.tree.options.debugLevel >= 2 ) {\n\t\t\tArray.prototype.unshift.call(arguments, this.toString());\n\t\t\tconsoleApply(\"log\", arguments);\n\t\t}\n\t},\n\t/** Deprecated.\n\t * @deprecated since 2014-02-16. Use resetLazy() instead.\n\t */\n\tdiscard: function(){\n\t\tthis.warn(\"FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead.\");\n\t\treturn this.resetLazy();\n\t},\n\t/** Remove DOM elements for all descendents. May be called on .collapse event\n\t * to keep the DOM small.\n\t * @param {boolean} [includeSelf=false]\n\t */\n\tdiscardMarkup: function(includeSelf){\n\t\tvar fn = includeSelf ? \"nodeRemoveMarkup\" : \"nodeRemoveChildMarkup\";\n\t\tthis.tree._callHook(fn, this);\n\t},\n\n\t// TODO: expand(flag)\n\n\t/**Find all nodes that match condition (excluding self).\n\t *\n\t * @param {string | function(node)} match title string to search for, or a\n\t *     callback function that returns `true` if a node is matched.\n\t * @returns {FancytreeNode[]} array of nodes (may be empty)\n\t */\n\tfindAll: function(match) {\n\t\tmatch = $.isFunction(match) ? match : _makeNodeTitleMatcher(match);\n\t\tvar res = [];\n\t\tthis.visit(function(n){\n\t\t\tif(match(n)){\n\t\t\t\tres.push(n);\n\t\t\t}\n\t\t});\n\t\treturn res;\n\t},\n\t/**Find first node that matches condition (excluding self).\n\t *\n\t * @param {string | function(node)} match title string to search for, or a\n\t *     callback function that returns `true` if a node is matched.\n\t * @returns {FancytreeNode} matching node or null\n\t * @see FancytreeNode#findAll\n\t */\n\tfindFirst: function(match) {\n\t\tmatch = $.isFunction(match) ? match : _makeNodeTitleMatcher(match);\n\t\tvar res = null;\n\t\tthis.visit(function(n){\n\t\t\tif(match(n)){\n\t\t\t\tres = n;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn res;\n\t},\n\t/* Apply selection state (internal use only) */\n\t_changeSelectStatusAttrs: function (state) {\n\t\tvar changed = false;\n\n\t\tswitch(state){\n\t\tcase false:\n\t\t\tchanged = ( this.selected || this.partsel );\n\t\t\tthis.selected = false;\n\t\t\tthis.partsel = false;\n\t\t\tbreak;\n\t\tcase true:\n\t\t\tchanged = ( !this.selected || !this.partsel );\n\t\t\tthis.selected = true;\n\t\t\tthis.partsel = true;\n\t\t\tbreak;\n\t\tcase undefined:\n\t\t\tchanged = ( this.selected || !this.partsel );\n\t\t\tthis.selected = false;\n\t\t\tthis.partsel = true;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\t_assert(false, \"invalid state: \" + state);\n\t\t}\n\t\t// this.debug(\"fixSelection3AfterLoad() _changeSelectStatusAttrs()\", state, changed);\n\t\tif( changed ){\n\t\t\tthis.renderStatus();\n\t\t}\n\t\treturn changed;\n\t},\n\t/**\n\t * Fix selection status, after this node was (de)selected in multi-hier mode.\n\t * This includes (de)selecting all children.\n\t */\n\tfixSelection3AfterClick: function() {\n\t\tvar flag = this.isSelected();\n\n//\t\tthis.debug(\"fixSelection3AfterClick()\");\n\n\t\tthis.visit(function(node){\n\t\t\tnode._changeSelectStatusAttrs(flag);\n\t\t});\n\t\tthis.fixSelection3FromEndNodes();\n\t},\n\t/**\n\t * Fix selection status for multi-hier mode.\n\t * Only end-nodes are considered to update the descendants branch and parents.\n\t * Should be called after this node has loaded new children or after\n\t * children have been modified using the API.\n\t */\n\tfixSelection3FromEndNodes: function() {\n//\t\tthis.debug(\"fixSelection3FromEndNodes()\");\n\t\t_assert(this.tree.options.selectMode === 3, \"expected selectMode 3\");\n\n\t\t// Visit all end nodes and adjust their parent's `selected` and `partsel`\n\t\t// attributes. Return selection state true, false, or undefined.\n\t\tfunction _walk(node){\n\t\t\tvar i, l, child, s, state, allSelected,someSelected,\n\t\t\t\tchildren = node.children;\n\n\t\t\tif( children && children.length ){\n\t\t\t\t// check all children recursively\n\t\t\t\tallSelected = true;\n\t\t\t\tsomeSelected = false;\n\n\t\t\t\tfor( i=0, l=children.length; i<l; i++ ){\n\t\t\t\t\tchild = children[i];\n\t\t\t\t\t// the selection state of a node is not relevant; we need the end-nodes\n\t\t\t\t\ts = _walk(child);\n\t\t\t\t\tif( s !== false ) {\n\t\t\t\t\t\tsomeSelected = true;\n\t\t\t\t\t}\n\t\t\t\t\tif( s !== true ) {\n\t\t\t\t\t\tallSelected = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tstate = allSelected ? true : (someSelected ? undefined : false);\n\t\t\t}else{\n\t\t\t\t// This is an end-node: simply report the status\n//\t\t\t\tstate = ( node.unselectable ) ? undefined : !!node.selected;\n\t\t\t\tstate = !!node.selected;\n\t\t\t}\n\t\t\tnode._changeSelectStatusAttrs(state);\n\t\t\treturn state;\n\t\t}\n\t\t_walk(this);\n\n\t\t// Update parent's state\n\t\tthis.visitParents(function(node){\n\t\t\tvar i, l, child, state,\n\t\t\t\tchildren = node.children,\n\t\t\t\tallSelected = true,\n\t\t\t\tsomeSelected = false;\n\n\t\t\tfor( i=0, l=children.length; i<l; i++ ){\n\t\t\t\tchild = children[i];\n\t\t\t\t// When fixing the parents, we trust the sibling status (i.e.\n\t\t\t\t// we don't recurse)\n\t\t\t\tif( child.selected || child.partsel ) {\n\t\t\t\t\tsomeSelected = true;\n\t\t\t\t}\n\t\t\t\tif( !child.unselectable && !child.selected ) {\n\t\t\t\t\tallSelected = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tstate = allSelected ? true : (someSelected ? undefined : false);\n\t\t\tnode._changeSelectStatusAttrs(state);\n\t\t});\n\t},\n\t// TODO: focus()\n\t/**\n\t * Update node data. If dict contains 'children', then also replace\n\t * the hole sub tree.\n\t * @param {NodeData} dict\n\t *\n\t * @see FancytreeNode#addChildren\n\t * @see FancytreeNode#applyPatch\n\t */\n\tfromDict: function(dict) {\n\t\t// copy all other attributes to this.data.xxx\n\t\tfor(var name in dict){\n\t\t\tif(NODE_ATTR_MAP[name]){\n\t\t\t\t// node.NAME = dict.NAME\n\t\t\t\tthis[name] = dict[name];\n\t\t\t}else if(name === \"data\"){\n\t\t\t\t// node.data += dict.data\n\t\t\t\t$.extend(this.data, dict.data);\n\t\t\t}else if(!$.isFunction(dict[name]) && !NONE_NODE_DATA_MAP[name]){\n\t\t\t\t// node.data.NAME = dict.NAME\n\t\t\t\tthis.data[name] = dict[name];\n\t\t\t}\n\t\t}\n\t\tif(dict.children){\n\t\t\t// recursively set children and render\n\t\t\tthis.removeChildren();\n\t\t\tthis.addChildren(dict.children);\n\t\t}\n\t\tthis.renderTitle();\n/*\n\t\tvar children = dict.children;\n\t\tif(children === undefined){\n\t\t\tthis.data = $.extend(this.data, dict);\n\t\t\tthis.render();\n\t\t\treturn;\n\t\t}\n\t\tdict = $.extend({}, dict);\n\t\tdict.children = undefined;\n\t\tthis.data = $.extend(this.data, dict);\n\t\tthis.removeChildren();\n\t\tthis.addChild(children);\n*/\n\t},\n\t/** Return the list of child nodes (undefined for unexpanded lazy nodes).\n\t * @returns {FancytreeNode[] | undefined}\n\t */\n\tgetChildren: function() {\n\t\tif(this.hasChildren() === undefined){ // TODO: only required for lazy nodes?\n\t\t\treturn undefined; // Lazy node: unloaded, currently loading, or load error\n\t\t}\n\t\treturn this.children;\n\t},\n\t/** Return the first child node or null.\n\t * @returns {FancytreeNode | null}\n\t */\n\tgetFirstChild: function() {\n\t\treturn this.children ? this.children[0] : null;\n\t},\n\t/** Return the 0-based child index.\n\t * @returns {int}\n\t */\n\tgetIndex: function() {\n//\t\treturn this.parent.children.indexOf(this);\n\t\treturn $.inArray(this, this.parent.children); // indexOf doesn't work in IE7\n\t},\n\t/** Return the hierarchical child index (1-based, e.g. '3.2.4').\n\t * @param {string} [separator=\".\"]\n\t * @param {int} [digits=1]\n\t * @returns {string}\n\t */\n\tgetIndexHier: function(separator, digits) {\n\t\tseparator = separator || \".\";\n\t\tvar s,\n\t\t\tres = [];\n\t\t$.each(this.getParentList(false, true), function(i, o){\n\t\t\ts = \"\" + (o.getIndex() + 1);\n\t\t\tif( digits ){\n\t\t\t\t// prepend leading zeroes\n\t\t\t\ts = (\"0000000\" + s).substr(-digits);\n\t\t\t}\n\t\t\tres.push(s);\n\t\t});\n\t\treturn res.join(separator);\n\t},\n\t/** Return the parent keys separated by options.keyPathSeparator, e.g. \"id_1/id_17/id_32\".\n\t * @param {boolean} [excludeSelf=false]\n\t * @returns {string}\n\t */\n\tgetKeyPath: function(excludeSelf) {\n\t\tvar path = [],\n\t\t\tsep = this.tree.options.keyPathSeparator;\n\t\tthis.visitParents(function(n){\n\t\t\tif(n.parent){\n\t\t\t\tpath.unshift(n.key);\n\t\t\t}\n\t\t}, !excludeSelf);\n\t\treturn sep + path.join(sep);\n\t},\n\t/** Return the last child of this node or null.\n\t * @returns {FancytreeNode | null}\n\t */\n\tgetLastChild: function() {\n\t\treturn this.children ? this.children[this.children.length - 1] : null;\n\t},\n\t/** Return node depth. 0: System root node, 1: visible top-level node, 2: first sub-level, ... .\n\t * @returns {int}\n\t */\n\tgetLevel: function() {\n\t\tvar level = 0,\n\t\t\tdtn = this.parent;\n\t\twhile( dtn ) {\n\t\t\tlevel++;\n\t\t\tdtn = dtn.parent;\n\t\t}\n\t\treturn level;\n\t},\n\t/** Return the successor node (under the same parent) or null.\n\t * @returns {FancytreeNode | null}\n\t */\n\tgetNextSibling: function() {\n\t\t// TODO: use indexOf, if available: (not in IE6)\n\t\tif( this.parent ){\n\t\t\tvar i, l,\n\t\t\t\tac = this.parent.children;\n\n\t\t\tfor(i=0, l=ac.length-1; i<l; i++){ // up to length-2, so next(last) = null\n\t\t\t\tif( ac[i] === this ){\n\t\t\t\t\treturn ac[i+1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t},\n\t/** Return the parent node (null for the system root node).\n\t * @returns {FancytreeNode | null}\n\t */\n\tgetParent: function() {\n\t\t// TODO: return null for top-level nodes?\n\t\treturn this.parent;\n\t},\n\t/** Return an array of all parent nodes (top-down).\n\t * @param {boolean} [includeRoot=false] Include the invisible system root node.\n\t * @param {boolean} [includeSelf=false] Include the node itself.\n\t * @returns {FancytreeNode[]}\n\t */\n\tgetParentList: function(includeRoot, includeSelf) {\n\t\tvar l = [],\n\t\t\tdtn = includeSelf ? this : this.parent;\n\t\twhile( dtn ) {\n\t\t\tif( includeRoot || dtn.parent ){\n\t\t\t\tl.unshift(dtn);\n\t\t\t}\n\t\t\tdtn = dtn.parent;\n\t\t}\n\t\treturn l;\n\t},\n\t/** Return the predecessor node (under the same parent) or null.\n\t * @returns {FancytreeNode | null}\n\t */\n\tgetPrevSibling: function() {\n\t\tif( this.parent ){\n\t\t\tvar i, l,\n\t\t\t\tac = this.parent.children;\n\n\t\t\tfor(i=1, l=ac.length; i<l; i++){ // start with 1, so prev(first) = null\n\t\t\t\tif( ac[i] === this ){\n\t\t\t\t\treturn ac[i-1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t},\n\t/**\n\t * Return an array of selected descendant nodes.\n\t * @param {boolean} [stopOnParents=false] only return the topmost selected\n\t *     node (useful with selectMode 3)\n\t * @returns {FancytreeNode[]}\n\t */\n\tgetSelectedNodes: function(stopOnParents) {\n\t\tvar nodeList = [];\n\t\tthis.visit(function(node){\n\t\t\tif( node.selected ) {\n\t\t\t\tnodeList.push(node);\n\t\t\t\tif( stopOnParents === true ){\n\t\t\t\t\treturn \"skip\"; // stop processing this branch\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn nodeList;\n\t},\n\t/** Return true if node has children. Return undefined if not sure, i.e. the node is lazy and not yet loaded).\n\t * @returns {boolean | undefined}\n\t */\n\thasChildren: function() {\n\t\tif(this.lazy){\n\t\t\tif(this.children == null ){\n\t\t\t\t// null or undefined: Not yet loaded\n\t\t\t\treturn undefined;\n\t\t\t}else if(this.children.length === 0){\n\t\t\t\t// Loaded, but response was empty\n\t\t\t\treturn false;\n\t\t\t}else if(this.children.length === 1 && this.children[0].isStatusNode() ){\n\t\t\t\t// Currently loading or load error\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn !!( this.children && this.children.length );\n\t},\n\t/** Return true if node has keyboard focus.\n\t * @returns {boolean}\n\t */\n\thasFocus: function() {\n\t\treturn (this.tree.hasFocus() && this.tree.focusNode === this);\n\t},\n\t/** Write to browser console if debugLevel >= 1 (prepending node info)\n\t *\n\t * @param {*} msg string or object or array of such\n\t */\n\tinfo: function(msg){\n\t\tif( this.tree.options.debugLevel >= 1 ) {\n\t\t\tArray.prototype.unshift.call(arguments, this.toString());\n\t\t\tconsoleApply(\"info\", arguments);\n\t\t}\n\t},\n\t/** Return true if node is active (see also FancytreeNode#isSelected).\n\t * @returns {boolean}\n\t */\n\tisActive: function() {\n\t\treturn (this.tree.activeNode === this);\n\t},\n\t/** Return true if node is a direct child of otherNode.\n\t * @param {FancytreeNode} otherNode\n\t * @returns {boolean}\n\t */\n\tisChildOf: function(otherNode) {\n\t\treturn (this.parent && this.parent === otherNode);\n\t},\n\t/** Return true, if node is a direct or indirect sub node of otherNode.\n\t * @param {FancytreeNode} otherNode\n\t * @returns {boolean}\n\t */\n\tisDescendantOf: function(otherNode) {\n\t\tif(!otherNode || otherNode.tree !== this.tree){\n\t\t\treturn false;\n\t\t}\n\t\tvar p = this.parent;\n\t\twhile( p ) {\n\t\t\tif( p === otherNode ){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tp = p.parent;\n\t\t}\n\t\treturn false;\n\t},\n\t/** Return true if node is expanded.\n\t * @returns {boolean}\n\t */\n\tisExpanded: function() {\n\t\treturn !!this.expanded;\n\t},\n\t/** Return true if node is the first node of its parent's children.\n\t * @returns {boolean}\n\t */\n\tisFirstSibling: function() {\n\t\tvar p = this.parent;\n\t\treturn !p || p.children[0] === this;\n\t},\n\t/** Return true if node is a folder, i.e. has the node.folder attribute set.\n\t * @returns {boolean}\n\t */\n\tisFolder: function() {\n\t\treturn !!this.folder;\n\t},\n\t/** Return true if node is the last node of its parent's children.\n\t * @returns {boolean}\n\t */\n\tisLastSibling: function() {\n\t\tvar p = this.parent;\n\t\treturn !p || p.children[p.children.length-1] === this;\n\t},\n\t/** Return true if node is lazy (even if data was already loaded)\n\t * @returns {boolean}\n\t */\n\tisLazy: function() {\n\t\treturn !!this.lazy;\n\t},\n\t/** Return true if node is lazy and loaded. For non-lazy nodes always return true.\n\t * @returns {boolean}\n\t */\n\tisLoaded: function() {\n\t\treturn !this.lazy || this.hasChildren() !== undefined; // Also checks if the only child is a status node\n\t},\n\t/** Return true if children are currently beeing loaded, i.e. a Ajax request is pending.\n\t * @returns {boolean}\n\t */\n\tisLoading: function() {\n\t\treturn !!this._isLoading;\n\t},\n\t/*\n\t * @deprecated since v2.4.0:  Use isRootNode() instead\n\t */\n\tisRoot: function() {\n\t\treturn this.isRootNode();\n\t},\n\t/** (experimental) Return true if this is partially loaded.\n\t * @returns {boolean}\n\t * @since 2.15\n\t */\n\tisPartload: function() {\n\t\treturn !!this.partload;\n\t},\n\t/** Return true if this is the (invisible) system root node.\n\t * @returns {boolean}\n\t * @since 2.4\n\t */\n\tisRootNode: function() {\n\t\treturn (this.tree.rootNode === this);\n\t},\n\t/** Return true if node is selected, i.e. has a checkmark set (see also FancytreeNode#isActive).\n\t * @returns {boolean}\n\t */\n\tisSelected: function() {\n\t\treturn !!this.selected;\n\t},\n\t/** Return true if this node is a temporarily generated system node like\n\t * 'loading', 'paging', or 'error' (node.statusNodeType contains the type).\n\t * @returns {boolean}\n\t */\n\tisStatusNode: function() {\n\t\treturn !!this.statusNodeType;\n\t},\n\t/** Return true if this node is a status node of type 'paging'.\n\t * @returns {boolean}\n\t * @since 2.15\n\t */\n\tisPagingNode: function() {\n\t\treturn this.statusNodeType === \"paging\";\n\t},\n\t/** Return true if this a top level node, i.e. a direct child of the (invisible) system root node.\n\t * @returns {boolean}\n\t * @since 2.4\n\t */\n\tisTopLevel: function() {\n\t\treturn (this.tree.rootNode === this.parent);\n\t},\n\t/** Return true if node is lazy and not yet loaded. For non-lazy nodes always return false.\n\t * @returns {boolean}\n\t */\n\tisUndefined: function() {\n\t\treturn this.hasChildren() === undefined; // also checks if the only child is a status node\n\t},\n\t/** Return true if all parent nodes are expanded. Note: this does not check\n\t * whether the node is scrolled into the visible part of the screen.\n\t * @returns {boolean}\n\t */\n\tisVisible: function() {\n\t\tvar i, l,\n\t\t\tparents = this.getParentList(false, false);\n\n\t\tfor(i=0, l=parents.length; i<l; i++){\n\t\t\tif( ! parents[i].expanded ){ return false; }\n\t\t}\n\t\treturn true;\n\t},\n\t/** Deprecated.\n\t * @deprecated since 2014-02-16: use load() instead.\n\t */\n\tlazyLoad: function(discard) {\n\t\tthis.warn(\"FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead.\");\n\t\treturn this.load(discard);\n\t},\n\t/**\n\t * Load all children of a lazy node if neccessary. The *expanded* state is maintained.\n\t * @param {boolean} [forceReload=false] Pass true to discard any existing nodes before.\n\t * @returns {$.Promise}\n\t */\n\tload: function(forceReload) {\n\t\tvar res, source,\n\t\t\tthat = this;\n\n\t\t_assert( this.isLazy(), \"load() requires a lazy node\" );\n\t\t// _assert( forceReload || this.isUndefined(), \"Pass forceReload=true to re-load a lazy node\" );\n\t\tif( !forceReload && !this.isUndefined() ) {\n\t\t\treturn _getResolvedPromise(this);\n\t\t}\n\t\tif( this.isLoaded() ){\n\t\t\tthis.resetLazy(); // also collapses\n\t\t}\n\t\t// This method is also called by setExpanded() and loadKeyPath(), so we\n\t\t// have to avoid recursion.\n\t\tsource = this.tree._triggerNodeEvent(\"lazyLoad\", this);\n\t\tif( source === false ) { // #69\n\t\t\treturn _getResolvedPromise(this);\n\t\t}\n\t\t_assert(typeof source !== \"boolean\", \"lazyLoad event must return source in data.result\");\n\t\tres = this.tree._callHook(\"nodeLoadChildren\", this, source);\n\t\tif( this.expanded ) {\n\t\t\tres.always(function(){\n\t\t\t\tthat.render();\n\t\t\t});\n\t\t}\n\t\treturn res;\n\t},\n\t/** Expand all parents and optionally scroll into visible area as neccessary.\n\t * Promise is resolved, when lazy loading and animations are done.\n\t * @param {object} [opts] passed to `setExpanded()`.\n\t *     Defaults to {noAnimation: false, noEvents: false, scrollIntoView: true}\n\t * @returns {$.Promise}\n\t */\n\tmakeVisible: function(opts) {\n\t\tvar i,\n\t\t\tthat = this,\n\t\t\tdeferreds = [],\n\t\t\tdfd = new $.Deferred(),\n\t\t\tparents = this.getParentList(false, false),\n\t\t\tlen = parents.length,\n\t\t\teffects = !(opts && opts.noAnimation === true),\n\t\t\tscroll = !(opts && opts.scrollIntoView === false);\n\n\t\t// Expand bottom-up, so only the top node is animated\n\t\tfor(i = len - 1; i >= 0; i--){\n\t\t\t// that.debug(\"pushexpand\" + parents[i]);\n\t\t\tdeferreds.push(parents[i].setExpanded(true, opts));\n\t\t}\n\t\t$.when.apply($, deferreds).done(function(){\n\t\t\t// All expands have finished\n\t\t\t// that.debug(\"expand DONE\", scroll);\n\t\t\tif( scroll ){\n\t\t\t\tthat.scrollIntoView(effects).done(function(){\n\t\t\t\t\t// that.debug(\"scroll DONE\");\n\t\t\t\t\tdfd.resolve();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tdfd.resolve();\n\t\t\t}\n\t\t});\n\t\treturn dfd.promise();\n\t},\n\t/** Move this node to targetNode.\n\t *  @param {FancytreeNode} targetNode\n\t *  @param {string} mode <pre>\n\t *      'child': append this node as last child of targetNode.\n\t *               This is the default. To be compatble with the D'n'd\n\t *               hitMode, we also accept 'over'.\n\t *      'firstChild': add this node as first child of targetNode.\n\t *      'before': add this node as sibling before targetNode.\n\t *      'after': add this node as sibling after targetNode.</pre>\n\t *  @param {function} [map] optional callback(FancytreeNode) to allow modifcations\n\t */\n\tmoveTo: function(targetNode, mode, map) {\n\t\tif(mode === undefined || mode === \"over\"){\n\t\t\tmode = \"child\";\n\t\t} else if ( mode === \"firstChild\" ) {\n\t\t\tif( targetNode.children && targetNode.children.length ) {\n\t\t\t\tmode = \"before\";\n\t\t\t\ttargetNode = targetNode.children[0];\n\t\t\t} else {\n\t\t\t\tmode = \"child\";\n\t\t\t}\n\t\t}\n\t\tvar pos,\n\t\t\tprevParent = this.parent,\n\t\t\ttargetParent = (mode === \"child\") ? targetNode : targetNode.parent;\n\n\t\tif(this === targetNode){\n\t\t\treturn;\n\t\t}else if( !this.parent  ){\n\t\t\t$.error(\"Cannot move system root\");\n\t\t}else if( targetParent.isDescendantOf(this) ){\n\t\t\t$.error(\"Cannot move a node to its own descendant\");\n\t\t}\n\t\t// Unlink this node from current parent\n\t\tif( this.parent.children.length === 1 ) {\n\t\t\tif( this.parent === targetParent ){\n\t\t\t\treturn; // #258\n\t\t\t}\n\t\t\tthis.parent.children = this.parent.lazy ? [] : null;\n\t\t\tthis.parent.expanded = false;\n\t\t} else {\n\t\t\tpos = $.inArray(this, this.parent.children);\n\t\t\t_assert(pos >= 0, \"invalid source parent\");\n\t\t\tthis.parent.children.splice(pos, 1);\n\t\t}\n\t\t// Remove from source DOM parent\n//\t\tif(this.parent.ul){\n//\t\t\tthis.parent.ul.removeChild(this.li);\n//\t\t}\n\n\t\t// Insert this node to target parent's child list\n\t\tthis.parent = targetParent;\n\t\tif( targetParent.hasChildren() ) {\n\t\t\tswitch(mode) {\n\t\t\tcase \"child\":\n\t\t\t\t// Append to existing target children\n\t\t\t\ttargetParent.children.push(this);\n\t\t\t\tbreak;\n\t\t\tcase \"before\":\n\t\t\t\t// Insert this node before target node\n\t\t\t\tpos = $.inArray(targetNode, targetParent.children);\n\t\t\t\t_assert(pos >= 0, \"invalid target parent\");\n\t\t\t\ttargetParent.children.splice(pos, 0, this);\n\t\t\t\tbreak;\n\t\t\tcase \"after\":\n\t\t\t\t// Insert this node after target node\n\t\t\t\tpos = $.inArray(targetNode, targetParent.children);\n\t\t\t\t_assert(pos >= 0, \"invalid target parent\");\n\t\t\t\ttargetParent.children.splice(pos+1, 0, this);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\t$.error(\"Invalid mode \" + mode);\n\t\t\t}\n\t\t} else {\n\t\t\ttargetParent.children = [ this ];\n\t\t}\n\t\t// Parent has no <ul> tag yet:\n//\t\tif( !targetParent.ul ) {\n//\t\t\t// This is the parent's first child: create UL tag\n//\t\t\t// (Hidden, because it will be\n//\t\t\ttargetParent.ul = document.createElement(\"ul\");\n//\t\t\ttargetParent.ul.style.display = \"none\";\n//\t\t\ttargetParent.li.appendChild(targetParent.ul);\n//\t\t}\n//\t\t// Issue 319: Add to target DOM parent (only if node was already rendered(expanded))\n//\t\tif(this.li){\n//\t\t\ttargetParent.ul.appendChild(this.li);\n//\t\t}^\n\n\t\t// Let caller modify the nodes\n\t\tif( map ){\n\t\t\ttargetNode.visit(map, true);\n\t\t}\n\t\t// Handle cross-tree moves\n\t\tif( this.tree !== targetNode.tree ) {\n\t\t\t// Fix node.tree for all source nodes\n//\t\t\t_assert(false, \"Cross-tree move is not yet implemented.\");\n\t\t\tthis.warn(\"Cross-tree moveTo is experimantal!\");\n\t\t\tthis.visit(function(n){\n\t\t\t\t// TODO: fix selection state and activation, ...\n\t\t\t\tn.tree = targetNode.tree;\n\t\t\t}, true);\n\t\t}\n\n\t\t// A collaposed node won't re-render children, so we have to remove it manually\n\t\t// if( !targetParent.expanded ){\n\t\t//   prevParent.ul.removeChild(this.li);\n\t\t// }\n\n\t\t// Update HTML markup\n\t\tif( !prevParent.isDescendantOf(targetParent)) {\n\t\t\tprevParent.render();\n\t\t}\n\t\tif( !targetParent.isDescendantOf(prevParent) && targetParent !== prevParent) {\n\t\t\ttargetParent.render();\n\t\t}\n\t\t// TODO: fix selection state\n\t\t// TODO: fix active state\n\n/*\n\t\tvar tree = this.tree;\n\t\tvar opts = tree.options;\n\t\tvar pers = tree.persistence;\n\n\n\t\t// Always expand, if it's below minExpandLevel\n//\t\ttree.logDebug (\"%s._addChildNode(%o), l=%o\", this, ftnode, ftnode.getLevel());\n\t\tif ( opts.minExpandLevel >= ftnode.getLevel() ) {\n//\t\t\ttree.logDebug (\"Force expand for %o\", ftnode);\n\t\t\tthis.bExpanded = true;\n\t\t}\n\n\t\t// In multi-hier mode, update the parents selection state\n\t\t// DT issue #82: only if not initializing, because the children may not exist yet\n//\t\tif( !ftnode.data.isStatusNode() && opts.selectMode==3 && !isInitializing )\n//\t\t\tftnode._fixSelectionState();\n\n\t\t// In multi-hier mode, update the parents selection state\n\t\tif( ftnode.bSelected && opts.selectMode==3 ) {\n\t\t\tvar p = this;\n\t\t\twhile( p ) {\n\t\t\t\tif( !p.hasSubSel )\n\t\t\t\t\tp._setSubSel(true);\n\t\t\t\tp = p.parent;\n\t\t\t}\n\t\t}\n\t\t// render this node and the new child\n\t\tif ( tree.bEnableUpdate )\n\t\t\tthis.render();\n\n\t\treturn ftnode;\n\n*/\n\t},\n\t/** Set focus relative to this node and optionally activate.\n\t *\n\t * @param {number} where The keyCode that would normally trigger this move,\n\t *\t\te.g. `$.ui.keyCode.LEFT` would collapse the node if it\n\t *      is expanded or move to the parent oterwise.\n\t * @param {boolean} [activate=true]\n\t * @returns {$.Promise}\n\t */\n\t// navigate: function(where, activate) {\n\t// \tconsole.time(\"navigate\")\n\t// \tthis._navigate(where, activate)\n\t// \tconsole.timeEnd(\"navigate\")\n\t// },\n\tnavigate: function(where, activate) {\n\t\tvar i, parents, res,\n\t\t\thandled = true,\n\t\t\tKC = $.ui.keyCode,\n\t\t\tsib = null;\n\n\t\t// Navigate to node\n\t\tfunction _goto(n){\n\t\t\tif( n ){\n\t\t\t\ttry { n.makeVisible(); } catch(e) {} // #272\n\t\t\t\t// Node may still be hidden by a filter\n\t\t\t\tif( ! $(n.span).is(\":visible\") ) {\n\t\t\t\t\tn.debug(\"Navigate: skipping hidden node\");\n\t\t\t\t\tn.navigate(where, activate);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn activate === false ? n.setFocus() : n.setActive();\n\t\t\t}\n\t\t}\n\n\t\tswitch( where ) {\n\t\t\tcase KC.BACKSPACE:\n\t\t\t\tif( this.parent && this.parent.parent ) {\n\t\t\t\t\tres = _goto(this.parent);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase KC.LEFT:\n\t\t\t\tif( this.expanded ) {\n\t\t\t\t\tthis.setExpanded(false);\n\t\t\t\t\tres = _goto(this);\n\t\t\t\t} else if( this.parent && this.parent.parent ) {\n\t\t\t\t\tres = _goto(this.parent);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase KC.RIGHT:\n\t\t\t\tif( !this.expanded && (this.children || this.lazy) ) {\n\t\t\t\t\tthis.setExpanded();\n\t\t\t\t\tres = _goto(this);\n\t\t\t\t} else if( this.children && this.children.length ) {\n\t\t\t\t\tres = _goto(this.children[0]);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase KC.UP:\n\t\t\t\tsib = this.getPrevSibling();\n\t\t\t\t// #359: skip hidden sibling nodes, preventing a _goto() recursion\n\t\t\t\twhile( sib && !$(sib.span).is(\":visible\") ) {\n\t\t\t\t\tsib = sib.getPrevSibling();\n\t\t\t\t}\n\t\t\t\twhile( sib && sib.expanded && sib.children && sib.children.length ) {\n\t\t\t\t\tsib = sib.children[sib.children.length - 1];\n\t\t\t\t}\n\t\t\t\tif( !sib && this.parent && this.parent.parent ){\n\t\t\t\t\tsib = this.parent;\n\t\t\t\t}\n\t\t\t\tres = _goto(sib);\n\t\t\t\tbreak;\n\t\t\tcase KC.DOWN:\n\t\t\t\tif( this.expanded && this.children && this.children.length ) {\n\t\t\t\t\tsib = this.children[0];\n\t\t\t\t} else {\n\t\t\t\t\tparents = this.getParentList(false, true);\n\t\t\t\t\tfor(i=parents.length-1; i>=0; i--) {\n\t\t\t\t\t\tsib = parents[i].getNextSibling();\n\t\t\t\t\t\t// #359: skip hidden sibling nodes, preventing a _goto() recursion\n\t\t\t\t\t\twhile( sib && !$(sib.span).is(\":visible\") ) {\n\t\t\t\t\t\t\tsib = sib.getNextSibling();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif( sib ){ break; }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tres = _goto(sib);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\thandled = false;\n\t\t}\n\t\treturn res || _getResolvedPromise();\n\t},\n\t/**\n\t * Remove this node (not allowed for system root).\n\t */\n\tremove: function() {\n\t\treturn this.parent.removeChild(this);\n\t},\n\t/**\n\t * Remove childNode from list of direct children.\n\t * @param {FancytreeNode} childNode\n\t */\n\tremoveChild: function(childNode) {\n\t\treturn this.tree._callHook(\"nodeRemoveChild\", this, childNode);\n\t},\n\t/**\n\t * Remove all child nodes and descendents. This converts the node into a leaf.<br>\n\t * If this was a lazy node, it is still considered 'loaded'; call node.resetLazy()\n\t * in order to trigger lazyLoad on next expand.\n\t */\n\tremoveChildren: function() {\n\t\treturn this.tree._callHook(\"nodeRemoveChildren\", this);\n\t},\n\t/**\n\t * Remove class from node's span tag and .extraClasses.\n\t *\n\t * @param {string} className class name\n\t *\n\t * @since 2.17\n\t */\n\tremoveClass: function(className){\n\t\treturn this.toggleClass(className, false);\n\t},\n\t/**\n\t * This method renders and updates all HTML markup that is required\n\t * to display this node in its current state.<br>\n\t * Note:\n\t * <ul>\n\t * <li>It should only be neccessary to call this method after the node object\n\t *     was modified by direct access to its properties, because the common\n\t *     API methods (node.setTitle(), moveTo(), addChildren(), remove(), ...)\n\t *     already handle this.\n\t * <li> {@link FancytreeNode#renderTitle} and {@link FancytreeNode#renderStatus}\n\t *     are implied. If changes are more local, calling only renderTitle() or\n\t *     renderStatus() may be sufficient and faster.\n\t * <li>If a node was created/removed, node.render() must be called <i>on the parent</i>.\n\t * </ul>\n\t *\n\t * @param {boolean} [force=false] re-render, even if html markup was already created\n\t * @param {boolean} [deep=false] also render all descendants, even if parent is collapsed\n\t */\n\trender: function(force, deep) {\n\t\treturn this.tree._callHook(\"nodeRender\", this, force, deep);\n\t},\n\t/** Create HTML markup for the node's outer &lt;span> (expander, checkbox, icon, and title).\n\t * Implies {@link FancytreeNode#renderStatus}.\n\t * @see Fancytree_Hooks#nodeRenderTitle\n\t */\n\trenderTitle: function() {\n\t\treturn this.tree._callHook(\"nodeRenderTitle\", this);\n\t},\n\t/** Update element's CSS classes according to node state.\n\t * @see Fancytree_Hooks#nodeRenderStatus\n\t */\n\trenderStatus: function() {\n\t\treturn this.tree._callHook(\"nodeRenderStatus\", this);\n\t},\n\t/**\n\t * (experimental) Replace this node with `source`.\n\t * @since 2.15\n\t */\n\treplaceWith: function(source) {\n\t\tvar res,\n\t\t\tparent = this.parent,\n\t\t\tpos = $.inArray(this, parent.children),\n\t\t\tthat = this;\n\n\t\t_assert( this.isPagingNode(), \"replaceWith() currently requires a paging status node\" );\n\n\t\tres = this.tree._callHook(\"nodeLoadChildren\", this, source);\n\t\tres.done(function(data){\n\t\t\t// New nodes are currently children of `this`.\n\t\t\tvar children = that.children;\n\t\t\t// Prepend newly loaded child nodes to `this`\n\t\t\t// Move new children after self\n\t\t\tfor( i=0; i<children.length; i++ ) {\n\t\t\t\tchildren[i].parent = parent;\n\t\t\t}\n\t\t\tparent.children.splice.apply(parent.children, [pos + 1, 0].concat(children));\n\n\t\t\t// Remove self\n\t\t\tthat.children = null;\n\t\t\tthat.remove();\n\t\t\t// Redraw new nodes\n\t\t\tparent.render();\n\t\t\t// TODO: set node.partload = false if this was tha last paging node?\n\t\t\t// parent.addPagingNode(false);\n\t\t}).fail(function(){\n\t\t\tthat.setExpanded();\n\t\t});\n\t\treturn res;\n\t\t// $.error(\"Not implemented: replaceWith()\");\n\t},\n\t/**\n\t * Remove all children, collapse, and set the lazy-flag, so that the lazyLoad\n\t * event is triggered on next expand.\n\t */\n\tresetLazy: function() {\n\t\tthis.removeChildren();\n\t\tthis.expanded = false;\n\t\tthis.lazy = true;\n\t\tthis.children = undefined;\n\t\tthis.renderStatus();\n\t},\n\t/** Schedule activity for delayed execution (cancel any pending request).\n\t *  scheduleAction('cancel') will only cancel a pending request (if any).\n\t * @param {string} mode\n\t * @param {number} ms\n\t */\n\tscheduleAction: function(mode, ms) {\n\t\tif( this.tree.timer ) {\n\t\t\tclearTimeout(this.tree.timer);\n//            this.tree.debug(\"clearTimeout(%o)\", this.tree.timer);\n\t\t}\n\t\tthis.tree.timer = null;\n\t\tvar self = this; // required for closures\n\t\tswitch (mode) {\n\t\tcase \"cancel\":\n\t\t\t// Simply made sure that timer was cleared\n\t\t\tbreak;\n\t\tcase \"expand\":\n\t\t\tthis.tree.timer = setTimeout(function(){\n\t\t\t\tself.tree.debug(\"setTimeout: trigger expand\");\n\t\t\t\tself.setExpanded(true);\n\t\t\t}, ms);\n\t\t\tbreak;\n\t\tcase \"activate\":\n\t\t\tthis.tree.timer = setTimeout(function(){\n\t\t\t\tself.tree.debug(\"setTimeout: trigger activate\");\n\t\t\t\tself.setActive(true);\n\t\t\t}, ms);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\t$.error(\"Invalid mode \" + mode);\n\t\t}\n//        this.tree.debug(\"setTimeout(%s, %s): %s\", mode, ms, this.tree.timer);\n\t},\n\t/**\n\t *\n\t * @param {boolean | PlainObject} [effects=false] animation options.\n\t * @param {object} [options=null] {topNode: null, effects: ..., parent: ...} this node will remain visible in\n\t *     any case, even if `this` is outside the scroll pane.\n\t * @returns {$.Promise}\n\t */\n\tscrollIntoView: function(effects, options) {\n\t\tif( options !== undefined && _isNode(options) ) {\n\t\t\tthis.warn(\"scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead.\");\n\t\t\toptions = {topNode: options};\n\t\t}\n\t\t// this.$scrollParent = (this.options.scrollParent === \"auto\") ? $ul.scrollParent() : $(this.options.scrollParent);\n\t\t// this.$scrollParent = this.$scrollParent.length ? this.$scrollParent || this.$container;\n\n\t\tvar topNodeY, nodeY, horzScrollbarHeight, containerOffsetTop,\n\t\t\topts = $.extend({\n\t\t\t\teffects: (effects === true) ? {duration: 200, queue: false} : effects,\n\t\t\t\tscrollOfs: this.tree.options.scrollOfs,\n\t\t\t\tscrollParent: this.tree.options.scrollParent || this.tree.$container,\n\t\t\t\ttopNode: null\n\t\t\t}, options),\n\t\t\tdfd = new $.Deferred(),\n\t\t\tthat = this,\n\t\t\tnodeHeight = $(this.span).height(),\n\t\t\t$container = $(opts.scrollParent),\n\t\t\ttopOfs = opts.scrollOfs.top || 0,\n\t\t\tbottomOfs = opts.scrollOfs.bottom || 0,\n\t\t\tcontainerHeight = $container.height(),// - topOfs - bottomOfs,\n\t\t\tscrollTop = $container.scrollTop(),\n\t\t\t$animateTarget = $container,\n\t\t\tisParentWindow = $container[0] === window,\n\t\t\ttopNode = opts.topNode || null,\n\t\t\tnewScrollTop = null;\n\n\t\t// this.debug(\"scrollIntoView(), scrollTop=\" + scrollTop, opts.scrollOfs);\n//\t\t_assert($(this.span).is(\":visible\"), \"scrollIntoView node is invisible\"); // otherwise we cannot calc offsets\n\t\tif( !$(this.span).is(\":visible\") ) {\n\t\t\t// We cannot calc offsets for hidden elements\n\t\t\tthis.warn(\"scrollIntoView(): node is invisible.\");\n\t\t\treturn _getResolvedPromise();\n\t\t}\n\t\tif( isParentWindow ) {\n\t\t\tnodeY = $(this.span).offset().top;\n\t\t\ttopNodeY = (topNode && topNode.span) ? $(topNode.span).offset().top : 0;\n\t\t\t$animateTarget = $(\"html,body\");\n\n\t\t} else {\n\t\t\t_assert($container[0] !== document && $container[0] !== document.body,\n\t\t\t\t\"scrollParent should be a simple element or `window`, not document or body.\");\n\n\t\t\tcontainerOffsetTop = $container.offset().top,\n\t\t\tnodeY = $(this.span).offset().top - containerOffsetTop + scrollTop; // relative to scroll parent\n\t\t\ttopNodeY = topNode ? $(topNode.span).offset().top - containerOffsetTop + scrollTop : 0;\n\t\t\thorzScrollbarHeight = Math.max(0, ($container.innerHeight() - $container[0].clientHeight));\n\t\t\tcontainerHeight -= horzScrollbarHeight;\n\t\t}\n\n\t\t// this.debug(\"    scrollIntoView(), nodeY=\" + nodeY + \", containerHeight=\" + containerHeight);\n\t\tif( nodeY < (scrollTop + topOfs) ){\n\t\t\t// Node is above visible container area\n\t\t\tnewScrollTop = nodeY - topOfs;\n\t\t\t// this.debug(\"    scrollIntoView(), UPPER newScrollTop=\" + newScrollTop);\n\n\t\t}else if((nodeY + nodeHeight) > (scrollTop + containerHeight - bottomOfs)){\n\t\t\tnewScrollTop = nodeY + nodeHeight - containerHeight + bottomOfs;\n\t\t\t// this.debug(\"    scrollIntoView(), LOWER newScrollTop=\" + newScrollTop);\n\t\t\t// If a topNode was passed, make sure that it is never scrolled\n\t\t\t// outside the upper border\n\t\t\tif(topNode){\n\t\t\t\t_assert(topNode.isRootNode() || $(topNode.span).is(\":visible\"), \"topNode must be visible\");\n\t\t\t\tif( topNodeY < newScrollTop ){\n\t\t\t\t\tnewScrollTop = topNodeY - topOfs;\n\t\t\t\t\t// this.debug(\"    scrollIntoView(), TOP newScrollTop=\" + newScrollTop);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif(newScrollTop !== null){\n\t\t\t// this.debug(\"    scrollIntoView(), SET newScrollTop=\" + newScrollTop);\n\t\t\tif(opts.effects){\n\t\t\t\topts.effects.complete = function(){\n\t\t\t\t\tdfd.resolveWith(that);\n\t\t\t\t};\n\t\t\t\t$animateTarget.stop(true).animate({\n\t\t\t\t\tscrollTop: newScrollTop\n\t\t\t\t}, opts.effects);\n\t\t\t}else{\n\t\t\t\t$animateTarget[0].scrollTop = newScrollTop;\n\t\t\t\tdfd.resolveWith(this);\n\t\t\t}\n\t\t}else{\n\t\t\tdfd.resolveWith(this);\n\t\t}\n\t\treturn dfd.promise();\n\t},\n\n\t/**Activate this node.\n\t * @param {boolean} [flag=true] pass false to deactivate\n\t * @param {object} [opts] additional options. Defaults to {noEvents: false}\n\t * @returns {$.Promise}\n\t */\n\tsetActive: function(flag, opts){\n\t\treturn this.tree._callHook(\"nodeSetActive\", this, flag, opts);\n\t},\n\t/**Expand or collapse this node. Promise is resolved, when lazy loading and animations are done.\n\t * @param {boolean} [flag=true] pass false to collapse\n\t * @param {object} [opts] additional options. Defaults to {noAnimation: false, noEvents: false}\n\t * @returns {$.Promise}\n\t */\n\tsetExpanded: function(flag, opts){\n\t\treturn this.tree._callHook(\"nodeSetExpanded\", this, flag, opts);\n\t},\n\t/**Set keyboard focus to this node.\n\t * @param {boolean} [flag=true] pass false to blur\n\t * @see Fancytree#setFocus\n\t */\n\tsetFocus: function(flag){\n\t\treturn this.tree._callHook(\"nodeSetFocus\", this, flag);\n\t},\n\t/**Select this node, i.e. check the checkbox.\n\t * @param {boolean} [flag=true] pass false to deselect\n\t */\n\tsetSelected: function(flag){\n\t\treturn this.tree._callHook(\"nodeSetSelected\", this, flag);\n\t},\n\t/**Mark a lazy node as 'error', 'loading', 'nodata', or 'ok'.\n\t * @param {string} status 'error'|'empty'|'ok'\n\t * @param {string} [message]\n\t * @param {string} [details]\n\t */\n\tsetStatus: function(status, message, details){\n\t\treturn this.tree._callHook(\"nodeSetStatus\", this, status, message, details);\n\t},\n\t/**Rename this node.\n\t * @param {string} title\n\t */\n\tsetTitle: function(title){\n\t\tthis.title = title;\n\t\tthis.renderTitle();\n\t},\n\t/**Sort child list by title.\n\t * @param {function} [cmp] custom compare function(a, b) that returns -1, 0, or 1 (defaults to sort by title).\n\t * @param {boolean} [deep=false] pass true to sort all descendant nodes\n\t */\n\tsortChildren: function(cmp, deep) {\n\t\tvar i,l,\n\t\t\tcl = this.children;\n\n\t\tif( !cl ){\n\t\t\treturn;\n\t\t}\n\t\tcmp = cmp || function(a, b) {\n\t\t\tvar x = a.title.toLowerCase(),\n\t\t\t\ty = b.title.toLowerCase();\n\t\t\treturn x === y ? 0 : x > y ? 1 : -1;\n\t\t\t};\n\t\tcl.sort(cmp);\n\t\tif( deep ){\n\t\t\tfor(i=0, l=cl.length; i<l; i++){\n\t\t\t\tif( cl[i].children ){\n\t\t\t\t\tcl[i].sortChildren(cmp, \"$norender$\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif( deep !== \"$norender$\" ){\n\t\t\tthis.render();\n\t\t}\n\t},\n\t/** Convert node (or whole branch) into a plain object.\n\t *\n\t * The result is compatible with node.addChildren().\n\t *\n\t * @param {boolean} [recursive=false] include child nodes\n\t * @param {function} [callback] callback(dict, node) is called for every node, in order to allow modifications\n\t * @returns {NodeData}\n\t */\n\ttoDict: function(recursive, callback) {\n\t\tvar i, l, node,\n\t\t\tdict = {},\n\t\t\tself = this;\n\n\t\t$.each(NODE_ATTRS, function(i, a){\n\t\t\tif(self[a] || self[a] === false){\n\t\t\t\tdict[a] = self[a];\n\t\t\t}\n\t\t});\n\t\tif(!$.isEmptyObject(this.data)){\n\t\t\tdict.data = $.extend({}, this.data);\n\t\t\tif($.isEmptyObject(dict.data)){\n\t\t\t\tdelete dict.data;\n\t\t\t}\n\t\t}\n\t\tif( callback ){\n\t\t\tcallback(dict, self);\n\t\t}\n\t\tif( recursive ) {\n\t\t\tif(this.hasChildren()){\n\t\t\t\tdict.children = [];\n\t\t\t\tfor(i=0, l=this.children.length; i<l; i++ ){\n\t\t\t\t\tnode = this.children[i];\n\t\t\t\t\tif( !node.isStatusNode() ){\n\t\t\t\t\t\tdict.children.push(node.toDict(true, callback));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}else{\n//                dict.children = null;\n\t\t\t}\n\t\t}\n\t\treturn dict;\n\t},\n\t/**\n\t * Set, clear, or toggle class of node's span tag and .extraClasses.\n\t *\n\t * @param {string} className class name (separate multiple classes by space)\n\t * @param {boolean} [flag] true/false to add/remove class. If omitted, class is toggled.\n\t * @returns {boolean} true if a class was added\n\t *\n\t * @since 2.17\n\t */\n\ttoggleClass: function(value, flag){\n\t\tvar className, hasClass,\n\t\t\trnotwhite = ( /\\S+/g ),\n\t\t\tclassNames = value.match( rnotwhite ) || [],\n\t\t\ti = 0,\n\t\t\twasAdded = false,\n\t\t\tstatusElem = this[this.tree.statusClassPropName],\n\t\t\tcurClasses = (\" \" + (this.extraClasses || \"\") + \" \");\n\n\t\t// this.info(\"toggleClass('\" + value + \"', \" + flag + \")\", curClasses);\n\t\t// Modify DOM element directly if it already exists\n\t\tif( statusElem ) {\n\t\t\t$(statusElem).toggleClass(value, flag);\n\t\t}\n\t\t// Modify node.extraClasses to make this change persistent\n\t\t// Toggle if flag was not passed\n\t\twhile ( className = classNames[ i++ ] ) {\n\t\t\thasClass = curClasses.indexOf(\" \" + className + \" \") >= 0;\n\t\t\tflag = (flag === undefined) ? (!hasClass) : !!flag;\n\t\t\tif ( flag ) {\n\t\t\t\tif( !hasClass ) {\n\t\t\t\t\tcurClasses += className + \" \";\n\t\t\t\t\twasAdded = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twhile ( curClasses.indexOf( \" \" + className + \" \" ) > -1 ) {\n\t\t\t\t\tcurClasses = curClasses.replace( \" \" + className + \" \", \" \" );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.extraClasses = $.trim(curClasses);\n\t\t// this.info(\"-> toggleClass('\" + value + \"', \" + flag + \"): '\" + this.extraClasses + \"'\");\n\t\treturn wasAdded;\n\t},\n\t/** Flip expanded status.  */\n\ttoggleExpanded: function(){\n\t\treturn this.tree._callHook(\"nodeToggleExpanded\", this);\n\t},\n\t/** Flip selection status.  */\n\ttoggleSelected: function(){\n\t\treturn this.tree._callHook(\"nodeToggleSelected\", this);\n\t},\n\ttoString: function() {\n\t\treturn \"<FancytreeNode(#\" + this.key + \", '\" + this.title + \"')>\";\n\t},\n\t/** Call fn(node) for all child nodes.<br>\n\t * Stop iteration, if fn() returns false. Skip current branch, if fn() returns \"skip\".<br>\n\t * Return false if iteration was stopped.\n\t *\n\t * @param {function} fn the callback function.\n\t *     Return false to stop iteration, return \"skip\" to skip this node and\n\t *     its children only.\n\t * @param {boolean} [includeSelf=false]\n\t * @returns {boolean}\n\t */\n\tvisit: function(fn, includeSelf) {\n\t\tvar i, l,\n\t\t\tres = true,\n\t\t\tchildren = this.children;\n\n\t\tif( includeSelf === true ) {\n\t\t\tres = fn(this);\n\t\t\tif( res === false || res === \"skip\" ){\n\t\t\t\treturn res;\n\t\t\t}\n\t\t}\n\t\tif(children){\n\t\t\tfor(i=0, l=children.length; i<l; i++){\n\t\t\t\tres = children[i].visit(fn, true);\n\t\t\t\tif( res === false ){\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t},\n\t/** Call fn(node) for all child nodes and recursively load lazy children.<br>\n\t * <b>Note:</b> If you need this method, you probably should consider to review\n\t * your architecture! Recursivley loading nodes is a perfect way for lazy\n\t * programmers to flood the server with requests ;-)\n\t *\n\t * @param {function} [fn] optional callback function.\n\t *     Return false to stop iteration, return \"skip\" to skip this node and\n\t *     its children only.\n\t * @param {boolean} [includeSelf=false]\n\t * @returns {$.Promise}\n\t * @since 2.4\n\t */\n\tvisitAndLoad: function(fn, includeSelf, _recursion) {\n\t\tvar dfd, res, loaders,\n\t\t\tnode = this;\n\n\t\t// node.debug(\"visitAndLoad\");\n\t\tif( fn && includeSelf === true ) {\n\t\t\tres = fn(node);\n\t\t\tif( res === false || res === \"skip\" ) {\n\t\t\t\treturn _recursion ? res : _getResolvedPromise();\n\t\t\t}\n\t\t}\n\t\tif( !node.children && !node.lazy ) {\n\t\t\treturn _getResolvedPromise();\n\t\t}\n\t\tdfd = new $.Deferred();\n\t\tloaders = [];\n\t\t// node.debug(\"load()...\");\n\t\tnode.load().done(function(){\n\t\t\t// node.debug(\"load()... done.\");\n\t\t\tfor(var i=0, l=node.children.length; i<l; i++){\n\t\t\t\tres = node.children[i].visitAndLoad(fn, true, true);\n\t\t\t\tif( res === false ) {\n\t\t\t\t\tdfd.reject();\n\t\t\t\t\tbreak;\n\t\t\t\t} else if ( res !== \"skip\" ) {\n\t\t\t\t\tloaders.push(res); // Add promise to the list\n\t\t\t\t}\n\t\t\t}\n\t\t\t$.when.apply(this, loaders).then(function(){\n\t\t\t\tdfd.resolve();\n\t\t\t});\n\t\t});\n\t\treturn dfd.promise();\n\t},\n\t/** Call fn(node) for all parent nodes, bottom-up, including invisible system root.<br>\n\t * Stop iteration, if fn() returns false.<br>\n\t * Return false if iteration was stopped.\n\t *\n\t * @param {function} fn the callback function.\n\t *     Return false to stop iteration, return \"skip\" to skip this node and children only.\n\t * @param {boolean} [includeSelf=false]\n\t * @returns {boolean}\n\t */\n\tvisitParents: function(fn, includeSelf) {\n\t\t// Visit parent nodes (bottom up)\n\t\tif(includeSelf && fn(this) === false){\n\t\t\treturn false;\n\t\t}\n\t\tvar p = this.parent;\n\t\twhile( p ) {\n\t\t\tif(fn(p) === false){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tp = p.parent;\n\t\t}\n\t\treturn true;\n\t},\n\t/** Write warning to browser console (prepending node info)\n\t *\n\t * @param {*} msg string or object or array of such\n\t */\n\twarn: function(msg){\n\t\tArray.prototype.unshift.call(arguments, this.toString());\n\t\tconsoleApply(\"warn\", arguments);\n\t}\n};\n\n\n/* *****************************************************************************\n * Fancytree\n */\n/**\n * Construct a new tree object.\n *\n * @class Fancytree\n * @classdesc The controller behind a fancytree.\n * This class also contains 'hook methods': see {@link Fancytree_Hooks}.\n *\n * @param {Widget} widget\n *\n * @property {string} _id Automatically generated unique tree instance ID, e.g. \"1\".\n * @property {string} _ns Automatically generated unique tree namespace, e.g. \".fancytree-1\".\n * @property {FancytreeNode} activeNode Currently active node or null.\n * @property {string} ariaPropName Property name of FancytreeNode that contains the element which will receive the aria attributes.\n *     Typically \"li\", but \"tr\" for table extension.\n * @property {jQueryObject} $container Outer &lt;ul> element (or &lt;table> element for ext-table).\n * @property {jQueryObject} $div A jQuery object containing the element used to instantiate the tree widget (`widget.element`)\n * @property {object} data Metadata, i.e. properties that may be passed to `source` in addition to a children array.\n * @property {object} ext Hash of all active plugin instances.\n * @property {FancytreeNode} focusNode Currently focused node or null.\n * @property {FancytreeNode} lastSelectedNode Used to implement selectMode 1 (single select)\n * @property {string} nodeContainerAttrName Property name of FancytreeNode that contains the outer element of single nodes.\n *     Typically \"li\", but \"tr\" for table extension.\n * @property {FancytreeOptions} options Current options, i.e. default options + options passed to constructor.\n * @property {FancytreeNode} rootNode Invisible system root node.\n * @property {string} statusClassPropName Property name of FancytreeNode that contains the element which will receive the status classes.\n *     Typically \"span\", but \"tr\" for table extension.\n * @property {object} widget Base widget instance.\n */\nfunction Fancytree(widget) {\n\tthis.widget = widget;\n\tthis.$div = widget.element;\n\tthis.options = widget.options;\n\tif( this.options ) {\n\t\tif(  $.isFunction(this.options.lazyload ) && !$.isFunction(this.options.lazyLoad) ) {\n\t\t\tthis.options.lazyLoad = function() {\n\t\t\t\tFT.warn(\"The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead.\");\n\t\t\t\treturn widget.options.lazyload.apply(this, arguments);\n\t\t\t};\n\t\t}\n\t\tif( $.isFunction(this.options.loaderror) ) {\n\t\t\t$.error(\"The 'loaderror' event was renamed since 2014-07-03. Use 'loadError' (with uppercase E) instead.\");\n\t\t}\n\t\tif( this.options.fx !== undefined ) {\n\t\t\tFT.warn(\"The 'fx' options was replaced by 'toggleEffect' since 2014-11-30.\");\n\t\t}\n\t}\n\tthis.ext = {}; // Active extension instances\n\t// allow to init tree.data.foo from <div data-foo=''>\n\tthis.data = _getElementDataAsDict(this.$div);\n\t// TODO: use widget.uuid instead?\n\tthis._id = $.ui.fancytree._nextId++;\n\t// TODO: use widget.eventNamespace instead?\n\tthis._ns = \".fancytree-\" + this._id; // append for namespaced events\n\tthis.activeNode = null;\n\tthis.focusNode = null;\n\tthis._hasFocus = null;\n\tthis.lastSelectedNode = null;\n\tthis.systemFocusElement = null;\n\tthis.lastQuicksearchTerm = \"\";\n\tthis.lastQuicksearchTime = 0;\n\n\tthis.statusClassPropName = \"span\";\n\tthis.ariaPropName = \"li\";\n\tthis.nodeContainerAttrName = \"li\";\n\n\t// Remove previous markup if any\n\tthis.$div.find(\">ul.fancytree-container\").remove();\n\n\t// Create a node without parent.\n\tvar fakeParent = { tree: this },\n\t\t$ul;\n\tthis.rootNode = new FancytreeNode(fakeParent, {\n\t\ttitle: \"root\",\n\t\tkey: \"root_\" + this._id,\n\t\tchildren: null,\n\t\texpanded: true\n\t});\n\tthis.rootNode.parent = null;\n\n\t// Create root markup\n\t$ul = $(\"<ul>\", {\n\t\t\"class\": \"ui-fancytree fancytree-container fancytree-plain\"\n\t}).appendTo(this.$div);\n\tthis.$container = $ul;\n\tthis.rootNode.ul = $ul[0];\n\n\tif(this.options.debugLevel == null){\n\t\tthis.options.debugLevel = FT.debugLevel;\n\t}\n\t// Add container to the TAB chain\n\t// See http://www.w3.org/TR/wai-aria-practices/#focus_activedescendant\n\t// #577: Allow to set tabindex to \"0\", \"-1\" and \"\"\n\tthis.$container.attr(\"tabindex\", this.options.tabindex);\n\t// this.$container.attr(\"tabindex\", this.options.tabbable ? \"0\" : \"-1\");\n\tif(this.options.aria){\n\t\tthis.$container\n\t\t\t.attr(\"role\", \"tree\")\n\t\t\t.attr(\"aria-multiselectable\", true);\n\t}\n}\n\n\nFancytree.prototype = /** @lends Fancytree# */{\n\t/* Return a context object that can be re-used for _callHook().\n\t * @param {Fancytree | FancytreeNode | EventData} obj\n\t * @param {Event} originalEvent\n\t * @param {Object} extra\n\t * @returns {EventData}\n\t */\n\t_makeHookContext: function(obj, originalEvent, extra) {\n\t\tvar ctx, tree;\n\t\tif(obj.node !== undefined){\n\t\t\t// obj is already a context object\n\t\t\tif(originalEvent && obj.originalEvent !== originalEvent){\n\t\t\t\t$.error(\"invalid args\");\n\t\t\t}\n\t\t\tctx = obj;\n\t\t}else if(obj.tree){\n\t\t\t// obj is a FancytreeNode\n\t\t\ttree = obj.tree;\n\t\t\tctx = { node: obj, tree: tree, widget: tree.widget, options: tree.widget.options, originalEvent: originalEvent };\n\t\t}else if(obj.widget){\n\t\t\t// obj is a Fancytree\n\t\t\tctx = { node: null, tree: obj, widget: obj.widget, options: obj.widget.options, originalEvent: originalEvent };\n\t\t}else{\n\t\t\t$.error(\"invalid args\");\n\t\t}\n\t\tif(extra){\n\t\t\t$.extend(ctx, extra);\n\t\t}\n\t\treturn ctx;\n\t},\n\t/* Trigger a hook function: funcName(ctx, [...]).\n\t *\n\t * @param {string} funcName\n\t * @param {Fancytree|FancytreeNode|EventData} contextObject\n\t * @param {any}  [_extraArgs] optional additional arguments\n\t * @returns {any}\n\t */\n\t_callHook: function(funcName, contextObject, _extraArgs) {\n\t\tvar ctx = this._makeHookContext(contextObject),\n\t\t\tfn = this[funcName],\n\t\t\targs = Array.prototype.slice.call(arguments, 2);\n\t\tif(!$.isFunction(fn)){\n\t\t\t$.error(\"_callHook('\" + funcName + \"') is not a function\");\n\t\t}\n\t\targs.unshift(ctx);\n//\t\tthis.debug(\"_hook\", funcName, ctx.node && ctx.node.toString() || ctx.tree.toString(), args);\n\t\treturn fn.apply(this, args);\n\t},\n\t/* Check if current extensions dependencies are met and throw an error if not.\n\t *\n\t * This method may be called inside the `treeInit` hook for custom extensions.\n\t *\n\t * @param {string} extension name of the required extension\n\t * @param {boolean} [required=true] pass `false` if the extension is optional, but we want to check for order if it is present\n\t * @param {boolean} [before] `true` if `name` must be included before this, `false` otherwise (use `null` if order doesn't matter)\n\t * @param {string} [message] optional error message (defaults to a descriptve error message)\n\t */\n\t_requireExtension: function(name, required, before, message) {\n\t\tbefore = !!before;\n\t\tvar thisName = this._local.name,\n\t\t\textList = this.options.extensions,\n\t\t\tisBefore = $.inArray(name, extList) < $.inArray(thisName, extList),\n\t\t\tisMissing = required && this.ext[name] == null,\n\t\t\tbadOrder = !isMissing && before != null && (before !== isBefore);\n\n\t\t_assert(thisName && thisName !== name, \"invalid or same name\");\n\n\t\tif( isMissing || badOrder ){\n\t\t\tif( !message ){\n\t\t\t\tif( isMissing || required ){\n\t\t\t\t\tmessage = \"'\" + thisName + \"' extension requires '\" + name + \"'\";\n\t\t\t\t\tif( badOrder ){\n\t\t\t\t\t\tmessage += \" to be registered \" + (before ? \"before\" : \"after\") + \" itself\";\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\tmessage = \"If used together, `\" + name + \"` must be registered \" + (before ? \"before\" : \"after\") + \" `\" + thisName + \"`\";\n\t\t\t\t}\n\t\t\t}\n\t\t\t$.error(message);\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\t/** Activate node with a given key and fire focus and activate events.\n\t *\n\t * A prevously activated node will be deactivated.\n\t * If activeVisible option is set, all parents will be expanded as necessary.\n\t * Pass key = false, to deactivate the current node only.\n\t * @param {string} key\n\t * @returns {FancytreeNode} activated node (null, if not found)\n\t */\n\tactivateKey: function(key) {\n\t\tvar node = this.getNodeByKey(key);\n\t\tif(node){\n\t\t\tnode.setActive();\n\t\t}else if(this.activeNode){\n\t\t\tthis.activeNode.setActive(false);\n\t\t}\n\t\treturn node;\n\t},\n\t/** (experimental) Add child status nodes that indicate 'More...', ....\n\t * @param {boolean|object} node optional node definition. Pass `false` to remove all paging nodes.\n\t * @param {string} [mode='append'] 'child'|firstChild'\n\t * @since 2.15\n\t */\n\taddPagingNode: function(node, mode){\n\t\treturn this.rootNode.addPagingNode(node, mode);\n\t},\n\t/** (experimental) Modify existing data model.\n\t *\n\t * @param {Array} patchList array of [key, NodePatch] arrays\n\t * @returns {$.Promise} resolved, when all patches have been applied\n\t * @see TreePatch\n\t */\n\tapplyPatch: function(patchList) {\n\t\tvar dfd, i, p2, key, patch, node,\n\t\t\tpatchCount = patchList.length,\n\t\t\tdeferredList = [];\n\n\t\tfor(i=0; i<patchCount; i++){\n\t\t\tp2 = patchList[i];\n\t\t\t_assert(p2.length === 2, \"patchList must be an array of length-2-arrays\");\n\t\t\tkey = p2[0];\n\t\t\tpatch = p2[1];\n\t\t\tnode = (key === null) ? this.rootNode : this.getNodeByKey(key);\n\t\t\tif(node){\n\t\t\t\tdfd = new $.Deferred();\n\t\t\t\tdeferredList.push(dfd);\n\t\t\t\tnode.applyPatch(patch).always(_makeResolveFunc(dfd, node));\n\t\t\t}else{\n\t\t\t\tthis.warn(\"could not find node with key '\" + key + \"'\");\n\t\t\t}\n\t\t}\n\t\t// Return a promise that is resolved, when ALL patches were applied\n\t\treturn $.when.apply($, deferredList).promise();\n\t},\n\t/* TODO: implement in dnd extension\n\tcancelDrag: function() {\n\t\tvar dd = $.ui.ddmanager.current;\n\t\tif(dd){\n\t\t\tdd.cancel();\n\t\t}\n\t},\n   */\n\t/** Remove all nodes.\n\t * @since 2.14\n\t */\n\tclear: function(source) {\n\t\tthis._callHook(\"treeClear\", this);\n\t},\n   /** Return the number of nodes.\n\t* @returns {integer}\n\t*/\n\tcount: function() {\n\t\treturn this.rootNode.countChildren();\n\t},\n\t/** Write to browser console if debugLevel >= 2 (prepending tree name)\n\t *\n\t * @param {*} msg string or object or array of such\n\t */\n\tdebug: function(msg){\n\t\tif( this.options.debugLevel >= 2 ) {\n\t\t\tArray.prototype.unshift.call(arguments, this.toString());\n\t\t\tconsoleApply(\"log\", arguments);\n\t\t}\n\t},\n\t// TODO: disable()\n\t// TODO: enable()\n\t// TODO: enableUpdate()\n\n\t/**Find all nodes that matches condition.\n\t *\n\t * @param {string | function(node)} match title string to search for, or a\n\t *     callback function that returns `true` if a node is matched.\n\t * @returns {FancytreeNode[]} array of nodes (may be empty)\n\t * @see FancytreeNode#findAll\n\t * @since 2.12\n\t */\n\tfindAll: function(match) {\n\t\treturn this.rootNode.findAll(match);\n\t},\n\t/**Find first node that matches condition.\n\t *\n\t * @param {string | function(node)} match title string to search for, or a\n\t *     callback function that returns `true` if a node is matched.\n\t * @returns {FancytreeNode} matching node or null\n\t * @see FancytreeNode#findFirst\n\t * @since 2.12\n\t */\n\tfindFirst: function(match) {\n\t\treturn this.rootNode.findFirst(match);\n\t},\n\t/** Find the next visible node that starts with `match`, starting at `startNode`\n\t * and wrap-around at the end.\n\t *\n\t * @param {string|function} match\n\t * @param {FancytreeNode} [startNode] defaults to first node\n\t * @returns {FancytreeNode} matching node or null\n\t */\n\tfindNextNode: function(match, startNode, visibleOnly) {\n\t\tvar stopNode = null,\n\t\t\tparentChildren = startNode.parent.children,\n\t\t\tmatchingNode = null,\n\t\t\twalkVisible = function(parent, idx, fn) {\n\t\t\t\tvar i, grandParent,\n\t\t\t\t\tparentChildren = parent.children,\n\t\t\t\t\tsiblingCount = parentChildren.length,\n\t\t\t\t\tnode = parentChildren[idx];\n\t\t\t\t// visit node itself\n\t\t\t\tif( node && fn(node) === false ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t// visit descendants\n\t\t\t\tif( node && node.children && node.expanded ) {\n\t\t\t\t\tif( walkVisible(node, 0, fn) === false ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// visit subsequent siblings\n\t\t\t\tfor( i = idx + 1; i < siblingCount; i++ ) {\n\t\t\t\t\tif( walkVisible(parent, i, fn) === false ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// visit parent's subsequent siblings\n\t\t\t\tgrandParent = parent.parent;\n\t\t\t\tif( grandParent ) {\n\t\t\t\t\treturn walkVisible(grandParent, grandParent.children.indexOf(parent) + 1, fn);\n\t\t\t\t} else {\n\t\t\t\t\t// wrap-around: restart with first node\n\t\t\t\t\treturn walkVisible(parent, 0, fn);\n\t\t\t\t}\n\t\t\t};\n\n\t\tmatch = (typeof match === \"string\") ? _makeNodeTitleStartMatcher(match) : match;\n\t\tstartNode = startNode || this.getFirstChild();\n\n\t\twalkVisible(startNode.parent, parentChildren.indexOf(startNode), function(node){\n\t\t\t// Stop iteration if we see the start node a second time\n\t\t\tif( node === stopNode ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tstopNode = stopNode || node;\n\t\t\t// Ignore nodes hidden by a filter\n\t\t\tif( ! $(node.span).is(\":visible\") ) {\n\t\t\t\tnode.debug(\"quicksearch: skipping hidden node\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Test if we found a match, but search for a second match if this\n\t\t\t// was the currently active node\n\t\t\tif( match(node) ) {\n\t\t\t\t// node.debug(\"quicksearch match \" + node.title, startNode);\n\t\t\t\tmatchingNode = node;\n\t\t\t\tif( matchingNode !== startNode ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn matchingNode;\n\t},\n\t// TODO: fromDict\n\t/**\n\t * Generate INPUT elements that can be submitted with html forms.\n\t *\n\t * In selectMode 3 only the topmost selected nodes are considered, unless\n\t * `opts.stopOnParents: false` is passed.\n\t *\n\t * @param {boolean | string} [selected=true] Pass false to disable, pass a string to overide the field name (default: 'ft_ID[]')\n\t * @param {boolean | string} [active=true] Pass false to disable, pass a string to overide the field name (default: 'ft_ID_active')\n\t * @param {object} [opts] default { stopOnParents: true }\n\t */\n\tgenerateFormElements: function(selected, active, opts) {\n\t\t// TODO: test case\n\t\topts = opts || {};\n\n\t\tvar nodeList,\n\t\t\tselectedName = (typeof selected === \"string\") ? selected : \"ft_\" + this._id + \"[]\",\n\t\t\tactiveName = (typeof active === \"string\") ? active : \"ft_\" + this._id + \"_active\",\n\t\t\tid = \"fancytree_result_\" + this._id,\n\t\t\t$result = $(\"#\" + id),\n\t\t\tstopOnParents = this.options.selectMode === 3 && opts.stopOnParents !== false;\n\n\t\tif($result.length){\n\t\t\t$result.empty();\n\t\t}else{\n\t\t\t$result = $(\"<div>\", {\n\t\t\t\tid: id\n\t\t\t}).hide().insertAfter(this.$container);\n\t\t}\n\t\tif(selected !== false){\n\t\t\tnodeList = this.getSelectedNodes(stopOnParents);\n\t\t\t$.each(nodeList, function(idx, node){\n\t\t\t\t$result.append($(\"<input>\", {\n\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\tname: selectedName,\n\t\t\t\t\tvalue: node.key,\n\t\t\t\t\tchecked: true\n\t\t\t\t}));\n\t\t\t});\n\t\t}\n\t\tif(active !== false && this.activeNode){\n\t\t\t$result.append($(\"<input>\", {\n\t\t\t\ttype: \"radio\",\n\t\t\t\tname: activeName,\n\t\t\t\tvalue: this.activeNode.key,\n\t\t\t\tchecked: true\n\t\t\t}));\n\t\t}\n\t},\n\t/**\n\t * Return the currently active node or null.\n\t * @returns {FancytreeNode}\n\t */\n\tgetActiveNode: function() {\n\t\treturn this.activeNode;\n\t},\n\t/** Return the first top level node if any (not the invisible root node).\n\t * @returns {FancytreeNode | null}\n\t */\n\tgetFirstChild: function() {\n\t\treturn this.rootNode.getFirstChild();\n\t},\n\t/**\n\t * Return node that has keyboard focus or null.\n\t * @returns {FancytreeNode}\n\t */\n\tgetFocusNode: function() {\n\t\treturn this.focusNode;\n\t},\n\t/**\n\t * Return node with a given key or null if not found.\n\t * @param {string} key\n\t * @param {FancytreeNode} [searchRoot] only search below this node\n\t * @returns {FancytreeNode | null}\n\t */\n\tgetNodeByKey: function(key, searchRoot) {\n\t\t// Search the DOM by element ID (assuming this is faster than traversing all nodes).\n\t\t// $(\"#...\") has problems, if the key contains '.', so we use getElementById()\n\t\tvar el, match;\n\t\tif(!searchRoot){\n\t\t\tel = document.getElementById(this.options.idPrefix + key);\n\t\t\tif( el ){\n\t\t\t\treturn el.ftnode ? el.ftnode : null;\n\t\t\t}\n\t\t}\n\t\t// Not found in the DOM, but still may be in an unrendered part of tree\n\t\t// TODO: optimize with specialized loop\n\t\t// TODO: consider keyMap?\n\t\tsearchRoot = searchRoot || this.rootNode;\n\t\tmatch = null;\n\t\tsearchRoot.visit(function(node){\n//            window.console.log(\"getNodeByKey(\" + key + \"): \", node.key);\n\t\t\tif(node.key === key) {\n\t\t\t\tmatch = node;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}, true);\n\t\treturn match;\n\t},\n\t/** Return the invisible system root node.\n\t * @returns {FancytreeNode}\n\t */\n\tgetRootNode: function() {\n\t\treturn this.rootNode;\n\t},\n\t/**\n\t * Return an array of selected nodes.\n\t * @param {boolean} [stopOnParents=false] only return the topmost selected\n\t *     node (useful with selectMode 3)\n\t * @returns {FancytreeNode[]}\n\t */\n\tgetSelectedNodes: function(stopOnParents) {\n\t\treturn this.rootNode.getSelectedNodes(stopOnParents);\n\t},\n\t/** Return true if the tree control has keyboard focus\n\t * @returns {boolean}\n\t */\n\thasFocus: function(){\n\t\treturn !!this._hasFocus;\n\t},\n\t/** Write to browser console if debugLevel >= 1 (prepending tree name)\n\t * @param {*} msg string or object or array of such\n\t */\n\tinfo: function(msg){\n\t\tif( this.options.debugLevel >= 1 ) {\n\t\t\tArray.prototype.unshift.call(arguments, this.toString());\n\t\t\tconsoleApply(\"info\", arguments);\n\t\t}\n\t},\n/*\n\tTODO: isInitializing: function() {\n\t\treturn ( this.phase==\"init\" || this.phase==\"postInit\" );\n\t},\n\tTODO: isReloading: function() {\n\t\treturn ( this.phase==\"init\" || this.phase==\"postInit\" ) && this.options.persist && this.persistence.cookiesFound;\n\t},\n\tTODO: isUserEvent: function() {\n\t\treturn ( this.phase==\"userEvent\" );\n\t},\n*/\n\n\t/**\n\t * Make sure that a node with a given ID is loaded, by traversing - and\n\t * loading - its parents. This method is ment for lazy hierarchies.\n\t * A callback is executed for every node as we go.\n\t * @example\n\t * tree.loadKeyPath(\"/_3/_23/_26/_27\", function(node, status){\n\t *   if(status === \"loaded\") {\n\t *     console.log(\"loaded intermiediate node \" + node);\n\t *   }else if(status === \"ok\") {\n\t *     node.activate();\n\t *   }\n\t * });\n\t *\n\t * @param {string | string[]} keyPathList one or more key paths (e.g. '/3/2_1/7')\n\t * @param {function} callback callback(node, status) is called for every visited node ('loading', 'loaded', 'ok', 'error')\n\t * @returns {$.Promise}\n\t */\n\tloadKeyPath: function(keyPathList, callback, _rootNode) {\n\t\tvar deferredList, dfd, i, path, key, loadMap, node, root, segList,\n\t\t\tsep = this.options.keyPathSeparator,\n\t\t\tself = this;\n\n\t\tcallback = callback || $.noop;\n\t\tif(!$.isArray(keyPathList)){\n\t\t\tkeyPathList = [keyPathList];\n\t\t}\n\t\t// Pass 1: handle all path segments for nodes that are already loaded\n\t\t// Collect distinct top-most lazy nodes in a map\n\t\tloadMap = {};\n\n\t\tfor(i=0; i<keyPathList.length; i++){\n\t\t\troot = _rootNode || this.rootNode;\n\t\t\tpath = keyPathList[i];\n\t\t\t// strip leading slash\n\t\t\tif(path.charAt(0) === sep){\n\t\t\t\tpath = path.substr(1);\n\t\t\t}\n\t\t\t// traverse and strip keys, until we hit a lazy, unloaded node\n\t\t\tsegList = path.split(sep);\n\t\t\twhile(segList.length){\n\t\t\t\tkey = segList.shift();\n//                node = _findDirectChild(root, key);\n\t\t\t\tnode = root._findDirectChild(key);\n\t\t\t\tif(!node){\n\t\t\t\t\tthis.warn(\"loadKeyPath: key not found: \" + key + \" (parent: \" + root + \")\");\n\t\t\t\t\tcallback.call(this, key, \"error\");\n\t\t\t\t\tbreak;\n\t\t\t\t}else if(segList.length === 0){\n\t\t\t\t\tcallback.call(this, node, \"ok\");\n\t\t\t\t\tbreak;\n\t\t\t\t}else if(!node.lazy || (node.hasChildren() !== undefined )){\n\t\t\t\t\tcallback.call(this, node, \"loaded\");\n\t\t\t\t\troot = node;\n\t\t\t\t}else{\n\t\t\t\t\tcallback.call(this, node, \"loaded\");\n//                    segList.unshift(key);\n\t\t\t\t\tif(loadMap[key]){\n\t\t\t\t\t\tloadMap[key].push(segList.join(sep));\n\t\t\t\t\t}else{\n\t\t\t\t\t\tloadMap[key] = [segList.join(sep)];\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n//        alert(\"loadKeyPath: loadMap=\" + JSON.stringify(loadMap));\n\t\t// Now load all lazy nodes and continue itearation for remaining paths\n\t\tdeferredList = [];\n\t\t// Avoid jshint warning 'Don't make functions within a loop.':\n\t\tfunction __lazyload(key, node, dfd){\n\t\t\tcallback.call(self, node, \"loading\");\n\t\t\tnode.load().done(function(){\n\t\t\t\tself.loadKeyPath.call(self, loadMap[key], callback, node).always(_makeResolveFunc(dfd, self));\n\t\t\t}).fail(function(errMsg){\n\t\t\t\tself.warn(\"loadKeyPath: error loading: \" + key + \" (parent: \" + root + \")\");\n\t\t\t\tcallback.call(self, node, \"error\");\n\t\t\t\tdfd.reject();\n\t\t\t});\n\t\t}\n\t\tfor(key in loadMap){\n\t\t\tnode = root._findDirectChild(key);\n//            alert(\"loadKeyPath: lazy node(\" + key + \") = \" + node);\n\t\t\tdfd = new $.Deferred();\n\t\t\tdeferredList.push(dfd);\n\t\t\t__lazyload(key, node, dfd);\n\t\t}\n\t\t// Return a promise that is resolved, when ALL paths were loaded\n\t\treturn $.when.apply($, deferredList).promise();\n\t},\n\t/** Re-fire beforeActivate, activate, and (optional) focus events.\n\t * Calling this method in the `init` event, will activate the node that\n\t * was marked 'active' in the source data, and optionally set the keyboard\n\t * focus.\n\t * @param [setFocus=false]\n\t */\n\treactivate: function(setFocus) {\n\t\tvar res,\n\t\t\tnode = this.activeNode;\n\n\t\tif( !node ) {\n\t\t\treturn _getResolvedPromise();\n\t\t}\n\t\tthis.activeNode = null; // Force re-activating\n\t\tres = node.setActive(true, {noFocus: true});\n\t\tif( setFocus ){\n\t\t\tnode.setFocus();\n\t\t}\n\t\treturn res;\n\t},\n\t/** Reload tree from source and return a promise.\n\t * @param [source] optional new source (defaults to initial source data)\n\t * @returns {$.Promise}\n\t */\n\treload: function(source) {\n\t\tthis._callHook(\"treeClear\", this);\n\t\treturn this._callHook(\"treeLoad\", this, source);\n\t},\n\t/**Render tree (i.e. create DOM elements for all top-level nodes).\n\t * @param {boolean} [force=false] create DOM elemnts, even if parent is collapsed\n\t * @param {boolean} [deep=false]\n\t */\n\trender: function(force, deep) {\n\t\treturn this.rootNode.render(force, deep);\n\t},\n\t// TODO: selectKey: function(key, select)\n\t// TODO: serializeArray: function(stopOnParents)\n\t/**\n\t * @param {boolean} [flag=true]\n\t */\n\tsetFocus: function(flag) {\n\t\treturn this._callHook(\"treeSetFocus\", this, flag);\n\t},\n\t/**\n\t * Return all nodes as nested list of {@link NodeData}.\n\t *\n\t * @param {boolean} [includeRoot=false] Returns the hidden system root node (and its children)\n\t * @param {function} [callback] callback(dict, node) is called for every node, in order to allow modifications\n\t * @returns {Array | object}\n\t * @see FancytreeNode#toDict\n\t */\n\ttoDict: function(includeRoot, callback){\n\t\tvar res = this.rootNode.toDict(true, callback);\n\t\treturn includeRoot ? res : res.children;\n\t},\n\t/* Implicitly called for string conversions.\n\t * @returns {string}\n\t */\n\ttoString: function(){\n\t\treturn \"<Fancytree(#\" + this._id + \")>\";\n\t},\n\t/* _trigger a widget event with additional node ctx.\n\t * @see EventData\n\t */\n\t_triggerNodeEvent: function(type, node, originalEvent, extra) {\n//\t\tthis.debug(\"_trigger(\" + type + \"): '\" + ctx.node.title + \"'\", ctx);\n\t\tvar ctx = this._makeHookContext(node, originalEvent, extra),\n\t\t\tres = this.widget._trigger(type, originalEvent, ctx);\n\t\tif(res !== false && ctx.result !== undefined){\n\t\t\treturn ctx.result;\n\t\t}\n\t\treturn res;\n\t},\n\t/* _trigger a widget event with additional tree data. */\n\t_triggerTreeEvent: function(type, originalEvent, extra) {\n//\t\tthis.debug(\"_trigger(\" + type + \")\", ctx);\n\t\tvar ctx = this._makeHookContext(this, originalEvent, extra),\n\t\t\tres = this.widget._trigger(type, originalEvent, ctx);\n\n\t\tif(res !== false && ctx.result !== undefined){\n\t\t\treturn ctx.result;\n\t\t}\n\t\treturn res;\n\t},\n\t/** Call fn(node) for all nodes.\n\t *\n\t * @param {function} fn the callback function.\n\t *     Return false to stop iteration, return \"skip\" to skip this node and children only.\n\t * @returns {boolean} false, if the iterator was stopped.\n\t */\n\tvisit: function(fn) {\n\t\treturn this.rootNode.visit(fn, false);\n\t},\n\t/** Write warning to browser console (prepending tree info)\n\t *\n\t * @param {*} msg string or object or array of such\n\t */\n\twarn: function(msg){\n\t\tArray.prototype.unshift.call(arguments, this.toString());\n\t\tconsoleApply(\"warn\", arguments);\n\t}\n};\n\n/**\n * These additional methods of the {@link Fancytree} class are 'hook functions'\n * that can be used and overloaded by extensions.\n * (See <a href=\"https://github.com/mar10/fancytree/wiki/TutorialExtensions\">writing extensions</a>.)\n * @mixin Fancytree_Hooks\n */\n$.extend(Fancytree.prototype,\n\t/** @lends Fancytree_Hooks# */\n\t{\n\t/** Default handling for mouse click events.\n\t *\n\t * @param {EventData} ctx\n\t */\n\tnodeClick: function(ctx) {\n\t\tvar activate, expand,\n\t\t\t// event = ctx.originalEvent,\n\t\t\ttargetType = ctx.targetType,\n\t\t\tnode = ctx.node;\n\n//\t    this.debug(\"ftnode.onClick(\" + event.type + \"): ftnode:\" + this + \", button:\" + event.button + \", which: \" + event.which, ctx);\n\t\t// TODO: use switch\n\t\t// TODO: make sure clicks on embedded <input> doesn't steal focus (see table sample)\n\t\tif( targetType === \"expander\" ) {\n\t\t\tif( node.isLoading() ) {\n\t\t\t\t// #495: we probably got a click event while a lazy load is pending.\n\t\t\t\t// The 'expanded' state is not yet set, so 'toggle' would expand\n\t\t\t\t// and trigger lazyLoad again.\n\t\t\t\t// It would be better to allow to collapse/expand the status node\n\t\t\t\t// while loading (instead of ignoring), but that would require some\n\t\t\t\t// more work.\n\t\t\t\tnode.debug(\"Got 2nd click while loading: ignored\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Clicking the expander icon always expands/collapses\n\t\t\tthis._callHook(\"nodeToggleExpanded\", ctx);\n\n\t\t} else if( targetType === \"checkbox\" ) {\n\t\t\t// Clicking the checkbox always (de)selects\n\t\t\tthis._callHook(\"nodeToggleSelected\", ctx);\n\t\t\tif( ctx.options.focusOnSelect ) { // #358\n\t\t\t\tthis._callHook(\"nodeSetFocus\", ctx, true);\n\t\t\t}\n\n\t\t} else {\n\t\t\t// Honor `clickFolderMode` for\n\t\t\texpand = false;\n\t\t\tactivate = true;\n\t\t\tif( node.folder ) {\n\t\t\t\tswitch( ctx.options.clickFolderMode ) {\n\t\t\t\tcase 2: // expand only\n\t\t\t\t\texpand = true;\n\t\t\t\t\tactivate = false;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3: // expand and activate\n\t\t\t\t\tactivate = true;\n\t\t\t\t\texpand = true; //!node.isExpanded();\n\t\t\t\t\tbreak;\n\t\t\t\t// else 1 or 4: just activate\n\t\t\t\t}\n\t\t\t}\n\t\t\tif( activate ) {\n\t\t\t\tthis.nodeSetFocus(ctx);\n\t\t\t\tthis._callHook(\"nodeSetActive\", ctx, true);\n\t\t\t}\n\t\t\tif( expand ) {\n\t\t\t\tif(!activate){\n//                    this._callHook(\"nodeSetFocus\", ctx);\n\t\t\t\t}\n//\t\t\t\tthis._callHook(\"nodeSetExpanded\", ctx, true);\n\t\t\t\tthis._callHook(\"nodeToggleExpanded\", ctx);\n\t\t\t}\n\t\t}\n\t\t// Make sure that clicks stop, otherwise <a href='#'> jumps to the top\n\t\t// if(event.target.localName === \"a\" && event.target.className === \"fancytree-title\"){\n\t\t// \tevent.preventDefault();\n\t\t// }\n\t\t// TODO: return promise?\n\t},\n\t/** Collapse all other  children of same parent.\n\t *\n\t * @param {EventData} ctx\n\t * @param {object} callOpts\n\t */\n\tnodeCollapseSiblings: function(ctx, callOpts) {\n\t\t// TODO: return promise?\n\t\tvar ac, i, l,\n\t\t\tnode = ctx.node;\n\n\t\tif( node.parent ){\n\t\t\tac = node.parent.children;\n\t\t\tfor (i=0, l=ac.length; i<l; i++) {\n\t\t\t\tif ( ac[i] !== node && ac[i].expanded ){\n\t\t\t\t\tthis._callHook(\"nodeSetExpanded\", ac[i], false, callOpts);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t/** Default handling for mouse douleclick events.\n\t * @param {EventData} ctx\n\t */\n\tnodeDblclick: function(ctx) {\n\t\t// TODO: return promise?\n\t\tif( ctx.targetType === \"title\" && ctx.options.clickFolderMode === 4) {\n//\t\t\tthis.nodeSetFocus(ctx);\n//\t\t\tthis._callHook(\"nodeSetActive\", ctx, true);\n\t\t\tthis._callHook(\"nodeToggleExpanded\", ctx);\n\t\t}\n\t\t// TODO: prevent text selection on dblclicks\n\t\tif( ctx.targetType === \"title\" ) {\n\t\t\tctx.originalEvent.preventDefault();\n\t\t}\n\t},\n\t/** Default handling for mouse keydown events.\n\t *\n\t * NOTE: this may be called with node == null if tree (but no node) has focus.\n\t * @param {EventData} ctx\n\t */\n\tnodeKeydown: function(ctx) {\n\t\t// TODO: return promise?\n\t\tvar matchNode, stamp, res, focusNode,\n\t\t\tevent = ctx.originalEvent,\n\t\t\tnode = ctx.node,\n\t\t\ttree = ctx.tree,\n\t\t\topts = ctx.options,\n\t\t\twhich = event.which,\n\t\t\twhichChar = String.fromCharCode(which),\n\t\t\tclean = !(event.altKey || event.ctrlKey || event.metaKey || event.shiftKey),\n\t\t\t$target = $(event.target),\n\t\t\thandled = true,\n\t\t\tactivate = !(event.ctrlKey || !opts.autoActivate );\n\n//\t\t(node || FT).debug(\"ftnode.nodeKeydown(\" + event.type + \"): ftnode:\" + this + \", charCode:\" + event.charCode + \", keyCode: \" + event.keyCode + \", which: \" + event.which);\n//\t\tFT.debug(\"eventToString\", which, '\"' + String.fromCharCode(which) + '\"', '\"' + FT.eventToString(event) + '\"');\n\n\t\t// Set focus to active (or first node) if no other node has the focus yet\n\t\tif( !node ){\n\t\t\tfocusNode = (this.getActiveNode() || this.getFirstChild());\n\t\t\tif (focusNode){\n\t\t\t\tfocusNode.setFocus();\n\t\t\t\tnode = ctx.node = this.focusNode;\n\t\t\t\tnode.debug(\"Keydown force focus on active node\");\n\t\t\t}\n\t\t}\n\n\t\tif( opts.quicksearch && clean && /\\w/.test(whichChar) && !$target.is(\":input:enabled\") ) {\n\t\t\t// Allow to search for longer streaks if typed in quickly\n\t\t\tstamp = new Date().getTime();\n\t\t\tif( stamp - tree.lastQuicksearchTime > 500 ) {\n\t\t\t\ttree.lastQuicksearchTerm = \"\";\n\t\t\t}\n\t\t\ttree.lastQuicksearchTime = stamp;\n\t\t\ttree.lastQuicksearchTerm += whichChar;\n\t\t\t// tree.debug(\"quicksearch find\", tree.lastQuicksearchTerm);\n\t\t\tmatchNode = tree.findNextNode(tree.lastQuicksearchTerm, tree.getActiveNode());\n\t\t\tif( matchNode ) {\n\t\t\t\tmatchNode.setActive();\n\t\t\t}\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\t\tswitch( FT.eventToString(event) ) {\n\t\t\tcase \"+\":\n\t\t\tcase \"=\": // 187: '+' @ Chrome, Safari\n\t\t\t\ttree.nodeSetExpanded(ctx, true);\n\t\t\t\tbreak;\n\t\t\tcase \"-\":\n\t\t\t\ttree.nodeSetExpanded(ctx, false);\n\t\t\t\tbreak;\n\t\t\tcase \"space\":\n\t\t\t\tif( node.isPagingNode() ) {\n\t\t\t\t\ttree._triggerNodeEvent(\"clickPaging\", ctx, event);\n\t\t\t\t} else if(opts.checkbox){\n\t\t\t\t\ttree.nodeToggleSelected(ctx);\n\t\t\t\t}else{\n\t\t\t\t\ttree.nodeSetActive(ctx, true);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"return\":\n\t\t\t\ttree.nodeSetActive(ctx, true);\n\t\t\t\tbreak;\n\t\t\tcase \"backspace\":\n\t\t\tcase \"left\":\n\t\t\tcase \"right\":\n\t\t\tcase \"up\":\n\t\t\tcase \"down\":\n\t\t\t\tres = node.navigate(event.which, activate);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\thandled = false;\n\t\t}\n\t\tif(handled){\n\t\t\tevent.preventDefault();\n\t\t}\n\t},\n\n\n\t// /** Default handling for mouse keypress events. */\n\t// nodeKeypress: function(ctx) {\n\t//     var event = ctx.originalEvent;\n\t// },\n\n\t// /** Trigger lazyLoad event (async). */\n\t// nodeLazyLoad: function(ctx) {\n\t//     var node = ctx.node;\n\t//     if(this._triggerNodeEvent())\n\t// },\n\t/** Load child nodes (async).\n\t *\n\t * @param {EventData} ctx\n\t * @param {object[]|object|string|$.Promise|function} source\n\t * @returns {$.Promise} The deferred will be resolved as soon as the (ajax)\n\t *     data was rendered.\n\t */\n\tnodeLoadChildren: function(ctx, source) {\n\t\tvar ajax, delay, dfd,\n\t\t\ttree = ctx.tree,\n\t\t\tnode = ctx.node,\n\t\t\trequestId = new Date().getTime();\n\n\t\tif($.isFunction(source)){\n\t\t\tsource = source.call(tree, {type: \"source\"}, ctx);\n\t\t\t_assert(!$.isFunction(source), \"source callback must not return another function\");\n\t\t}\n\t\tif(source.url){\n\t\t\tif( node._requestId ) {\n\t\t\t\tnode.warn(\"Recursive load request #\" + requestId + \" while #\" + node._requestId + \" is pending.\");\n\t\t\t// } else {\n\t\t\t// \tnode.debug(\"Send load request #\" + requestId);\n\t\t\t}\n\t\t\t// `source` is an Ajax options object\n\t\t\tajax = $.extend({}, ctx.options.ajax, source);\n\t\t\tnode._requestId = requestId;\n\t\t\tif(ajax.debugDelay){\n\t\t\t\t// simulate a slow server\n\t\t\t\tdelay = ajax.debugDelay;\n\t\t\t\tif($.isArray(delay)){ // random delay range [min..max]\n\t\t\t\t\tdelay = delay[0] + Math.random() * (delay[1] - delay[0]);\n\t\t\t\t}\n\t\t\t\tnode.warn(\"nodeLoadChildren waiting debugDelay \" + Math.round(delay) + \" ms ...\");\n\t\t\t\tajax.debugDelay = false;\n\t\t\t\tdfd = $.Deferred(function (dfd) {\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t$.ajax(ajax)\n\t\t\t\t\t\t\t.done(function () {\tdfd.resolveWith(this, arguments); })\n\t\t\t\t\t\t\t.fail(function () {\tdfd.rejectWith(this, arguments); });\n\t\t\t\t\t}, delay);\n\t\t\t\t});\n\t\t\t}else{\n\t\t\t\tdfd = $.ajax(ajax);\n\t\t\t}\n\n\t\t\t// Defer the deferred: we want to be able to reject, even if ajax\n\t\t\t// resolved ok.\n\t\t\tsource = new $.Deferred();\n\t\t\tdfd.done(function (data, textStatus, jqXHR) {\n\t\t\t\tvar errorObj, res;\n\n\t\t\t\tif((this.dataType === \"json\" || this.dataType === \"jsonp\") && typeof data === \"string\"){\n\t\t\t\t\t$.error(\"Ajax request returned a string (did you get the JSON dataType wrong?).\");\n\t\t\t\t}\n\t\t\t\tif( node._requestId && node._requestId > requestId ) {\n\t\t\t\t\t// The expected request time stamp is later than `requestId`\n\t\t\t\t\t// (which was kept as as closure variable to this handler function)\n\t\t\t\t\t// node.warn(\"Ignored load response for obsolete request #\" + requestId + \" (expected #\" + node._requestId + \")\");\n\t\t\t\t\tsource.rejectWith(this, [RECURSIVE_REQUEST_ERROR]);\n\t\t\t\t\treturn;\n\t\t\t\t// } else {\n\t\t\t\t// \tnode.debug(\"Response returned for load request #\" + requestId);\n\t\t\t\t}\n\t\t\t\t// postProcess is similar to the standard ajax dataFilter hook,\n\t\t\t\t// but it is also called for JSONP\n\t\t\t\tif( ctx.options.postProcess ){\n\t\t\t\t\ttry {\n\t\t\t\t\t\tres = tree._triggerNodeEvent(\"postProcess\", ctx, ctx.originalEvent, {\n\t\t\t\t\t\t\tresponse: data, error: null, dataType: this.dataType\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tres = { error: e, message: \"\" + e, details: \"postProcess failed\"};\n\t\t\t\t\t}\n\t\t\t\t\tif( res.error ) {\n\t\t\t\t\t\terrorObj = $.isPlainObject(res.error) ? res.error : {message: res.error};\n\t\t\t\t\t\terrorObj = tree._makeHookContext(node, null, errorObj);\n\t\t\t\t\t\tsource.rejectWith(this, [errorObj]);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tdata = $.isArray(res) ? res : data;\n\n\t\t\t\t} else if (data && data.hasOwnProperty(\"d\") && ctx.options.enableAspx ) {\n\t\t\t\t\t// Process ASPX WebMethod JSON object inside \"d\" property\n\t\t\t\t\tdata = (typeof data.d === \"string\") ? $.parseJSON(data.d) : data.d;\n\t\t\t\t}\n\t\t\t\tsource.resolveWith(this, [data]);\n\t\t\t}).fail(function (jqXHR, textStatus, errorThrown) {\n\t\t\t\tvar errorObj = tree._makeHookContext(node, null, {\n\t\t\t\t\terror: jqXHR,\n\t\t\t\t\targs: Array.prototype.slice.call(arguments),\n\t\t\t\t\tmessage: errorThrown,\n\t\t\t\t\tdetails: jqXHR.status + \": \" + errorThrown\n\t\t\t\t});\n\t\t\t\tsource.rejectWith(this, [errorObj]);\n\t\t\t});\n\t\t}\n\t\t// #383: accept and convert ECMAScript 6 Promise\n\t\tif( $.isFunction(source.then) && $.isFunction(source[\"catch\"]) ) {\n\t\t\tdfd = source;\n\t\t\tsource = new $.Deferred();\n\t\t\tdfd.then(function(value){\n\t\t\t\tsource.resolve(value);\n\t\t\t}, function(reason){\n\t\t\t\tsource.reject(reason);\n\t\t\t});\n\t\t}\n\t\tif($.isFunction(source.promise)){\n\t\t\t// `source` is a deferred, i.e. ajax request\n\t\t\t// _assert(!node.isLoading(), \"recursive load\");\n\t\t\ttree.nodeSetStatus(ctx, \"loading\");\n\n\t\t\tsource.done(function (children) {\n\t\t\t\ttree.nodeSetStatus(ctx, \"ok\");\n\t\t\t\tnode._requestId = null;\n\t\t\t}).fail(function(error){\n\t\t\t\tvar ctxErr;\n\n\t\t\t\tif ( error === RECURSIVE_REQUEST_ERROR ) {\n\t\t\t\t\tnode.warn(\"Ignored response for obsolete load request #\" + requestId + \" (expected #\" + node._requestId + \")\");\n\t\t\t\t\treturn;\n\t\t\t\t} else if (error.node && error.error && error.message) {\n\t\t\t\t\t// error is already a context object\n\t\t\t\t\tctxErr = error;\n\t\t\t\t} else {\n\t\t\t\t\tctxErr = tree._makeHookContext(node, null, {\n\t\t\t\t\t\terror: error, // it can be jqXHR or any custom error\n\t\t\t\t\t\targs: Array.prototype.slice.call(arguments),\n\t\t\t\t\t\tmessage: error ? (error.message || error.toString()) : \"\"\n\t\t\t\t\t});\n\t\t\t\t\tif( ctxErr.message === \"[object Object]\" ) {\n\t\t\t\t\t\tctxErr.message = \"\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tnode.warn(\"Load children failed (\" + ctxErr.message + \")\", ctxErr);\n\t\t\t\tif( tree._triggerNodeEvent(\"loadError\", ctxErr, null) !== false ) {\n\t\t\t\t\ttree.nodeSetStatus(ctx, \"error\", ctxErr.message, ctxErr.details);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t// $.when(source) resolves also for non-deferreds\n\t\treturn $.when(source).done(function(children){\n\t\t\tvar metaData;\n\n\t\t\tif( $.isPlainObject(children) ){\n\t\t\t\t// We got {foo: 'abc', children: [...]}\n\t\t\t\t// Copy extra properties to tree.data.foo\n\t\t\t\t_assert(node.isRootNode(), \"source may only be an object for root nodes (expecting an array of child objects otherwise)\");\n\t\t\t\t_assert($.isArray(children.children), \"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')\");\n\t\t\t\tmetaData = children;\n\t\t\t\tchildren = children.children;\n\t\t\t\tdelete metaData.children;\n\t\t\t\t$.extend(tree.data, metaData);\n\t\t\t}\n\t\t\t_assert($.isArray(children), \"expected array of children\");\n\t\t\tnode._setChildren(children);\n\t\t\t// trigger fancytreeloadchildren\n\t\t\ttree._triggerNodeEvent(\"loadChildren\", node);\n\t\t});\n\t},\n\t/** [Not Implemented]  */\n\tnodeLoadKeyPath: function(ctx, keyPathList) {\n\t\t// TODO: implement and improve\n\t\t// http://code.google.com/p/dynatree/issues/detail?id=222\n\t},\n\t/**\n\t * Remove a single direct child of ctx.node.\n\t * @param {EventData} ctx\n\t * @param {FancytreeNode} childNode dircect child of ctx.node\n\t */\n\tnodeRemoveChild: function(ctx, childNode) {\n\t\tvar idx,\n\t\t\tnode = ctx.node,\n\t\t\topts = ctx.options,\n\t\t\tsubCtx = $.extend({}, ctx, {node: childNode}),\n\t\t\tchildren = node.children;\n\n\t\t// FT.debug(\"nodeRemoveChild()\", node.toString(), childNode.toString());\n\n\t\tif( children.length === 1 ) {\n\t\t\t_assert(childNode === children[0], \"invalid single child\");\n\t\t\treturn this.nodeRemoveChildren(ctx);\n\t\t}\n\t\tif( this.activeNode && (childNode === this.activeNode || this.activeNode.isDescendantOf(childNode))){\n\t\t\tthis.activeNode.setActive(false); // TODO: don't fire events\n\t\t}\n\t\tif( this.focusNode && (childNode === this.focusNode || this.focusNode.isDescendantOf(childNode))){\n\t\t\tthis.focusNode = null;\n\t\t}\n\t\t// TODO: persist must take care to clear select and expand cookies\n\t\tthis.nodeRemoveMarkup(subCtx);\n\t\tthis.nodeRemoveChildren(subCtx);\n\t\tidx = $.inArray(childNode, children);\n\t\t_assert(idx >= 0, \"invalid child\");\n\t\t// Unlink to support GC\n\t\tchildNode.visit(function(n){\n\t\t\tn.parent = null;\n\t\t}, true);\n\t\tthis._callHook(\"treeRegisterNode\", this, false, childNode);\n\t\tif ( opts.removeNode ){\n\t\t\topts.removeNode.call(ctx.tree, {type: \"removeNode\"}, subCtx);\n\t\t}\n\t\t// remove from child list\n\t\tchildren.splice(idx, 1);\n\t},\n\t/**Remove HTML markup for all descendents of ctx.node.\n\t * @param {EventData} ctx\n\t */\n\tnodeRemoveChildMarkup: function(ctx) {\n\t\tvar node = ctx.node;\n\n\t\t// FT.debug(\"nodeRemoveChildMarkup()\", node.toString());\n\t\t// TODO: Unlink attr.ftnode to support GC\n\t\tif(node.ul){\n\t\t\tif( node.isRootNode() ) {\n\t\t\t\t$(node.ul).empty();\n\t\t\t} else {\n\t\t\t\t$(node.ul).remove();\n\t\t\t\tnode.ul = null;\n\t\t\t}\n\t\t\tnode.visit(function(n){\n\t\t\t\tn.li = n.ul = null;\n\t\t\t});\n\t\t}\n\t},\n\t/**Remove all descendants of ctx.node.\n\t* @param {EventData} ctx\n\t*/\n\tnodeRemoveChildren: function(ctx) {\n\t\tvar subCtx,\n\t\t\ttree = ctx.tree,\n\t\t\tnode = ctx.node,\n\t\t\tchildren = node.children,\n\t\t\topts = ctx.options;\n\n\t\t// FT.debug(\"nodeRemoveChildren()\", node.toString());\n\t\tif(!children){\n\t\t\treturn;\n\t\t}\n\t\tif( this.activeNode && this.activeNode.isDescendantOf(node)){\n\t\t\tthis.activeNode.setActive(false); // TODO: don't fire events\n\t\t}\n\t\tif( this.focusNode && this.focusNode.isDescendantOf(node)){\n\t\t\tthis.focusNode = null;\n\t\t}\n\t\t// TODO: persist must take care to clear select and expand cookies\n\t\tthis.nodeRemoveChildMarkup(ctx);\n\t\t// Unlink children to support GC\n\t\t// TODO: also delete this.children (not possible using visit())\n\t\tsubCtx = $.extend({}, ctx);\n\t\tnode.visit(function(n){\n\t\t\tn.parent = null;\n\t\t\ttree._callHook(\"treeRegisterNode\", tree, false, n);\n\t\t\tif ( opts.removeNode ){\n\t\t\t\tsubCtx.node = n;\n\t\t\t\topts.removeNode.call(ctx.tree, {type: \"removeNode\"}, subCtx);\n\t\t\t}\n\t\t});\n\t\tif( node.lazy ){\n\t\t\t// 'undefined' would be interpreted as 'not yet loaded' for lazy nodes\n\t\t\tnode.children = [];\n\t\t} else{\n\t\t\tnode.children = null;\n\t\t}\n\t\tif( !node.isRootNode() ) {\n\t\t\tnode.expanded = false;  // #449, #459\n\t\t}\n\t\tthis.nodeRenderStatus(ctx);\n\t},\n\t/**Remove HTML markup for ctx.node and all its descendents.\n\t * @param {EventData} ctx\n\t */\n\tnodeRemoveMarkup: function(ctx) {\n\t\tvar node = ctx.node;\n\t\t// FT.debug(\"nodeRemoveMarkup()\", node.toString());\n\t\t// TODO: Unlink attr.ftnode to support GC\n\t\tif(node.li){\n\t\t\t$(node.li).remove();\n\t\t\tnode.li = null;\n\t\t}\n\t\tthis.nodeRemoveChildMarkup(ctx);\n\t},\n\t/**\n\t * Create `&lt;li>&lt;span>..&lt;/span> .. &lt;/li>` tags for this node.\n\t *\n\t * This method takes care that all HTML markup is created that is required\n\t * to display this node in it's current state.\n\t *\n\t * Call this method to create new nodes, or after the strucuture\n\t * was changed (e.g. after moving this node or adding/removing children)\n\t * nodeRenderTitle() and nodeRenderStatus() are implied.\n\t *\n\t * Note: if a node was created/removed, nodeRender() must be called for the\n\t *       parent.\n\t * &lt;code>\n\t * &lt;li id='KEY' ftnode=NODE>\n\t *     &lt;span class='fancytree-node fancytree-expanded fancytree-has-children fancytree-lastsib fancytree-exp-el fancytree-ico-e'>\n\t *         &lt;span class=\"fancytree-expander\">&lt;/span>\n\t *         &lt;span class=\"fancytree-checkbox\">&lt;/span> // only present in checkbox mode\n\t *         &lt;span class=\"fancytree-icon\">&lt;/span>\n\t *         &lt;a href=\"#\" class=\"fancytree-title\"> Node 1 &lt;/a>\n\t *     &lt;/span>\n\t *     &lt;ul> // only present if node has children\n\t *         &lt;li id='KEY' ftnode=NODE> child1 ... &lt;/li>\n\t *         &lt;li id='KEY' ftnode=NODE> child2 ... &lt;/li>\n\t *     &lt;/ul>\n\t * &lt;/li>\n\t * &lt;/code>\n\t *\n\t * @param {EventData} ctx\n\t * @param {boolean} [force=false] re-render, even if html markup was already created\n\t * @param {boolean} [deep=false] also render all descendants, even if parent is collapsed\n\t * @param {boolean} [collapsed=false] force root node to be collapsed, so we can apply animated expand later\n\t */\n\tnodeRender: function(ctx, force, deep, collapsed, _recursive) {\n\t\t/* This method must take care of all cases where the current data mode\n\t\t * (i.e. node hierarchy) does not match the current markup.\n\t\t *\n\t\t * - node was not yet rendered:\n\t\t *   create markup\n\t\t * - node was rendered: exit fast\n\t\t * - children have been added\n\t\t * - children have been removed\n\t\t */\n\t\tvar childLI, childNode1, childNode2, i, l, next, subCtx,\n\t\t\tnode = ctx.node,\n\t\t\ttree = ctx.tree,\n\t\t\topts = ctx.options,\n\t\t\taria = opts.aria,\n\t\t\tfirstTime = false,\n\t\t\tparent = node.parent,\n\t\t\tisRootNode = !parent,\n\t\t\tchildren = node.children,\n\t\t\tsuccessorLi = null;\n\t\t// FT.debug(\"nodeRender(\" + !!force + \", \" + !!deep + \")\", node.toString());\n\n\t\tif( ! isRootNode && ! parent.ul ) {\n\t\t\t// Calling node.collapse on a deep, unrendered node\n\t\t\treturn;\n\t\t}\n\t\t_assert(isRootNode || parent.ul, \"parent UL must exist\");\n\n\t\t// Render the node\n\t\tif( !isRootNode ){\n\t\t\t// Discard markup on force-mode, or if it is not linked to parent <ul>\n\t\t\tif(node.li && (force || (node.li.parentNode !== node.parent.ul) ) ){\n\t\t\t\tif( node.li.parentNode === node.parent.ul ){\n\t\t\t\t\t// #486: store following node, so we can insert the new markup there later\n\t\t\t\t\tsuccessorLi = node.li.nextSibling;\n\t\t\t\t}else{\n\t\t\t\t\t// May happen, when a top-level node was dropped over another\n\t\t\t\t\tthis.debug(\"Unlinking \" + node + \" (must be child of \" + node.parent + \")\");\n\t\t\t\t}\n//\t            this.debug(\"nodeRemoveMarkup...\");\n\t\t\t\tthis.nodeRemoveMarkup(ctx);\n\t\t\t}\n\t\t\t// Create <li><span /> </li>\n//\t\t\tnode.debug(\"render...\");\n\t\t\tif( !node.li ) {\n//\t            node.debug(\"render... really\");\n\t\t\t\tfirstTime = true;\n\t\t\t\tnode.li = document.createElement(\"li\");\n\t\t\t\tnode.li.ftnode = node;\n\t\t\t\tif(aria){\n\t\t\t\t\t// TODO: why doesn't this work:\n//\t\t\t\t\tnode.li.role = \"treeitem\";\n//                    $(node.li).attr(\"role\", \"treeitem\")\n//                    .attr(\"aria-labelledby\", \"ftal_\" + opts.idPrefix + node.key);\n\t\t\t\t}\n\t\t\t\tif( node.key && opts.generateIds ){\n\t\t\t\t\tnode.li.id = opts.idPrefix + node.key;\n\t\t\t\t}\n\t\t\t\tnode.span = document.createElement(\"span\");\n\t\t\t\tnode.span.className = \"fancytree-node\";\n\t\t\t\tif(aria){\n\t\t\t\t\t$(node.span).attr(\"aria-labelledby\", \"ftal_\" + opts.idPrefix + node.key);\n\t\t\t\t}\n\t\t\t\tnode.li.appendChild(node.span);\n\n\t\t\t\t// Create inner HTML for the <span> (expander, checkbox, icon, and title)\n\t\t\t\tthis.nodeRenderTitle(ctx);\n\n\t\t\t\t// Allow tweaking and binding, after node was created for the first time\n\t\t\t\tif ( opts.createNode ){\n\t\t\t\t\topts.createNode.call(tree, {type: \"createNode\"}, ctx);\n\t\t\t\t}\n\t\t\t}else{\n//\t\t\t\tthis.nodeRenderTitle(ctx);\n\t\t\t\tthis.nodeRenderStatus(ctx);\n\t\t\t}\n\t\t\t// Allow tweaking after node state was rendered\n\t\t\tif ( opts.renderNode ){\n\t\t\t\topts.renderNode.call(tree, {type: \"renderNode\"}, ctx);\n\t\t\t}\n\t\t}\n\n\t\t// Visit child nodes\n\t\tif( children ){\n\t\t\tif( isRootNode || node.expanded || deep === true ) {\n\t\t\t\t// Create a UL to hold the children\n\t\t\t\tif( !node.ul ){\n\t\t\t\t\tnode.ul = document.createElement(\"ul\");\n\t\t\t\t\tif((collapsed === true && !_recursive) || !node.expanded){\n\t\t\t\t\t\t// hide top UL, so we can use an animation to show it later\n\t\t\t\t\t\tnode.ul.style.display = \"none\";\n\t\t\t\t\t}\n\t\t\t\t\tif(aria){\n\t\t\t\t\t\t$(node.ul).attr(\"role\", \"group\");\n\t\t\t\t\t}\n\t\t\t\t\tif ( node.li ) { // issue #67\n\t\t\t\t\t\tnode.li.appendChild(node.ul);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnode.tree.$div.append(node.ul);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Add child markup\n\t\t\t\tfor(i=0, l=children.length; i<l; i++) {\n\t\t\t\t\tsubCtx = $.extend({}, ctx, {node: children[i]});\n\t\t\t\t\tthis.nodeRender(subCtx, force, deep, false, true);\n\t\t\t\t}\n\t\t\t\t// Remove <li> if nodes have moved to another parent\n\t\t\t\tchildLI = node.ul.firstChild;\n\t\t\t\twhile( childLI ){\n\t\t\t\t\tchildNode2 = childLI.ftnode;\n\t\t\t\t\tif( childNode2 && childNode2.parent !== node ) {\n\t\t\t\t\t\tnode.debug(\"_fixParent: remove missing \" + childNode2, childLI);\n\t\t\t\t\t\tnext = childLI.nextSibling;\n\t\t\t\t\t\tchildLI.parentNode.removeChild(childLI);\n\t\t\t\t\t\tchildLI = next;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tchildLI = childLI.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Make sure, that <li> order matches node.children order.\n\t\t\t\tchildLI = node.ul.firstChild;\n\t\t\t\tfor(i=0, l=children.length-1; i<l; i++) {\n\t\t\t\t\tchildNode1 = children[i];\n\t\t\t\t\tchildNode2 = childLI.ftnode;\n\t\t\t\t\tif( childNode1 !== childNode2 ) {\n\t\t\t\t\t\t// node.debug(\"_fixOrder: mismatch at index \" + i + \": \" + childNode1 + \" != \" + childNode2);\n\t\t\t\t\t\tnode.ul.insertBefore(childNode1.li, childNode2.li);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchildLI = childLI.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}else{\n\t\t\t// No children: remove markup if any\n\t\t\tif( node.ul ){\n//\t\t\t\talert(\"remove child markup for \" + node);\n\t\t\t\tthis.warn(\"remove child markup for \" + node);\n\t\t\t\tthis.nodeRemoveChildMarkup(ctx);\n\t\t\t}\n\t\t}\n\t\tif( !isRootNode ){\n\t\t\t// Update element classes according to node state\n\t\t\t// this.nodeRenderStatus(ctx);\n\t\t\t// Finally add the whole structure to the DOM, so the browser can render\n\t\t\tif( firstTime ){\n\t\t\t\t// #486: successorLi is set, if we re-rendered (i.e. discarded)\n\t\t\t\t// existing markup, which  we want to insert at the same position.\n\t\t\t\t// (null is equivalent to append)\n//\t\t\t\tparent.ul.appendChild(node.li);\n\t\t\t\tparent.ul.insertBefore(node.li, successorLi);\n\t\t\t}\n\t\t}\n\t},\n\t/** Create HTML inside the node's outer &lt;span> (i.e. expander, checkbox,\n\t * icon, and title).\n\t *\n\t * nodeRenderStatus() is implied.\n\t * @param {EventData} ctx\n\t * @param {string} [title] optinal new title\n\t */\n\tnodeRenderTitle: function(ctx, title) {\n\t\t// set node connector images, links and text\n\t\tvar id, icon, nodeTitle, role, tabindex, tooltip,\n\t\t\tnode = ctx.node,\n\t\t\ttree = ctx.tree,\n\t\t\topts = ctx.options,\n\t\t\taria = opts.aria,\n\t\t\tlevel = node.getLevel(),\n\t\t\tares = [];\n\n\t\tif(title !== undefined){\n\t\t\tnode.title = title;\n\t\t}\n\t\tif(!node.span){\n\t\t\t// Silently bail out if node was not rendered yet, assuming\n\t\t\t// node.render() will be called as the node becomes visible\n\t\t\treturn;\n\t\t}\n\t\t// Connector (expanded, expandable or simple)\n\t\tif( level < opts.minExpandLevel ) {\n\t\t\tif( !node.lazy ) {\n\t\t\t\tnode.expanded = true;\n\t\t\t}\n\t\t\tif(level > 1){\n\t\t\t\tif(aria){\n\t\t\t\t\tares.push(\"<span role='button' class='fancytree-expander fancytree-expander-fixed'></span>\");\n\t\t\t\t}else{\n\t\t\t\t\tares.push(\"<span class='fancytree-expander fancytree-expander-fixed''></span>\");\n\t\t\t\t}\n\t\t\t}\n\t\t\t// .. else (i.e. for root level) skip expander/connector alltogether\n\t\t} else {\n\t\t\tif(aria){\n\t\t\t\tares.push(\"<span role='button' class='fancytree-expander'></span>\");\n\t\t\t}else{\n\t\t\t\tares.push(\"<span class='fancytree-expander'></span>\");\n\t\t\t}\n\t\t}\n\t\t// Checkbox mode\n\t\tif( opts.checkbox && node.hideCheckbox !== true && !node.isStatusNode() ) {\n\t\t\tif(aria){\n\t\t\t\tares.push(\"<span role='checkbox' class='fancytree-checkbox'></span>\");\n\t\t\t}else{\n\t\t\t\tares.push(\"<span class='fancytree-checkbox'></span>\");\n\t\t\t}\n\t\t}\n\t\t// Folder or doctype icon\n\t\tif( node.data.iconClass !== undefined ) {  // 2015-11-16\n\t\t\t// Handle / warn about backward compatibility\n\t\t\tif( node.icon ) {\n\t\t\t\t$.error(\"'iconClass' node option is deprecated since v2.14.0: use 'icon' only instead\");\n\t\t\t} else {\n\t\t\t\tnode.warn(\"'iconClass' node option is deprecated since v2.14.0: use 'icon' instead\");\n\t\t\t\tnode.icon = node.data.iconClass;\n\t\t\t}\n\t\t}\n\t\t// If opts.icon is a callback and returns something other than undefined, use that\n\t\t// else if node.icon is a boolean or string, use that\n\t\t// else if opts.icon is a boolean or string, use that\n\t\t// else show standard icon (which may be different for folders or documents)\n\t\tif( $.isFunction(opts.icon) ) {\n\t\t\ticon = opts.icon.call(tree, {type: \"icon\"}, ctx);\n\t\t\tif( icon == null ) {\n\t\t\t\ticon = node.icon;\n\t\t\t}\n\t\t} else {\n\t\t\ticon = (node.icon != null) ? node.icon : opts.icon;\n\t\t}\n\t\tif( icon == null ) {\n\t\t\ticon = true;  // no icon option at all: show default icon\n\t\t} else {\n\t\t\tif( typeof icon !== \"boolean\" ) {\n\t\t\t\t// icon is defined, but not true/false: must be a string\n\t\t\t\ticon = \"\" + icon;\n\t\t\t}\n\t\t}\n\t\tif( icon !== false ) {\n\t\t\trole = aria ? \" role='img'\" : \"\";\n\t\t\tif ( typeof icon === \"string\" ) {\n\t\t\t\tif( TEST_IMG.test(icon) ) {\n\t\t\t\t\t// node.icon is an image url. Prepend imagePath\n\t\t\t\t\ticon = (icon.charAt(0) === \"/\") ? icon : ((opts.imagePath || \"\") + icon);\n\t\t\t\t\tares.push(\"<img src='\" + icon + \"' class='fancytree-icon' alt='' />\");\n\t\t\t\t} else {\n\t\t\t\t\tares.push(\"<span \" + role + \" class='fancytree-custom-icon \" + icon +  \"'></span>\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// standard icon: theme css will take care of this\n\t\t\t\tares.push(\"<span \" + role + \" class='fancytree-icon'></span>\");\n\t\t\t}\n\t\t}\n\t\t// Node title\n\t\tnodeTitle = \"\";\n\t\tif ( opts.renderTitle ){\n\t\t\tnodeTitle = opts.renderTitle.call(tree, {type: \"renderTitle\"}, ctx) || \"\";\n\t\t}\n\t\tif(!nodeTitle){\n\t\t\ttooltip = node.tooltip ? \" title='\" + _escapeHtml(node.tooltip) + \"'\" : \"\";\n\t\t\tid = aria ? \" id='ftal_\" + opts.idPrefix + node.key + \"'\" : \"\";\n\t\t\trole = aria ? \" role='treeitem'\" : \"\";\n\t\t\ttabindex = opts.titlesTabbable ? \" tabindex='0'\" : \"\";\n\n\t\t\tnodeTitle = \"<span \" + role + \" class='fancytree-title'\" +\n\t\t\t\tid + tooltip + tabindex + \">\" +\n\t\t\t\t(opts.escapeTitles ? _escapeHtml(node.title) : node.title) +\n\t\t\t\t\"</span>\";\n\t\t}\n\t\tares.push(nodeTitle);\n\t\t// Note: this will trigger focusout, if node had the focus\n\t\t//$(node.span).html(ares.join(\"\")); // it will cleanup the jQuery data currently associated with SPAN (if any), but it executes more slowly\n\t\tnode.span.innerHTML = ares.join(\"\");\n\t\t// Update CSS classes\n\t\tthis.nodeRenderStatus(ctx);\n\t\tif ( opts.enhanceTitle ){\n\t\t\tctx.$title = $(\">span.fancytree-title\", node.span);\n\t\t\tnodeTitle = opts.enhanceTitle.call(tree, {type: \"enhanceTitle\"}, ctx) || \"\";\n\t\t}\n\t},\n\t/** Update element classes according to node state.\n\t * @param {EventData} ctx\n\t */\n\tnodeRenderStatus: function(ctx) {\n\t\t// Set classes for current status\n\t\tvar node = ctx.node,\n\t\t\ttree = ctx.tree,\n\t\t\topts = ctx.options,\n//\t\t\tnodeContainer = node[tree.nodeContainerAttrName],\n\t\t\thasChildren = node.hasChildren(),\n\t\t\tisLastSib = node.isLastSibling(),\n\t\t\taria = opts.aria,\n//            $ariaElem = aria ? $(node[tree.ariaPropName]) : null,\n\t\t\t$ariaElem = $(node.span).find(\".fancytree-title\"),\n\t\t\tcn = opts._classNames,\n\t\t\tcnList = [],\n\t\t\tstatusElem = node[tree.statusClassPropName];\n\n\t\tif( !statusElem ){\n\t\t\t// if this function is called for an unrendered node, ignore it (will be updated on nect render anyway)\n\t\t\treturn;\n\t\t}\n\t\t// Build a list of class names that we will add to the node <span>\n\t\tcnList.push(cn.node);\n\t\tif( tree.activeNode === node ){\n\t\t\tcnList.push(cn.active);\n//\t\t\t$(\">span.fancytree-title\", statusElem).attr(\"tabindex\", \"0\");\n//\t\t\ttree.$container.removeAttr(\"tabindex\");\n\t\t// }else{\n//\t\t\t$(\">span.fancytree-title\", statusElem).removeAttr(\"tabindex\");\n//\t\t\ttree.$container.attr(\"tabindex\", \"0\");\n\t\t}\n\t\tif( tree.focusNode === node ){\n\t\t\tcnList.push(cn.focused);\n\t\t\tif(aria){\n//              $(\">span.fancytree-title\", statusElem).attr(\"tabindex\", \"0\");\n//                $(\">span.fancytree-title\", statusElem).attr(\"tabindex\", \"-1\");\n\t\t\t\t// TODO: is this the right element for this attribute?\n\t\t\t\t$ariaElem\n\t\t\t\t\t.attr(\"aria-activedescendant\", true);\n//\t\t\t\t\t.attr(\"tabindex\", \"-1\");\n\t\t\t}\n\t\t}else if(aria){\n//\t\t\t$(\">span.fancytree-title\", statusElem).attr(\"tabindex\", \"-1\");\n\t\t\t$ariaElem\n\t\t\t\t.removeAttr(\"aria-activedescendant\");\n//\t\t\t\t.removeAttr(\"tabindex\");\n\t\t}\n\t\tif( node.expanded ){\n\t\t\tcnList.push(cn.expanded);\n\t\t\tif(aria){\n\t\t\t\t$ariaElem.attr(\"aria-expanded\", true);\n\t\t\t}\n\t\t}else if(aria){\n\t\t\t$ariaElem.removeAttr(\"aria-expanded\");\n\t\t}\n\t\tif( node.folder ){\n\t\t\tcnList.push(cn.folder);\n\t\t}\n\t\tif( hasChildren !== false ){\n\t\t\tcnList.push(cn.hasChildren);\n\t\t}\n\t\t// TODO: required?\n\t\tif( isLastSib ){\n\t\t\tcnList.push(cn.lastsib);\n\t\t}\n\t\tif( node.lazy && node.children == null ){\n\t\t\tcnList.push(cn.lazy);\n\t\t}\n\t\tif( node.partload ){\n\t\t\tcnList.push(cn.partload);\n\t\t}\n\t\tif( node.partsel ){\n\t\t\tcnList.push(cn.partsel);\n\t\t}\n\t\tif( node.unselectable ){\n\t\t\tcnList.push(cn.unselectable);\n\t\t}\n\t\tif( node._isLoading ){\n\t\t\tcnList.push(cn.loading);\n\t\t}\n\t\tif( node._error ){\n\t\t\tcnList.push(cn.error);\n\t\t}\n\t\tif( node.statusNodeType ) {\n\t\t\tcnList.push(cn.statusNodePrefix + node.statusNodeType);\n\t\t}\n\t\tif( node.selected ){\n\t\t\tcnList.push(cn.selected);\n\t\t\tif(aria){\n\t\t\t\t$ariaElem.attr(\"aria-selected\", true);\n\t\t\t}\n\t\t}else if(aria){\n\t\t\t$ariaElem.attr(\"aria-selected\", false);\n\t\t}\n\t\tif( node.extraClasses ){\n\t\t\tcnList.push(node.extraClasses);\n\t\t}\n\t\t// IE6 doesn't correctly evaluate multiple class names,\n\t\t// so we create combined class names that can be used in the CSS\n\t\tif( hasChildren === false ){\n\t\t\tcnList.push(cn.combinedExpanderPrefix + \"n\" +\n\t\t\t\t\t(isLastSib ? \"l\" : \"\")\n\t\t\t\t\t);\n\t\t}else{\n\t\t\tcnList.push(cn.combinedExpanderPrefix +\n\t\t\t\t\t(node.expanded ? \"e\" : \"c\") +\n\t\t\t\t\t(node.lazy && node.children == null ? \"d\" : \"\") +\n\t\t\t\t\t(isLastSib ? \"l\" : \"\")\n\t\t\t\t\t);\n\t\t}\n\t\tcnList.push(cn.combinedIconPrefix +\n\t\t\t\t(node.expanded ? \"e\" : \"c\") +\n\t\t\t\t(node.folder ? \"f\" : \"\")\n\t\t\t\t);\n//        node.span.className = cnList.join(\" \");\n\t\tstatusElem.className = cnList.join(\" \");\n\n\t\t// TODO: we should not set this in the <span> tag also, if we set it here:\n\t\t// Maybe most (all) of the classes should be set in LI instead of SPAN?\n\t\tif(node.li){\n\t\t\tnode.li.className = isLastSib ? cn.lastsib : \"\";\n\t\t}\n\t},\n\t/** Activate node.\n\t * flag defaults to true.\n\t * If flag is true, the node is activated (must be a synchronous operation)\n\t * If flag is false, the node is deactivated (must be a synchronous operation)\n\t * @param {EventData} ctx\n\t * @param {boolean} [flag=true]\n\t * @param {object} [opts] additional options. Defaults to {noEvents: false, noFocus: false}\n\t * @returns {$.Promise}\n\t */\n\tnodeSetActive: function(ctx, flag, callOpts) {\n\t\t// Handle user click / [space] / [enter], according to clickFolderMode.\n\t\tcallOpts = callOpts || {};\n\t\tvar subCtx,\n\t\t\tnode = ctx.node,\n\t\t\ttree = ctx.tree,\n\t\t\topts = ctx.options,\n\t\t\tnoEvents = (callOpts.noEvents === true),\n\t\t\tnoFocus = (callOpts.noFocus === true),\n\t\t\tisActive = (node === tree.activeNode);\n\n\t\t// flag defaults to true\n\t\tflag = (flag !== false);\n\t\t// node.debug(\"nodeSetActive\", flag);\n\n\t\tif(isActive === flag){\n\t\t\t// Nothing to do\n\t\t\treturn _getResolvedPromise(node);\n\t\t}else if(flag && !noEvents && this._triggerNodeEvent(\"beforeActivate\", node, ctx.originalEvent) === false ){\n\t\t\t// Callback returned false\n\t\t\treturn _getRejectedPromise(node, [\"rejected\"]);\n\t\t}\n\t\tif(flag){\n\t\t\tif(tree.activeNode){\n\t\t\t\t_assert(tree.activeNode !== node, \"node was active (inconsistency)\");\n\t\t\t\tsubCtx = $.extend({}, ctx, {node: tree.activeNode});\n\t\t\t\ttree.nodeSetActive(subCtx, false);\n\t\t\t\t_assert(tree.activeNode === null, \"deactivate was out of sync?\");\n\t\t\t}\n\t\t\tif(opts.activeVisible){\n\t\t\t\t// tree.nodeMakeVisible(ctx);\n\t\t\t\tnode.makeVisible({scrollIntoView: false}); // nodeSetFocus will scroll\n\t\t\t}\n\t\t\ttree.activeNode = node;\n\t\t\ttree.nodeRenderStatus(ctx);\n\t\t\tif( !noFocus ) {\n\t\t\t\ttree.nodeSetFocus(ctx);\n\t\t\t}\n\t\t\tif( !noEvents ) {\n\t\t\t\ttree._triggerNodeEvent(\"activate\", node, ctx.originalEvent);\n\t\t\t}\n\t\t}else{\n\t\t\t_assert(tree.activeNode === node, \"node was not active (inconsistency)\");\n\t\t\ttree.activeNode = null;\n\t\t\tthis.nodeRenderStatus(ctx);\n\t\t\tif( !noEvents ) {\n\t\t\t\tctx.tree._triggerNodeEvent(\"deactivate\", node, ctx.originalEvent);\n\t\t\t}\n\t\t}\n\t\treturn _getResolvedPromise(node);\n\t},\n\t/** Expand or collapse node, return Deferred.promise.\n\t *\n\t * @param {EventData} ctx\n\t * @param {boolean} [flag=true]\n\t * @param {object} [opts] additional options. Defaults to {noAnimation: false, noEvents: false}\n\t * @returns {$.Promise} The deferred will be resolved as soon as the (lazy)\n\t *     data was retrieved, rendered, and the expand animation finshed.\n\t */\n\tnodeSetExpanded: function(ctx, flag, callOpts) {\n\t\tcallOpts = callOpts || {};\n\t\tvar _afterLoad, dfd, i, l, parents, prevAC,\n\t\t\tnode = ctx.node,\n\t\t\ttree = ctx.tree,\n\t\t\topts = ctx.options,\n\t\t\tnoAnimation = (callOpts.noAnimation === true),\n\t\t\tnoEvents = (callOpts.noEvents === true);\n\n\t\t// flag defaults to true\n\t\tflag = (flag !== false);\n\n\t\t// node.debug(\"nodeSetExpanded(\" + flag + \")\");\n\n\t\tif((node.expanded && flag) || (!node.expanded && !flag)){\n\t\t\t// Nothing to do\n\t\t\t// node.debug(\"nodeSetExpanded(\" + flag + \"): nothing to do\");\n\t\t\treturn _getResolvedPromise(node);\n\t\t}else if(flag && !node.lazy && !node.hasChildren() ){\n\t\t\t// Prevent expanding of empty nodes\n\t\t\t// return _getRejectedPromise(node, [\"empty\"]);\n\t\t\treturn _getResolvedPromise(node);\n\t\t}else if( !flag && node.getLevel() < opts.minExpandLevel ) {\n\t\t\t// Prevent collapsing locked levels\n\t\t\treturn _getRejectedPromise(node, [\"locked\"]);\n\t\t}else if ( !noEvents && this._triggerNodeEvent(\"beforeExpand\", node, ctx.originalEvent) === false ){\n\t\t\t// Callback returned false\n\t\t\treturn _getRejectedPromise(node, [\"rejected\"]);\n\t\t}\n\t\t// If this node inside a collpased node, no animation and scrolling is needed\n\t\tif( !noAnimation && !node.isVisible() ) {\n\t\t\tnoAnimation = callOpts.noAnimation = true;\n\t\t}\n\n\t\tdfd = new $.Deferred();\n\n\t\t// Auto-collapse mode: collapse all siblings\n\t\tif( flag && !node.expanded && opts.autoCollapse ) {\n\t\t\tparents = node.getParentList(false, true);\n\t\t\tprevAC = opts.autoCollapse;\n\t\t\ttry{\n\t\t\t\topts.autoCollapse = false;\n\t\t\t\tfor(i=0, l=parents.length; i<l; i++){\n\t\t\t\t\t// TODO: should return promise?\n\t\t\t\t\tthis._callHook(\"nodeCollapseSiblings\", parents[i], callOpts);\n\t\t\t\t}\n\t\t\t}finally{\n\t\t\t\topts.autoCollapse = prevAC;\n\t\t\t}\n\t\t}\n\t\t// Trigger expand/collapse after expanding\n\t\tdfd.done(function(){\n\t\t\tvar\tlastChild = node.getLastChild();\n\t\t\tif( flag && opts.autoScroll && !noAnimation && lastChild ) {\n\t\t\t\t// Scroll down to last child, but keep current node visible\n\t\t\t\tlastChild.scrollIntoView(true, {topNode: node}).always(function(){\n\t\t\t\t\tif( !noEvents ) {\n\t\t\t\t\t\tctx.tree._triggerNodeEvent(flag ? \"expand\" : \"collapse\", ctx);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif( !noEvents ) {\n\t\t\t\t\tctx.tree._triggerNodeEvent(flag ? \"expand\" : \"collapse\", ctx);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t// vvv Code below is executed after loading finished:\n\t\t_afterLoad = function(callback){\n\t\t\tvar isVisible, isExpanded,\n\t\t\t\teffect = opts.toggleEffect;\n\n\t\t\tnode.expanded = flag;\n\t\t\t// Create required markup, but make sure the top UL is hidden, so we\n\t\t\t// can animate later\n\t\t\ttree._callHook(\"nodeRender\", ctx, false, false, true);\n\n\t\t\t// If the currently active node is now hidden, deactivate it\n\t\t\t// if( opts.activeVisible && this.activeNode && ! this.activeNode.isVisible() ) {\n\t\t\t//     this.activeNode.deactivate();\n\t\t\t// }\n\n\t\t\t// Expanding a lazy node: set 'loading...' and call callback\n\t\t\t// if( bExpand && this.data.isLazy && this.childList === null && !this._isLoading ) {\n\t\t\t//     this._loadContent();\n\t\t\t//     return;\n\t\t\t// }\n\t\t\t// Hide children, if node is collapsed\n\t\t\tif( node.ul ) {\n\t\t\t\tisVisible = (node.ul.style.display !== \"none\");\n\t\t\t\tisExpanded = !!node.expanded;\n\t\t\t\tif ( isVisible === isExpanded ) {\n\t\t\t\t\tnode.warn(\"nodeSetExpanded: UL.style.display already set\");\n\n\t\t\t\t} else if ( !effect || noAnimation ) {\n\t\t\t\t\tnode.ul.style.display = ( node.expanded || !parent ) ? \"\" : \"none\";\n\n\t\t\t\t} else {\n\t\t\t\t\t// The UI toggle() effect works with the ext-wide extension,\n\t\t\t\t\t// while jQuery.animate() has problems when the title span\n\t\t\t\t\t// has positon: absolute\n\n\t\t\t\t\t// duration = opts.fx.duration || 200;\n\t\t\t\t\t// easing = opts.fx.easing;\n\t\t\t\t\t// $(node.ul).animate(opts.fx, duration, easing, function(){\n\n\t\t\t\t\t// node.debug(\"nodeSetExpanded: animate start...\");\n\t\t\t\t\t$(node.ul).toggle(effect.effect, effect.options, effect.duration, function(){\n\t\t\t\t\t\t// node.debug(\"nodeSetExpanded: animate done\");\n\t\t\t\t\t\tcallback();\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcallback();\n\t\t};\n\t\t// ^^^ Code above is executed after loading finshed.\n\n\t\t// Load lazy nodes, if any. Then continue with _afterLoad()\n\t\tif(flag && node.lazy && node.hasChildren() === undefined){\n\t\t\t// node.debug(\"nodeSetExpanded: load start...\");\n\t\t\tnode.load().done(function(){\n\t\t\t\t// node.debug(\"nodeSetExpanded: load done\");\n\t\t\t\tif(dfd.notifyWith){ // requires jQuery 1.6+\n\t\t\t\t\tdfd.notifyWith(node, [\"loaded\"]);\n\t\t\t\t}\n\t\t\t\t_afterLoad(function () { dfd.resolveWith(node); });\n\t\t\t}).fail(function(errMsg){\n\t\t\t\t_afterLoad(function () { dfd.rejectWith(node, [\"load failed (\" + errMsg + \")\"]); });\n\t\t\t});\n/*\n\t\t\tvar source = tree._triggerNodeEvent(\"lazyLoad\", node, ctx.originalEvent);\n\t\t\t_assert(typeof source !== \"boolean\", \"lazyLoad event must return source in data.result\");\n\t\t\tnode.debug(\"nodeSetExpanded: load start...\");\n\t\t\tthis._callHook(\"nodeLoadChildren\", ctx, source).done(function(){\n\t\t\t\tnode.debug(\"nodeSetExpanded: load done\");\n\t\t\t\tif(dfd.notifyWith){ // requires jQuery 1.6+\n\t\t\t\t\tdfd.notifyWith(node, [\"loaded\"]);\n\t\t\t\t}\n\t\t\t\t_afterLoad.call(tree);\n\t\t\t}).fail(function(errMsg){\n\t\t\t\tdfd.rejectWith(node, [\"load failed (\" + errMsg + \")\"]);\n\t\t\t});\n*/\n\t\t}else{\n\t\t\t_afterLoad(function () { dfd.resolveWith(node); });\n\t\t}\n\t\t// node.debug(\"nodeSetExpanded: returns\");\n\t\treturn dfd.promise();\n\t},\n\t/** Focus or blur this node.\n\t * @param {EventData} ctx\n\t * @param {boolean} [flag=true]\n\t */\n\tnodeSetFocus: function(ctx, flag) {\n\t\t// ctx.node.debug(\"nodeSetFocus(\" + flag + \")\");\n\t\tvar ctx2,\n\t\t\ttree = ctx.tree,\n\t\t\tnode = ctx.node;\n\n\t\tflag = (flag !== false);\n\n\t\t// Blur previous node if any\n\t\tif(tree.focusNode){\n\t\t\tif(tree.focusNode === node && flag){\n\t\t\t\t// node.debug(\"nodeSetFocus(\" + flag + \"): nothing to do\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tctx2 = $.extend({}, ctx, {node: tree.focusNode});\n\t\t\ttree.focusNode = null;\n\t\t\tthis._triggerNodeEvent(\"blur\", ctx2);\n\t\t\tthis._callHook(\"nodeRenderStatus\", ctx2);\n\t\t}\n\t\t// Set focus to container and node\n\t\tif(flag){\n\t\t\tif( !this.hasFocus() ){\n\t\t\t\tnode.debug(\"nodeSetFocus: forcing container focus\");\n\t\t\t\tthis._callHook(\"treeSetFocus\", ctx, true, {calledByNode: true});\n\t\t\t}\n\t\t\tnode.makeVisible({scrollIntoView: false});\n\t\t\ttree.focusNode = node;\n\t\t\tif( tree.options.titlesTabbable ) {\n\t\t\t\t$(node.span).find(\".fancytree-title\").focus();\n\t\t\t} else {\n\t\t\t\t// We cannot set KB focus to a node, so use the tree container\n\t\t\t\t// #563, #570: IE scrolls on every call to .focus(), if the container\n\t\t\t\t// is partially outside the viewport. So do it only, when absolutely\n\t\t\t\t// neccessary:\n\t\t\t\tif( $(document.activeElement).closest(\".fancytree-container\").length === 0 ) {\n\t\t\t\t\t$(tree.$container).focus();\n\t\t\t\t}\n\t\t\t}\n\n//\t\t\t$(node.span).find(\".fancytree-title\").focus();\n\t\t\tthis._triggerNodeEvent(\"focus\", ctx);\n//          if(ctx.options.autoActivate){\n//              tree.nodeSetActive(ctx, true);\n//          }\n\t\t\tif(ctx.options.autoScroll){\n\t\t\t\tnode.scrollIntoView();\n\t\t\t}\n\t\t\tthis._callHook(\"nodeRenderStatus\", ctx);\n\t\t}\n\t},\n\t/** (De)Select node, return new status (sync).\n\t *\n\t * @param {EventData} ctx\n\t * @param {boolean} [flag=true]\n\t */\n\tnodeSetSelected: function(ctx, flag) {\n\t\tvar node = ctx.node,\n\t\t\ttree = ctx.tree,\n\t\t\topts = ctx.options;\n\t\t// flag defaults to true\n\t\tflag = (flag !== false);\n\n\t\tnode.debug(\"nodeSetSelected(\" + flag + \")\", ctx);\n\t\tif( node.unselectable){\n\t\t\treturn;\n\t\t}\n\t\t// TODO: !!node.expanded is nicer, but doesn't pass jshint\n\t\t// https://github.com/jshint/jshint/issues/455\n//        if( !!node.expanded === !!flag){\n\t\tif((node.selected && flag) || (!node.selected && !flag)){\n\t\t\treturn !!node.selected;\n\t\t}else if ( this._triggerNodeEvent(\"beforeSelect\", node, ctx.originalEvent) === false ){\n\t\t\treturn !!node.selected;\n\t\t}\n\t\tif(flag && opts.selectMode === 1){\n\t\t\t// single selection mode\n\t\t\tif(tree.lastSelectedNode){\n\t\t\t\ttree.lastSelectedNode.setSelected(false);\n\t\t\t}\n\t\t}else if(opts.selectMode === 3){\n\t\t\t// multi.hier selection mode\n\t\t\tnode.selected = flag;\n//\t\t\tthis._fixSelectionState(node);\n\t\t\tnode.fixSelection3AfterClick();\n\t\t}\n\t\tnode.selected = flag;\n\t\tthis.nodeRenderStatus(ctx);\n\t\ttree.lastSelectedNode = flag ? node : null;\n\t\ttree._triggerNodeEvent(\"select\", ctx);\n\t},\n\t/** Show node status (ok, loading, error, nodata) using styles and a dummy child node.\n\t *\n\t * @param {EventData} ctx\n\t * @param status\n\t * @param message\n\t * @param details\n\t * @since 2.3\n\t */\n\tnodeSetStatus: function(ctx, status, message, details) {\n\t\tvar node = ctx.node,\n\t\t\ttree = ctx.tree;\n\n\t\tfunction _clearStatusNode() {\n\t\t\t// Remove dedicated dummy node, if any\n\t\t\tvar firstChild = ( node.children ? node.children[0] : null );\n\t\t\tif ( firstChild && firstChild.isStatusNode() ) {\n\t\t\t\ttry{\n\t\t\t\t\t// I've seen exceptions here with loadKeyPath...\n\t\t\t\t\tif(node.ul){\n\t\t\t\t\t\tnode.ul.removeChild(firstChild.li);\n\t\t\t\t\t\tfirstChild.li = null; // avoid leaks (DT issue 215)\n\t\t\t\t\t}\n\t\t\t\t}catch(e){}\n\t\t\t\tif( node.children.length === 1 ){\n\t\t\t\t\tnode.children = [];\n\t\t\t\t}else{\n\t\t\t\t\tnode.children.shift();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfunction _setStatusNode(data, type) {\n\t\t\t// Create/modify the dedicated dummy node for 'loading...' or\n\t\t\t// 'error!' status. (only called for direct child of the invisible\n\t\t\t// system root)\n\t\t\tvar firstChild = ( node.children ? node.children[0] : null );\n\t\t\tif ( firstChild && firstChild.isStatusNode() ) {\n\t\t\t\t$.extend(firstChild, data);\n\t\t\t\tfirstChild.statusNodeType = type;\n\t\t\t\ttree._callHook(\"nodeRenderTitle\", firstChild);\n\t\t\t} else {\n\t\t\t\tnode._setChildren([data]);\n\t\t\t\tnode.children[0].statusNodeType = type;\n\t\t\t\ttree.render();\n\t\t\t}\n\t\t\treturn node.children[0];\n\t\t}\n\n\t\tswitch( status ){\n\t\tcase \"ok\":\n\t\t\t_clearStatusNode();\n\t\t\tnode._isLoading = false;\n\t\t\tnode._error = null;\n\t\t\tnode.renderStatus();\n\t\t\tbreak;\n\t\tcase \"loading\":\n\t\t\tif( !node.parent ) {\n\t\t\t\t_setStatusNode({\n\t\t\t\t\ttitle: tree.options.strings.loading + (message ? \" (\" + message + \")\" : \"\"),\n\t\t\t\t\t// icon: true,  // needed for 'loding' icon\n\t\t\t\t\tcheckbox: false,\n\t\t\t\t\ttooltip: details\n\t\t\t\t}, status);\n\t\t\t}\n\t\t\tnode._isLoading = true;\n\t\t\tnode._error = null;\n\t\t\tnode.renderStatus();\n\t\t\tbreak;\n\t\tcase \"error\":\n\t\t\t_setStatusNode({\n\t\t\t\ttitle: tree.options.strings.loadError + (message ? \" (\" + message + \")\" : \"\"),\n\t\t\t\t// icon: false,\n\t\t\t\tcheckbox: false,\n\t\t\t\ttooltip: details\n\t\t\t}, status);\n\t\t\tnode._isLoading = false;\n\t\t\tnode._error = { message: message, details: details };\n\t\t\tnode.renderStatus();\n\t\t\tbreak;\n\t\tcase \"nodata\":\n\t\t\t_setStatusNode({\n\t\t\t\ttitle: tree.options.strings.noData,\n\t\t\t\t// icon: false,\n\t\t\t\tcheckbox: false,\n\t\t\t\ttooltip: details\n\t\t\t}, status);\n\t\t\tnode._isLoading = false;\n\t\t\tnode._error = null;\n\t\t\tnode.renderStatus();\n\t\t\tbreak;\n\t\tdefault:\n\t\t\t$.error(\"invalid node status \" + status);\n\t\t}\n\t},\n\t/**\n\t *\n\t * @param {EventData} ctx\n\t */\n\tnodeToggleExpanded: function(ctx) {\n\t\treturn this.nodeSetExpanded(ctx, !ctx.node.expanded);\n\t},\n\t/**\n\t * @param {EventData} ctx\n\t */\n\tnodeToggleSelected: function(ctx) {\n\t\treturn this.nodeSetSelected(ctx, !ctx.node.selected);\n\t},\n\t/** Remove all nodes.\n\t * @param {EventData} ctx\n\t */\n\ttreeClear: function(ctx) {\n\t\tvar tree = ctx.tree;\n\t\ttree.activeNode = null;\n\t\ttree.focusNode = null;\n\t\ttree.$div.find(\">ul.fancytree-container\").empty();\n\t\t// TODO: call destructors and remove reference loops\n\t\ttree.rootNode.children = null;\n\t},\n\t/** Widget was created (called only once, even it re-initialized).\n\t * @param {EventData} ctx\n\t */\n\ttreeCreate: function(ctx) {\n\t},\n\t/** Widget was destroyed.\n\t * @param {EventData} ctx\n\t */\n\ttreeDestroy: function(ctx) {\n\t\tthis.$div.find(\">ul.fancytree-container\").remove();\n\t\tthis.$source && this.$source.removeClass(\"ui-helper-hidden\");\n\t},\n\t/** Widget was (re-)initialized.\n\t * @param {EventData} ctx\n\t */\n\ttreeInit: function(ctx) {\n\t\t//this.debug(\"Fancytree.treeInit()\");\n\t\tthis.treeLoad(ctx);\n\t},\n\t/** Parse Fancytree from source, as configured in the options.\n\t * @param {EventData} ctx\n\t * @param {object} [source] optional new source (use last data otherwise)\n\t */\n\ttreeLoad: function(ctx, source) {\n\t\tvar type, $ul,\n\t\t\ttree = ctx.tree,\n\t\t\t$container = ctx.widget.element,\n\t\t\tdfd,\n\t\t\t// calling context for root node\n\t\t\trootCtx = $.extend({}, ctx, {node: this.rootNode});\n\n\t\tif(tree.rootNode.children){\n\t\t\tthis.treeClear(ctx);\n\t\t}\n\t\tsource = source || this.options.source;\n\n\t\tif(!source){\n\t\t\ttype = $container.data(\"type\") || \"html\";\n\t\t\tswitch(type){\n\t\t\tcase \"html\":\n\t\t\t\t$ul = $container.find(\">ul:first\");\n\t\t\t\t$ul.addClass(\"ui-fancytree-source ui-helper-hidden\");\n\t\t\t\tsource = $.ui.fancytree.parseHtml($ul);\n\t\t\t\t// allow to init tree.data.foo from <ul data-foo=''>\n\t\t\t\tthis.data = $.extend(this.data, _getElementDataAsDict($ul));\n\t\t\t\tbreak;\n\t\t\tcase \"json\":\n\t//            $().addClass(\"ui-helper-hidden\");\n\t\t\t\tsource = $.parseJSON($container.text());\n\t\t\t\tif(source.children){\n\t\t\t\t\tif(source.title){tree.title = source.title;}\n\t\t\t\t\tsource = source.children;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\t$.error(\"Invalid data-type: \" + type);\n\t\t\t}\n\t\t}else if(typeof source === \"string\"){\n\t\t\t// TODO: source is an element ID\n\t\t\t$.error(\"Not implemented\");\n\t\t}\n\n\t\t// Trigger fancytreeinit after nodes have been loaded\n\t\tdfd = this.nodeLoadChildren(rootCtx, source).done(function(){\n\t\t\ttree.render();\n\t\t\tif( ctx.options.selectMode === 3 ){\n\t\t\t\ttree.rootNode.fixSelection3FromEndNodes();\n\t\t\t}\n\t\t\tif( tree.activeNode && tree.options.activeVisible ) {\n\t\t\t\ttree.activeNode.makeVisible();\n\t\t\t}\n\t\t\ttree._triggerTreeEvent(\"init\", null, { status: true });\n\t\t}).fail(function(){\n\t\t\ttree.render();\n\t\t\ttree._triggerTreeEvent(\"init\", null, { status: false });\n\t\t});\n\t\treturn dfd;\n\t},\n\t/** Node was inserted into or removed from the tree.\n\t * @param {EventData} ctx\n\t * @param {boolean} add\n\t * @param {FancytreeNode} node\n\t */\n\ttreeRegisterNode: function(ctx, add, node) {\n\t},\n\t/** Widget got focus.\n\t * @param {EventData} ctx\n\t * @param {boolean} [flag=true]\n\t */\n\ttreeSetFocus: function(ctx, flag, callOpts) {\n\t\tflag = (flag !== false);\n\n\t\t// this.debug(\"treeSetFocus(\" + flag + \"), callOpts: \", callOpts, this.hasFocus());\n\t\t// this.debug(\"    focusNode: \" + this.focusNode);\n\t\t// this.debug(\"    activeNode: \" + this.activeNode);\n\t\tif( flag !== this.hasFocus() ){\n\t\t\tthis._hasFocus = flag;\n\t\t\tif( !flag && this.focusNode ) {\n\t\t\t\t// Node also looses focus if widget blurs\n\t\t\t\tthis.focusNode.setFocus(false);\n\t\t\t} else if ( flag && (!callOpts || !callOpts.calledByNode) ) {\n\t\t\t\t$(this.$container).focus();\n\t\t\t}\n\t\t\tthis.$container.toggleClass(\"fancytree-treefocus\", flag);\n\t\t\tthis._triggerTreeEvent(flag ? \"focusTree\" : \"blurTree\");\n\t\t}\n\t}\n});\n\n\n/* ******************************************************************************\n * jQuery UI widget boilerplate\n */\n\n/**\n * The plugin (derrived from <a href=\" http://api.jqueryui.com/jQuery.widget/\">jQuery.Widget</a>).<br>\n * This constructor is not called directly. Use `$(selector).fancytree({})`\n * to initialize the plugin instead.<br>\n * <pre class=\"sh_javascript sunlight-highlight-javascript\">// Access widget methods and members:\n * var tree = $(\"#tree\").fancytree(\"getTree\");\n * var node = $(\"#tree\").fancytree(\"getActiveNode\", \"1234\");\n * </pre>\n *\n * @mixin Fancytree_Widget\n */\n\n$.widget(\"ui.fancytree\",\n\t/** @lends Fancytree_Widget# */\n\t{\n\t/**These options will be used as defaults\n\t * @type {FancytreeOptions}\n\t */\n\toptions:\n\t{\n\t\tactiveVisible: true,\n\t\tajax: {\n\t\t\ttype: \"GET\",\n\t\t\tcache: false, // false: Append random '_' argument to the request url to prevent caching.\n//          timeout: 0, // >0: Make sure we get an ajax error if server is unreachable\n\t\t\tdataType: \"json\" // Expect json format and pass json object to callbacks.\n\t\t},  //\n\t\taria: false, // TODO: default to true\n\t\tautoActivate: true,\n\t\tautoCollapse: false,\n//      autoFocus: false,\n\t\tautoScroll: false,\n\t\tcheckbox: false,\n\t\t/**defines click behavior*/\n\t\tclickFolderMode: 4,\n\t\tdebugLevel: null, // 0..2 (null: use global setting $.ui.fancytree.debugInfo)\n\t\tdisabled: false, // TODO: required anymore?\n\t\tenableAspx: true, // TODO: document\n\t\tescapeTitles: false,\n\t\textensions: [],\n\t\t// fx: { height: \"toggle\", duration: 200 },\n\t\t// toggleEffect: { effect: \"drop\", options: {direction: \"left\"}, duration: 200 },\n\t\t// toggleEffect: { effect: \"slide\", options: {direction: \"up\"}, duration: 200 },\n\t\ttoggleEffect: { effect: \"blind\", options: {direction: \"vertical\", scale: \"box\"}, duration: 200 },\n\t\tgenerateIds: false,\n\t\ticon: true,\n\t\tidPrefix: \"ft_\",\n\t\tfocusOnSelect: false,\n\t\tkeyboard: true,\n\t\tkeyPathSeparator: \"/\",\n\t\tminExpandLevel: 1,\n\t\tquicksearch: false,\n\t\tscrollOfs: {top: 0, bottom: 0},\n\t\tscrollParent: null,\n\t\tselectMode: 2,\n\t\tstrings: {\n\t\t\tloading: \"Loading&#8230;\",\n\t\t\tloadError: \"Load error!\",\n\t\t\tmoreData: \"More&#8230;\",\n\t\t\tnoData: \"No data.\"\n\t\t},\n\t\t// tabbable: true,  // @deprecated\n\t\ttabindex: \"0\",\n\t\ttitlesTabbable: false,\n\t\t_classNames: {\n\t\t\tnode: \"fancytree-node\",\n\t\t\tfolder: \"fancytree-folder\",\n\t\t\tcombinedExpanderPrefix: \"fancytree-exp-\",\n\t\t\tcombinedIconPrefix: \"fancytree-ico-\",\n\t\t\thasChildren: \"fancytree-has-children\",\n\t\t\tactive: \"fancytree-active\",\n\t\t\tselected: \"fancytree-selected\",\n\t\t\texpanded: \"fancytree-expanded\",\n\t\t\tlazy: \"fancytree-lazy\",\n\t\t\tfocused: \"fancytree-focused\",\n\t\t\tpartload: \"fancytree-partload\",\n\t\t\tpartsel: \"fancytree-partsel\",\n\t\t\tunselectable: \"fancytree-unselectable\",\n\t\t\tlastsib: \"fancytree-lastsib\",\n\t\t\tloading: \"fancytree-loading\",\n\t\t\terror: \"fancytree-error\",\n\t\t\tstatusNodePrefix: \"fancytree-statusnode-\"\n\t\t},\n\t\t// events\n\t\tlazyLoad: null,\n\t\tpostProcess: null\n\t},\n\t/* Set up the widget, Called on first $().fancytree() */\n\t_create: function() {\n\t\tthis.tree = new Fancytree(this);\n\n\t\tthis.$source = this.source || this.element.data(\"type\") === \"json\" ? this.element\n\t\t\t: this.element.find(\">ul:first\");\n\t\t// Subclass Fancytree instance with all enabled extensions\n\t\tvar extension, extName, i,\n\t\t\topts = this.options,\n\t\t\textensions = opts.extensions,\n\t\t\tbase = this.tree;\n\n\t\tfor(i=0; i<extensions.length; i++){\n\t\t\textName = extensions[i];\n\t\t\textension = $.ui.fancytree._extensions[extName];\n\t\t\tif(!extension){\n\t\t\t\t$.error(\"Could not apply extension '\" + extName + \"' (it is not registered, did you forget to include it?)\");\n\t\t\t}\n\t\t\t// Add extension options as tree.options.EXTENSION\n//\t\t\t_assert(!this.tree.options[extName], \"Extension name must not exist as option name: \" + extName);\n\t\t\tthis.tree.options[extName] = $.extend(true, {}, extension.options, this.tree.options[extName]);\n\t\t\t// Add a namespace tree.ext.EXTENSION, to hold instance data\n\t\t\t_assert(this.tree.ext[extName] === undefined, \"Extension name must not exist as Fancytree.ext attribute: '\" + extName + \"'\");\n//\t\t\tthis.tree[extName] = extension;\n\t\t\tthis.tree.ext[extName] = {};\n\t\t\t// Subclass Fancytree methods using proxies.\n\t\t\t_subclassObject(this.tree, base, extension, extName);\n\t\t\t// current extension becomes base for the next extension\n\t\t\tbase = extension;\n\t\t}\n\t\t//\n\t\tif( opts.icons !== undefined ) {  // 2015-11-16\n\t\t\tif( opts.icon !== true ) {\n\t\t\t\t$.error(\"'icons' tree option is deprecated since v2.14.0: use 'icon' only instead\");\n\t\t\t} else {\n\t\t\t\tthis.tree.warn(\"'icons' tree option is deprecated since v2.14.0: use 'icon' instead\");\n\t\t\t\topts.icon = opts.icons;\n\t\t\t}\n\t\t}\n\t\tif( opts.iconClass !== undefined ) {  // 2015-11-16\n\t\t\tif( opts.icon ) {\n\t\t\t\t$.error(\"'iconClass' tree option is deprecated since v2.14.0: use 'icon' only instead\");\n\t\t\t} else {\n\t\t\t\tthis.tree.warn(\"'iconClass' tree option is deprecated since v2.14.0: use 'icon' instead\");\n\t\t\t\topts.icon = opts.iconClass;\n\t\t\t}\n\t\t}\n\t\tif( opts.tabbable !== undefined ) {  // 2016-04-04\n\t\t\topts.tabindex = opts.tabbable ? \"0\" : \"-1\";\n\t\t\tthis.tree.warn(\"'tabbable' tree option is deprecated since v2.17.0: use 'tabindex='\" + opts.tabindex + \"' instead\");\n\t\t}\n\t\t//\n\t\tthis.tree._callHook(\"treeCreate\", this.tree);\n\t\t// Note: 'fancytreecreate' event is fired by widget base class\n//        this.tree._triggerTreeEvent(\"create\");\n\t},\n\n\t/* Called on every $().fancytree() */\n\t_init: function() {\n\t\tthis.tree._callHook(\"treeInit\", this.tree);\n\t\t// TODO: currently we call bind after treeInit, because treeInit\n\t\t// might change tree.$container.\n\t\t// It would be better, to move ebent binding into hooks altogether\n\t\tthis._bind();\n\t},\n\n\t/* Use the _setOption method to respond to changes to options */\n\t_setOption: function(key, value) {\n\t\tvar callDefault = true,\n\t\t\trerender = false;\n\t\tswitch( key ) {\n\t\tcase \"aria\":\n\t\tcase \"checkbox\":\n\t\tcase \"icon\":\n\t\tcase \"minExpandLevel\":\n\t\t// case \"tabbable\":\n\t\tcase \"tabindex\":\n//\t\tcase \"nolink\":\n\t\t\tthis.tree._callHook(\"treeCreate\", this.tree);\n\t\t\trerender = true;\n\t\t\tbreak;\n\t\tcase \"escapeTitles\":\n\t\t\trerender = true;\n\t\t\tbreak;\n\t\tcase \"source\":\n\t\t\tcallDefault = false;\n\t\t\tthis.tree._callHook(\"treeLoad\", this.tree, value);\n\t\t\tbreak;\n\t\t}\n\t\tthis.tree.debug(\"set option \" + key + \"=\" + value + \" <\" + typeof(value) + \">\");\n\t\tif(callDefault){\n\t\t\t// In jQuery UI 1.8, you have to manually invoke the _setOption method from the base widget\n\t\t\t$.Widget.prototype._setOption.apply(this, arguments);\n\t\t\t// TODO: In jQuery UI 1.9 and above, you use the _super method instead\n//          this._super( \"_setOption\", key, value );\n\t\t}\n\t\tif(rerender){\n\t\t\tthis.tree.render(true, false);  // force, not-deep\n\t\t}\n\t},\n\n\t/** Use the destroy method to clean up any modifications your widget has made to the DOM */\n\tdestroy: function() {\n\t\tthis._unbind();\n\t\tthis.tree._callHook(\"treeDestroy\", this.tree);\n\t\t// In jQuery UI 1.8, you must invoke the destroy method from the base widget\n\t\t$.Widget.prototype.destroy.call(this);\n\t\t// TODO: delete tree and nodes to make garbage collect easier?\n\t\t// TODO: In jQuery UI 1.9 and above, you would define _destroy instead of destroy and not call the base method\n\t},\n\n\t// -------------------------------------------------------------------------\n\n\t/* Remove all event handlers for our namespace */\n\t_unbind: function() {\n\t\tvar ns = this.tree._ns;\n\t\tthis.element.unbind(ns);\n\t\tthis.tree.$container.unbind(ns);\n\t\t$(document).unbind(ns);\n\t},\n\t/* Add mouse and kyboard handlers to the container */\n\t_bind: function() {\n\t\tvar that = this,\n\t\t\topts = this.options,\n\t\t\ttree = this.tree,\n\t\t\tns = tree._ns\n\t\t\t// selstartEvent = ( $.support.selectstart ? \"selectstart\" : \"mousedown\" )\n\t\t\t;\n\n\t\t// Remove all previuous handlers for this tree\n\t\tthis._unbind();\n\n\t\t//alert(\"keydown\" + ns + \"foc=\" + tree.hasFocus() + tree.$container);\n\t\t// tree.debug(\"bind events; container: \", tree.$container);\n\t\ttree.$container.on(\"focusin\" + ns + \" focusout\" + ns, function(event){\n\t\t\tvar node = FT.getNode(event),\n\t\t\t\tflag = (event.type === \"focusin\");\n\t\t\t// tree.debug(\"Tree container got event \" + event.type, node, event);\n\t\t\t// tree.treeOnFocusInOut.call(tree, event);\n\t\t\tif(node){\n\t\t\t\t// For example clicking into an <input> that is part of a node\n\t\t\t\ttree._callHook(\"nodeSetFocus\", node, flag);\n\t\t\t}else{\n\t\t\t\ttree._callHook(\"treeSetFocus\", tree, flag);\n\t\t\t}\n\t\t}).on(\"selectstart\" + ns, \"span.fancytree-title\", function(event){\n\t\t\t// prevent mouse-drags to select text ranges\n\t\t\t// tree.debug(\"<span title> got event \" + event.type);\n\t\t\tevent.preventDefault();\n\t\t}).on(\"keydown\" + ns, function(event){\n\t\t\t// TODO: also bind keyup and keypress\n\t\t\t// tree.debug(\"got event \" + event.type + \", hasFocus:\" + tree.hasFocus());\n\t\t\t// if(opts.disabled || opts.keyboard === false || !tree.hasFocus() ){\n\t\t\tif(opts.disabled || opts.keyboard === false ){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tvar res,\n\t\t\t\tnode = tree.focusNode, // node may be null\n\t\t\t\tctx = tree._makeHookContext(node || tree, event),\n\t\t\t\tprevPhase = tree.phase;\n\n\t\t\ttry {\n\t\t\t\ttree.phase = \"userEvent\";\n\t\t\t\t// If a 'fancytreekeydown' handler returns false, skip the default\n\t\t\t\t// handling (implemented by tree.nodeKeydown()).\n\t\t\t\tif(node){\n\t\t\t\t\tres = tree._triggerNodeEvent(\"keydown\", node, event);\n\t\t\t\t}else{\n\t\t\t\t\tres = tree._triggerTreeEvent(\"keydown\", event);\n\t\t\t\t}\n\t\t\t\tif ( res === \"preventNav\" ){\n\t\t\t\t\tres = true; // prevent keyboard navigation, but don't prevent default handling of embedded input controls\n\t\t\t\t} else if ( res !== false ){\n\t\t\t\t\tres = tree._callHook(\"nodeKeydown\", ctx);\n\t\t\t\t}\n\t\t\t\treturn res;\n\t\t\t} finally {\n\t\t\t\ttree.phase = prevPhase;\n\t\t\t}\n\t\t}).on(\"click\" + ns + \" dblclick\" + ns, function(event){\n\t\t\t// that.tree.debug(\"event(\" + event + \"): !\");\n\t\t\tif(opts.disabled){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tvar ctx,\n\t\t\t\tet = FT.getEventTarget(event),\n\t\t\t\tnode = et.node,\n\t\t\t\ttree = that.tree,\n\t\t\t\tprevPhase = tree.phase;\n\n\t\t\t// that.tree.debug(\"event(\" + event.type + \"): node: \", node);\n\t\t\tif( !node ){\n\t\t\t\treturn true;  // Allow bubbling of other events\n\t\t\t}\n\t\t\tctx = tree._makeHookContext(node, event);\n\t\t\t// that.tree.debug(\"event(\" + event.type + \"): node: \", node);\n\t\t\ttry {\n\t\t\t\ttree.phase = \"userEvent\";\n\t\t\t\tswitch(event.type) {\n\t\t\t\tcase \"click\":\n\t\t\t\t\tctx.targetType = et.type;\n\t\t\t\t\tif( node.isPagingNode() ) {\n\t\t\t\t\t\treturn tree._triggerNodeEvent(\"clickPaging\", ctx, event) === true;\n\t\t\t\t\t}\n\t\t\t\t\treturn ( tree._triggerNodeEvent(\"click\", ctx, event) === false ) ? false : tree._callHook(\"nodeClick\", ctx);\n\t\t\t\tcase \"dblclick\":\n\t\t\t\t\tctx.targetType = et.type;\n\t\t\t\t\treturn ( tree._triggerNodeEvent(\"dblclick\", ctx, event) === false ) ? false : tree._callHook(\"nodeDblclick\", ctx);\n\t\t\t\t}\n//             } catch(e) {\n// //                var _ = null; // DT issue 117 // TODO\n//                 $.error(e);\n\t\t\t} finally {\n\t\t\t\ttree.phase = prevPhase;\n\t\t\t}\n\t\t});\n\t},\n\t/** Return the active node or null.\n\t * @returns {FancytreeNode}\n\t */\n\tgetActiveNode: function() {\n\t\treturn this.tree.activeNode;\n\t},\n\t/** Return the matching node or null.\n\t * @param {string} key\n\t * @returns {FancytreeNode}\n\t */\n\tgetNodeByKey: function(key) {\n\t\treturn this.tree.getNodeByKey(key);\n\t},\n\t/** Return the invisible system root node.\n\t * @returns {FancytreeNode}\n\t */\n\tgetRootNode: function() {\n\t\treturn this.tree.rootNode;\n\t},\n\t/** Return the current tree instance.\n\t * @returns {Fancytree}\n\t */\n\tgetTree: function() {\n\t\treturn this.tree;\n\t}\n});\n\n// $.ui.fancytree was created by the widget factory. Create a local shortcut:\nFT = $.ui.fancytree;\n\n/**\n * Static members in the `$.ui.fancytree` namespace.<br>\n * <br>\n * <pre class=\"sh_javascript sunlight-highlight-javascript\">// Access static members:\n * var node = $.ui.fancytree.getNode(element);\n * alert($.ui.fancytree.version);\n * </pre>\n *\n * @mixin Fancytree_Static\n */\n$.extend($.ui.fancytree,\n\t/** @lends Fancytree_Static# */\n\t{\n\t/** @type {string} */\n\tversion: \"2.18.0\",      // Set to semver by 'grunt release'\n\t/** @type {string} */\n\tbuildType: \"production\", // Set to 'production' by 'grunt build'\n\t/** @type {int} */\n\tdebugLevel: 1,            // Set to 1 by 'grunt build'\n\t\t\t\t\t\t\t  // Used by $.ui.fancytree.debug() and as default for tree.options.debugLevel\n\n\t_nextId: 1,\n\t_nextNodeKey: 1,\n\t_extensions: {},\n\t// focusTree: null,\n\n\t/** Expose class object as $.ui.fancytree._FancytreeClass */\n\t_FancytreeClass: Fancytree,\n\t/** Expose class object as $.ui.fancytree._FancytreeNodeClass */\n\t_FancytreeNodeClass: FancytreeNode,\n\t/* Feature checks to provide backwards compatibility */\n\tjquerySupports: {\n\t\t// http://jqueryui.com/upgrade-guide/1.9/#deprecated-offset-option-merged-into-my-and-at\n\t\tpositionMyOfs: isVersionAtLeast($.ui.version, 1, 9)\n\t\t},\n\t/** Throw an error if condition fails (debug method).\n\t * @param {boolean} cond\n\t * @param {string} msg\n\t */\n\tassert: function(cond, msg){\n\t\treturn _assert(cond, msg);\n\t},\n\t/** Return a function that executes *fn* at most every *timeout* ms.\n\t * @param {integer} timeout\n\t * @param {function} fn\n\t * @param {boolean} [invokeAsap=false]\n\t * @param {any} [ctx]\n\t */\n\tdebounce: function(timeout, fn, invokeAsap, ctx) {\n\t\tvar timer;\n\t\tif(arguments.length === 3 && typeof invokeAsap !== \"boolean\") {\n\t\t\tctx = invokeAsap;\n\t\t\tinvokeAsap = false;\n\t\t}\n\t\treturn function() {\n\t\t\tvar args = arguments;\n\t\t\tctx = ctx || this;\n\t\t\tinvokeAsap && !timer && fn.apply(ctx, args);\n\t\t\tclearTimeout(timer);\n\t\t\ttimer = setTimeout(function() {\n\t\t\t\tinvokeAsap || fn.apply(ctx, args);\n\t\t\t\ttimer = null;\n\t\t\t}, timeout);\n\t\t};\n\t},\n\t/** Write message to console if debugLevel >= 2\n\t * @param {string} msg\n\t */\n\tdebug: function(msg){\n\t\t/*jshint expr:true */\n\t\t($.ui.fancytree.debugLevel >= 2) && consoleApply(\"log\", arguments);\n\t},\n\t/** Write error message to console.\n\t * @param {string} msg\n\t */\n\terror: function(msg){\n\t\tconsoleApply(\"error\", arguments);\n\t},\n\t/** Convert &lt;, &gt;, &amp;, &quot;, &#39;, &#x2F; to the equivalent entities.\n\t *\n\t * @param {string} s\n\t * @returns {string}\n\t */\n\tescapeHtml: _escapeHtml,\n\t/** Make jQuery.position() arguments backwards compatible, i.e. if\n\t * jQuery UI version <= 1.8, convert\n\t *   { my: \"left+3 center\", at: \"left bottom\", of: $target }\n\t * to\n\t *   { my: \"left center\", at: \"left bottom\", of: $target, offset: \"3  0\" }\n\t *\n\t * See http://jqueryui.com/upgrade-guide/1.9/#deprecated-offset-option-merged-into-my-and-at\n\t * and http://jsfiddle.net/mar10/6xtu9a4e/\n\t */\n\tfixPositionOptions: function(opts) {\n\t\tif( opts.offset || (\"\" + opts.my + opts.at ).indexOf(\"%\") >= 0 ) {\n\t\t   $.error(\"expected new position syntax (but '%' is not supported)\");\n\t\t}\n\t\tif( ! $.ui.fancytree.jquerySupports.positionMyOfs ) {\n\t\t\tvar // parse 'left+3 center' into ['left+3 center', 'left', '+3', 'center', undefined]\n\t\t\t\tmyParts = /(\\w+)([+-]?\\d+)?\\s+(\\w+)([+-]?\\d+)?/.exec(opts.my),\n\t\t\t\tatParts = /(\\w+)([+-]?\\d+)?\\s+(\\w+)([+-]?\\d+)?/.exec(opts.at),\n\t\t\t\t// convert to numbers\n\t\t\t\tdx = (myParts[2] ? (+myParts[2]) : 0) + (atParts[2] ? (+atParts[2]) : 0),\n\t\t\t\tdy = (myParts[4] ? (+myParts[4]) : 0) + (atParts[4] ? (+atParts[4]) : 0);\n\n\t\t\topts = $.extend({}, opts, { // make a copy and overwrite\n\t\t\t\tmy: myParts[1] + \" \" + myParts[3],\n\t\t\t\tat: atParts[1] + \" \" + atParts[3]\n\t\t\t});\n\t\t\tif( dx || dy ) {\n\t\t\t\topts.offset = \"\" + dx + \" \" + dy;\n\t\t\t}\n\t\t}\n\t\treturn opts;\n\t},\n\t/** Return a {node: FancytreeNode, type: TYPE} object for a mouse event.\n\t *\n\t * @param {Event} event Mouse event, e.g. click, ...\n\t * @returns {string} 'title' | 'prefix' | 'expander' | 'checkbox' | 'icon' | undefined\n\t */\n\tgetEventTargetType: function(event){\n\t\treturn this.getEventTarget(event).type;\n\t},\n\t/** Return a {node: FancytreeNode, type: TYPE} object for a mouse event.\n\t *\n\t * @param {Event} event Mouse event, e.g. click, ...\n\t * @returns {object} Return a {node: FancytreeNode, type: TYPE} object\n\t *     TYPE: 'title' | 'prefix' | 'expander' | 'checkbox' | 'icon' | undefined\n\t */\n\tgetEventTarget: function(event){\n\t\tvar tcn = event && event.target ? event.target.className : \"\",\n\t\t\tres = {node: this.getNode(event.target), type: undefined};\n\t\t// We use a fast version of $(res.node).hasClass()\n\t\t// See http://jsperf.com/test-for-classname/2\n\t\tif( /\\bfancytree-title\\b/.test(tcn) ){\n\t\t\tres.type = \"title\";\n\t\t}else if( /\\bfancytree-expander\\b/.test(tcn) ){\n\t\t\tres.type = (res.node.hasChildren() === false ? \"prefix\" : \"expander\");\n\t\t}else if( /\\bfancytree-checkbox\\b/.test(tcn) || /\\bfancytree-radio\\b/.test(tcn) ){\n\t\t\tres.type = \"checkbox\";\n\t\t}else if( /\\bfancytree-icon\\b/.test(tcn) ){\n\t\t\tres.type = \"icon\";\n\t\t}else if( /\\bfancytree-node\\b/.test(tcn) ){\n\t\t\t// Somewhere near the title\n\t\t\tres.type = \"title\";\n\t\t}else if( event && event.target && $(event.target).closest(\".fancytree-title\").length ) {\n\t\t\t// #228: clicking an embedded element inside a title\n\t\t\tres.type = \"title\";\n\t\t}\n\t\treturn res;\n\t},\n\t/** Return a FancytreeNode instance from element, event, or jQuery object.\n\t *\n\t * @param {Element | jQueryObject | Event} el\n\t * @returns {FancytreeNode} matching node or null\n\t */\n\tgetNode: function(el){\n\t\tif(el instanceof FancytreeNode){\n\t\t\treturn el; // el already was a FancytreeNode\n\t\t}else if(el.selector !== undefined){\n\t\t\tel = el[0]; // el was a jQuery object: use the DOM element\n\t\t}else if(el.originalEvent !== undefined){\n\t\t\tel = el.target; // el was an Event\n\t\t}\n\t\twhile( el ) {\n\t\t\tif(el.ftnode) {\n\t\t\t\treturn el.ftnode;\n\t\t\t}\n\t\t\tel = el.parentNode;\n\t\t}\n\t\treturn null;\n\t},\n\t/** Return a Fancytree instance, from element, index, event, or jQueryObject.\n\t *\n\t * @param {Element | jQueryObject | Event | integer | string} [el]\n\t * @returns {Fancytree} matching tree or null\n\t * @example\n\t * $.ui.fancytree.getTree();   // Get first Fancytree instance on page\n\t * $.ui.fancytree.getTree(1);  // Get second Fancytree instance on page\n\t * $.ui.fancytree.getTree(\"#tree\"); // Get tree for this matching element\n\t *\n\t * @since 2.13\n\t */\n\tgetTree: function(el){\n\t\tvar widget;\n\n\t\tif( el instanceof Fancytree ) {\n\t\t\treturn el; // el already was a Fancytree\n\t\t}\n\t\tif( el === undefined ) {\n\t\t\tel = 0;  // get first tree\n\t\t}\n\t\tif( typeof el === \"number\" ) {\n\t\t\tel = $(\".fancytree-container\").eq(el); // el was an integer: return nth instance\n\t\t} else if( typeof el === \"string\" ) {\n\t\t\tel = $(el).eq(0); // el was a selector: use first match\n\t\t} else if( el.selector !== undefined ) {\n\t\t\tel = el.eq(0); // el was a jQuery object: use the first DOM element\n\t\t} else if( el.originalEvent !== undefined ) {\n\t\t\tel = $(el.target); // el was an Event\n\t\t}\n\t\tel = el.closest(\":ui-fancytree\");\n\t\twidget = el.data(\"ui-fancytree\") || el.data(\"fancytree\"); // the latter is required by jQuery <= 1.8\n\t\treturn widget ? widget.tree : null;\n\t},\n\t/** Write message to console if debugLevel >= 1\n\t * @param {string} msg\n\t */\n\tinfo: function(msg){\n\t\t/*jshint expr:true */\n\t\t($.ui.fancytree.debugLevel >= 1) && consoleApply(\"info\", arguments);\n\t},\n\t/** Convert a keydown or mouse event to a canonical string like 'ctrl+a', 'ctrl+shift+f2', 'shift+leftdblclick'.\n\t * This is especially handy for switch-statements in event handlers.\n\t * @param {event}\n\t * @returns {string}\n\t */\n\teventToString: function(event) {\n\t\t// Poor-man's hotkeys. See here for a complete implementation:\n\t\t//   https://github.com/jeresig/jquery.hotkeys\n\t\tvar which = event.which,\n\t\t\tet = event.type,\n\t\t\ts = [];\n\n\t\tif( event.altKey ) { s.push(\"alt\"); }\n\t\tif( event.ctrlKey ) { s.push(\"ctrl\"); }\n\t\tif( event.metaKey ) { s.push(\"meta\"); }\n\t\tif( event.shiftKey ) { s.push(\"shift\"); }\n\n\t\tif( et === \"click\" || et === \"dblclick\" ) {\n\t\t\ts.push(MOUSE_BUTTONS[event.button] + et);\n\t\t} else {\n\t\t\tif( !IGNORE_KEYCODES[which] ) {\n\t\t\t\ts.push( SPECIAL_KEYCODES[which] || String.fromCharCode(which).toLowerCase() );\n\t\t\t}\n\t\t}\n\t\treturn s.join(\"+\");\n\t},\n\t/* @deprecated: use eventToString(event) instead.\n\t */\n\tkeyEventToString: function(event) {\n\t\tthis.warn(\"keyEventToString() is deprecated: use eventToString()\");\n\t\treturn this.eventToString(event);\n\t},\n\t/**\n\t * Parse tree data from HTML <ul> markup\n\t *\n\t * @param {jQueryObject} $ul\n\t * @returns {NodeData[]}\n\t */\n\tparseHtml: function($ul) {\n\t\t// TODO: understand this:\n\t\t/*jshint validthis:true */\n\t\tvar classes, className, extraClasses, i, iPos, l, tmp, tmp2,\n\t\t\t$children = $ul.find(\">li\"),\n\t\t\tchildren = [];\n\n\t\t$children.each(function() {\n\t\t\tvar allData, lowerCaseAttr,\n\t\t\t\t$li = $(this),\n\t\t\t\t$liSpan = $li.find(\">span:first\", this),\n\t\t\t\t$liA = $liSpan.length ? null : $li.find(\">a:first\"),\n\t\t\t\td = { tooltip: null, data: {} };\n\n\t\t\tif( $liSpan.length ) {\n\t\t\t\td.title = $liSpan.html();\n\n\t\t\t} else if( $liA && $liA.length ) {\n\t\t\t\t// If a <li><a> tag is specified, use it literally and extract href/target.\n\t\t\t\td.title = $liA.html();\n\t\t\t\td.data.href = $liA.attr(\"href\");\n\t\t\t\td.data.target = $liA.attr(\"target\");\n\t\t\t\td.tooltip = $liA.attr(\"title\");\n\n\t\t\t} else {\n\t\t\t\t// If only a <li> tag is specified, use the trimmed string up to\n\t\t\t\t// the next child <ul> tag.\n\t\t\t\td.title = $li.html();\n\t\t\t\tiPos = d.title.search(/<ul/i);\n\t\t\t\tif( iPos >= 0 ){\n\t\t\t\t\td.title = d.title.substring(0, iPos);\n\t\t\t\t}\n\t\t\t}\n\t\t\td.title = $.trim(d.title);\n\n\t\t\t// Make sure all fields exist\n\t\t\tfor(i=0, l=CLASS_ATTRS.length; i<l; i++){\n\t\t\t\td[CLASS_ATTRS[i]] = undefined;\n\t\t\t}\n\t\t\t// Initialize to `true`, if class is set and collect extraClasses\n\t\t\tclasses = this.className.split(\" \");\n\t\t\textraClasses = [];\n\t\t\tfor(i=0, l=classes.length; i<l; i++){\n\t\t\t\tclassName = classes[i];\n\t\t\t\tif(CLASS_ATTR_MAP[className]){\n\t\t\t\t\td[className] = true;\n\t\t\t\t}else{\n\t\t\t\t\textraClasses.push(className);\n\t\t\t\t}\n\t\t\t}\n\t\t\td.extraClasses = extraClasses.join(\" \");\n\n\t\t\t// Parse node options from ID, title and class attributes\n\t\t\ttmp = $li.attr(\"title\");\n\t\t\tif( tmp ){\n\t\t\t\td.tooltip = tmp; // overrides <a title='...'>\n\t\t\t}\n\t\t\ttmp = $li.attr(\"id\");\n\t\t\tif( tmp ){\n\t\t\t\td.key = tmp;\n\t\t\t}\n\t\t\t// Add <li data-NAME='...'> as node.data.NAME\n\t\t\tallData = _getElementDataAsDict($li);\n\t\t\tif( allData && !$.isEmptyObject(allData) ) {\n\t\t\t\t// #507: convert data-hidecheckbox (lower case) to hideCheckbox\n\t\t\t\tfor( lowerCaseAttr in NODE_ATTR_LOWERCASE_MAP ) {\n\t\t\t\t\tif( allData.hasOwnProperty(lowerCaseAttr) ) {\n\t\t\t\t\t\tallData[NODE_ATTR_LOWERCASE_MAP[lowerCaseAttr]] = allData[lowerCaseAttr];\n\t\t\t\t\t\tdelete allData[lowerCaseAttr];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// #56: Allow to set special node.attributes from data-...\n\t\t\t\tfor(i=0, l=NODE_ATTRS.length; i<l; i++){\n\t\t\t\t\ttmp = NODE_ATTRS[i];\n\t\t\t\t\ttmp2 = allData[tmp];\n\t\t\t\t\tif( tmp2 != null ) {\n\t\t\t\t\t\tdelete allData[tmp];\n\t\t\t\t\t\td[tmp] = tmp2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// All other data-... goes to node.data...\n\t\t\t\t$.extend(d.data, allData);\n\t\t\t}\n\t\t\t// Recursive reading of child nodes, if LI tag contains an UL tag\n\t\t\t$ul = $li.find(\">ul:first\");\n\t\t\tif( $ul.length ) {\n\t\t\t\td.children = $.ui.fancytree.parseHtml($ul);\n\t\t\t}else{\n\t\t\t\td.children = d.lazy ? undefined : null;\n\t\t\t}\n\t\t\tchildren.push(d);\n//            FT.debug(\"parse \", d, children);\n\t\t});\n\t\treturn children;\n\t},\n\t/** Add Fancytree extension definition to the list of globally available extensions.\n\t *\n\t * @param {object} definition\n\t */\n\tregisterExtension: function(definition){\n\t\t_assert(definition.name != null, \"extensions must have a `name` property.\");\n\t\t_assert(definition.version != null, \"extensions must have a `version` property.\");\n\t\t$.ui.fancytree._extensions[definition.name] = definition;\n\t},\n\t/** Inverse of escapeHtml().\n\t *\n\t * @param {string} s\n\t * @returns {string}\n\t */\n\tunescapeHtml: function(s){\n\t\tvar e = document.createElement(\"div\");\n\t\te.innerHTML = s;\n\t\treturn e.childNodes.length === 0 ? \"\" : e.childNodes[0].nodeValue;\n\t},\n\t/** Write warning message to console.\n\t * @param {string} msg\n\t */\n\twarn: function(msg){\n\t\tconsoleApply(\"warn\", arguments);\n\t}\n});\n\n}(jQuery, window, document));\n\n// Extending Fancytree\n// ===================\n//\n// See also the [live demo](http://wwwendt.de/tech/fancytree/demo/sample-ext-childcounter.html) of this code.\n//\n// Every extension should have a comment header containing some information\n// about the author, copyright and licensing. Also a pointer to the latest\n// source code.\n// Prefix with `/*!` so the comment is not removed by the minifier.\n\n/*!\n * jquery.fancytree.childcounter.js\n *\n * Add a child counter bubble to tree nodes.\n * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)\n *\n * Copyright (c) 2008-2016, Martin Wendt (http://wwWendt.de)\n *\n * Released under the MIT license\n * https://github.com/mar10/fancytree/wiki/LicenseInfo\n *\n * @version 2.18.0\n * @date 2016-05-02T19:34\n */\n\n// To keep the global namespace clean, we wrap everything in a closure\n\n;(function($, undefined) {\n\n// Consider to use [strict mode](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)\n\"use strict\";\n\n// The [coding guidelines](http://contribute.jquery.org/style-guide/js/)\n// require jshint compliance.\n// But for this sample, we want to allow unused variables for demonstration purpose.\n\n/*jshint unused:false */\n\n\n// Adding methods\n// --------------\n\n// New member functions can be added to the `Fancytree` class.\n// This function will be available for every tree instance:\n//\n//     var tree = $(\"#tree\").fancytree(\"getTree\");\n//     tree.countSelected(false);\n\n$.ui.fancytree._FancytreeClass.prototype.countSelected = function(topOnly){\n\tvar tree = this,\n\t\ttreeOptions = tree.options;\n\n\treturn tree.getSelectedNodes(topOnly).length;\n};\n\n\n// The `FancytreeNode` class can also be easily extended. This would be called\n// like\n//     node.updateCounters();\n//\n// It is also good practice to add a docstring comment.\n/**\n * [ext-childcounter] Update counter badges for `node` and its parents.\n * May be called in the `loadChildren` event, to update parents of lazy loaded\n * nodes.\n * @alias FancytreeNode#updateCounters\n * @requires jquery.fancytree.childcounters.js\n */\n$.ui.fancytree._FancytreeNodeClass.prototype.updateCounters = function(){\n\tvar node = this,\n\t\t$badge = $(\"span.fancytree-childcounter\", node.span),\n\t\textOpts = node.tree.options.childcounter,\n\t\tcount = node.countChildren(extOpts.deep);\n\n\tnode.data.childCounter = count;\n\tif( (count || !extOpts.hideZeros) && (!node.isExpanded() || !extOpts.hideExpanded) ) {\n\t\tif( !$badge.length ) {\n\t\t\t$badge = $(\"<span class='fancytree-childcounter'/>\").appendTo($(\"span.fancytree-icon\", node.span));\n\t\t}\n\t\t$badge.text(count);\n\t} else {\n\t\t$badge.remove();\n\t}\n\tif( extOpts.deep && !node.isTopLevel() && !node.isRoot() ) {\n\t\tnode.parent.updateCounters();\n\t}\n};\n\n\n// Finally, we can extend the widget API and create functions that are called\n// like so:\n//\n//     $(\"#tree\").fancytree(\"widgetMethod1\", \"abc\");\n\n$.ui.fancytree.prototype.widgetMethod1 = function(arg1){\n\tvar tree = this.tree;\n\treturn arg1;\n};\n\n\n// Register a Fancytree extension\n// ------------------------------\n// A full blown extension, extension is available for all trees and can be\n// enabled like so (see also the [live demo](http://wwwendt.de/tech/fancytree/demo/sample-ext-childcounter.html)):\n//\n//    <script src=\"../src/jquery.fancytree.js\" type=\"text/javascript\"></script>\n//    <script src=\"../src/jquery.fancytree.childcounter.js\" type=\"text/javascript\"></script>\n//    ...\n//\n//     $(\"#tree\").fancytree({\n//         extensions: [\"childcounter\"],\n//         childcounter: {\n//             hideExpanded: true\n//         },\n//         ...\n//     });\n//\n\n\n/* 'childcounter' extension */\n$.ui.fancytree.registerExtension({\n// Every extension must be registered by a unique name.\n\tname: \"childcounter\",\n// Version information should be compliant with [semver](http://semver.org)\n\tversion: \"1.0.0\",\n\n// Extension specific options and their defaults.\n// This options will be available as `tree.options.childcounter.hideExpanded`\n\n\toptions: {\n\t\tdeep: true,\n\t\thideZeros: true,\n\t\thideExpanded: false\n\t},\n\n// Attributes other than `options` (or functions) can be defined here, and\n// will be added to the tree.ext.EXTNAME namespace, in this case `tree.ext.childcounter.foo`.\n// They can also be accessed as `this._local.foo` from within the extension\n// methods.\n\tfoo: 42,\n\n// Local functions are prefixed with an underscore '_'.\n// Callable as `this._local._appendCounter()`.\n\n\t_appendCounter: function(bar){\n\t\tvar tree = this;\n\t},\n\n// **Override virtual methods for this extension.**\n//\n// Fancytree implements a number of 'hook methods', prefixed by 'node...' or 'tree...'.\n// with a `ctx` argument (see [EventData](http://www.wwwendt.de/tech/fancytree/doc/jsdoc/global.html#EventData)\n// for details) and an extended calling context:<br>\n// `this`       : the Fancytree instance<br>\n// `this._local`: the namespace that contains extension attributes and private methods (same as this.ext.EXTNAME)<br>\n// `this._super`: the virtual function that was overridden (member of previous extension or Fancytree)\n//\n// See also the [complete list of available hook functions](http://www.wwwendt.de/tech/fancytree/doc/jsdoc/Fancytree_Hooks.html).\n\n\t/* Init */\n// `treeInit` is triggered when a tree is initalized. We can set up classes or\n// bind event handlers here...\n\ttreeInit: function(ctx){\n\t\tvar tree = this, // same as ctx.tree,\n\t\t\topts = ctx.options,\n\t\t\textOpts = ctx.options.childcounter;\n// Optionally check for dependencies with other extensions\n\t\t/* this._requireExtension(\"glyph\", false, false); */\n// Call the base implementation\n\t\tthis._superApply(arguments);\n// Add a class to the tree container\n\t\tthis.$container.addClass(\"fancytree-ext-childcounter\");\n\t},\n\n// Destroy this tree instance (we only call the default implementation, so\n// this method could as well be omitted).\n\n\ttreeDestroy: function(ctx){\n\t\tthis._superApply(arguments);\n\t},\n\n// Overload the `renderTitle` hook, to append a counter badge\n\tnodeRenderTitle: function(ctx, title) {\n\t\tvar node = ctx.node,\n\t\t\textOpts = ctx.options.childcounter,\n\t\t\tcount = (node.data.childCounter == null) ? node.countChildren(extOpts.deep) : +node.data.childCounter;\n// Let the base implementation render the title\n\t\tthis._superApply(arguments);\n// Append a counter badge\n\t\tif( (count || ! extOpts.hideZeros) && (!node.isExpanded() || !extOpts.hideExpanded) ){\n\t\t\t$(\"span.fancytree-icon\", node.span).append($(\"<span class='fancytree-childcounter'/>\").text(count));\n\t\t}\n\t},\n// Overload the `setExpanded` hook, so the counters are updated\n\tnodeSetExpanded: function(ctx, flag, opts) {\n\t\tvar tree = ctx.tree,\n\t\t\tnode = ctx.node;\n// Let the base implementation expand/collapse the node, then redraw the title\n// after the animation has finished\n\t\treturn this._superApply(arguments).always(function(){\n\t\t\ttree.nodeRenderTitle(ctx);\n\t\t});\n\t}\n\n// End of extension definition\n});\n// End of namespace closure\n}(jQuery));\n\n/*!\n *\n * jquery.fancytree.clones.js\n * Support faster lookup of nodes by key and shared ref-ids.\n * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)\n *\n * Copyright (c) 2008-2016, Martin Wendt (http://wwWendt.de)\n *\n * Released under the MIT license\n * https://github.com/mar10/fancytree/wiki/LicenseInfo\n *\n * @version 2.18.0\n * @date 2016-05-02T19:34\n */\n\n;(function($, window, document, undefined) {\n\n\"use strict\";\n\n/*******************************************************************************\n * Private functions and variables\n */\nfunction _assert(cond, msg){\n\t// TODO: see qunit.js extractStacktrace()\n\tif(!cond){\n\t\tmsg = msg ? \": \" + msg : \"\";\n\t\t$.error(\"Assertion failed\" + msg);\n\t}\n}\n\n\n/* Return first occurrence of member from array. */\nfunction _removeArrayMember(arr, elem) {\n\t// TODO: use Array.indexOf for IE >= 9\n\tvar i;\n\tfor (i = arr.length - 1; i >= 0; i--) {\n\t\tif (arr[i] === elem) {\n\t\t\tarr.splice(i, 1);\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\n\n\n// /**\n//  * Calculate a 32 bit FNV-1a hash\n//  * Found here: https://gist.github.com/vaiorabbit/5657561\n//  * Ref.: http://isthe.com/chongo/tech/comp/fnv/\n//  *\n//  * @param {string} str the input value\n//  * @param {boolean} [asString=false] set to true to return the hash value as\n//  *     8-digit hex string instead of an integer\n//  * @param {integer} [seed] optionally pass the hash of the previous chunk\n//  * @returns {integer | string}\n//  */\n// function hashFnv32a(str, asString, seed) {\n// \t/*jshint bitwise:false */\n// \tvar i, l,\n// \t\thval = (seed === undefined) ? 0x811c9dc5 : seed;\n\n// \tfor (i = 0, l = str.length; i < l; i++) {\n// \t\thval ^= str.charCodeAt(i);\n// \t\thval += (hval << 1) + (hval << 4) + (hval << 7) + (hval << 8) + (hval << 24);\n// \t}\n// \tif( asString ){\n// \t\t// Convert to 8 digit hex string\n// \t\treturn (\"0000000\" + (hval >>> 0).toString(16)).substr(-8);\n// \t}\n// \treturn hval >>> 0;\n// }\n\n\n/**\n * JS Implementation of MurmurHash3 (r136) (as of May 20, 2011)\n *\n * @author <a href=\"mailto:gary.court@gmail.com\">Gary Court</a>\n * @see http://github.com/garycourt/murmurhash-js\n * @author <a href=\"mailto:aappleby@gmail.com\">Austin Appleby</a>\n * @see http://sites.google.com/site/murmurhash/\n *\n * @param {string} key ASCII only\n * @param {boolean} [asString=false]\n * @param {number} seed Positive integer only\n * @return {number} 32-bit positive integer hash\n */\nfunction hashMurmur3(key, asString, seed) {\n\t/*jshint bitwise:false */\n\tvar h1b, k1,\n\t\tremainder = key.length & 3,\n\t\tbytes = key.length - remainder,\n\t\th1 = seed,\n\t\tc1 = 0xcc9e2d51,\n\t\tc2 = 0x1b873593,\n\t\ti = 0;\n\n\twhile (i < bytes) {\n\t\tk1 =\n\t\t\t((key.charCodeAt(i) & 0xff)) |\n\t\t\t((key.charCodeAt(++i) & 0xff) << 8) |\n\t\t\t((key.charCodeAt(++i) & 0xff) << 16) |\n\t\t\t((key.charCodeAt(++i) & 0xff) << 24);\n\t\t++i;\n\n\t\tk1 = ((((k1 & 0xffff) * c1) + ((((k1 >>> 16) * c1) & 0xffff) << 16))) & 0xffffffff;\n\t\tk1 = (k1 << 15) | (k1 >>> 17);\n\t\tk1 = ((((k1 & 0xffff) * c2) + ((((k1 >>> 16) * c2) & 0xffff) << 16))) & 0xffffffff;\n\n\t\th1 ^= k1;\n\t\th1 = (h1 << 13) | (h1 >>> 19);\n\t\th1b = ((((h1 & 0xffff) * 5) + ((((h1 >>> 16) * 5) & 0xffff) << 16))) & 0xffffffff;\n\t\th1 = (((h1b & 0xffff) + 0x6b64) + ((((h1b >>> 16) + 0xe654) & 0xffff) << 16));\n\t}\n\n\tk1 = 0;\n\n\tswitch (remainder) {\n\t\t/*jshint -W086:true */\n\t\tcase 3: k1 ^= (key.charCodeAt(i + 2) & 0xff) << 16;\n\t\tcase 2: k1 ^= (key.charCodeAt(i + 1) & 0xff) << 8;\n\t\tcase 1: k1 ^= (key.charCodeAt(i) & 0xff);\n\n\t\tk1 = (((k1 & 0xffff) * c1) + ((((k1 >>> 16) * c1) & 0xffff) << 16)) & 0xffffffff;\n\t\tk1 = (k1 << 15) | (k1 >>> 17);\n\t\tk1 = (((k1 & 0xffff) * c2) + ((((k1 >>> 16) * c2) & 0xffff) << 16)) & 0xffffffff;\n\t\th1 ^= k1;\n\t}\n\n\th1 ^= key.length;\n\n\th1 ^= h1 >>> 16;\n\th1 = (((h1 & 0xffff) * 0x85ebca6b) + ((((h1 >>> 16) * 0x85ebca6b) & 0xffff) << 16)) & 0xffffffff;\n\th1 ^= h1 >>> 13;\n\th1 = ((((h1 & 0xffff) * 0xc2b2ae35) + ((((h1 >>> 16) * 0xc2b2ae35) & 0xffff) << 16))) & 0xffffffff;\n\th1 ^= h1 >>> 16;\n\n\tif( asString ){\n\t\t// Convert to 8 digit hex string\n\t\treturn (\"0000000\" + (h1 >>> 0).toString(16)).substr(-8);\n\t}\n\treturn h1 >>> 0;\n}\n\n// console.info(hashMurmur3(\"costarring\"));\n// console.info(hashMurmur3(\"costarring\", true));\n// console.info(hashMurmur3(\"liquid\"));\n// console.info(hashMurmur3(\"liquid\", true));\n\n\n/*\n * Return a unique key for node by calculationg the hash of the parents refKey-list\n */\nfunction calcUniqueKey(node) {\n\tvar key,\n\t\tpath = $.map(node.getParentList(false, true), function(e){ return e.refKey || e.key; });\n\tpath = path.join(\"/\");\n\tkey = \"id_\" + hashMurmur3(path, true);\n\t// node.debug(path + \" -> \" + key);\n\treturn key;\n}\n\n\n/**\n * [ext-clones] Return a list of clone-nodes or null.\n * @param {boolean} [includeSelf=false]\n * @returns {FancytreeNode[] | null}\n *\n * @alias FancytreeNode#getCloneList\n * @requires jquery.fancytree.clones.js\n */\n$.ui.fancytree._FancytreeNodeClass.prototype.getCloneList = function(includeSelf){\n\tvar key,\n\t\ttree = this.tree,\n\t\trefList = tree.refMap[this.refKey] || null,\n\t\tkeyMap = tree.keyMap;\n\n\tif( refList ) {\n\t\tkey = this.key;\n\t\t// Convert key list to node list\n\t\tif( includeSelf ) {\n\t\t\trefList = $.map(refList, function(val){ return keyMap[val]; });\n\t\t} else {\n\t\t\trefList = $.map(refList, function(val){ return val === key ? null : keyMap[val]; });\n\t\t\tif( refList.length < 1 ) {\n\t\t\t\trefList = null;\n\t\t\t}\n\t\t}\n\t}\n\treturn refList;\n};\n\n\n/**\n * [ext-clones] Return true if this node has at least another clone with same refKey.\n * @returns {boolean}\n *\n * @alias FancytreeNode#isClone\n * @requires jquery.fancytree.clones.js\n */\n$.ui.fancytree._FancytreeNodeClass.prototype.isClone = function(){\n\tvar refKey = this.refKey || null,\n\t\trefList = refKey && this.tree.refMap[refKey] || null;\n\treturn !!(refList && refList.length > 1);\n};\n\n\n/**\n * [ext-clones] Update key and/or refKey for an existing node.\n * @param {string} key\n * @param {string} refKey\n * @returns {boolean}\n *\n * @alias FancytreeNode#reRegister\n * @requires jquery.fancytree.clones.js\n */\n$.ui.fancytree._FancytreeNodeClass.prototype.reRegister = function(key, refKey){\n\tkey = (key == null) ? null :  \"\" + key;\n\trefKey = (refKey == null) ? null :  \"\" + refKey;\n\t// this.debug(\"reRegister\", key, refKey);\n\n\tvar tree = this.tree,\n\t\tprevKey = this.key,\n\t\tprevRefKey = this.refKey,\n\t\tkeyMap = tree.keyMap,\n\t\trefMap = tree.refMap,\n\t\trefList = refMap[prevRefKey] || null,\n//\t\tcurCloneKeys = refList ? node.getCloneList(true),\n\t\tmodified = false;\n\n\t// Key has changed: update all references\n\tif( key != null && key !== this.key ) {\n\t\tif( keyMap[key] ) {\n\t\t\t$.error(\"[ext-clones] reRegister(\" + key + \"): already exists: \" + this);\n\t\t}\n\t\t// Update keyMap\n\t\tdelete keyMap[prevKey];\n\t\tkeyMap[key] = this;\n\t\t// Update refMap\n\t\tif( refList ) {\n\t\t\trefMap[prevRefKey] = $.map(refList, function(e){\n\t\t\t\treturn e === prevKey ? key : e;\n\t\t\t});\n\t\t}\n\t\tthis.key = key;\n\t\tmodified = true;\n\t}\n\n\t// refKey has changed\n\tif( refKey != null && refKey !== this.refKey ) {\n\t\t// Remove previous refKeys\n\t\tif( refList ){\n\t\t\tif( refList.length === 1 ){\n\t\t\t\tdelete refMap[prevRefKey];\n\t\t\t}else{\n\t\t\t\trefMap[prevRefKey] = $.map(refList, function(e){\n\t\t\t\t\treturn e === prevKey ? null : e;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t// Add refKey\n\t\tif( refMap[refKey] ) {\n\t\t\trefMap[refKey].append(key);\n\t\t}else{\n\t\t\trefMap[refKey] = [ this.key ];\n\t\t}\n\t\tthis.refKey = refKey;\n\t\tmodified = true;\n\t}\n\treturn modified;\n};\n\n\n/**\n * [ext-clones] Define a refKey for an existing node.\n * @param {string} refKey\n * @returns {boolean}\n *\n * @alias FancytreeNode#setRefKey\n * @requires jquery.fancytree.clones.js\n * @since 2.16\n */\n$.ui.fancytree._FancytreeNodeClass.prototype.setRefKey = function(refKey){\n\treturn this.reRegister(null, refKey);\n};\n\n\n/**\n * [ext-clones] Return all nodes with a given refKey (null if not found).\n * @param {string} refKey\n * @param {FancytreeNode} [rootNode] optionally restrict results to descendants of this node\n * @returns {FancytreeNode[] | null}\n * @alias Fancytree#getNodesByRef\n * @requires jquery.fancytree.clones.js\n */\n$.ui.fancytree._FancytreeClass.prototype.getNodesByRef = function(refKey, rootNode){\n\tvar keyMap = this.keyMap,\n\t\trefList = this.refMap[refKey] || null;\n\n\tif( refList ) {\n\t\t// Convert key list to node list\n\t\tif( rootNode ) {\n\t\t\trefList = $.map(refList, function(val){\n\t\t\t\tvar node = keyMap[val];\n\t\t\t\treturn node.isDescendantOf(rootNode) ? node : null;\n\t\t\t});\n\t\t}else{\n\t\t\trefList = $.map(refList, function(val){ return keyMap[val]; });\n\t\t}\n\t\tif( refList.length < 1 ) {\n\t\t\trefList = null;\n\t\t}\n\t}\n\treturn refList;\n};\n\n\n/**\n * [ext-clones] Replace a refKey with a new one.\n * @param {string} oldRefKey\n * @param {string} newRefKey\n * @alias Fancytree#changeRefKey\n * @requires jquery.fancytree.clones.js\n */\n$.ui.fancytree._FancytreeClass.prototype.changeRefKey = function(oldRefKey, newRefKey) {\n\tvar i, node,\n\t\tkeyMap = this.keyMap,\n\t\trefList = this.refMap[oldRefKey] || null;\n\n\tif (refList) {\n\t\tfor (i = 0; i < refList.length; i++) {\n\t\t\tnode = keyMap[refList[i]];\n\t\t\tnode.refKey = newRefKey;\n\t\t}\n\t\tdelete this.refMap[oldRefKey];\n\t\tthis.refMap[newRefKey] = refList;\n\t}\n};\n\n\n/*******************************************************************************\n * Extension code\n */\n$.ui.fancytree.registerExtension({\n\tname: \"clones\",\n\tversion: \"0.0.3\",\n\t// Default options for this extension.\n\toptions: {\n\t\thighlightActiveClones: true, // set 'fancytree-active-clone' on active clones and all peers\n\t\thighlightClones: false       // set 'fancytree-clone' class on any node that has at least one clone\n\t},\n\n\ttreeCreate: function(ctx){\n\t\tthis._superApply(arguments);\n\t\tctx.tree.refMap = {};\n\t\tctx.tree.keyMap = {};\n\t},\n\ttreeInit: function(ctx){\n\t\tthis.$container.addClass(\"fancytree-ext-clones\");\n\t\t_assert(ctx.options.defaultKey == null);\n\t\t// Generate unique / reproducible default keys\n\t\tctx.options.defaultKey = function(node){\n\t\t\treturn calcUniqueKey(node);\n\t\t};\n\t\t// The default implementation loads initial data\n\t\tthis._superApply(arguments);\n\t},\n\ttreeClear: function(ctx){\n\t\tctx.tree.refMap = {};\n\t\tctx.tree.keyMap = {};\n\t\treturn this._superApply(arguments);\n\t},\n\ttreeRegisterNode: function(ctx, add, node) {\n\t\tvar refList, len,\n\t\t\ttree = ctx.tree,\n\t\t\tkeyMap = tree.keyMap,\n\t\t\trefMap = tree.refMap,\n\t\t\tkey = node.key,\n\t\t\trefKey = (node && node.refKey != null) ? \"\" + node.refKey : null;\n\n//\t\tctx.tree.debug(\"clones.treeRegisterNode\", add, node);\n\n\t\tif( node.isStatusNode() ){\n\t\t\treturn this._superApply(arguments);\n\t\t}\n\n\t\tif( add ) {\n\t\t\tif( keyMap[node.key] != null ) {\n\t\t\t\t$.error(\"clones.treeRegisterNode: node.key already exists: \" + node);\n\t\t\t}\n\t\t\tkeyMap[key] = node;\n\t\t\tif( refKey ) {\n\t\t\t\trefList = refMap[refKey];\n\t\t\t\tif( refList ) {\n\t\t\t\t\trefList.push(key);\n\t\t\t\t\tif( refList.length === 2 && ctx.options.clones.highlightClones ) {\n\t\t\t\t\t\t// Mark peer node, if it just became a clone (no need to\n\t\t\t\t\t\t// mark current node, since it will be rendered later anyway)\n\t\t\t\t\t\tkeyMap[refList[0]].renderStatus();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\trefMap[refKey] = [key];\n\t\t\t\t}\n\t\t\t\t// node.debug(\"clones.treeRegisterNode: add clone =>\", refMap[refKey]);\n\t\t\t}\n\t\t}else {\n\t\t\tif( keyMap[key] == null ) {\n\t\t\t\t$.error(\"clones.treeRegisterNode: node.key not registered: \" + node.key);\n\t\t\t}\n\t\t\tdelete keyMap[key];\n\t\t\tif( refKey ) {\n\t\t\t\trefList = refMap[refKey];\n\t\t\t\t// node.debug(\"clones.treeRegisterNode: remove clone BEFORE =>\", refMap[refKey]);\n\t\t\t\tif( refList ) {\n\t\t\t\t\tlen = refList.length;\n\t\t\t\t\tif( len <= 1 ){\n\t\t\t\t\t\t_assert(len === 1);\n\t\t\t\t\t\t_assert(refList[0] === key);\n\t\t\t\t\t\tdelete refMap[refKey];\n\t\t\t\t\t}else{\n\t\t\t\t\t\t_removeArrayMember(refList, key);\n\t\t\t\t\t\t// Unmark peer node, if this was the only clone\n\t\t\t\t\t\tif( len === 2 && ctx.options.clones.highlightClones ) {\n//\t\t\t\t\t\t\tnode.debug(\"clones.treeRegisterNode: last =>\", node.getCloneList());\n\t\t\t\t\t\t\tkeyMap[refList[0]].renderStatus();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// node.debug(\"clones.treeRegisterNode: remove clone =>\", refMap[refKey]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this._superApply(arguments);\n\t},\n\tnodeRenderStatus: function(ctx) {\n\t\tvar $span, res,\n\t\t\tnode = ctx.node;\n\n\t\tres = this._superApply(arguments);\n\n\t\tif( ctx.options.clones.highlightClones ) {\n\t\t\t$span = $(node[ctx.tree.statusClassPropName]);\n\t\t\t// Only if span already exists\n\t\t\tif( $span.length && node.isClone() ){\n//\t\t\t\tnode.debug(\"clones.nodeRenderStatus: \", ctx.options.clones.highlightClones);\n\t\t\t\t$span.addClass(\"fancytree-clone\");\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t},\n\tnodeSetActive: function(ctx, flag) {\n\t\tvar res,\n\t\t\tscpn = ctx.tree.statusClassPropName,\n\t\t\tnode = ctx.node;\n\n\t\tres = this._superApply(arguments);\n\n\t\tif( ctx.options.clones.highlightActiveClones && node.isClone() ) {\n\t\t\t$.each(node.getCloneList(true), function(idx, n){\n\t\t\t\t// n.debug(\"clones.nodeSetActive: \", flag !== false);\n\t\t\t\t$(n[scpn]).toggleClass(\"fancytree-active-clone\", flag !== false);\n\t\t\t});\n\t\t}\n\t\treturn res;\n\t}\n});\n}(jQuery, window, document));\n\n/*!\n * jquery.fancytree.dnd.js\n *\n * Drag-and-drop support.\n * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)\n *\n * Copyright (c) 2008-2016, Martin Wendt (http://wwWendt.de)\n *\n * Released under the MIT license\n * https://github.com/mar10/fancytree/wiki/LicenseInfo\n *\n * @version 2.18.0\n * @date 2016-05-02T19:34\n */\n\n;(function($, window, document, undefined) {\n\n\"use strict\";\n\n/* *****************************************************************************\n * Private functions and variables\n */\nvar didRegisterDnd = false,\n\tclassDropAccept = \"fancytree-drop-accept\",\n\tclassDropAfter = \"fancytree-drop-after\",\n\tclassDropBefore = \"fancytree-drop-before\",\n\tclassDropOver = \"fancytree-drop-over\",\n\tclassDropReject = \"fancytree-drop-reject\",\n\tclassDropTarget = \"fancytree-drop-target\";\n\n/* Convert number to string and prepend +/-; return empty string for 0.*/\nfunction offsetString(n){\n\treturn n === 0 ? \"\" : (( n > 0 ) ? (\"+\" + n) : (\"\" + n));\n}\n\n//--- Extend ui.draggable event handling --------------------------------------\n\nfunction _registerDnd() {\n\tif(didRegisterDnd){\n\t\treturn;\n\t}\n\n\t// Register proxy-functions for draggable.start/drag/stop\n\n\t$.ui.plugin.add(\"draggable\", \"connectToFancytree\", {\n\t\tstart: function(event, ui) {\n\t\t\t// 'draggable' was renamed to 'ui-draggable' since jQueryUI 1.10\n\t\t\tvar draggable = $(this).data(\"ui-draggable\") || $(this).data(\"draggable\"),\n\t\t\t\tsourceNode = ui.helper.data(\"ftSourceNode\") || null;\n\n\t\t\tif(sourceNode) {\n\t\t\t\t// Adjust helper offset, so cursor is slightly outside top/left corner\n\t\t\t\tdraggable.offset.click.top = -2;\n\t\t\t\tdraggable.offset.click.left = + 16;\n\t\t\t\t// Trigger dragStart event\n\t\t\t\t// TODO: when called as connectTo..., the return value is ignored(?)\n\t\t\t\treturn sourceNode.tree.ext.dnd._onDragEvent(\"start\", sourceNode, null, event, ui, draggable);\n\t\t\t}\n\t\t},\n\t\tdrag: function(event, ui) {\n\t\t\tvar ctx, isHelper, logObject,\n\t\t\t\t// 'draggable' was renamed to 'ui-draggable' since jQueryUI 1.10\n\t\t\t\tdraggable = $(this).data(\"ui-draggable\") || $(this).data(\"draggable\"),\n\t\t\t\tsourceNode = ui.helper.data(\"ftSourceNode\") || null,\n\t\t\t\tprevTargetNode = ui.helper.data(\"ftTargetNode\") || null,\n\t\t\t\ttargetNode = $.ui.fancytree.getNode(event.target),\n\t\t\t\tdndOpts = sourceNode && sourceNode.tree.options.dnd;\n\n\t\t\t// logObject = sourceNode || prevTargetNode || $.ui.fancytree;\n\t\t\t// logObject.debug(\"Drag event:\", event, event.shiftKey);\n\t\t\tif(event.target && !targetNode){\n\t\t\t\t// We got a drag event, but the targetNode could not be found\n\t\t\t\t// at the event location. This may happen,\n\t\t\t\t// 1. if the mouse jumped over the drag helper,\n\t\t\t\t// 2. or if a non-fancytree element is dragged\n\t\t\t\t// We ignore it:\n\t\t\t\tisHelper = $(event.target).closest(\"div.fancytree-drag-helper,#fancytree-drop-marker\").length > 0;\n\t\t\t\tif(isHelper){\n\t\t\t\t\tlogObject = sourceNode || prevTargetNode || $.ui.fancytree;\n\t\t\t\t\tlogObject.debug(\"Drag event over helper: ignored.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tui.helper.data(\"ftTargetNode\", targetNode);\n\n\t\t\tif( dndOpts && dndOpts.updateHelper ) {\n\t\t\t\tctx = sourceNode.tree._makeHookContext(sourceNode, event, {\n\t\t\t\t\totherNode: targetNode,\n\t\t\t\t\tui: ui,\n\t\t\t\t\tdraggable: draggable,\n\t\t\t\t\tdropMarker: $(\"#fancytree-drop-marker\")\n\t\t\t\t});\n\t\t\t\tdndOpts.updateHelper.call(sourceNode.tree, sourceNode, ctx);\n\t\t\t}\n\n\t\t\t// Leaving a tree node\n\t\t\tif(prevTargetNode && prevTargetNode !== targetNode ) {\n\t\t\t\tprevTargetNode.tree.ext.dnd._onDragEvent(\"leave\", prevTargetNode, sourceNode, event, ui, draggable);\n\t\t\t}\n\t\t\tif(targetNode){\n\t\t\t\tif(!targetNode.tree.options.dnd.dragDrop) {\n\t\t\t\t\t// not enabled as drop target\n\t\t\t\t} else if(targetNode === prevTargetNode) {\n\t\t\t\t\t// Moving over same node\n\t\t\t\t\ttargetNode.tree.ext.dnd._onDragEvent(\"over\", targetNode, sourceNode, event, ui, draggable);\n\t\t\t\t}else{\n\t\t\t\t\t// Entering this node first time\n\t\t\t\t\ttargetNode.tree.ext.dnd._onDragEvent(\"enter\", targetNode, sourceNode, event, ui, draggable);\n\t\t\t\t\ttargetNode.tree.ext.dnd._onDragEvent(\"over\", targetNode, sourceNode, event, ui, draggable);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// else go ahead with standard event handling\n\t\t},\n\t\tstop: function(event, ui) {\n\t\t\tvar logObject,\n\t\t\t\t// 'draggable' was renamed to 'ui-draggable' since jQueryUI 1.10:\n\t\t\t\tdraggable = $(this).data(\"ui-draggable\") || $(this).data(\"draggable\"),\n\t\t\t\tsourceNode = ui.helper.data(\"ftSourceNode\") || null,\n\t\t\t\ttargetNode = ui.helper.data(\"ftTargetNode\") || null,\n\t\t\t\tdropped = (event.type === \"mouseup\" && event.which === 1);\n\n\t\t\tif(!dropped){\n\t\t\t\tlogObject = sourceNode || targetNode || $.ui.fancytree;\n\t\t\t\tlogObject.debug(\"Drag was cancelled\");\n\t\t\t}\n\t\t\tif(targetNode) {\n\t\t\t\tif(dropped){\n\t\t\t\t\ttargetNode.tree.ext.dnd._onDragEvent(\"drop\", targetNode, sourceNode, event, ui, draggable);\n\t\t\t\t}\n\t\t\t\ttargetNode.tree.ext.dnd._onDragEvent(\"leave\", targetNode, sourceNode, event, ui, draggable);\n\t\t\t}\n\t\t\tif(sourceNode){\n\t\t\t\tsourceNode.tree.ext.dnd._onDragEvent(\"stop\", sourceNode, null, event, ui, draggable);\n\t\t\t}\n\t\t}\n\t});\n\n\tdidRegisterDnd = true;\n}\n\n\n/* *****************************************************************************\n * Drag and drop support\n */\nfunction _initDragAndDrop(tree) {\n\tvar dnd = tree.options.dnd || null,\n\t\tglyph = tree.options.glyph || null;\n\n\t// Register 'connectToFancytree' option with ui.draggable\n\tif( dnd ) {\n\t\t_registerDnd();\n\t}\n\t// Attach ui.draggable to this Fancytree instance\n\tif(dnd && dnd.dragStart ) {\n\t\ttree.widget.element.draggable($.extend({\n\t\t\taddClasses: false,\n\t\t\t// DT issue 244: helper should be child of scrollParent:\n\t\t\tappendTo: tree.$container,\n//\t\t\tappendTo: \"body\",\n\t\t\tcontainment: false,\n//\t\t\tcontainment: \"parent\",\n\t\t\tdelay: 0,\n\t\t\tdistance: 4,\n\t\t\trevert: false,\n\t\t\tscroll: true, // to disable, also set css 'position: inherit' on ul.fancytree-container\n\t\t\tscrollSpeed: 7,\n\t\t\tscrollSensitivity: 10,\n\t\t\t// Delegate draggable.start, drag, and stop events to our handler\n\t\t\tconnectToFancytree: true,\n\t\t\t// Let source tree create the helper element\n\t\t\thelper: function(event) {\n\t\t\t\tvar $helper, $nodeTag, opts,\n\t\t\t\t\tsourceNode = $.ui.fancytree.getNode(event.target);\n\n\t\t\t\tif(!sourceNode){\n\t\t\t\t\t// #405, DT issue 211: might happen, if dragging a table *header*\n\t\t\t\t\treturn \"<div>ERROR?: helper requested but sourceNode not found</div>\";\n\t\t\t\t}\n\t\t\t\topts = sourceNode.tree.options.dnd;\n\t\t\t\t$nodeTag = $(sourceNode.span);\n\t\t\t\t// Only event and node argument is available\n\t\t\t\t$helper = $(\"<div class='fancytree-drag-helper'><span class='fancytree-drag-helper-img' /></div>\")\n\t\t\t\t\t.css({zIndex: 3, position: \"relative\"}) // so it appears above ext-wide selection bar\n\t\t\t\t\t.append($nodeTag.find(\"span.fancytree-title\").clone());\n\n\t\t\t\t// Attach node reference to helper object\n\t\t\t\t$helper.data(\"ftSourceNode\", sourceNode);\n\n\t\t\t\t// Support glyph symbols instead of icons\n\t\t\t\tif( glyph ) {\n\t\t\t\t\t$helper.find(\".fancytree-drag-helper-img\")\n\t\t\t\t\t\t.addClass(glyph.map.dragHelper);\n\t\t\t\t}\n\t\t\t\t// Allow to modify the helper, e.g. to add multi-node-drag feedback\n\t\t\t\tif( opts.initHelper ) {\n\t\t\t\t\topts.initHelper.call(sourceNode.tree, sourceNode, {\n\t\t\t\t\t\tnode: sourceNode,\n\t\t\t\t\t\ttree: sourceNode.tree,\n\t\t\t\t\t\toriginalEvent: event,\n\t\t\t\t\t\tui: { helper: $helper }\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// We return an unconnected element, so `draggable` will add this\n\t\t\t\t// to the parent specified as `appendTo` option\n\t\t\t\treturn $helper;\n\t\t\t},\n\t\t\tstart: function(event, ui) {\n\t\t\t\tvar sourceNode = ui.helper.data(\"ftSourceNode\");\n\t\t\t\treturn !!sourceNode; // Abort dragging if no node could be found\n\t\t\t}\n\t\t}, tree.options.dnd.draggable));\n\t}\n\t// Attach ui.droppable to this Fancytree instance\n\tif(dnd && dnd.dragDrop) {\n\t\ttree.widget.element.droppable($.extend({\n\t\t\taddClasses: false,\n\t\t\ttolerance: \"intersect\",\n\t\t\tgreedy: false\n/*\n\t\t\tactivate: function(event, ui) {\n\t\t\t\ttree.debug(\"droppable - activate\", event, ui, this);\n\t\t\t},\n\t\t\tcreate: function(event, ui) {\n\t\t\t\ttree.debug(\"droppable - create\", event, ui);\n\t\t\t},\n\t\t\tdeactivate: function(event, ui) {\n\t\t\t\ttree.debug(\"droppable - deactivate\", event, ui);\n\t\t\t},\n\t\t\tdrop: function(event, ui) {\n\t\t\t\ttree.debug(\"droppable - drop\", event, ui);\n\t\t\t},\n\t\t\tout: function(event, ui) {\n\t\t\t\ttree.debug(\"droppable - out\", event, ui);\n\t\t\t},\n\t\t\tover: function(event, ui) {\n\t\t\t\ttree.debug(\"droppable - over\", event, ui);\n\t\t\t}\n*/\n\t\t}, tree.options.dnd.droppable));\n\t}\n}\n\n\n/* *****************************************************************************\n *\n */\n\n$.ui.fancytree.registerExtension({\n\tname: \"dnd\",\n\tversion: \"0.3.0\",\n\t// Default options for this extension.\n\toptions: {\n\t\t// Make tree nodes accept draggables\n\t\tautoExpandMS: 1000,  // Expand nodes after n milliseconds of hovering.\n\t\tdraggable: null,     // Additional options passed to jQuery draggable\n\t\tdroppable: null,     // Additional options passed to jQuery droppable\n\t\tfocusOnClick: false, // Focus, although draggable cancels mousedown event (#270)\n\t\tpreventVoidMoves: true, // Prevent dropping nodes 'before self', etc.\n\t\tpreventRecursiveMoves: true, // Prevent dropping nodes on own descendants\n\t\tsmartRevert: true,   // set draggable.revert = true if drop was rejected\n\t\t// Events (drag support)\n\t\tdragStart: null,     // Callback(sourceNode, data), return true, to enable dnd\n\t\tdragStop: null,      // Callback(sourceNode, data)\n\t\tinitHelper: null,    // Callback(sourceNode, data)\n\t\tupdateHelper: null,  // Callback(sourceNode, data)\n\t\t// Events (drop support)\n\t\tdragEnter: null,     // Callback(targetNode, data)\n\t\tdragOver: null,      // Callback(targetNode, data)\n\t\tdragExpand: null,    // Callback(targetNode, data), return false to prevent autoExpand\n\t\tdragDrop: null,      // Callback(targetNode, data)\n\t\tdragLeave: null      // Callback(targetNode, data)\n\t},\n\n\ttreeInit: function(ctx){\n\t\tvar tree = ctx.tree;\n\t\tthis._superApply(arguments);\n\t\t// issue #270: draggable eats mousedown events\n\t\tif( tree.options.dnd.dragStart ){\n\t\t\ttree.$container.on(\"mousedown\", function(event){\n//\t\t\t\tif( !tree.hasFocus() && ctx.options.dnd.focusOnClick ) {\n\t\t\t\tif( ctx.options.dnd.focusOnClick ) {  // #270\n\t\t\t\t\tvar node = $.ui.fancytree.getNode(event);\n\t\t\t\t\tif (node){\n\t\t\t\t\t\tnode.debug(\"Re-enable focus that was prevented by jQuery UI draggable.\");\n\t\t\t\t\t\t// node.setFocus();\n\t\t\t\t\t\t// $(node.span).closest(\":tabbable\").focus();\n\t\t\t\t\t\t// $(event.target).trigger(\"focus\");\n\t\t\t\t\t\t// $(event.target).closest(\":tabbable\").trigger(\"focus\");\n\t\t\t\t\t}\n\t\t\t\t\tsetTimeout(function() { // #300\n\t\t\t\t\t\t$(event.target).closest(\":tabbable\").focus();\n\t\t\t\t\t}, 10);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t_initDragAndDrop(tree);\n\t},\n\t/* Display drop marker according to hitMode ('after', 'before', 'over'). */\n\t_setDndStatus: function(sourceNode, targetNode, helper, hitMode, accept) {\n\t\tvar markerOffsetX = 0,\n\t\t\tmarkerAt = \"center\",\n\t\t\tinstData = this._local,\n\t\t\tglyph = this.options.glyph || null,\n\t\t\t$source = sourceNode ? $(sourceNode.span) : null,\n\t\t\t$target = $(targetNode.span);\n\n\t\tif( !instData.$dropMarker ) {\n\t\t\tinstData.$dropMarker = $(\"<div id='fancytree-drop-marker'></div>\")\n\t\t\t\t.hide()\n\t\t\t\t.css({\"z-index\": 1000})\n\t\t\t\t.prependTo($(this.$div).parent());\n//                .prependTo(\"body\");\n\n\t\t\tif( glyph ) {\n\t\t\t\t// instData.$dropMarker.addClass(glyph.map.dragHelper);\n\t\t\t\tinstData.$dropMarker\n\t\t\t\t\t.addClass(glyph.map.dropMarker);\n\t\t\t}\n\t\t}\n\t\tif( hitMode === \"after\" || hitMode === \"before\" || hitMode === \"over\" ){\n\t\t\tswitch(hitMode){\n\t\t\tcase \"before\":\n\t\t\t\tmarkerAt = \"top\";\n\t\t\t\tbreak;\n\t\t\tcase \"after\":\n\t\t\t\tmarkerAt = \"bottom\";\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tmarkerOffsetX = 8;\n\t\t\t}\n\n\t\t\tinstData.$dropMarker\n\t\t\t\t.toggleClass(classDropAfter, hitMode === \"after\")\n\t\t\t\t.toggleClass(classDropOver, hitMode === \"over\")\n\t\t\t\t.toggleClass(classDropBefore, hitMode === \"before\")\n\t\t\t\t.show()\n\t\t\t\t.position($.ui.fancytree.fixPositionOptions({\n\t\t\t\t\tmy: \"left\" + offsetString(markerOffsetX) + \" center\",\n\t\t\t\t\tat: \"left \" + markerAt,\n\t\t\t\t\tof: $target\n\t\t\t\t\t}));\n\t\t} else {\n\t\t\tinstData.$dropMarker.hide();\n\t\t}\n\t\tif( $source ){\n\t\t\t$source\n\t\t\t\t.toggleClass(classDropAccept, accept === true)\n\t\t\t\t.toggleClass(classDropReject, accept === false);\n\t\t}\n\t\t$target\n\t\t\t.toggleClass(classDropTarget, hitMode === \"after\" || hitMode === \"before\" || hitMode === \"over\")\n\t\t\t.toggleClass(classDropAfter, hitMode === \"after\")\n\t\t\t.toggleClass(classDropBefore, hitMode === \"before\")\n\t\t\t.toggleClass(classDropAccept, accept === true)\n\t\t\t.toggleClass(classDropReject, accept === false);\n\n\t\thelper\n\t\t\t.toggleClass(classDropAccept, accept === true)\n\t\t\t.toggleClass(classDropReject, accept === false);\n\t},\n\n\t/*\n\t * Handles drag'n'drop functionality.\n\t *\n\t * A standard jQuery drag-and-drop process may generate these calls:\n\t *\n\t * start:\n\t *     _onDragEvent(\"start\", sourceNode, null, event, ui, draggable);\n\t * drag:\n\t *     _onDragEvent(\"leave\", prevTargetNode, sourceNode, event, ui, draggable);\n\t *     _onDragEvent(\"over\", targetNode, sourceNode, event, ui, draggable);\n\t *     _onDragEvent(\"enter\", targetNode, sourceNode, event, ui, draggable);\n\t * stop:\n\t *     _onDragEvent(\"drop\", targetNode, sourceNode, event, ui, draggable);\n\t *     _onDragEvent(\"leave\", targetNode, sourceNode, event, ui, draggable);\n\t *     _onDragEvent(\"stop\", sourceNode, null, event, ui, draggable);\n\t */\n\t_onDragEvent: function(eventName, node, otherNode, event, ui, draggable) {\n\t\t// if(eventName !== \"over\"){\n\t\t// \tthis.debug(\"tree.ext.dnd._onDragEvent(%s, %o, %o) - %o\", eventName, node, otherNode, this);\n\t\t// }\n\t\tvar accept, nodeOfs, parentRect, rect, relPos, relPos2,\n\t\t\tenterResponse, hitMode, r,\n\t\t\topts = this.options,\n\t\t\tdnd = opts.dnd,\n\t\t\tctx = this._makeHookContext(node, event, {otherNode: otherNode, ui: ui, draggable: draggable}),\n\t\t\tres = null,\n\t\t\tthat = this,\n\t\t\t$nodeTag = $(node.span);\n\n\t\tif( dnd.smartRevert ) {\n\t\t\tdraggable.options.revert = \"invalid\";\n\t\t}\n\n\t\tswitch (eventName) {\n\n\t\tcase \"start\":\n\t\t\tif( node.isStatusNode() ) {\n\t\t\t\tres = false;\n\t\t\t} else if(dnd.dragStart) {\n\t\t\t\tres = dnd.dragStart(node, ctx);\n\t\t\t}\n\t\t\tif(res === false) {\n\t\t\t\tthis.debug(\"tree.dragStart() cancelled\");\n\t\t\t\t//draggable._clear();\n\t\t\t\t// NOTE: the return value seems to be ignored (drag is not canceled, when false is returned)\n\t\t\t\t// TODO: call this._cancelDrag()?\n\t\t\t\tui.helper.trigger(\"mouseup\")\n\t\t\t\t\t.hide();\n\t\t\t} else {\n\t\t\t\tif( dnd.smartRevert ) {\n\t\t\t\t\t// #567, #593: fix revert position\n\t\t\t\t\t// rect = node.li.getBoundingClientRect();\n\t\t\t\t\trect = node[ctx.tree.nodeContainerAttrName].getBoundingClientRect();\n\t\t\t\t\tparentRect = $(draggable.options.appendTo)[0].getBoundingClientRect();\n\t\t\t\t\tdraggable.originalPosition.left = Math.max(0, rect.left - parentRect.left);\n\t\t\t\t\tdraggable.originalPosition.top = Math.max(0, rect.top - parentRect.top);\n\t\t\t\t}\n\t\t\t\t$nodeTag.addClass(\"fancytree-drag-source\");\n\t\t\t\t// Register global handlers to allow cancel\n\t\t\t\t$(document)\n\t\t\t\t\t.on(\"keydown.fancytree-dnd,mousedown.fancytree-dnd\", function(event){\n\t\t\t\t\t\t// node.tree.debug(\"dnd global event\", event.type, event.which);\n\t\t\t\t\t\tif( event.type === \"keydown\" && event.which === $.ui.keyCode.ESCAPE ) {\n\t\t\t\t\t\t\tthat.ext.dnd._cancelDrag();\n\t\t\t\t\t\t} else if( event.type === \"mousedown\" ) {\n\t\t\t\t\t\t\tthat.ext.dnd._cancelDrag();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"enter\":\n\t\t\tif(dnd.preventRecursiveMoves && node.isDescendantOf(otherNode)){\n\t\t\t\tr = false;\n\t\t\t}else{\n\t\t\t\tr = dnd.dragEnter ? dnd.dragEnter(node, ctx) : null;\n\t\t\t}\n\t\t\tif(!r){\n\t\t\t\t// convert null, undefined, false to false\n\t\t\t\tres = false;\n\t\t\t}else if ( $.isArray(r) ) {\n\t\t\t\t// TODO: also accept passing an object of this format directly\n\t\t\t\tres = {\n\t\t\t\t\tover: ($.inArray(\"over\", r) >= 0),\n\t\t\t\t\tbefore: ($.inArray(\"before\", r) >= 0),\n\t\t\t\t\tafter: ($.inArray(\"after\", r) >= 0)\n\t\t\t\t};\n\t\t\t}else{\n\t\t\t\tres = {\n\t\t\t\t\tover: ((r === true) || (r === \"over\")),\n\t\t\t\t\tbefore: ((r === true) || (r === \"before\")),\n\t\t\t\t\tafter: ((r === true) || (r === \"after\"))\n\t\t\t\t};\n\t\t\t}\n\t\t\tui.helper.data(\"enterResponse\", res);\n\t\t\t// this.debug(\"helper.enterResponse: %o\", res);\n\t\t\tbreak;\n\n\t\tcase \"over\":\n\t\t\tenterResponse = ui.helper.data(\"enterResponse\");\n\t\t\thitMode = null;\n\t\t\tif(enterResponse === false){\n\t\t\t\t// Don't call dragOver if onEnter returned false.\n//                break;\n\t\t\t} else if(typeof enterResponse === \"string\") {\n\t\t\t\t// Use hitMode from onEnter if provided.\n\t\t\t\thitMode = enterResponse;\n\t\t\t} else {\n\t\t\t\t// Calculate hitMode from relative cursor position.\n\t\t\t\tnodeOfs = $nodeTag.offset();\n\t\t\t\trelPos = { x: event.pageX - nodeOfs.left,\n\t\t\t\t\t\t   y: event.pageY - nodeOfs.top };\n\t\t\t\trelPos2 = { x: relPos.x / $nodeTag.width(),\n\t\t\t\t\t\t\ty: relPos.y / $nodeTag.height() };\n\n\t\t\t\tif( enterResponse.after && relPos2.y > 0.75 ){\n\t\t\t\t\thitMode = \"after\";\n\t\t\t\t} else if(!enterResponse.over && enterResponse.after && relPos2.y > 0.5 ){\n\t\t\t\t\thitMode = \"after\";\n\t\t\t\t} else if(enterResponse.before && relPos2.y <= 0.25) {\n\t\t\t\t\thitMode = \"before\";\n\t\t\t\t} else if(!enterResponse.over && enterResponse.before && relPos2.y <= 0.5) {\n\t\t\t\t\thitMode = \"before\";\n\t\t\t\t} else if(enterResponse.over) {\n\t\t\t\t\thitMode = \"over\";\n\t\t\t\t}\n\t\t\t\t// Prevent no-ops like 'before source node'\n\t\t\t\t// TODO: these are no-ops when moving nodes, but not in copy mode\n\t\t\t\tif( dnd.preventVoidMoves ){\n\t\t\t\t\tif(node === otherNode){\n\t\t\t\t\t\tthis.debug(\"    drop over source node prevented\");\n\t\t\t\t\t\thitMode = null;\n\t\t\t\t\t}else if(hitMode === \"before\" && otherNode && node === otherNode.getNextSibling()){\n\t\t\t\t\t\tthis.debug(\"    drop after source node prevented\");\n\t\t\t\t\t\thitMode = null;\n\t\t\t\t\t}else if(hitMode === \"after\" && otherNode && node === otherNode.getPrevSibling()){\n\t\t\t\t\t\tthis.debug(\"    drop before source node prevented\");\n\t\t\t\t\t\thitMode = null;\n\t\t\t\t\t}else if(hitMode === \"over\" && otherNode && otherNode.parent === node && otherNode.isLastSibling() ){\n\t\t\t\t\t\tthis.debug(\"    drop last child over own parent prevented\");\n\t\t\t\t\t\thitMode = null;\n\t\t\t\t\t}\n\t\t\t\t}\n//                this.debug(\"hitMode: %s - %s - %s\", hitMode, (node.parent === otherNode), node.isLastSibling());\n\t\t\t\tui.helper.data(\"hitMode\", hitMode);\n\t\t\t}\n\t\t\t// Auto-expand node (only when 'over' the node, not 'before', or 'after')\n\t\t\tif(hitMode !== \"before\" && hitMode !== \"after\" && dnd.autoExpandMS &&\n\t\t\t\tnode.hasChildren() !== false && !node.expanded &&\n\t\t\t\t(!dnd.dragExpand || dnd.dragExpand(node, ctx) !== false)\n\t\t\t\t) {\n\t\t\t\t// TODO: maybe add a callback `dragExpand()` here to allow more control\n\t\t\t\tnode.scheduleAction(\"expand\", dnd.autoExpandMS);\n\t\t\t}\n\t\t\tif(hitMode && dnd.dragOver){\n\t\t\t\t// TODO: http://code.google.com/p/dynatree/source/detail?r=625\n\t\t\t\tctx.hitMode = hitMode;\n\t\t\t\tres = dnd.dragOver(node, ctx);\n\t\t\t}\n\t\t\taccept = (res !== false && hitMode !== null);\n\t\t\tif( dnd.smartRevert ) {\n\t\t\t\tdraggable.options.revert = !accept;\n\t\t\t}\n\t\t\tthis._local._setDndStatus(otherNode, node, ui.helper, hitMode, accept);\n\t\t\tbreak;\n\n\t\tcase \"drop\":\n\t\t\thitMode = ui.helper.data(\"hitMode\");\n\t\t\tif(hitMode && dnd.dragDrop){\n\t\t\t\tctx.hitMode = hitMode;\n\t\t\t\tdnd.dragDrop(node, ctx);\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"leave\":\n\t\t\t// Cancel pending expand request\n\t\t\tnode.scheduleAction(\"cancel\");\n\t\t\tui.helper.data(\"enterResponse\", null);\n\t\t\tui.helper.data(\"hitMode\", null);\n\t\t\tthis._local._setDndStatus(otherNode, node, ui.helper, \"out\", undefined);\n\t\t\tif(dnd.dragLeave){\n\t\t\t\tdnd.dragLeave(node, ctx);\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"stop\":\n\t\t\t$nodeTag.removeClass(\"fancytree-drag-source\");\n\t\t\t$(document).off(\".fancytree-dnd\");\n\t\t\tif(dnd.dragStop){\n\t\t\t\tdnd.dragStop(node, ctx);\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\t$.error(\"Unsupported drag event: \" + eventName);\n\t\t}\n\t\treturn res;\n\t},\n\n\t_cancelDrag: function() {\n\t\t var dd = $.ui.ddmanager.current;\n\t\t if(dd){\n\t\t\t dd.cancel();\n\t\t }\n\t}\n});\n}(jQuery, window, document));\n\n/*!\n * jquery.fancytree.edit.js\n *\n * Make node titles editable.\n * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)\n *\n * Copyright (c) 2008-2016, Martin Wendt (http://wwWendt.de)\n *\n * Released under the MIT license\n * https://github.com/mar10/fancytree/wiki/LicenseInfo\n *\n * @version 2.18.0\n * @date 2016-05-02T19:34\n */\n\n;(function($, window, document, undefined) {\n\n\"use strict\";\n\n\n/*******************************************************************************\n * Private functions and variables\n */\n\nvar isMac = /Mac/.test(navigator.platform),\n\tescapeHtml = $.ui.fancytree.escapeHtml,\n\tunescapeHtml = $.ui.fancytree.unescapeHtml;\n\n/**\n * [ext-edit] Start inline editing of current node title.\n *\n * @alias FancytreeNode#editStart\n * @requires Fancytree\n */\n$.ui.fancytree._FancytreeNodeClass.prototype.editStart = function(){\n\tvar $input,\n\t\tnode = this,\n\t\ttree = this.tree,\n\t\tlocal = tree.ext.edit,\n\t\tinstOpts = tree.options.edit,\n\t\t$title = $(\".fancytree-title\", node.span),\n\t\teventData = {\n\t\t\tnode: node,\n\t\t\ttree: tree,\n\t\t\toptions: tree.options,\n\t\t\tisNew: $(node[tree.statusClassPropName]).hasClass(\"fancytree-edit-new\"),\n\t\t\torgTitle: node.title,\n\t\t\tinput: null,\n\t\t\tdirty: false\n\t\t\t};\n\n\t// beforeEdit may want to modify the title before editing\n\tif( instOpts.beforeEdit.call(node, {type: \"beforeEdit\"}, eventData) === false ) {\n\t\treturn false;\n\t}\n\t$.ui.fancytree.assert(!local.currentNode, \"recursive edit\");\n\tlocal.currentNode = this;\n\tlocal.eventData = eventData;\n\n\t// Disable standard Fancytree mouse- and key handling\n\ttree.widget._unbind();\n\t// #116: ext-dnd prevents the blur event, so we have to catch outer clicks\n\t$(document).on(\"mousedown.fancytree-edit\", function(event){\n\t\tif( ! $(event.target).hasClass(\"fancytree-edit-input\") ){\n\t\t\tnode.editEnd(true, event);\n\t\t}\n\t});\n\n\t// Replace node with <input>\n\t$input = $(\"<input />\", {\n\t\t\"class\": \"fancytree-edit-input\",\n\t\ttype: \"text\",\n\t\tvalue: tree.options.escapeTitles ? eventData.orgTitle : unescapeHtml(eventData.orgTitle)\n\t});\n\tlocal.eventData.input = $input;\n\tif ( instOpts.adjustWidthOfs != null ) {\n\t\t$input.width($title.width() + instOpts.adjustWidthOfs);\n\t}\n\tif ( instOpts.inputCss != null ) {\n\t\t$input.css(instOpts.inputCss);\n\t}\n\n\t$title.html($input);\n\n\t// Focus <input> and bind keyboard handler\n\t$input\n\t\t.focus()\n\t\t.change(function(event){\n\t\t\t$input.addClass(\"fancytree-edit-dirty\");\n\t\t}).keydown(function(event){\n\t\t\tswitch( event.which ) {\n\t\t\tcase $.ui.keyCode.ESCAPE:\n\t\t\t\tnode.editEnd(false, event);\n\t\t\t\tbreak;\n\t\t\tcase $.ui.keyCode.ENTER:\n\t\t\t\tnode.editEnd(true, event);\n\t\t\t\treturn false; // so we don't start editmode on Mac\n\t\t\t}\n\t\t\tevent.stopPropagation();\n\t\t}).blur(function(event){\n\t\t\treturn node.editEnd(true, event);\n\t\t});\n\n\tinstOpts.edit.call(node, {type: \"edit\"}, eventData);\n};\n\n\n/**\n * [ext-edit] Stop inline editing.\n * @param {Boolean} [applyChanges=false] false: cancel edit, true: save (if modified)\n * @alias FancytreeNode#editEnd\n * @requires jquery.fancytree.edit.js\n */\n$.ui.fancytree._FancytreeNodeClass.prototype.editEnd = function(applyChanges, _event){\n\tvar newVal,\n\t\tnode = this,\n\t\ttree = this.tree,\n\t\tlocal = tree.ext.edit,\n\t\teventData = local.eventData,\n\t\tinstOpts = tree.options.edit,\n\t\t$title = $(\".fancytree-title\", node.span),\n\t\t$input = $title.find(\"input.fancytree-edit-input\");\n\n\t// eventData.isNew = $(node[tree.statusClassPropName]).hasClass(\"fancytree-edit-new\");\n\n\tif( instOpts.trim ) {\n\t\t$input.val($.trim($input.val()));\n\t}\n\tnewVal = $input.val();\n\t// eventData.dirty = $input.hasClass(\"fancytree-edit-dirty\") || ;\n\teventData.dirty = ( newVal !== node.title );\n\n\t// Find out, if saving is required\n\tif( applyChanges === false ) {\n\t\t// If true/false was passed, honor this (except in rename mode, if unchanged)\n\t\teventData.save = false;\n\t} else if( eventData.isNew ) {\n\t\t// In create mode, we save everyting, except for empty text\n\t\teventData.save = (newVal !== \"\");\n\t} else {\n\t\t// In rename mode, we save everyting, except for empty or unchanged text\n\t\teventData.save = eventData.dirty && (newVal !== \"\");\n\t}\n\t// Allow to break (keep editor open), modify input, or re-define data.save\n\tif( instOpts.beforeClose.call(node, {type: \"beforeClose\"}, eventData) === false){\n\t\treturn false;\n\t}\n\tif( eventData.save && instOpts.save.call(node, {type: \"save\"}, eventData) === false){\n\t\treturn false;\n\t}\n\t$input\n\t\t.removeClass(\"fancytree-edit-dirty\")\n\t\t.unbind();\n\t// Unbind outer-click handler\n\t$(document).off(\".fancytree-edit\");\n\n\tif( eventData.save ) {\n\t\t// # 171: escape user input (not required if global escaping is on)\n\t\tnode.setTitle( tree.options.escapeTitles ? newVal : escapeHtml(newVal) );\n\t\tnode.setFocus();\n\t}else{\n\t\tif( eventData.isNew ) {\n\t\t\tnode.remove();\n\t\t\tnode = eventData.node = null;\n\t\t\tlocal.relatedNode.setFocus();\n\t\t} else {\n\t\t\tnode.renderTitle();\n\t\t\tnode.setFocus();\n\t\t}\n\t}\n\tlocal.eventData = null;\n\tlocal.currentNode = null;\n\tlocal.relatedNode = null;\n\t// Re-enable mouse and keyboard handling\n\ttree.widget._bind();\n\t// Set keyboard focus, even if setFocus() claims 'nothing to do'\n\t$(tree.$container).focus();\n\teventData.input = null;\n\tinstOpts.close.call(node, {type: \"close\"}, eventData);\n\treturn true;\n};\n\n\n/**\n* [ext-edit] Create a new child or sibling node and start edit mode.\n*\n* @param {String} [mode='child'] 'before', 'after', or 'child'\n* @param {Object} [init] NodeData (or simple title string)\n* @alias FancytreeNode#editCreateNode\n* @requires jquery.fancytree.edit.js\n* @since 2.4\n*/\n$.ui.fancytree._FancytreeNodeClass.prototype.editCreateNode = function(mode, init){\n\tvar newNode,\n\t\ttree = this.tree,\n\t\tself = this;\n\n\tmode = mode || \"child\";\n\tif( init == null ) {\n\t\tinit = { title: \"\" };\n\t} else if( typeof init === \"string\" ) {\n\t\tinit = { title: init };\n\t} else {\n\t\t$.ui.fancytree.assert($.isPlainObject(init));\n\t}\n\t// Make sure node is expanded (and loaded) in 'child' mode\n\tif( mode === \"child\" && !this.isExpanded() && this.hasChildren() !== false ) {\n\t\tthis.setExpanded().done(function(){\n\t\t\tself.editCreateNode(mode, init);\n\t\t});\n\t\treturn;\n\t}\n\tnewNode = this.addNode(init, mode);\n\tnewNode.makeVisible(/*{noAnimation: true}*/).done(function(){\n\t\t$(newNode[tree.statusClassPropName]).addClass(\"fancytree-edit-new\");\n\t\tself.tree.ext.edit.relatedNode = self;\n\t\tnewNode.editStart();\n\t});\n};\n\n\n/**\n * [ext-edit] Check if any node in this tree  in edit mode.\n *\n * @returns {FancytreeNode | null}\n * @alias Fancytree#isEditing\n * @requires jquery.fancytree.edit.js\n */\n$.ui.fancytree._FancytreeClass.prototype.isEditing = function(){\n\treturn this.ext.edit.currentNode;\n};\n\n\n/**\n * [ext-edit] Check if this node is in edit mode.\n * @returns {Boolean} true if node is currently beeing edited\n * @alias FancytreeNode#isEditing\n * @requires jquery.fancytree.edit.js\n */\n$.ui.fancytree._FancytreeNodeClass.prototype.isEditing = function(){\n\treturn this.tree.ext.edit.currentNode === this;\n};\n\n\n/*******************************************************************************\n * Extension code\n */\n$.ui.fancytree.registerExtension({\n\tname: \"edit\",\n\tversion: \"0.2.0\",\n\t// Default options for this extension.\n\toptions: {\n\t\tadjustWidthOfs: 4,   // null: don't adjust input size to content\n\t\tallowEmpty: false,   // Prevent empty input\n\t\tinputCss: {minWidth: \"3em\"},\n\t\ttriggerCancel: [\"esc\", \"tab\", \"click\"],\n\t\t// triggerStart: [\"f2\", \"dblclick\", \"shift+click\", \"mac+enter\"],\n\t\ttriggerStart: [\"f2\", \"shift+click\", \"mac+enter\"],\n\t\ttrim: true,          // Trim whitespace before save\n\t\t// Events:\n\t\tbeforeClose: $.noop, // Return false to prevent cancel/save (data.input is available)\n\t\tbeforeEdit: $.noop,  // Return false to prevent edit mode\n\t\tclose: $.noop,       // Editor was removed\n\t\tedit: $.noop,        // Editor was opened (available as data.input)\n//\t\tkeypress: $.noop,    // Not yet implemented\n\t\tsave: $.noop         // Save data.input.val() or return false to keep editor open\n\t},\n\t// Local attributes\n\tcurrentNode: null,\n\n\ttreeInit: function(ctx){\n\t\tthis._superApply(arguments);\n\t\tthis.$container.addClass(\"fancytree-ext-edit\");\n\t},\n\tnodeClick: function(ctx) {\n\t\tif( $.inArray(\"shift+click\", ctx.options.edit.triggerStart) >= 0 ){\n\t\t\tif( ctx.originalEvent.shiftKey ){\n\t\t\t\tctx.node.editStart();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn this._superApply(arguments);\n\t},\n\tnodeDblclick: function(ctx) {\n\t\tif( $.inArray(\"dblclick\", ctx.options.edit.triggerStart) >= 0 ){\n\t\t\tctx.node.editStart();\n\t\t\treturn false;\n\t\t}\n\t\treturn this._superApply(arguments);\n\t},\n\tnodeKeydown: function(ctx) {\n\t\tswitch( ctx.originalEvent.which ) {\n\t\tcase 113: // [F2]\n\t\t\tif( $.inArray(\"f2\", ctx.options.edit.triggerStart) >= 0 ){\n\t\t\t\tctx.node.editStart();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase $.ui.keyCode.ENTER:\n\t\t\tif( $.inArray(\"mac+enter\", ctx.options.edit.triggerStart) >= 0 && isMac ){\n\t\t\t\tctx.node.editStart();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\treturn this._superApply(arguments);\n\t}\n});\n}(jQuery, window, document));\n\n/*!\n * jquery.fancytree.filter.js\n *\n * Remove or highlight tree nodes, based on a filter.\n * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)\n *\n * Copyright (c) 2008-2016, Martin Wendt (http://wwWendt.de)\n *\n * Released under the MIT license\n * https://github.com/mar10/fancytree/wiki/LicenseInfo\n *\n * @version 2.18.0\n * @date 2016-05-02T19:34\n */\n\n;(function($, window, document, undefined) {\n\n\"use strict\";\n\n\n/*******************************************************************************\n * Private functions and variables\n */\n\nvar KeyNoData = \"__not_found__\",\n\tescapeHtml = $.ui.fancytree.escapeHtml;\n\nfunction _escapeRegex(str){\n\t/*jshint regexdash:true */\n\treturn (str + \"\").replace(/([.?*+\\^\\$\\[\\]\\\\(){}|-])/g, \"\\\\$1\");\n}\n\nfunction extractHtmlText(s){\n\tif( s.indexOf(\">\") >= 0 ) {\n\t\treturn $(\"<div/>\").html(s).text();\n\t}\n\treturn s;\n}\n\n$.ui.fancytree._FancytreeClass.prototype._applyFilterImpl = function(filter, branchMode, opts){\n\tvar leavesOnly, match, statusNode, re, re2,\n\t\tcount = 0,\n\t\ttreeOpts = this.options,\n\t\tescapeTitles = treeOpts.escapeTitles,\n\t\tfilterOpts = treeOpts.filter,\n\t\thideMode = filterOpts.mode === \"hide\";\n\n\topts = opts || {};\n\tleavesOnly = !!opts.leavesOnly && !branchMode;\n\n\t// Default to 'match title substring (not case sensitive)'\n\tif(typeof filter === \"string\"){\n\t\t// console.log(\"rex\", filter.split('').join('\\\\w*').replace(/\\W/, \"\"))\n\t\tif( filterOpts.fuzzy ) {\n\t\t\t// See https://codereview.stackexchange.com/questions/23899/faster-javascript-fuzzy-string-matching-function/23905#23905\n\t\t\t// and http://www.quora.com/How-is-the-fuzzy-search-algorithm-in-Sublime-Text-designed\n\t\t\t// and http://www.dustindiaz.com/autocomplete-fuzzy-matching\n\t\t\tmatch = filter.split(\"\").reduce(function(a, b) {\n\t\t\t\treturn a + \"[^\" + b + \"]*\" + b;\n\t\t\t});\n\t\t} else {\n\t\t\tmatch = _escapeRegex(filter); // make sure a '.' is treated literally\n\t\t}\n\t\tre = new RegExp(\".*\" + match + \".*\", \"i\");\n\t\tre2 = new RegExp(filter, \"gi\");\n\t\tfilter = function(node){\n\t\t\tvar display,\n\t\t\t\ttext = escapeTitles ? node.title : extractHtmlText(node.title),\n\t\t\t\tres = !!re.test(text);\n\n\t\t\tif( res && filterOpts.highlight ) {\n\t\t\t\tdisplay = escapeTitles ? escapeHtml(node.title) : text;\n\t\t\t\tnode.titleWithHighlight = display.replace(re2, function(s){\n\t\t\t\t\treturn \"<mark>\" + s + \"</mark>\";\n\t\t\t\t});\n\t\t\t\t// node.debug(\"filter\", escapeTitles, text, node.titleWithHighlight);\n\t\t\t}\n\t\t\treturn res;\n\t\t};\n\t}\n\n\tthis.enableFilter = true;\n\tthis.lastFilterArgs = arguments;\n\n\tthis.$div.addClass(\"fancytree-ext-filter\");\n\tif( hideMode ){\n\t\tthis.$div.addClass(\"fancytree-ext-filter-hide\");\n\t} else {\n\t\tthis.$div.addClass(\"fancytree-ext-filter-dimm\");\n\t}\n\t// Reset current filter\n\tthis.visit(function(node){\n\t\tdelete node.match;\n\t\tdelete node.titleWithHighlight;\n\t\tnode.subMatchCount = 0;\n\t});\n\tstatusNode = this.getRootNode()._findDirectChild(KeyNoData);\n\tif( statusNode ) {\n\t\tstatusNode.remove();\n\t}\n\n\t// Adjust node.hide, .match, and .subMatchCount properties\n\tthis.visit(function(node){\n\t\tif ( leavesOnly && node.children != null ) {\n\t\t\treturn;\n\t\t}\n\t\tvar res = filter(node);\n\t\tif( res === \"skip\" ) {\n\t\t\tnode.visit(function(c){\n\t\t\t\tc.match = false;\n\t\t\t}, true);\n\t\t\treturn \"skip\";\n\t\t} else if( res ) {\n\t\t\tcount++;\n\t\t\tnode.match = true;\n\t\t\tnode.visitParents(function(p){\n\t\t\t\tp.subMatchCount += 1;\n\t\t\t\tif( opts.autoExpand && !p.expanded ) {\n\t\t\t\t\tp.setExpanded(true, {noAnimation: true, noEvents: true, scrollIntoView: false});\n\t\t\t\t\tp._filterAutoExpanded = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif( branchMode || res === \"branch\" ) {\n\t\t\t\tnode.visit(function(c){\n\t\t\t\t\tc.match = true;\n\t\t\t\t});\n\t\t\t\tif( opts.autoExpand && !node.expanded ) {\n\t\t\t\t\tnode.setExpanded(true, {noAnimation: true, noEvents: true, scrollIntoView: false});\n\t\t\t\t\tnode._filterAutoExpanded = true;\n\t\t\t\t}\n\t\t\t\treturn \"skip\";\n\t\t\t}\n\t\t}\n\t});\n\tif( count === 0 && filterOpts.nodata ) {\n\t\tstatusNode = filterOpts.nodata;\n\t\tif( $.isFunction(statusNode) ) {\n\t\t\tstatusNode = statusNode();\n\t\t}\n\t\tif( statusNode === true ) {\n\t\t\tstatusNode = {};\n\t\t} else if( typeof statusNode === \"string\" ) {\n\t\t\tstatusNode = { title: statusNode };\n\t\t}\n\t\tstatusNode = $.extend({\n\t\t\tstatusNodeType: \"nodata\",\n\t\t\tkey: KeyNoData,\n\t\t\ttitle: this.options.strings.noData\n\t\t}, statusNode);\n\n\t\tthis.getRootNode().addNode(statusNode).match = true;\n\t}\n\t// Redraw whole tree\n\tthis.render();\n\treturn count;\n};\n\n/**\n * [ext-filter] Dimm or hide nodes.\n *\n * @param {function | string} filter\n * @param {boolean} [opts={autoExpand: false, leavesOnly: false}]\n * @returns {integer} count\n * @alias Fancytree#filterNodes\n * @requires jquery.fancytree.filter.js\n */\n$.ui.fancytree._FancytreeClass.prototype.filterNodes = function(filter, opts) {\n\tif( typeof opts === \"boolean\" ) {\n\t\topts = { leavesOnly: opts };\n\t\tthis.warn(\"Fancytree.filterNodes() leavesOnly option is deprecated since 2.9.0 / 2015-04-19.\");\n\t}\n\treturn this._applyFilterImpl(filter, false, opts);\n};\n\n/**\n * @deprecated\n */\n$.ui.fancytree._FancytreeClass.prototype.applyFilter = function(filter){\n\tthis.warn(\"Fancytree.applyFilter() is deprecated since 2.1.0 / 2014-05-29. Use .filterNodes() instead.\");\n\treturn this.filterNodes.apply(this, arguments);\n};\n\n/**\n * [ext-filter] Dimm or hide whole branches.\n *\n * @param {function | string} filter\n * @param {boolean} [opts={autoExpand: false}]\n * @returns {integer} count\n * @alias Fancytree#filterBranches\n * @requires jquery.fancytree.filter.js\n */\n$.ui.fancytree._FancytreeClass.prototype.filterBranches = function(filter, opts){\n\treturn this._applyFilterImpl(filter, true, opts);\n};\n\n\n/**\n * [ext-filter] Reset the filter.\n *\n * @alias Fancytree#clearFilter\n * @requires jquery.fancytree.filter.js\n */\n$.ui.fancytree._FancytreeClass.prototype.clearFilter = function(){\n\tvar $title,\n\t\tstatusNode = this.getRootNode()._findDirectChild(KeyNoData),\n\t\tescapeTitles = this.options.escapeTitles,\n\t\tenhanceTitle = this.options.enhanceTitle;\n\n\tif( statusNode ) {\n\t\tstatusNode.remove();\n\t}\n\tthis.visit(function(node){\n\t\tif( node.match ) {  // #491\n\t\t\t$title = $(\">span.fancytree-title\", node.span);\n\t\t\tif( escapeTitles ) {\n\t\t\t\t$title.text(node.title);\n\t\t\t} else {\n\t\t\t\t$title.html(node.title);\n\t\t\t}\n\t\t\tif( enhanceTitle ) {\n\t\t\t\tenhanceTitle({type: \"enhanceTitle\"}, {node: node, $title: $title});\n\t\t\t}\n\t\t}\n\t\tdelete node.match;\n\t\tdelete node.subMatchCount;\n\t\tdelete node.titleWithHighlight;\n\t\tif ( node.$subMatchBadge ) {\n\t\t\tnode.$subMatchBadge.remove();\n\t\t\tdelete node.$subMatchBadge;\n\t\t}\n\t\tif( node._filterAutoExpanded && node.expanded ) {\n\t\t\tnode.setExpanded(false, {noAnimation: true, noEvents: true, scrollIntoView: false});\n\t\t}\n\t\tdelete node._filterAutoExpanded;\n\t});\n\tthis.enableFilter = false;\n\tthis.lastFilterArgs = null;\n\tthis.$div.removeClass(\"fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide\");\n\tthis.render();\n};\n\n\n/**\n * [ext-filter] Return true if a filter is currently applied.\n *\n * @returns {Boolean}\n * @alias Fancytree#isFilterActive\n * @requires jquery.fancytree.filter.js\n * @since 2.13\n */\n$.ui.fancytree._FancytreeClass.prototype.isFilterActive = function(){\n\treturn !!this.enableFilter;\n};\n\n\n/**\n * [ext-filter] Return true if this node is matched by current filter (or no filter is active).\n *\n * @returns {Boolean}\n * @alias FancytreeNode#isMatched\n * @requires jquery.fancytree.filter.js\n * @since 2.13\n */\n$.ui.fancytree._FancytreeNodeClass.prototype.isMatched = function(){\n\treturn !(this.tree.enableFilter && !this.match);\n};\n\n\n/*******************************************************************************\n * Extension code\n */\n$.ui.fancytree.registerExtension({\n\tname: \"filter\",\n\tversion: \"0.7.0\",\n\t// Default options for this extension.\n\toptions: {\n\t\tautoApply: true,  // Re-apply last filter if lazy data is loaded\n\t\tcounter: true,  // Show a badge with number of matching child nodes near parent icons\n\t\tfuzzy: false,  // Match single characters in order, e.g. 'fb' will match 'FooBar'\n\t\thideExpandedCounter: true,  // Hide counter badge, when parent is expanded\n\t\thighlight: true,  // Highlight matches by wrapping inside <mark> tags\n\t\tnodata: true,  // Display a 'no data' status node if result is empty\n\t\tmode: \"dimm\",  // Grayout unmatched nodes (pass \"hide\" to remove unmatched node instead)\n\t\t// events\n\t\tenhanceTitle: null\n\t},\n\tnodeLoadChildren: function(ctx, source) {\n\t\treturn this._superApply(arguments).done(function() {\n\t\t\tif( ctx.tree.enableFilter && ctx.tree.lastFilterArgs && ctx.options.filter.autoApply ) {\n\t\t\t\tctx.tree._applyFilterImpl.apply(ctx.tree, ctx.tree.lastFilterArgs);\n\t\t\t}\n\t\t});\n\t},\n\tnodeSetExpanded: function(ctx, flag, callOpts) {\n\t\tdelete ctx.node._filterAutoExpanded;\n\t\t// Make sure counter badge is displayed again, when node is beeing collapsed\n\t\tif( !flag && ctx.options.filter.hideExpandedCounter && ctx.node.$subMatchBadge ) {\n\t\t\tctx.node.$subMatchBadge.show();\n\t\t}\n\t\treturn this._superApply(arguments);\n\t},\n\tnodeRenderStatus: function(ctx) {\n\t\t// Set classes for current status\n\t\tvar res,\n\t\t\tnode = ctx.node,\n\t\t\ttree = ctx.tree,\n\t\t\topts = ctx.options.filter,\n\t\t\t$title = $(\"span.fancytree-title\", node.span),\n\t\t\t$span = $(node[tree.statusClassPropName]),\n\t\t\tenhanceTitle = ctx.options.enhanceTitle,\n\t\t\tescapeTitles = ctx.options.escapeTitles;\n\n\t\tres = this._superApply(arguments);\n\t\t// nothing to do, if node was not yet rendered\n\t\tif( !$span.length || !tree.enableFilter ) {\n\t\t\treturn res;\n\t\t}\n\t\t$span\n\t\t\t.toggleClass(\"fancytree-match\", !!node.match)\n\t\t\t.toggleClass(\"fancytree-submatch\", !!node.subMatchCount)\n\t\t\t.toggleClass(\"fancytree-hide\", !(node.match || node.subMatchCount));\n\t\t// Add/update counter badge\n\t\tif( opts.counter && node.subMatchCount && (!node.isExpanded() || !opts.hideExpandedCounter) ) {\n\t\t\tif( !node.$subMatchBadge ) {\n\t\t\t\tnode.$subMatchBadge = $(\"<span class='fancytree-childcounter'/>\");\n\t\t\t\t$(\"span.fancytree-icon, span.fancytree-custom-icon\", node.span).append(node.$subMatchBadge);\n\t\t\t}\n\t\t\tnode.$subMatchBadge.show().text(node.subMatchCount);\n\t\t} else if ( node.$subMatchBadge ) {\n\t\t\tnode.$subMatchBadge.hide();\n\t\t}\n\t\t// node.debug(\"nodeRenderStatus\", node.titleWithHighlight, node.title)\n\t\tif( node.titleWithHighlight ) {\n\t\t\t$title.html(node.titleWithHighlight);\n\t\t} else if ( escapeTitles ) {\n\t\t\t$title.text(node.title);\n\t\t} else {\n\t\t\t$title.html(node.title);\n\t\t}\n\t\tif( enhanceTitle ) {\n\t\t\tenhanceTitle({type: \"enhanceTitle\"}, {node: node, $title: $title});\n\t\t}\n\t\treturn res;\n\t}\n});\n}(jQuery, window, document));\n\n/*!\n * jquery.fancytree.glyph.js\n *\n * Use glyph fonts as instead of icon sprites.\n * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)\n *\n * Copyright (c) 2008-2016, Martin Wendt (http://wwWendt.de)\n *\n * Released under the MIT license\n * https://github.com/mar10/fancytree/wiki/LicenseInfo\n *\n * @version 2.18.0\n * @date 2016-05-02T19:34\n */\n\n;(function($, window, document, undefined) {\n\n\"use strict\";\n\n/* *****************************************************************************\n * Private functions and variables\n */\n\nfunction _getIcon(opts, type){\n\treturn opts.map[type];\n}\n\n$.ui.fancytree.registerExtension({\n\tname: \"glyph\",\n\tversion: \"0.4.0\",\n\t// Default options for this extension.\n\toptions: {\n\t\tmap: {\n\t\t\t// Samples from Font Awesome 3.2\n\t\t\t//   http://fortawesome.github.io/Font-Awesome/3.2.1/icons/\n\t\t\t// See here for alternatives:\n\t\t\t//   http://fortawesome.github.io/Font-Awesome/icons/\n\t\t\t//   http://getbootstrap.com/components/\n\t\t\tcheckbox: \"icon-check-empty\",\n\t\t\tcheckboxSelected: \"icon-check\",\n\t\t\tcheckboxUnknown: \"icon-check icon-muted\",\n\t\t\terror: \"icon-exclamation-sign\",\n\t\t\texpanderClosed: \"icon-caret-right\",\n\t\t\texpanderLazy: \"icon-angle-right\",\n\t\t\texpanderOpen: \"icon-caret-down\",\n\t\t\tnodata: \"icon-meh\",\n\t\t\tnoExpander: \"\",\n\t\t\tdragHelper: \"icon-caret-right\",\n\t\t\tdropMarker: \"icon-caret-right\",\n\t\t\t// Default node icons.\n\t\t\t// (Use tree.options.icon callback to define custom icons\n\t\t\t// based on node data)\n\t\t\tdoc: \"icon-file-alt\",\n\t\t\tdocOpen: \"icon-file-alt\",\n\t\t\tloading: \"icon-refresh icon-spin\",\n\t\t\tfolder: \"icon-folder-close-alt\",\n\t\t\tfolderOpen: \"icon-folder-open-alt\"\n\t\t}\n\t},\n\n\ttreeInit: function(ctx){\n\t\tvar tree = ctx.tree;\n\t\tthis._superApply(arguments);\n\t\ttree.$container.addClass(\"fancytree-ext-glyph\");\n\t},\n\tnodeRenderStatus: function(ctx) {\n\t\tvar icon, res, span,\n\t\t\tnode = ctx.node,\n\t\t\t$span = $(node.span),\n\t\t\topts = ctx.options.glyph,\n\t\t\tmap = opts.map;\n\n\t\tres = this._superApply(arguments);\n\n\t\tif( node.isRoot() ){\n\t\t\treturn res;\n\t\t}\n\t\tspan = $span.children(\"span.fancytree-expander\").get(0);\n\t\tif( span ){\n\t\t\t// if( node.isLoading() ){\n\t\t\t\t// icon = \"loading\";\n\t\t\tif( node.expanded ){\n\t\t\t\ticon = \"expanderOpen\";\n\t\t\t}else if( node.isUndefined() ){\n\t\t\t\ticon = \"expanderLazy\";\n\t\t\t}else if( node.hasChildren() ){\n\t\t\t\ticon = \"expanderClosed\";\n\t\t\t}else{\n\t\t\t\ticon = \"noExpander\";\n\t\t\t}\n\t\t\tspan.className = \"fancytree-expander \" + map[icon];\n\t\t}\n\n\t\tif( node.tr ){\n\t\t\tspan = $(\"td\", node.tr).find(\"span.fancytree-checkbox\").get(0);\n\t\t}else{\n\t\t\tspan = $span.children(\"span.fancytree-checkbox\").get(0);\n\t\t}\n\t\tif( span ){\n\t\t\ticon = node.selected ? \"checkboxSelected\" : (node.partsel ? \"checkboxUnknown\" : \"checkbox\");\n\t\t\tspan.className = \"fancytree-checkbox \" + map[icon];\n\t\t}\n\n\t\t// Standard icon (note that this does not match .fancytree-custom-icon,\n\t\t// that might be set by opts.icon callbacks)\n\t\tspan = $span.children(\"span.fancytree-icon\").get(0);\n\t\tif( span ){\n\t\t\tif( node.statusNodeType ){\n\t\t\t\ticon = _getIcon(opts, node.statusNodeType); // loading, error\n\t\t\t}else if( node.folder ){\n\t\t\t\ticon = node.expanded ? _getIcon(opts, \"folderOpen\") : _getIcon(opts, \"folder\");\n\t\t\t}else{\n\t\t\t\ticon = node.expanded ? _getIcon(opts, \"docOpen\") : _getIcon(opts, \"doc\");\n\t\t\t}\n\t\t\tspan.className = \"fancytree-icon \" + icon;\n\t\t}\n\t\treturn res;\n\t},\n\tnodeSetStatus: function(ctx, status, message, details) {\n\t\tvar res, span,\n\t\t\topts = ctx.options.glyph,\n\t\t\tnode = ctx.node;\n\n\t\tres = this._superApply(arguments);\n\n\t\tif( status === \"error\" || status === \"loading\" || status === \"nodata\" ){\n\t\t\tif(node.parent){\n\t\t\t\tspan = $(\"span.fancytree-expander\", node.span).get(0);\n\t\t\t\tspan.className = \"fancytree-expander \" + _getIcon(opts, status);\n\t\t\t}else{ //\n\t\t\t\tspan = $(\".fancytree-statusnode-\" + status, node[this.nodeContainerAttrName])\n\t\t\t\t\t.find(\"span.fancytree-icon\").get(0);\n\t\t\t\tspan.className = \"fancytree-icon \" + _getIcon(opts, status);\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t}\n});\n}(jQuery, window, document));\n\n/*!\n * jquery.fancytree.gridnav.js\n *\n * Support keyboard navigation for trees with embedded input controls.\n * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)\n *\n * Copyright (c) 2008-2016, Martin Wendt (http://wwWendt.de)\n *\n * Released under the MIT license\n * https://github.com/mar10/fancytree/wiki/LicenseInfo\n *\n * @version 2.18.0\n * @date 2016-05-02T19:34\n */\n\n;(function($, window, document, undefined) {\n\n\"use strict\";\n\n\n/*******************************************************************************\n * Private functions and variables\n */\n\n// Allow these navigation keys even when input controls are focused\n\nvar\tKC = $.ui.keyCode,\n\t// which keys are *not* handled by embedded control, but passed to tree\n\t// navigation handler:\n\tNAV_KEYS = {\n\t\t\"text\": [KC.UP, KC.DOWN],\n\t\t\"checkbox\": [KC.UP, KC.DOWN, KC.LEFT, KC.RIGHT],\n\t\t\"radiobutton\": [KC.UP, KC.DOWN, KC.LEFT, KC.RIGHT],\n\t\t\"select-one\": [KC.LEFT, KC.RIGHT],\n\t\t\"select-multiple\": [KC.LEFT, KC.RIGHT]\n\t};\n\n\n/* Calculate TD column index (considering colspans).*/\nfunction getColIdx($tr, $td) {\n\tvar colspan,\n\t\ttd = $td.get(0),\n\t\tidx = 0;\n\n\t$tr.children().each(function () {\n\t\tif( this === td ) {\n\t\t\treturn false;\n\t\t}\n\t\tcolspan = $(this).prop(\"colspan\");\n\t\tidx += colspan ? colspan : 1;\n\t});\n\treturn idx;\n}\n\n\n/* Find TD at given column index (considering colspans).*/\nfunction findTdAtColIdx($tr, colIdx) {\n\tvar colspan,\n\t\tres = null,\n\t\tidx = 0;\n\n\t$tr.children().each(function () {\n\t\tif( idx >= colIdx ) {\n\t\t\tres = $(this);\n\t\t\treturn false;\n\t\t}\n\t\tcolspan = $(this).prop(\"colspan\");\n\t\tidx += colspan ? colspan : 1;\n\t});\n\treturn res;\n}\n\n\n/* Find adjacent cell for a given direction. Skip empty cells and consider merged cells */\nfunction findNeighbourTd($target, keyCode){\n\tvar $tr, colIdx,\n\t\t$td = $target.closest(\"td\"),\n\t\t$tdNext = null;\n\n\tswitch( keyCode ){\n\t\tcase KC.LEFT:\n\t\t\t$tdNext = $td.prev();\n\t\t\tbreak;\n\t\tcase KC.RIGHT:\n\t\t\t$tdNext = $td.next();\n\t\t\tbreak;\n\t\tcase KC.UP:\n\t\tcase KC.DOWN:\n\t\t\t$tr = $td.parent();\n\t\t\tcolIdx = getColIdx($tr, $td);\n\t\t\twhile( true ) {\n\t\t\t\t$tr = (keyCode === KC.UP) ? $tr.prev() : $tr.next();\n\t\t\t\tif( !$tr.length ) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// Skip hidden rows\n\t\t\t\tif( $tr.is(\":hidden\") ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t// Find adjacent cell in the same column\n\t\t\t\t$tdNext = findTdAtColIdx($tr, colIdx);\n\t\t\t\t// Skip cells that don't conatain a focusable element\n\t\t\t\tif( $tdNext && $tdNext.find(\":input\").length ) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t}\n\treturn $tdNext;\n}\n\n\n/*******************************************************************************\n * Extension code\n */\n$.ui.fancytree.registerExtension({\n\tname: \"gridnav\",\n\tversion: \"0.0.1\",\n\t// Default options for this extension.\n\toptions: {\n\t\tautofocusInput:   false,  // Focus first embedded input if node gets activated\n\t\thandleCursorKeys: true   // Allow UP/DOWN in inputs to move to prev/next node\n\t},\n\n\ttreeInit: function(ctx){\n\t\t// gridnav requires the table extension to be loaded before itself\n\t\tthis._requireExtension(\"table\", true, true);\n\t\tthis._superApply(arguments);\n\n\t\tthis.$container.addClass(\"fancytree-ext-gridnav\");\n\n\t\t// Activate node if embedded input gets focus (due to a click)\n\t\tthis.$container.on(\"focusin\", function(event){\n\t\t\tvar ctx2,\n\t\t\t\tnode = $.ui.fancytree.getNode(event.target);\n\n\t\t\tif( node && !node.isActive() ){\n\t\t\t\t// Call node.setActive(), but also pass the event\n\t\t\t\tctx2 = ctx.tree._makeHookContext(node, event);\n\t\t\t\tctx.tree._callHook(\"nodeSetActive\", ctx2, true);\n\t\t\t}\n\t\t});\n\t},\n\tnodeSetActive: function(ctx, flag) {\n\t\tvar $outer,\n\t\t\topts = ctx.options.gridnav,\n\t\t\tnode = ctx.node,\n\t\t\tevent = ctx.originalEvent || {},\n\t\t\ttriggeredByInput = $(event.target).is(\":input\");\n\n\t\tflag = (flag !== false);\n\n\t\tthis._superApply(arguments);\n\n\t\tif( flag ){\n\t\t\tif( ctx.options.titlesTabbable ){\n\t\t\t\tif( !triggeredByInput ) {\n\t\t\t\t\t$(node.span).find(\"span.fancytree-title\").focus();\n\t\t\t\t\tnode.setFocus();\n\t\t\t\t}\n\t\t\t\t// If one node is tabbable, the container no longer needs to be\n\t\t\t\tctx.tree.$container.attr(\"tabindex\", \"-1\");\n\t\t\t\t// ctx.tree.$container.removeAttr(\"tabindex\");\n\t\t\t} else if( opts.autofocusInput && !triggeredByInput ){\n\t\t\t\t// Set focus to input sub input (if node was clicked, but not\n\t\t\t\t// when TAB was pressed )\n\t\t\t\t$outer = $(node.tr || node.span);\n\t\t\t\t$outer.find(\":input:enabled:first\").focus();\n\t\t\t}\n\t\t}\n\t},\n\tnodeKeydown: function(ctx) {\n\t\tvar inputType, handleKeys, $td,\n\t\t\topts = ctx.options.gridnav,\n\t\t\tevent = ctx.originalEvent,\n\t\t\t$target = $(event.target);\n\n\t\t// jQuery\n\t\tinputType = $target.is(\":input:enabled\") ? $target.prop(\"type\") : null;\n//\t\tctx.tree.debug(\"ext-gridnav nodeKeydown\", event, inputType);\n\n\t\tif( inputType && opts.handleCursorKeys ){\n\t\t\thandleKeys = NAV_KEYS[inputType];\n\t\t\tif( handleKeys && $.inArray(event.which, handleKeys) >= 0 ){\n\t\t\t\t$td = findNeighbourTd($target, event.which);\n\t\t\t\t// ctx.node.debug(\"ignore keydown in input\", event.which, handleKeys);\n\t\t\t\tif( $td && $td.length ) {\n\t\t\t\t\t$td.find(\":input:enabled\").focus();\n\t\t\t\t\t// Prevent Fancytree default navigation\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\t// ctx.tree.debug(\"ext-gridnav NOT HANDLED\", event, inputType);\n\t\treturn this._superApply(arguments);\n\t}\n});\n}(jQuery, window, document));\n\n/*!\n * jquery.fancytree.persist.js\n *\n * Persist tree status in cookiesRemove or highlight tree nodes, based on a filter.\n * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)\n *\n * @depends: js-cookie or jquery-cookie\n *\n * Copyright (c) 2008-2016, Martin Wendt (http://wwWendt.de)\n *\n * Released under the MIT license\n * https://github.com/mar10/fancytree/wiki/LicenseInfo\n *\n * @version 2.18.0\n * @date 2016-05-02T19:34\n */\n\n;(function($, window, document, undefined) {\n\n\"use strict\";\n/* global Cookies:false */\n\n/*******************************************************************************\n * Private functions and variables\n */\nvar cookieGetter, cookieRemover, cookieSetter,\n\t_assert = $.ui.fancytree.assert,\n\tACTIVE = \"active\",\n\tEXPANDED = \"expanded\",\n\tFOCUS = \"focus\",\n\tSELECTED = \"selected\";\n\nif( typeof Cookies === \"function\" ) {\n\t// Assume https://github.com/js-cookie/js-cookie\n\tcookieSetter = Cookies.set;\n\tcookieGetter = Cookies.get;\n\tcookieRemover = Cookies.remove;\n} else {\n\t// Fall back to https://github.com/carhartl/jquery-cookie\n\tcookieSetter = cookieGetter = $.cookie;\n\tcookieRemover = $.removeCookie;\n}\n\n/* Recursively load lazy nodes\n * @param {string} mode 'load', 'expand', false\n */\nfunction _loadLazyNodes(tree, local, keyList, mode, dfd) {\n\tvar i, key, l, node,\n\t\tfoundOne = false,\n\t\tdeferredList = [],\n\t\tmissingKeyList = [];\n\n\tkeyList = keyList || [];\n\tdfd = dfd || $.Deferred();\n\n\tfor( i=0, l=keyList.length; i<l; i++ ) {\n\t\tkey = keyList[i];\n\t\tnode = tree.getNodeByKey(key);\n\t\tif( node ) {\n\t\t\tif( mode && node.isUndefined() ) {\n\t\t\t\tfoundOne = true;\n\t\t\t\ttree.debug(\"_loadLazyNodes: \" + node + \" is lazy: loading...\");\n\t\t\t\tif( mode === \"expand\" ) {\n\t\t\t\t\tdeferredList.push(node.setExpanded());\n\t\t\t\t} else {\n\t\t\t\t\tdeferredList.push(node.load());\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttree.debug(\"_loadLazyNodes: \" + node + \" already loaded.\");\n\t\t\t\tnode.setExpanded();\n\t\t\t}\n\t\t} else {\n\t\t\tmissingKeyList.push(key);\n\t\t\ttree.debug(\"_loadLazyNodes: \" + node + \" was not yet found.\");\n\t\t}\n\t}\n\n\t$.when.apply($, deferredList).always(function(){\n\t\t// All lazy-expands have finished\n\t\tif( foundOne && missingKeyList.length > 0 ) {\n\t\t\t// If we read new nodes from server, try to resolve yet-missing keys\n\t\t\t_loadLazyNodes(tree, local, missingKeyList, mode, dfd);\n\t\t} else {\n\t\t\tif( missingKeyList.length ) {\n\t\t\t\ttree.warn(\"_loadLazyNodes: could not load those keys: \", missingKeyList);\n\t\t\t\tfor( i=0, l=missingKeyList.length; i<l; i++ ) {\n\t\t\t\t\tkey = keyList[i];\n\t\t\t\t\tlocal._appendKey(EXPANDED, keyList[i], false);\n\t\t\t\t}\n\t\t\t}\n\t\t\tdfd.resolve();\n\t\t}\n\t});\n\treturn dfd;\n}\n\n\n/**\n * [ext-persist] Remove persistence cookies of the given type(s).\n * Called like\n *     $(\"#tree\").fancytree(\"getTree\").clearCookies(\"active expanded focus selected\");\n *\n * @alias Fancytree#clearCookies\n * @requires jquery.fancytree.persist.js\n */\n$.ui.fancytree._FancytreeClass.prototype.clearCookies = function(types){\n\tvar local = this.ext.persist,\n\t\tprefix = local.cookiePrefix;\n\n\ttypes = types || \"active expanded focus selected\";\n\tif(types.indexOf(ACTIVE) >= 0){\n\t\tlocal._data(prefix + ACTIVE, null);\n\t}\n\tif(types.indexOf(EXPANDED) >= 0){\n\t\tlocal._data(prefix + EXPANDED, null);\n\t}\n\tif(types.indexOf(FOCUS) >= 0){\n\t\tlocal._data(prefix + FOCUS, null);\n\t}\n\tif(types.indexOf(SELECTED) >= 0){\n\t\tlocal._data(prefix + SELECTED, null);\n\t}\n};\n\n\n/**\n * [ext-persist] Return persistence information from cookies\n *\n * Called like\n *     $(\"#tree\").fancytree(\"getTree\").getPersistData();\n *\n * @alias Fancytree#getPersistData\n * @requires jquery.fancytree.persist.js\n */\n$.ui.fancytree._FancytreeClass.prototype.getPersistData = function(){\n\tvar local = this.ext.persist,\n\t\tprefix = local.cookiePrefix,\n\t\tdelim = local.cookieDelimiter,\n\t\tres = {};\n\n\tres[ACTIVE] = local._data(prefix + ACTIVE);\n\tres[EXPANDED] = (local._data(prefix + EXPANDED) || \"\").split(delim);\n\tres[SELECTED] = (local._data(prefix + SELECTED) || \"\").split(delim);\n\tres[FOCUS] = local._data(prefix + FOCUS);\n\treturn res;\n};\n\n\n/* *****************************************************************************\n * Extension code\n */\n$.ui.fancytree.registerExtension({\n\tname: \"persist\",\n\tversion: \"0.3.0\",\n\t// Default options for this extension.\n\toptions: {\n\t\tcookieDelimiter: \"~\",\n\t\tcookiePrefix: undefined, // 'fancytree-<treeId>-' by default\n\t\tcookie: {\n\t\t\traw: false,\n\t\t\texpires: \"\",\n\t\t\tpath: \"\",\n\t\t\tdomain: \"\",\n\t\t\tsecure: false\n\t\t},\n\t\texpandLazy: false,     // true: recursively expand and load lazy nodes\n\t\tfireActivate: true,    // false: suppress `activate` event after active node was restored\n\t\toverrideSource: true,  // true: cookie takes precedence over `source` data attributes.\n\t\tstore: \"auto\",         // 'cookie': force cookie, 'local': force localStore, 'session': force sessionStore\n\t\ttypes: \"active expanded focus selected\"\n\t},\n\n\t/* Generic read/write string data to cookie, sessionStorage or localStorage. */\n\t_data: function(key, value){\n\t\tvar ls = this._local.localStorage; // null, sessionStorage, or localStorage\n\n\t\tif( value === undefined ) {\n\t\t\treturn ls ? ls.getItem(key) : cookieGetter(key);\n\t\t} else if ( value === null ) {\n\t\t\tif( ls ) {\n\t\t\t\tls.removeItem(key);\n\t\t\t} else {\n\t\t\t\tcookieRemover(key);\n\t\t\t}\n\t\t} else {\n\t\t\tif( ls ) {\n\t\t\t\tls.setItem(key, value);\n\t\t\t} else {\n\t\t\t\tcookieSetter(key, value, this.options.persist.cookie);\n\t\t\t}\n\t\t}\n\t},\n\n\t/* Append `key` to a cookie. */\n\t_appendKey: function(type, key, flag){\n\t\tkey = \"\" + key; // #90\n\t\tvar local = this._local,\n\t\t\tinstOpts = this.options.persist,\n\t\t\tdelim = instOpts.cookieDelimiter,\n\t\t\tcookieName = local.cookiePrefix + type,\n\t\t\tdata = local._data(cookieName),\n\t\t\tkeyList = data ? data.split(delim) : [],\n\t\t\tidx = $.inArray(key, keyList);\n\t\t// Remove, even if we add a key,  so the key is always the last entry\n\t\tif(idx >= 0){\n\t\t\tkeyList.splice(idx, 1);\n\t\t}\n\t\t// Append key to cookie\n\t\tif(flag){\n\t\t\tkeyList.push(key);\n\t\t}\n\t\tlocal._data(cookieName, keyList.join(delim));\n\t},\n\n\ttreeInit: function(ctx){\n\t\tvar tree = ctx.tree,\n\t\t\topts = ctx.options,\n\t\t\tlocal = this._local,\n\t\t\tinstOpts = this.options.persist;\n\n\t\t// For 'auto' or 'cookie' mode, the cookie plugin must be available\n\t\t_assert((instOpts.store !== \"auto\" && instOpts.store !== \"cookie\") || cookieGetter,\n\t\t\t\"Missing required plugin for 'persist' extension: js.cookie.js or jquery.cookie.js\");\n\n\t\tlocal.cookiePrefix = instOpts.cookiePrefix || (\"fancytree-\" + tree._id + \"-\");\n\t\tlocal.storeActive = instOpts.types.indexOf(ACTIVE) >= 0;\n\t\tlocal.storeExpanded = instOpts.types.indexOf(EXPANDED) >= 0;\n\t\tlocal.storeSelected = instOpts.types.indexOf(SELECTED) >= 0;\n\t\tlocal.storeFocus = instOpts.types.indexOf(FOCUS) >= 0;\n\t\tif( instOpts.store === \"cookie\" || !window.localStorage ) {\n\t\t\tlocal.localStorage = null;\n\t\t} else {\n\t\t\tlocal.localStorage = (instOpts.store === \"local\") ? window.localStorage : window.sessionStorage;\n\t\t}\n\n\t\t// Bind init-handler to apply cookie state\n\t\ttree.$div.bind(\"fancytreeinit\", function(event){\n\t\t\tif ( tree._triggerTreeEvent(\"beforeRestore\", null, {}) === false ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar cookie, dfd, i, keyList, node,\n\t\t\t\tprevFocus = local._data(local.cookiePrefix + FOCUS), // record this before node.setActive() overrides it;\n\t\t\t\tnoEvents = instOpts.fireActivate === false;\n\n\t\t\t// tree.debug(\"document.cookie:\", document.cookie);\n\n\t\t\tcookie = local._data(local.cookiePrefix + EXPANDED);\n\t\t\tkeyList = cookie && cookie.split(instOpts.cookieDelimiter);\n\n\t\t\tif( local.storeExpanded ) {\n\t\t\t\t// Recursively load nested lazy nodes if expandLazy is 'expand' or 'load'\n\t\t\t\t// Also remove expand-cookies for unmatched nodes\n\t\t\t\tdfd = _loadLazyNodes(tree, local, keyList, instOpts.expandLazy ? \"expand\" : false , null);\n\t\t\t} else {\n\t\t\t\t// nothing to do\n\t\t\t\tdfd = new $.Deferred().resolve();\n\t\t\t}\n\n\t\t\tdfd.done(function(){\n\t\t\t\tif(local.storeSelected){\n\t\t\t\t\tcookie = local._data(local.cookiePrefix + SELECTED);\n\t\t\t\t\tif(cookie){\n\t\t\t\t\t\tkeyList = cookie.split(instOpts.cookieDelimiter);\n\t\t\t\t\t\tfor(i=0; i<keyList.length; i++){\n\t\t\t\t\t\t\tnode = tree.getNodeByKey(keyList[i]);\n\t\t\t\t\t\t\tif(node){\n\t\t\t\t\t\t\t\tif(node.selected === undefined || instOpts.overrideSource && (node.selected === false)){\n//\t\t\t\t\t\t\t\t\tnode.setSelected();\n\t\t\t\t\t\t\t\t\tnode.selected = true;\n\t\t\t\t\t\t\t\t\tnode.renderStatus();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t// node is no longer member of the tree: remove from cookie also\n\t\t\t\t\t\t\t\tlocal._appendKey(SELECTED, keyList[i], false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// In selectMode 3 we have to fix the child nodes, since we\n\t\t\t\t\t// only stored the selected *top* nodes\n\t\t\t\t\tif( tree.options.selectMode === 3 ){\n\t\t\t\t\t\ttree.visit(function(n){\n\t\t\t\t\t\t\tif( n.selected ) {\n\t\t\t\t\t\t\t\tn.fixSelection3AfterClick();\n\t\t\t\t\t\t\t\treturn \"skip\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(local.storeActive){\n\t\t\t\t\tcookie = local._data(local.cookiePrefix + ACTIVE);\n\t\t\t\t\tif(cookie && (opts.persist.overrideSource || !tree.activeNode)){\n\t\t\t\t\t\tnode = tree.getNodeByKey(cookie);\n\t\t\t\t\t\tif(node){\n\t\t\t\t\t\t\tnode.debug(\"persist: set active\", cookie);\n\t\t\t\t\t\t\t// We only want to set the focus if the container\n\t\t\t\t\t\t\t// had the keyboard focus before\n\t\t\t\t\t\t\tnode.setActive(true, {\n\t\t\t\t\t\t\t\tnoFocus: true,\n\t\t\t\t\t\t\t\tnoEvents: noEvents\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(local.storeFocus && prevFocus){\n\t\t\t\t\tnode = tree.getNodeByKey(prevFocus);\n\t\t\t\t\tif(node){\n\t\t\t\t\t\t// node.debug(\"persist: set focus\", cookie);\n\t\t\t\t\t\tif( tree.options.titlesTabbable ) {\n\t\t\t\t\t\t\t$(node.span).find(\".fancytree-title\").focus();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$(tree.$container).focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// node.setFocus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttree._triggerTreeEvent(\"restore\", null, {});\n\t\t\t});\n\t\t});\n\t\t// Init the tree\n\t\treturn this._superApply(arguments);\n\t},\n\tnodeSetActive: function(ctx, flag, opts) {\n\t\tvar res,\n\t\t\tlocal = this._local;\n\n\t\tflag = (flag !== false);\n\t\tres = this._superApply(arguments);\n\n\t\tif(local.storeActive){\n\t\t\tlocal._data(local.cookiePrefix + ACTIVE, this.activeNode ? this.activeNode.key : null);\n\t\t}\n\t\treturn res;\n\t},\n\tnodeSetExpanded: function(ctx, flag, opts) {\n\t\tvar res,\n\t\t\tnode = ctx.node,\n\t\t\tlocal = this._local;\n\n\t\tflag = (flag !== false);\n\t\tres = this._superApply(arguments);\n\n\t\tif(local.storeExpanded){\n\t\t\tlocal._appendKey(EXPANDED, node.key, flag);\n\t\t}\n\t\treturn res;\n\t},\n\tnodeSetFocus: function(ctx, flag) {\n\t\tvar res,\n\t\t\tlocal = this._local;\n\n\t\tflag = (flag !== false);\n\t\tres = this._superApply(arguments);\n\n\t\tif( local.storeFocus ) {\n\t\t\tlocal._data(local.cookiePrefix + FOCUS, this.focusNode ? this.focusNode.key : null);\n\t\t}\n\t\treturn res;\n\t},\n\tnodeSetSelected: function(ctx, flag) {\n\t\tvar res, selNodes,\n\t\t\ttree = ctx.tree,\n\t\t\tnode = ctx.node,\n\t\t\tlocal = this._local;\n\n\t\tflag = (flag !== false);\n\t\tres = this._superApply(arguments);\n\n\t\tif(local.storeSelected){\n\t\t\tif( tree.options.selectMode === 3 ){\n\t\t\t\t// In selectMode 3 we only store the the selected *top* nodes.\n\t\t\t\t// De-selecting a node may also de-select some parents, so we\n\t\t\t\t// calculate the current status again\n\t\t\t\tselNodes = $.map(tree.getSelectedNodes(true), function(n){\n\t\t\t\t\treturn n.key;\n\t\t\t\t});\n\t\t\t\tselNodes = selNodes.join(ctx.options.persist.cookieDelimiter);\n\t\t\t\tlocal._data(local.cookiePrefix + SELECTED, selNodes);\n\t\t\t} else {\n\t\t\t\t// beforeSelect can prevent the change - flag doesn't reflect the node.selected state\n\t\t\t\tlocal._appendKey(SELECTED, node.key, node.selected);\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t}\n});\n}(jQuery, window, document));\n\n/*!\n * jquery.fancytree.table.js\n *\n * Render tree as table (aka 'treegrid', 'tabletree').\n * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)\n *\n * Copyright (c) 2008-2016, Martin Wendt (http://wwWendt.de)\n *\n * Released under the MIT license\n * https://github.com/mar10/fancytree/wiki/LicenseInfo\n *\n * @version 2.18.0\n * @date 2016-05-02T19:34\n */\n\n;(function($, window, document, undefined) {\n\n\"use strict\";\n\n/* *****************************************************************************\n * Private functions and variables\n */\nfunction _assert(cond, msg){\n\tmsg = msg || \"\";\n\tif(!cond){\n\t\t$.error(\"Assertion failed \" + msg);\n\t}\n}\n\nfunction insertSiblingAfter(referenceNode, newNode) {\n\treferenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n}\n\n/* Show/hide all rows that are structural descendants of `parent`. */\nfunction setChildRowVisibility(parent, flag) {\n\tparent.visit(function(node){\n\t\tvar tr = node.tr;\n\t\t// currentFlag = node.hide ? false : flag; // fix for ext-filter\n\t\tif(tr){\n\t\t\ttr.style.display = (node.hide || !flag) ? \"none\" : \"\";\n\t\t}\n\t\tif(!node.expanded){\n\t\t\treturn \"skip\";\n\t\t}\n\t});\n}\n\n/* Find node that is rendered in previous row. */\nfunction findPrevRowNode(node){\n\tvar i, last, prev,\n\t\tparent = node.parent,\n\t\tsiblings = parent ? parent.children : null;\n\n\tif(siblings && siblings.length > 1 && siblings[0] !== node){\n\t\t// use the lowest descendant of the preceeding sibling\n\t\ti = $.inArray(node, siblings);\n\t\tprev = siblings[i - 1];\n\t\t_assert(prev.tr);\n\t\t// descend to lowest child (with a <tr> tag)\n\t\twhile(prev.children){\n\t\t\tlast = prev.children[prev.children.length - 1];\n\t\t\tif(!last.tr){\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tprev = last;\n\t\t}\n\t}else{\n\t\t// if there is no preceding sibling, use the direct parent\n\t\tprev = parent;\n\t}\n\treturn prev;\n}\n\n/* Render callback for 'wide' mode. */\n// function _renderStatusNodeWide(event, data) {\n// \tvar node = data.node,\n// \t\tnodeColumnIdx = data.options.table.nodeColumnIdx,\n// \t\t$tdList = $(node.tr).find(\">td\");\n\n// \t$tdList.eq(nodeColumnIdx).attr(\"colspan\", data.tree.columnCount);\n// \t$tdList.not(\":eq(\" + nodeColumnIdx + \")\").remove();\n// }\n\n\n$.ui.fancytree.registerExtension({\n\tname: \"table\",\n\tversion: \"0.3.0\",\n\t// Default options for this extension.\n\toptions: {\n\t\tcheckboxColumnIdx: null, // render the checkboxes into the this column index (default: nodeColumnIdx)\n\t\t// customStatus: false,\t // true: generate renderColumns events for status nodes\n\t\tindentation: 16,         // indent every node level by 16px\n\t\tnodeColumnIdx: 0         // render node expander, icon, and title to this column (default: #0)\n\t},\n\t// Overide virtual methods for this extension.\n\t// `this`       : is this extension object\n\t// `this._super`: the virtual function that was overriden (member of prev. extension or Fancytree)\n\ttreeInit: function(ctx){\n\t\tvar i, n, $row, $tbody,\n\t\t\ttree = ctx.tree,\n\t\t\topts = ctx.options,\n\t\t\ttableOpts = opts.table,\n\t\t\t$table = tree.widget.element;\n\n\t\tif( tableOpts.customStatus != null ) {\n\t\t\tif( opts.renderStatusColumns != null) {\n\t\t\t\t$.error(\"The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' only instead.\");\n\t\t\t} else {\n\t\t\t\ttree.warn(\"The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' instead.\");\n\t\t\t\topts.renderStatusColumns = tableOpts.customStatus;\n\t\t\t}\n\t\t}\n\t\tif( opts.renderStatusColumns ) {\n\t\t\tif( opts.renderStatusColumns === true ) {\n\t\t\t\topts.renderStatusColumns = opts.renderColumns;\n\t\t\t// } else if( opts.renderStatusColumns === \"wide\" ) {\n\t\t\t// \topts.renderStatusColumns = _renderStatusNodeWide;\n\t\t\t}\n\t\t}\n\n\t\t$table.addClass(\"fancytree-container fancytree-ext-table\");\n\t\ttree.tbody = $table.find(\">tbody\")[0];\n\t\t$tbody = $(tree.tbody);\n\n\t\t// Prepare row templates:\n\t\t// Determine column count from table header if any\n\t\ttree.columnCount = $(\"thead >tr:last >th\", $table).length;\n\t\t// Read TR templates from tbody if any\n\t\t$row = $tbody.children(\"tr:first\");\n\t\tif( $row.length ) {\n\t\t\tn = $row.children(\"td\").length;\n\t\t\tif( tree.columnCount && n !== tree.columnCount ) {\n\t\t\t\ttree.warn(\"Column count mismatch between thead (\" + tree.columnCount + \") and tbody (\" + n + \"); using tbody.\");\n\t\t\t\ttree.columnCount = n;\n\t\t\t}\n\t\t\t$row = $row.clone();\n\t\t} else {\n\t\t\t// Only thead is defined: create default row markup\n\t\t\t_assert(tree.columnCount >= 1, \"Need either <thead> or <tbody> with <td> elements to determine column count.\");\n\t\t\t$row = $(\"<tr />\");\n\t\t\tfor(i=0; i<tree.columnCount; i++) {\n\t\t\t\t$row.append(\"<td />\");\n\t\t\t}\n\t\t}\n\t\t$row.find(\">td\").eq(tableOpts.nodeColumnIdx)\n\t\t\t.html(\"<span class='fancytree-node' />\");\n\t\tif( opts.aria ) {\n\t\t\t$row.attr(\"role\", \"row\");\n\t\t\t$row.find(\"td\").attr(\"role\", \"gridcell\");\n\t\t}\n\t\ttree.rowFragment = document.createDocumentFragment();\n\t\ttree.rowFragment.appendChild($row.get(0));\n\n\t\t// // If tbody contains a second row, use this as status node template\n\t\t// $row = $tbody.children(\"tr:eq(1)\");\n\t\t// if( $row.length === 0 ) {\n\t\t// \ttree.statusRowFragment = tree.rowFragment;\n\t\t// } else {\n\t\t// \t$row = $row.clone();\n\t\t// \ttree.statusRowFragment = document.createDocumentFragment();\n\t\t// \ttree.statusRowFragment.appendChild($row.get(0));\n\t\t// }\n\t\t//\n\t\t$tbody.empty();\n\n\t\t// Make sure that status classes are set on the node's <tr> elements\n\t\ttree.statusClassPropName = \"tr\";\n\t\ttree.ariaPropName = \"tr\";\n\t\tthis.nodeContainerAttrName = \"tr\";\n\n\t\t// #489: make sure $container is set to <table>, even if ext-dnd is listed before ext-table\n\t\ttree.$container = $table;\n\n\t\tthis._superApply(arguments);\n\n\t\t// standard Fancytree created a root UL\n\t\t$(tree.rootNode.ul).remove();\n\t\ttree.rootNode.ul = null;\n\n\t\t// Add container to the TAB chain\n\t\t// #577: Allow to set tabindex to \"0\", \"-1\" and \"\"\n\t\tthis.$container.attr(\"tabindex\", opts.tabindex);\n\t\t// this.$container.attr(\"tabindex\", opts.tabbable ? \"0\" : \"-1\");\n\t\tif(opts.aria) {\n\t\t\ttree.$container\n\t\t\t\t.attr(\"role\", \"treegrid\")\n\t\t\t\t.attr(\"aria-readonly\", true);\n\t\t}\n\t},\n\tnodeRemoveChildMarkup: function(ctx) {\n\t\tvar node = ctx.node;\n//\t\tnode.debug(\"nodeRemoveChildMarkup()\");\n\t\tnode.visit(function(n){\n\t\t\tif(n.tr){\n\t\t\t\t$(n.tr).remove();\n\t\t\t\tn.tr = null;\n\t\t\t}\n\t\t});\n\t},\n\tnodeRemoveMarkup: function(ctx) {\n\t\tvar node = ctx.node;\n//\t\tnode.debug(\"nodeRemoveMarkup()\");\n\t\tif(node.tr){\n\t\t\t$(node.tr).remove();\n\t\t\tnode.tr = null;\n\t\t}\n\t\tthis.nodeRemoveChildMarkup(ctx);\n\t},\n\t/* Override standard render. */\n\tnodeRender: function(ctx, force, deep, collapsed, _recursive) {\n\t\tvar children, firstTr, i, l, newRow, prevNode, prevTr, subCtx,\n\t\t\ttree = ctx.tree,\n\t\t\tnode = ctx.node,\n\t\t\topts = ctx.options,\n\t\t\tisRootNode = !node.parent;\n\n\t\tif( !_recursive ){\n\t\t\tctx.hasCollapsedParents = node.parent && !node.parent.expanded;\n\t\t}\n\t\t// $.ui.fancytree.debug(\"*** nodeRender \" + node + \", isRoot=\" + isRootNode, \"tr=\" + node.tr, \"hcp=\" + ctx.hasCollapsedParents, \"parent.tr=\" + (node.parent && node.parent.tr));\n\t\tif( !isRootNode ){\n\t\t\tif(!node.tr){\n\t\t\t\tif( ctx.hasCollapsedParents && !deep ) {\n\t\t\t\t\t// #166: we assume that the parent will be (recursively) rendered\n\t\t\t\t\t// later anyway.\n\t\t\t\t\tnode.debug(\"nodeRender ignored due to unrendered parent\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// Create new <tr> after previous row\n\t\t\t\t// if( node.isStatusNode() ) {\n\t\t\t\t// \tnewRow = tree.statusRowFragment.firstChild.cloneNode(true);\n\t\t\t\t// } else {\n\t\t\t\tnewRow = tree.rowFragment.firstChild.cloneNode(true);\n\t\t\t\t// }\n\t\t\t\tprevNode = findPrevRowNode(node);\n\t\t\t\t// $.ui.fancytree.debug(\"*** nodeRender \" + node + \": prev: \" + prevNode.key);\n\t\t\t\t_assert(prevNode);\n\t\t\t\tif(collapsed === true && _recursive){\n\t\t\t\t\t// hide all child rows, so we can use an animation to show it later\n\t\t\t\t\tnewRow.style.display = \"none\";\n\t\t\t\t}else if(deep && ctx.hasCollapsedParents){\n\t\t\t\t\t// also hide this row if deep === true but any parent is collapsed\n\t\t\t\t\tnewRow.style.display = \"none\";\n//\t\t\t\t\tnewRow.style.color = \"red\";\n\t\t\t\t}\n\t\t\t\tif(!prevNode.tr){\n\t\t\t\t\t_assert(!prevNode.parent, \"prev. row must have a tr, or is system root\");\n\t\t\t\t\ttree.tbody.appendChild(newRow);\n\t\t\t\t}else{\n\t\t\t\t\tinsertSiblingAfter(prevNode.tr, newRow);\n\t\t\t\t}\n\t\t\t\tnode.tr = newRow;\n\t\t\t\tif( node.key && opts.generateIds ){\n\t\t\t\t\tnode.tr.id = opts.idPrefix + node.key;\n\t\t\t\t}\n\t\t\t\tnode.tr.ftnode = node;\n\t\t\t\tif(opts.aria){\n\t\t\t\t\t// TODO: why doesn't this work:\n//                  node.li.role = \"treeitem\";\n\t\t\t\t\t$(node.tr).attr(\"aria-labelledby\", \"ftal_\" + node.key);\n\t\t\t\t}\n\t\t\t\tnode.span = $(\"span.fancytree-node\", node.tr).get(0);\n\t\t\t\t// Set icon, link, and title (normally this is only required on initial render)\n\t\t\t\tthis.nodeRenderTitle(ctx);\n\t\t\t\t// Allow tweaking, binding, after node was created for the first time\n//\t\t\t\ttree._triggerNodeEvent(\"createNode\", ctx);\n\t\t\t\tif ( opts.createNode ){\n\t\t\t\t\topts.createNode.call(tree, {type: \"createNode\"}, ctx);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif( force ) {\n\t\t\t\t\t// Set icon, link, and title (normally this is only required on initial render)\n\t\t\t\t\tthis.nodeRenderTitle(ctx); // triggers renderColumns()\n\t\t\t\t} else {\n\t\t\t\t\t// Update element classes according to node state\n\t\t\t\t\tthis.nodeRenderStatus(ctx);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// Allow tweaking after node state was rendered\n//\t\ttree._triggerNodeEvent(\"renderNode\", ctx);\n\t\tif ( opts.renderNode ){\n\t\t\topts.renderNode.call(tree, {type: \"renderNode\"}, ctx);\n\t\t}\n\t\t// Visit child nodes\n\t\t// Add child markup\n\t\tchildren = node.children;\n\t\tif(children && (isRootNode || deep || node.expanded)){\n\t\t\tfor(i=0, l=children.length; i<l; i++) {\n\t\t\t\tsubCtx = $.extend({}, ctx, {node: children[i]});\n\t\t\t\tsubCtx.hasCollapsedParents = subCtx.hasCollapsedParents || !node.expanded;\n\t\t\t\tthis.nodeRender(subCtx, force, deep, collapsed, true);\n\t\t\t}\n\t\t}\n\t\t// Make sure, that <tr> order matches node.children order.\n\t\tif(children && !_recursive){ // we only have to do it once, for the root branch\n\t\t\tprevTr = node.tr || null;\n\t\t\tfirstTr = tree.tbody.firstChild;\n\t\t\t// Iterate over all descendants\n\t\t\tnode.visit(function(n){\n\t\t\t\tif(n.tr){\n\t\t\t\t\tif(!n.parent.expanded && n.tr.style.display !== \"none\"){\n\t\t\t\t\t\t// fix after a node was dropped over a collapsed\n\t\t\t\t\t\tn.tr.style.display = \"none\";\n\t\t\t\t\t\tsetChildRowVisibility(n, false);\n\t\t\t\t\t}\n\t\t\t\t\tif(n.tr.previousSibling !== prevTr){\n\t\t\t\t\t\tnode.debug(\"_fixOrder: mismatch at node: \" + n);\n\t\t\t\t\t\tvar nextTr = prevTr ? prevTr.nextSibling : firstTr;\n\t\t\t\t\t\ttree.tbody.insertBefore(n.tr, nextTr);\n\t\t\t\t\t}\n\t\t\t\t\tprevTr = n.tr;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t// Update element classes according to node state\n\t\t// if(!isRootNode){\n\t\t// \tthis.nodeRenderStatus(ctx);\n\t\t// }\n\t},\n\tnodeRenderTitle: function(ctx, title) {\n\t\tvar $cb, res,\n\t\t\tnode = ctx.node,\n\t\t\topts = ctx.options,\n\t\t\tisStatusNode = node.isStatusNode();\n\n\t\tres = this._superApply(arguments);\n\n\t\tif( node.isRootNode() ) {\n\t\t\treturn res;\n\t\t}\n\t\t// Move checkbox to custom column\n\t\tif(opts.checkbox && !isStatusNode && opts.table.checkboxColumnIdx != null ){\n\t\t\t$cb = $(\"span.fancytree-checkbox\", node.span); //.detach();\n\t\t\t$(node.tr).find(\"td\").eq(+opts.table.checkboxColumnIdx).html($cb);\n\t\t}\n\t\t// Update element classes according to node state\n\t\tthis.nodeRenderStatus(ctx);\n\n\t\tif( isStatusNode ) {\n\t\t\tif( opts.renderStatusColumns ) {\n\t\t\t\t// Let user code write column content\n\t\t\t\topts.renderStatusColumns.call(ctx.tree, {type: \"renderStatusColumns\"}, ctx);\n\t\t\t} // else: default rendering for status node: leave other cells empty\n\t\t} else if ( opts.renderColumns ) {\n\t\t\topts.renderColumns.call(ctx.tree, {type: \"renderColumns\"}, ctx);\n\t\t}\n\t\treturn res;\n\t},\n\tnodeRenderStatus: function(ctx) {\n\t\tvar indent,\n\t\t\tnode = ctx.node,\n\t\t\topts = ctx.options;\n\n\t\tthis._superApply(arguments);\n\n\t\t$(node.tr).removeClass(\"fancytree-node\");\n\t\t// indent\n\t\tindent = (node.getLevel() - 1) * opts.table.indentation;\n\t\t$(node.span).css({paddingLeft: indent + \"px\"});  // #460\n\t\t// $(node.span).css({marginLeft: indent + \"px\"});\n\t },\n\t/* Expand node, return Deferred.promise. */\n\tnodeSetExpanded: function(ctx, flag, opts) {\n\t\t// flag defaults to true\n\t\tflag = (flag !== false);\n\n\t\tif((ctx.node.expanded && flag) || (!ctx.node.expanded && !flag)) {\n\t\t\t// Expanded state isn't changed - just call base implementation\n\t\t\treturn this._superApply(arguments);\n\t\t}\n\n\t\tvar dfd = new $.Deferred(),\n\t\t\tsubOpts = $.extend({}, opts, {noEvents: true, noAnimation: true});\n\n\t\topts = opts || {};\n\n\t\tfunction _afterExpand(ok) {\n\t\t\tsetChildRowVisibility(ctx.node, flag);\n\t\t\tif( ok ) {\n\t\t\t\tif( flag && ctx.options.autoScroll && !opts.noAnimation && ctx.node.hasChildren() ) {\n\t\t\t\t\t// Scroll down to last child, but keep current node visible\n\t\t\t\t\tctx.node.getLastChild().scrollIntoView(true, {topNode: ctx.node}).always(function(){\n\t\t\t\t\t\tif( !opts.noEvents ) {\n\t\t\t\t\t\t\tctx.tree._triggerNodeEvent(flag ? \"expand\" : \"collapse\", ctx);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdfd.resolveWith(ctx.node);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tif( !opts.noEvents ) {\n\t\t\t\t\t\tctx.tree._triggerNodeEvent(flag ? \"expand\" : \"collapse\", ctx);\n\t\t\t\t\t}\n\t\t\t\t\tdfd.resolveWith(ctx.node);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif( !opts.noEvents ) {\n\t\t\t\t\tctx.tree._triggerNodeEvent(flag ? \"expand\" : \"collapse\", ctx);\n\t\t\t\t}\n\t\t\t\tdfd.rejectWith(ctx.node);\n\t\t\t}\n\t\t}\n\t\t// Call base-expand with disabled  events and animation\n\t\tthis._super(ctx, flag, subOpts).done(function () {\n\t\t\t_afterExpand(true);\n\t\t}).fail(function () {\n\t\t\t_afterExpand(false);\n\t\t});\n\t\treturn dfd.promise();\n\t},\n\tnodeSetStatus: function(ctx, status, message, details) {\n\t\tif(status === \"ok\"){\n\t\t\tvar node = ctx.node,\n\t\t\t\tfirstChild = ( node.children ? node.children[0] : null );\n\t\t\tif ( firstChild && firstChild.isStatusNode() ) {\n\t\t\t\t$(firstChild.tr).remove();\n\t\t\t}\n\t\t}\n\t\treturn this._superApply(arguments);\n\t},\n\ttreeClear: function(ctx) {\n\t\tthis.nodeRemoveChildMarkup(this._makeHookContext(this.rootNode));\n\t\treturn this._superApply(arguments);\n\t},\n\ttreeDestroy: function(ctx) {\n\t\tthis.$container.find(\"tbody\").empty();\n\t\tthis.$source && this.$source.removeClass(\"ui-helper-hidden\");\n\t}\n\t/*,\n\ttreeSetFocus: function(ctx, flag) {\n//\t        alert(\"treeSetFocus\" + ctx.tree.$container);\n\t\tctx.tree.$container.focus();\n\t\t$.ui.fancytree.focusTree = ctx.tree;\n\t}*/\n});\n}(jQuery, window, document));\n\n/*!\n * jquery.fancytree.themeroller.js\n *\n * Enable jQuery UI ThemeRoller styles.\n * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)\n *\n * @see http://jqueryui.com/themeroller/\n *\n * Copyright (c) 2008-2016, Martin Wendt (http://wwWendt.de)\n *\n * Released under the MIT license\n * https://github.com/mar10/fancytree/wiki/LicenseInfo\n *\n * @version 2.18.0\n * @date 2016-05-02T19:34\n */\n\n;(function($, window, document, undefined) {\n\n\"use strict\";\n\n/*******************************************************************************\n * Extension code\n */\n$.ui.fancytree.registerExtension({\n\tname: \"themeroller\",\n\tversion: \"0.0.1\",\n\t// Default options for this extension.\n\toptions: {\n\t\tactiveClass: \"ui-state-active\",\n\t\tfoccusClass: \"ui-state-focus\",\n\t\thoverClass: \"ui-state-hover\",\n\t\tselectedClass: \"ui-state-highlight\"\n\t},\n\n\ttreeInit: function(ctx){\n\t\tthis._superApply(arguments);\n\t\tvar $el = ctx.widget.element;\n\n\t\tif($el[0].nodeName === \"TABLE\"){\n\t\t\t$el.addClass(\"ui-widget ui-corner-all\");\n\t\t\t$el.find(\">thead tr\").addClass(\"ui-widget-header\");\n\t\t\t$el.find(\">tbody\").addClass(\"ui-widget-conent\");\n\t\t}else{\n\t\t\t$el.addClass(\"ui-widget ui-widget-content ui-corner-all\");\n\t\t}\n\n\t\t$el.delegate(\".fancytree-node\", \"mouseenter mouseleave\", function(event){\n\t\t\tvar node = $.ui.fancytree.getNode(event.target),\n\t\t\t\tflag = (event.type === \"mouseenter\");\n\t\t\tnode.debug(\"hover: \" + flag);\n\t\t\t$(node.tr ? node.tr : node.span).toggleClass(\"ui-state-hover ui-corner-all\", flag);\n\t\t});\n\t},\n\ttreeDestroy: function(ctx){\n\t\tthis._superApply(arguments);\n\t\tctx.widget.element.removeClass(\"ui-widget ui-widget-content ui-corner-all\");\n\t},\n\tnodeRenderStatus: function(ctx){\n\t\tvar node = ctx.node,\n\t\t\t$el = $(node.tr ? node.tr : node.span);\n\t\tthis._superApply(arguments);\n/*\n\t\t.ui-state-highlight: Class to be applied to highlighted or selected elements. Applies \"highlight\" container styles to an element and its child text, links, and icons.\n\t\t.ui-state-error: Class to be applied to error messaging container elements. Applies \"error\" container styles to an element and its child text, links, and icons.\n\t\t.ui-state-error-text: An additional class that applies just the error text color without background. Can be used on form labels for instance. Also applies error icon color to child icons.\n\n\t\t.ui-state-default: Class to be applied to clickable button-like elements. Applies \"clickable default\" container styles to an element and its child text, links, and icons.\n\t\t.ui-state-hover: Class to be applied on mouseover to clickable button-like elements. Applies \"clickable hover\" container styles to an element and its child text, links, and icons.\n\t\t.ui-state-focus: Class to be applied on keyboard focus to clickable button-like elements. Applies \"clickable hover\" container styles to an element and its child text, links, and icons.\n\t\t.ui-state-active: Class to be applied on mousedown to clickable button-like elements. Applies \"clickable active\" container styles to an element and its child text, links, and icons.\n*/\n\t\t$el.toggleClass(\"ui-state-active\", node.isActive());\n\t\t$el.toggleClass(\"ui-state-focus\", node.hasFocus());\n\t\t$el.toggleClass(\"ui-state-highlight\", node.isSelected());\n\t}\n});\n}(jQuery, window, document));\n\n/*!\n * jquery.fancytree.wide.js\n * Support for 100% wide selection bars.\n * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)\n *\n * Copyright (c) 2008-2016, Martin Wendt (http://wwWendt.de)\n *\n * Released under the MIT license\n * https://github.com/mar10/fancytree/wiki/LicenseInfo\n *\n * @version 2.18.0\n * @date 2016-05-02T19:34\n */\n\n;(function($, window, document, undefined) {\n\n\"use strict\";\n\nvar reNumUnit = /^([+-]?(?:\\d+|\\d*\\.\\d+))([a-z]*|%)$/; // split \"1.5em\" to [\"1.5\", \"em\"]\n\n/*******************************************************************************\n * Private functions and variables\n */\n// var _assert = $.ui.fancytree.assert;\n\n/* Calculate inner width without scrollbar */\n// function realInnerWidth($el) {\n// \t// http://blog.jquery.com/2012/08/16/jquery-1-8-box-sizing-width-csswidth-and-outerwidth/\n// //\tinst.contWidth = parseFloat(this.$container.css(\"width\"), 10);\n// \t// 'Client width without scrollbar' - 'padding'\n// \treturn $el[0].clientWidth - ($el.innerWidth() -  parseFloat($el.css(\"width\"), 10));\n// }\n\n/* Create a global embedded CSS style for the tree. */\nfunction defineHeadStyleElement(id, cssText) {\n\tid = \"fancytree-style-\" + id;\n\tvar $headStyle = $(\"#\" + id);\n\n\tif( !cssText ) {\n\t\t$headStyle.remove();\n\t\treturn null;\n\t}\n\tif( !$headStyle.length ) {\n\t\t$headStyle = $(\"<style />\")\n\t\t\t.attr(\"id\", id)\n\t\t\t.addClass(\"fancytree-style\")\n\t\t\t.prop(\"type\", \"text/css\")\n\t\t\t.appendTo(\"head\");\n\t}\n\ttry {\n\t\t$headStyle.html(cssText);\n\t} catch ( e ) {\n\t\t// fix for IE 6-8\n\t\t$headStyle[0].styleSheet.cssText = cssText;\n\t}\n\treturn $headStyle;\n}\n\n/* Calculate the CSS rules that indent title spans. */\nfunction renderLevelCss(containerId, depth, levelOfs, lineOfs, measureUnit) {\n\tvar i,\n\t\tprefix = \"#\" + containerId + \" span.fancytree-level-\",\n\t\trules = [];\n\n\tfor(i = 0; i < depth; i++) {\n\t\trules.push(prefix + (i + 1) + \" span.fancytree-title { padding-left: \" +\n\t\t\t(i * levelOfs + lineOfs) + measureUnit + \"; }\");\n\t}\n\t// Some UI animations wrap the UL inside a DIV and set position:relative on both.\n\t// This breaks the left:0 and padding-left:nn settings of the title\n\trules.push(\"#\" + containerId +\n\t\t\" div.ui-effects-wrapper ul li span.fancytree-title \" +\n\t\t\"{ padding-left: 3px; position: static; width: auto; }\");\n\treturn rules.join(\"\\n\");\n}\n\n\n// /**\n//  * [ext-wide] Recalculate the width of the selection bar after the tree container\n//  * was resized.<br>\n//  * May be called explicitly on container resize, since there is no resize event\n//  * for DIV tags.\n//  *\n//  * @alias Fancytree#wideUpdate\n//  * @requires jquery.fancytree.wide.js\n//  */\n// $.ui.fancytree._FancytreeClass.prototype.wideUpdate = function(){\n// \tvar inst = this.ext.wide,\n// \t\tprevCw = inst.contWidth,\n// \t\tprevLo = inst.lineOfs;\n\n// \tinst.contWidth = realInnerWidth(this.$container);\n// \t// Each title is precceeded by 2 or 3 icons (16px + 3 margin)\n// \t//     + 1px title border and 3px title padding\n// \t// TODO: use code from treeInit() below\n// \tinst.lineOfs = (this.options.checkbox ? 3 : 2) * 19;\n// \tif( prevCw !== inst.contWidth || prevLo !== inst.lineOfs ) {\n// \t\tthis.debug(\"wideUpdate: \" + inst.contWidth);\n// \t\tthis.visit(function(node){\n// \t\t\tnode.tree._callHook(\"nodeRenderTitle\", node);\n// \t\t});\n// \t}\n// };\n\n/*******************************************************************************\n * Extension code\n */\n$.ui.fancytree.registerExtension({\n\tname: \"wide\",\n\tversion: \"0.0.3\",\n\t// Default options for this extension.\n\toptions: {\n\t\ticonWidth: null,  // Adjust this if @fancy-icon-width != \"16px\"\n\t\ticonSpacing: null, // Adjust this if @fancy-icon-spacing != \"3px\"\n\t\tlevelOfs: null    // Adjust this if ul padding != \"16px\"\n\t},\n\n\ttreeCreate: function(ctx){\n\t\tthis._superApply(arguments);\n\t\tthis.$container.addClass(\"fancytree-ext-wide\");\n\n\t\tvar containerId, cssText, iconSpacingUnit, iconWidthUnit, levelOfsUnit,\n\t\t\tinstOpts = ctx.options.wide,\n\t\t\t// css sniffing\n\t\t\t$dummyLI = $(\"<li id='fancytreeTemp'><span class='fancytree-node'><span class='fancytree-icon' /><span class='fancytree-title' /></span><ul />\")\n\t\t\t\t.appendTo(ctx.tree.$container),\n\t\t\t$dummyIcon = $dummyLI.find(\".fancytree-icon\"),\n\t\t\t$dummyUL = $dummyLI.find(\"ul\"),\n\t\t\t// $dummyTitle = $dummyLI.find(\".fancytree-title\"),\n\t\t\ticonSpacing = instOpts.iconSpacing || $dummyIcon.css(\"margin-left\"),\n\t\t\ticonWidth = instOpts.iconWidth || $dummyIcon.css(\"width\"),\n\t\t\tlevelOfs = instOpts.levelOfs || $dummyUL.css(\"padding-left\");\n\n\t\t$dummyLI.remove();\n\n\t\ticonSpacingUnit = iconSpacing.match(reNumUnit)[2];\n\t\ticonSpacing = parseFloat(iconSpacing, 10);\n\t\ticonWidthUnit = iconWidth.match(reNumUnit)[2];\n\t\ticonWidth = parseFloat(iconWidth, 10);\n\t\tlevelOfsUnit = levelOfs.match(reNumUnit)[2];\n\t\tif( iconSpacingUnit !== iconWidthUnit || levelOfsUnit !== iconWidthUnit ) {\n\t\t\t$.error(\"iconWidth, iconSpacing, and levelOfs must have the same css measure unit\");\n\t\t}\n\t\tthis._local.measureUnit = iconWidthUnit;\n\t\tthis._local.levelOfs = parseFloat(levelOfs);\n\t\tthis._local.lineOfs = (1 + (ctx.options.checkbox ? 1 : 0) + (ctx.options.icon === false ? 0 : 1)) * (iconWidth + iconSpacing) + iconSpacing;\n\t\tthis._local.maxDepth = 10;\n\n\t\t// Get/Set a unique Id on the container (if not already exists)\n\t\tcontainerId = this.$container.uniqueId().attr(\"id\");\n\t\t// Generated css rules for some levels (extended on demand)\n\t\tcssText = renderLevelCss(containerId, this._local.maxDepth,\n\t\t\tthis._local.levelOfs, this._local.lineOfs, this._local.measureUnit);\n\t\tdefineHeadStyleElement(containerId, cssText);\n\t},\n\ttreeDestroy: function(ctx){\n\t\t// Remove generated css rules\n\t\tdefineHeadStyleElement(this.$container.attr(\"id\"), null);\n\t\treturn this._superApply(arguments);\n\t},\n\tnodeRenderStatus: function(ctx) {\n\t\tvar containerId, cssText, res,\n\t\t\tnode = ctx.node,\n\t\t\tlevel = node.getLevel();\n\n\t\tres = this._superApply(arguments);\n\t\t// Generate some more level-n rules if required\n\t\tif( level > this._local.maxDepth ) {\n\t\t\tcontainerId = this.$container.attr(\"id\");\n\t\t\tthis._local.maxDepth *= 2;\n\t\t\tnode.debug(\"Define global ext-wide css up to level \" + this._local.maxDepth);\n\t\t\tcssText = renderLevelCss(containerId, this._local.maxDepth,\n\t\t\t\tthis._local.levelOfs, this._local.lineOfs, this._local.measureUnit);\n\t\t\tdefineHeadStyleElement(containerId, cssText);\n\t\t}\n\t\t// Add level-n class to apply indentation padding.\n\t\t// (Setting element style would not work, since it cannot easily be\n\t\t// overriden while animations run)\n\t\t$(node.span).addClass(\"fancytree-level-\" + level);\n\t\treturn res;\n\t}\n});\n}(jQuery, window, document));\n"]}